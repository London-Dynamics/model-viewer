!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ModelViewerElement={},e.three)}(this,(function(e,t){"use strict";
/**
     * @license
     * Copyright 2019 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */const i=globalThis,s=i.ShadowRoot&&(void 0===i.ShadyCSS||i.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,n=Symbol(),a=new WeakMap;let r=class{constructor(e,t,i){if(this._$cssResult$=!0,i!==n)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(s&&void 0===e){const i=void 0!==t&&1===t.length;i&&(e=a.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&a.set(t,e))}return e}toString(){return this.cssText}};const o=s?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new r("string"==typeof e?e:e+"",void 0,n))(t)})(e):e,{is:l,defineProperty:A,getOwnPropertyDescriptor:c,getOwnPropertyNames:h,getOwnPropertySymbols:u,getPrototypeOf:d}=Object,p=globalThis,g=p.trustedTypes,m=g?g.emptyScript:"",f=p.reactiveElementPolyfillSupport,b=(e,t)=>e,y={toAttribute(e,t){switch(t){case Boolean:e=e?m:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},C=(e,t)=>!l(e,t),I={attribute:!0,type:String,converter:y,reflect:!1,useDefault:!1,hasChanged:C};
/**
     * @license
     * Copyright 2017 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */Symbol.metadata??=Symbol("metadata"),p.litPropertyMetadata??=new WeakMap;let E=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=I){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const i=Symbol(),s=this.getPropertyDescriptor(e,i,t);void 0!==s&&A(this.prototype,e,s)}}static getPropertyDescriptor(e,t,i){const{get:s,set:n}=c(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:s,set(t){const a=s?.call(this);n?.call(this,t),this.requestUpdate(e,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??I}static _$Ei(){if(this.hasOwnProperty(b("elementProperties")))return;const e=d(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(b("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(b("properties"))){const e=this.properties,t=[...h(e),...u(e)];for(const i of t)this.createProperty(i,e[i])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,i]of t)this.elementProperties.set(e,i)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const i=this._$Eu(e,t);void 0!==i&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(o(e))}else void 0!==e&&t.push(o(e));return t}static _$Eu(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(s)e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet));else for(const s of t){const t=document.createElement("style"),n=i.litNonce;void 0!==n&&t.setAttribute("nonce",n),t.textContent=s.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$ET(e,t){const i=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,i);if(void 0!==s&&!0===i.reflect){const n=(void 0!==i.converter?.toAttribute?i.converter:y).toAttribute(t,i.type);this._$Em=e,null==n?this.removeAttribute(s):this.setAttribute(s,n),this._$Em=null}}_$AK(e,t){const i=this.constructor,s=i._$Eh.get(e);if(void 0!==s&&this._$Em!==s){const e=i.getPropertyOptions(s),n="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:y;this._$Em=s,this[s]=n.fromAttribute(t,e.type)??this._$Ej?.get(s)??null,this._$Em=null}}requestUpdate(e,t,i){if(void 0!==e){const s=this.constructor,n=this[e];if(i??=s.getPropertyOptions(e),!((i.hasChanged??C)(n,t)||i.useDefault&&i.reflect&&n===this._$Ej?.get(e)&&!this.hasAttribute(s._$Eu(e,i))))return;this.C(e,t,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:i,reflect:s,wrapped:n},a){i&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,a??t??this[e]),!0!==n||void 0!==a)||(this._$AL.has(e)||(this.hasUpdated||i||(t=void 0),this._$AL.set(e,t)),!0===s&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,i]of e){const{wrapped:e}=i,s=this[t];!0!==e||this._$AL.has(t)||void 0===s||this.C(t,void 0,i,s)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach((e=>e.hostUpdate?.())),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach((e=>e.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach((e=>this._$ET(e,this[e]))),this._$EM()}updated(e){}firstUpdated(e){}};E.elementStyles=[],E.shadowRootOptions={mode:"open"},E[b("elementProperties")]=new Map,E[b("finalized")]=new Map,f?.({ReactiveElement:E}),(p.reactiveElementVersions??=[]).push("2.1.0");
/**
     * @license
     * Copyright 2017 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */
const w={attribute:!0,type:String,converter:y,reflect:!1,hasChanged:C},B=(e=w,t,i)=>{const{kind:s,metadata:n}=i;let a=globalThis.litPropertyMetadata.get(n);if(void 0===a&&globalThis.litPropertyMetadata.set(n,a=new Map),"setter"===s&&((e=Object.create(e)).wrapped=!0),a.set(i.name,e),"accessor"===s){const{name:s}=i;return{set(i){const n=t.get.call(this);t.set.call(this,i),this.requestUpdate(s,n,e)},init(t){return void 0!==t&&this.C(s,void 0,e,t),t}}}if("setter"===s){const{name:s}=i;return function(i){const n=this[s];t.call(this,i),this.requestUpdate(s,n,e)}}throw Error("Unsupported decorator location: "+s)};function v(e){return(t,i)=>"object"==typeof i?B(e,t,i):((e,t,i)=>{const s=t.hasOwnProperty(i);return t.constructor.createProperty(i,e),s?Object.getOwnPropertyDescriptor(t,i):void 0})(e,t,i)}
/**
     * @license
     * Copyright 2017 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */const x=globalThis,S=x.trustedTypes,Q=S?S.createPolicy("lit-html",{createHTML:e=>e}):void 0,M="$lit$",T=`lit$${Math.random().toFixed(9).slice(2)}$`,R="?"+T,D=`<${R}>`,k=document,F=()=>k.createComment(""),L=e=>null===e||"object"!=typeof e&&"function"!=typeof e,_=Array.isArray,P="[ \t\n\f\r]",O=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,G=/-->/g,U=/>/g,N=RegExp(`>|${P}(?:([^\\s"'>=/]+)(${P}*=${P}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),j=/'/g,H=/"/g,z=/^(?:script|style|textarea|title)$/i,q=(e=>(t,...i)=>({_$litType$:e,strings:t,values:i}))(1),V=Symbol.for("lit-noChange"),K=Symbol.for("lit-nothing"),W=new WeakMap,J=k.createTreeWalker(k,129);function Y(e,t){if(!_(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==Q?Q.createHTML(t):t}const X=(e,t)=>{const i=e.length-1,s=[];let n,a=2===t?"<svg>":3===t?"<math>":"",r=O;for(let t=0;t<i;t++){const i=e[t];let o,l,A=-1,c=0;for(;c<i.length&&(r.lastIndex=c,l=r.exec(i),null!==l);)c=r.lastIndex,r===O?"!--"===l[1]?r=G:void 0!==l[1]?r=U:void 0!==l[2]?(z.test(l[2])&&(n=RegExp("</"+l[2],"g")),r=N):void 0!==l[3]&&(r=N):r===N?">"===l[0]?(r=n??O,A=-1):void 0===l[1]?A=-2:(A=r.lastIndex-l[2].length,o=l[1],r=void 0===l[3]?N:'"'===l[3]?H:j):r===H||r===j?r=N:r===G||r===U?r=O:(r=N,n=void 0);const h=r===N&&e[t+1].startsWith("/>")?" ":"";a+=r===O?i+D:A>=0?(s.push(o),i.slice(0,A)+M+i.slice(A)+T+h):i+T+(-2===A?t:h)}return[Y(e,a+(e[i]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),s]};class ${constructor({strings:e,_$litType$:t},i){let s;this.parts=[];let n=0,a=0;const r=e.length-1,o=this.parts,[l,A]=X(e,t);if(this.el=$.createElement(l,i),J.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(s=J.nextNode())&&o.length<r;){if(1===s.nodeType){if(s.hasAttributes())for(const e of s.getAttributeNames())if(e.endsWith(M)){const t=A[a++],i=s.getAttribute(e).split(T),r=/([.?@])?(.*)/.exec(t);o.push({type:1,index:n,name:r[2],strings:i,ctor:"."===r[1]?se:"?"===r[1]?ne:"@"===r[1]?ae:ie}),s.removeAttribute(e)}else e.startsWith(T)&&(o.push({type:6,index:n}),s.removeAttribute(e));if(z.test(s.tagName)){const e=s.textContent.split(T),t=e.length-1;if(t>0){s.textContent=S?S.emptyScript:"";for(let i=0;i<t;i++)s.append(e[i],F()),J.nextNode(),o.push({type:2,index:++n});s.append(e[t],F())}}}else if(8===s.nodeType)if(s.data===R)o.push({type:2,index:n});else{let e=-1;for(;-1!==(e=s.data.indexOf(T,e+1));)o.push({type:7,index:n}),e+=T.length-1}n++}}static createElement(e,t){const i=k.createElement("template");return i.innerHTML=e,i}}function Z(e,t,i=e,s){if(t===V)return t;let n=void 0!==s?i._$Co?.[s]:i._$Cl;const a=L(t)?void 0:t._$litDirective$;return n?.constructor!==a&&(n?._$AO?.(!1),void 0===a?n=void 0:(n=new a(e),n._$AT(e,i,s)),void 0!==s?(i._$Co??=[])[s]=n:i._$Cl=n),void 0!==n&&(t=Z(e,n._$AS(e,t.values),n,s)),t}class ee{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,s=(e?.creationScope??k).importNode(t,!0);J.currentNode=s;let n=J.nextNode(),a=0,r=0,o=i[0];for(;void 0!==o;){if(a===o.index){let t;2===o.type?t=new te(n,n.nextSibling,this,e):1===o.type?t=new o.ctor(n,o.name,o.strings,this,e):6===o.type&&(t=new re(n,this,e)),this._$AV.push(t),o=i[++r]}a!==o?.index&&(n=J.nextNode(),a++)}return J.currentNode=k,s}p(e){let t=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}let te=class e{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,i,s){this.type=2,this._$AH=K,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Z(this,e,t),L(e)?e===K||null==e||""===e?(this._$AH!==K&&this._$AR(),this._$AH=K):e!==this._$AH&&e!==V&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>_(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==K&&L(this._$AH)?this._$AA.nextSibling.data=e:this.T(k.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:i}=e,s="number"==typeof i?this._$AC(e):(void 0===i.el&&(i.el=$.createElement(Y(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===s)this._$AH.p(t);else{const e=new ee(s,this),i=e.u(this.options);e.p(t),this.T(i),this._$AH=e}}_$AC(e){let t=W.get(e.strings);return void 0===t&&W.set(e.strings,t=new $(e)),t}k(t){_(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let s,n=0;for(const a of t)n===i.length?i.push(s=new e(this.O(F()),this.O(F()),this,this.options)):s=i[n],s._$AI(a),n++;n<i.length&&(this._$AR(s&&s._$AB.nextSibling,n),i.length=n)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}};class ie{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,s,n){this.type=1,this._$AH=K,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=n,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=K}_$AI(e,t=this,i,s){const n=this.strings;let a=!1;if(void 0===n)e=Z(this,e,t,0),a=!L(e)||e!==this._$AH&&e!==V,a&&(this._$AH=e);else{const s=e;let r,o;for(e=n[0],r=0;r<n.length-1;r++)o=Z(this,s[i+r],t,r),o===V&&(o=this._$AH[r]),a||=!L(o)||o!==this._$AH[r],o===K?e=K:e!==K&&(e+=(o??"")+n[r+1]),this._$AH[r]=o}a&&!s&&this.j(e)}j(e){e===K?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class se extends ie{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===K?void 0:e}}let ne=class extends ie{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==K)}};class ae extends ie{constructor(e,t,i,s,n){super(e,t,i,s,n),this.type=5}_$AI(e,t=this){if((e=Z(this,e,t,0)??K)===V)return;const i=this._$AH,s=e===K&&i!==K||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,n=e!==K&&(i===K||s);s&&this.element.removeEventListener(this.name,this,i),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class re{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Z(this,e)}}const oe=x.litHtmlPolyfillSupport;oe?.($,te),(x.litHtmlVersions??=[]).push("3.3.0");const le=(e,t,i)=>{const s=i?.renderBefore??t;let n=s._$litPart$;if(void 0===n){const e=i?.renderBefore??null;s._$litPart$=n=new te(t.insertBefore(F(),e),e,void 0,i??{})}return n._$AI(e),n
/**
     * @license
     * Copyright 2017 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */},Ae=globalThis;let ce=class extends E{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=le(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return V}};ce._$litElement$=!0,ce.finalized=!0,Ae.litElementHydrateSupport?.({LitElement:ce});const he=Ae.litElementPolyfillSupport;he?.({LitElement:ce}),(Ae.litElementVersions??=[]).push("4.2.0");
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const ue=null!=navigator.xr&&null!=self.XRSession&&null!=navigator.xr.isSessionSupported,de=ue&&null!=self.XRSession.prototype.requestHitTestSource,pe=null!=self.ResizeObserver,ge=null!=self.IntersectionObserver,me=de;(()=>{const e=navigator.userAgent||navigator.vendor||self.opera;let t=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)})();const fe=/android/i.test(navigator.userAgent),be=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,ye=/firefox/i.test(navigator.userAgent),Ce=/OculusBrowser/.test(navigator.userAgent),Ie=fe&&!ye&&!Ce,Ee=Boolean(window.webkit&&window.webkit.messageHandlers),we=(()=>{if(be){if(Ee)return Boolean(/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent));{const e=document.createElement("a");return Boolean(e.relList&&e.relList.supports&&e.relList.supports("ar"))}}return!1})(),Be=e=>e&&"null"!==e?xe(e):null,ve=()=>{if(me)return;const e=[];throw ue||e.push("WebXR Device API"),de||e.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${e.join(", ")}`)},xe=e=>new URL(e,window.location.toString()).toString(),Se=(e,t)=>{let i=null;const s=(...s)=>{null==i&&(e(...s),i=self.setTimeout((()=>i=null),t))};return s.flush=()=>{null!=i&&(self.clearTimeout(i),i=null)},s},Qe=(e,t)=>{let i=null;return(...s)=>{null!=i&&self.clearTimeout(i),i=self.setTimeout((()=>{i=null,e(...s)}),t)}},Me=(e,t,i)=>Math.max(t,Math.min(i,e)),Te=(()=>{const e=new RegExp("[?&]model-viewer-debug-mode(&|$)");return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(e)})();
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var Re=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const De=Symbol("currentEnvironmentMap"),ke=Symbol("currentBackground"),Fe=Symbol("updateEnvironment"),Le=Symbol("cancelEnvironmentUpdate");
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const _e=q` <style>
       :host {
         display: block;
         position: relative;
         contain: strict;
         width: 300px;
         height: 150px;
       }

       .container {
         position: relative;
         overflow: hidden;
       }

       .userInput {
         width: 100%;
         height: 100%;
         display: none;
         position: relative;
         outline-offset: -1px;
         outline-width: 1px;
       }

       canvas {
         position: absolute;
         display: none;
         pointer-events: none;
         /* NOTE(cdata): Chrome 76 and below apparently have a bug
      * that causes our canvas not to display pixels unless it is
      * on its own render layer
      * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
      */
         transform: translateZ(0);
       }

       .show {
         display: block;
       }

       /* Adapted from HTML5 Boilerplate
    *
    * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
       .screen-reader-only {
         border: 0;
         left: 0;
         top: 0;
         clip: rect(0, 0, 0, 0);
         height: 1px;
         margin: -1px;
         overflow: hidden;
         padding: 0;
         position: absolute;
         white-space: nowrap;
         width: 1px;
         pointer-events: none;
       }

       .slot {
         position: absolute;
         pointer-events: none;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
       }

       .slot > * {
         pointer-events: initial;
       }

       .annotation-wrapper ::slotted(*) {
         opacity: var(--max-hotspot-opacity, 1);
         transition: opacity 0.3s;
       }

       .pointer-tumbling .annotation-wrapper ::slotted(*) {
         pointer-events: none;
       }

       .annotation-wrapper ::slotted(*) {
         pointer-events: initial;
       }

       .annotation-wrapper.hide ::slotted(*) {
         opacity: var(--min-hotspot-opacity, 0.25);
       }

       .slot.poster {
         display: none;
         background-color: inherit;
       }

       .slot.poster.show {
         display: inherit;
       }

       .slot.poster > * {
         pointer-events: initial;
       }

       .slot.poster:not(.show) > * {
         pointer-events: none;
       }

       #default-poster {
         width: 100%;
         height: 100%;
         /* The default poster is a <button> so we need to set display
      * to prevent it from being affected by text-align: */
         display: block;
         position: absolute;
         border: none;
         padding: 0;
         background-size: contain;
         background-repeat: no-repeat;
         background-position: center;
         background-color: #fff0;
       }

       #default-progress-bar {
         display: block;
         position: relative;
         width: 100%;
         height: 100%;
         pointer-events: none;
         overflow: hidden;
       }

       #default-progress-bar > .bar {
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: var(--progress-bar-height, 5px);
         background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
         transition: transform 0.09s;
         transform-origin: top left;
         transform: scaleX(0);
         overflow: hidden;
       }

       #default-progress-bar > .bar.hide {
         transition: opacity 0.3s 1s;
         opacity: 0;
       }

       .centered {
         align-items: center;
         justify-content: center;
       }

       .cover {
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         pointer-events: none;
       }

       .slot.interaction-prompt {
         display: var(--interaction-prompt-display, flex);
         overflow: hidden;
         opacity: 0;
         will-change: opacity;
         transition: opacity 0.3s;
       }

       .slot.interaction-prompt.visible {
         opacity: 1;
       }

       .animated-container {
         will-change: transform, opacity;
         opacity: 0;
         transition: opacity 0.3s;
       }

       .slot.interaction-prompt > * {
         pointer-events: none;
       }

       .slot.ar-button {
         -moz-user-select: none;
         -webkit-tap-highlight-color: transparent;
         user-select: none;

         display: var(--ar-button-display, block);
       }

       .slot.ar-button:not(.enabled) {
         display: none;
       }

       .fab {
         display: flex;
         align-items: center;
         justify-content: center;
         box-sizing: border-box;
         width: 40px;
         height: 40px;
         cursor: pointer;
         background-color: #fff;
         box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
         border-radius: 100px;
       }

       .fab > * {
         opacity: 0.87;
       }

       #default-ar-button {
         position: absolute;
         bottom: 16px;
         right: 16px;
         transform: scale(var(--ar-button-scale, 1));
         transform-origin: bottom right;
       }

       .slot.pan-target {
         display: block;
         position: absolute;
         width: 0;
         height: 0;
         left: 50%;
         top: 50%;
         transform: translate3d(-50%, -50%, 0);
         background-color: transparent;
         opacity: 0;
         transition: opacity 0.3s;
       }

       #default-pan-target {
         width: 6px;
         height: 6px;
         border-radius: 6px;
         border: 1px solid white;
         box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
       }

       .slot.default {
         pointer-events: none;
       }

       .slot.progress-bar {
         pointer-events: none;
       }

       .slot.exit-webxr-ar-button {
         pointer-events: none;
       }

       .slot.exit-webxr-ar-button:not(.enabled) {
         display: none;
       }

       .ld-measure .ruler {
         position: absolute;
         font-size: 0.8rem;
         background-color: #fefefe;
         padding: 0.1rem 0.5rem;
         border-radius: 1rem;
         white-space: nowrap;
       }

       /* Hide the ld-puzzler slot template content by default */
       .slot.ld-puzzler > slot {
         display: none;
       }

       /* LD Puzzler Styles */
       .ld-puzzler .ld-snapping-point {
         pointer-events: none;
       }

       .ld-puzzler .back-facing .ld-snapping-point {
          opacity: 0.4;
       }

       .ld-puzzler .ld-floating-control-strip {
         pointer-events: auto;
         position: absolute;
         z-index: 100;
       }

       .ld-puzzler .ld-rotation-control {

       }

       .ld-puzzler .ld-break-link {

        pointer-events: auto;

       }

       .ld-puzzler .default-icon {
         font-size: 16px;
         line-height: 1;
         font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
         sans-serif;
        }
  </style>
  <div class="container">
    <div class="userInput" tabindex="0" role="img" aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>
    </div>

    <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
    <div class="slot poster">
      <slot name="poster">
        <button
          type="button"
          id="default-poster"
          aria-hidden="true"
          aria-label="Loading 3D model"
        ></button>
      </slot>
    </div>

    <div class="slot ar-button">
      <slot name="ar-button">
        <a
          id="default-ar-button"
          part="default-ar-button"
          class="fab"
          tabindex="2"
          role="button"
          href="javascript:void(0);"
          aria-label="View in your space"
        >
          ${q`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`}
        </a>
      </slot>
    </div>

    <div class="slot pan-target">
      <slot name="pan-target">
        <div id="default-pan-target"></div>
      </slot>
    </div>

    <div class="slot interaction-prompt cover centered">
      <div id="prompt" class="animated-container">
        <slot name="interaction-prompt" aria-hidden="true">
          ${q`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}
        </slot>
      </div>
    </div>

    <div id="finger0" class="animated-container cover">
      <slot name="finger0" aria-hidden="true"> </slot>
    </div>
    <div id="finger1" class="animated-container cover">
      <slot name="finger1" aria-hidden="true"> </slot>
    </div>

    <div class="slot ld-measure">
      <slot name="ruler-width">
        <div class="ruler" id="default-ruler-width" aria-hidden="true"></div>
      </slot>
      <slot name="ruler-height">
        <div class="ruler" id="default-ruler-height" aria-hidden="true"></div>
      </slot>
      <slot name="ruler-depth">
        <div class="ruler" id="default-ruler-depth" aria-hidden="true"></div>
      </slot>
    </div>

    <div class="slot ld-puzzler">
      <slot name="snapping-point">
        <div
          class="ld-snapping-point"
          part="ld-snapping-point"
          aria-hidden="true"
        ></div>
      </slot>
      <slot name="floating-control-strip">
        <div
          class="ld-floating-control-strip"
          part="ld-floating-control-strip"
          aria-hidden="true"
        ></div>
      </slot>
      <slot name="rotation-left">
        <div
          class="ld-rotation-control"
          part="ld-rotation-control ld-rotation-left"
          aria-hidden="true"
        >
          <div class="default-icon" part="ld-rotation-icon">↺</div>
        </div>
      </slot>
      <slot name="rotation-right">
        <div
          class="ld-rotation-control"
          part="ld-rotation-control ld-rotation-right"
          aria-hidden="true"
        >
          <div class="default-icon" part="ld-rotation-icon">↻</div>
        </div>
      </slot>
      <slot name="break-link">
        <div class="ld-break-link" part="ld-break-link" aria-hidden="true">
          <div class="default-icon" part="ld-break-link-icon">✖</div>
        </div>
      </slot>
    </div>

    <div class="slot default">
      <slot></slot>

      <div class="slot progress-bar">
        <slot name="progress-bar">
          <div id="default-progress-bar" aria-hidden="true">
            <div class="bar" part="default-progress-bar"></div>
          </div>
        </slot>
      </div>

      <div class="slot exit-webxr-ar-button">
        <slot name="exit-webxr-ar-button">
          <a
            id="default-exit-webxr-ar-button"
            part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true"
          >
            ${q`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}
          </a>
        </slot>
      </div>
    </div>
  </div>
  <div class="screen-reader-only" role="region" aria-label="Live announcements">
    <span id="status" role="status"></span>
  </div>`;var Pe=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var i,s=WebAssembly.validate(e)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",n=WebAssembly.instantiate(a(s),{}).then((function(e){(i=e.instance).exports.__wasm_call_ctors()}));function a(e){for(var i=new Uint8Array(e.length),s=0;s<e.length;++s){var n=e.charCodeAt(s);i[s]=n>96?n-97:n>64?n-39:n+4}var a=0;for(s=0;s<e.length;++s)i[a++]=i[s]<60?t[i[s]]:64*(i[s]-60)+i[++s];return i.buffer.slice(0,a)}function r(e,t,s,n,a,r){var o=i.exports.sbrk,l=s+3&-4,A=o(l*n),c=o(a.length),h=new Uint8Array(i.exports.memory.buffer);h.set(a,c);var u=e(A,s,n,c,a.length);if(0==u&&r&&r(A,l,n),t.set(h.subarray(A,A+s*n)),o(A-o(0)),0!=u)throw new Error("Malformed buffer data: "+u)}var o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},A=[],c=0;function h(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var i=e.data;t.pending-=i.count,t.requests[i.id][i.action](i.value),delete t.requests[i.id]},t}function u(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(s))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+r.toString()+d.toString(),i=new Blob([t],{type:"text/javascript"}),n=URL.createObjectURL(i),o=0;o<e;++o)A[o]=h(n);URL.revokeObjectURL(n)}function d(e){n.then((function(){var t=e.data;try{var s=new Uint8Array(t.count*t.size);r(i.exports[t.mode],s,t.count,t.size,t.source,i.exports[t.filter]),self.postMessage({id:t.id,count:t.count,action:"resolve",value:s},[s.buffer])}catch(e){self.postMessage({id:t.id,count:t.count,action:"reject",value:e})}}))}return{ready:n,supported:!0,useWorkers:function(e){u(e)},decodeVertexBuffer:function(e,t,s,n,a){r(i.exports.meshopt_decodeVertexBuffer,e,t,s,n,i.exports[o[a]])},decodeIndexBuffer:function(e,t,s,n){r(i.exports.meshopt_decodeIndexBuffer,e,t,s,n)},decodeIndexSequence:function(e,t,s,n){r(i.exports.meshopt_decodeIndexSequence,e,t,s,n)},decodeGltfBuffer:function(e,t,s,n,a,A){r(i.exports[l[a]],e,t,s,n,i.exports[o[A]])},decodeGltfBufferAsync:function(e,t,s,a,h){return A.length>0?function(e,t,i,s,n){for(var a=A[0],r=1;r<A.length;++r)A[r].pending<a.pending&&(a=A[r]);return new Promise((function(r,o){var l=new Uint8Array(i),A=c++;a.pending+=e,a.requests[A]={resolve:r,reject:o},a.object.postMessage({id:A,count:e,size:t,source:l,mode:s,filter:n},[l.buffer])}))}(e,t,s,l[a],o[h]):n.then((function(){var n=new Uint8Array(e*t);return r(i.exports[l[a]],n,e,t,s,i.exports[o[h]]),n}))}}}();const Oe=new WeakMap;class Ge extends t.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,n){const a=new t.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(e=>{this.parse(e,i,n)}),s,n)}parse(e,i,s=()=>{}){this.decodeDracoFile(e,i,null,null,t.SRGBColorSpace,s).catch(s)}decodeDracoFile(e,i,s,n,a=t.LinearSRGBColorSpace,r=()=>{}){const o={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:a};return this.decodeGeometry(e,o).then(i).catch(r)}decodeGeometry(e,t){const i=JSON.stringify(t);if(Oe.has(e)){const t=Oe.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const n=this.workerNextTaskID++,a=e.byteLength,r=this._getWorker(n,a).then((i=>(s=i,new Promise(((i,a)=>{s._callbacks[n]={resolve:i,reject:a},s.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return r.catch((()=>!0)).then((()=>{s&&n&&this._releaseTask(s,n)})),Oe.set(e,{key:i,promise:r}),r}_createGeometry(e){const i=new t.BufferGeometry;e.index&&i.setIndex(new t.BufferAttribute(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const n=e.attributes[s],a=n.name,r=n.array,o=n.itemSize,l=new t.BufferAttribute(r,o);"color"===a&&(this._assignVertexColorSpace(l,n.vertexColorSpace),l.normalized=r instanceof Float32Array==!1),i.setAttribute(a,l)}return i}_assignVertexColorSpace(e,i){if(i!==t.SRGBColorSpace)return;const s=new t.Color;for(let i=0,n=e.count;i<n;i++)s.fromBufferAttribute(e,i),t.ColorManagement.toWorkingColorSpace(s,t.SRGBColorSpace),e.setXYZ(i,s.r,s.g,s.b)}_loadLibrary(e,i){const s=new t.FileLoader(this.manager);return s.setPath(this.decoderPath),s.setResponseType(i),s.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{s.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const i=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const s=Ue.toString(),n=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const i=t.data;switch(i.type){case"decode":e._callbacks[i.id].resolve(i);break;case"error":e._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function Ue(){let e,t;function i(e,t,i,s,n,a){const r=a.num_components(),o=i.num_points()*r,l=o*n.BYTES_PER_ELEMENT,A=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),c=e._malloc(l);t.GetAttributeDataArrayForAllPoints(i,a,A,l,c);const h=new n(e.HEAPF32.buffer,c,o).slice();return e._free(c),{name:s,array:h,itemSize:r}}onmessage=function(s){const n=s.data;switch(n.type){case"init":e=n.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const s=n.buffer,a=n.taskConfig;t.then((e=>{const t=e.draco,r=new t.Decoder;try{const e=function(e,t,s,n){const a=n.attributeIDs,r=n.attributeTypes;let o,l;const A=t.GetEncodedGeometryType(s);if(A===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeArrayToMesh(s,s.byteLength,o);else{if(A!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeArrayToPointCloud(s,s.byteLength,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const c={index:null,attributes:[]};for(const s in a){const l=self[r[s]];let A,h;if(n.useUniqueIDs)h=a[s],A=t.GetAttributeByUniqueId(o,h);else{if(h=t.GetAttributeId(o,e[a[s]]),-1===h)continue;A=t.GetAttribute(o,h)}const u=i(e,t,o,s,l,A);"color"===s&&(u.vertexColorSpace=n.vertexColorSpace),c.attributes.push(u)}A===e.TRIANGULAR_MESH&&(c.index=function(e,t,i){const s=i.num_faces(),n=3*s,a=4*n,r=e._malloc(a);t.GetTrianglesUInt32Array(i,a,r);const o=new Uint32Array(e.HEAPF32.buffer,r,n).slice();return e._free(r),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),c}(t,r,new Int8Array(s),a),o=e.attributes.map((e=>e.array.buffer));e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:n.id,error:e.message})}finally{t.destroy(r)}}))}}}function Ne(e,i){if(i===t.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(i===t.TriangleFanDrawMode||i===t.TriangleStripDrawMode){let s=e.getIndex();if(null===s){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const n=s.count-2,a=[];if(i===t.TriangleFanDrawMode)for(let e=1;e<=n;e++)a.push(s.getX(0)),a.push(s.getX(e)),a.push(s.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(a.push(s.getX(e)),a.push(s.getX(e+1)),a.push(s.getX(e+2))):(a.push(s.getX(e+2)),a.push(s.getX(e+1)),a.push(s.getX(e)));a.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(a),r.clearGroups(),r}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),e}class je extends t.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new We(e)})),this.register((function(e){return new Je(e)})),this.register((function(e){return new nt(e)})),this.register((function(e){return new at(e)})),this.register((function(e){return new rt(e)})),this.register((function(e){return new Xe(e)})),this.register((function(e){return new $e(e)})),this.register((function(e){return new Ze(e)})),this.register((function(e){return new et(e)})),this.register((function(e){return new Ke(e)})),this.register((function(e){return new tt(e)})),this.register((function(e){return new Ye(e)})),this.register((function(e){return new st(e)})),this.register((function(e){return new it(e)})),this.register((function(e){return new qe(e)})),this.register((function(e){return new ot(e)})),this.register((function(e){return new lt(e)}))}load(e,i,s,n){const a=this;let r;if(""!==this.resourcePath)r=this.resourcePath;else if(""!==this.path){const i=t.LoaderUtils.extractUrlBase(e);r=t.LoaderUtils.resolveURL(i,this.path)}else r=t.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);const o=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},l=new t.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(t){try{a.parse(t,r,(function(t){i(t),a.manager.itemEnd(e)}),o)}catch(e){o(e)}}),s,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let n;const a={},r={},o=new TextDecoder;if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer){if(o.decode(new Uint8Array(e,0,4))===At){try{a[ze.KHR_BINARY_GLTF]=new ut(e)}catch(e){return void(s&&s(e))}n=JSON.parse(a[ze.KHR_BINARY_GLTF].content)}else n=JSON.parse(o.decode(e))}else n=e;if(void 0===n.asset||n.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Ot(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[t.name]=t,a[t.name]=!0}if(n.extensionsUsed)for(let e=0;e<n.extensionsUsed.length;++e){const t=n.extensionsUsed[e],i=n.extensionsRequired||[];switch(t){case ze.KHR_MATERIALS_UNLIT:a[t]=new Ve;break;case ze.KHR_DRACO_MESH_COMPRESSION:a[t]=new dt(n,this.dracoLoader);break;case ze.KHR_TEXTURE_TRANSFORM:a[t]=new pt;break;case ze.KHR_MESH_QUANTIZATION:a[t]=new gt;break;default:i.indexOf(t)>=0&&void 0===r[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(a),l.setPlugins(r),l.parse(i,s)}parseAsync(e,t){const i=this;return new Promise((function(s,n){i.parse(e,t,s,n)}))}}function He(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const ze={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class qe{constructor(e){this.parser=e,this.name=ze.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let n=i.cache.get(s);if(n)return n;const a=i.json,r=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let o;const l=new t.Color(16777215);void 0!==r.color&&l.setRGB(r.color[0],r.color[1],r.color[2],t.LinearSRGBColorSpace);const A=void 0!==r.range?r.range:0;switch(r.type){case"directional":o=new t.DirectionalLight(l),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new t.PointLight(l),o.distance=A;break;case"spot":o=new t.SpotLight(l),o.distance=A,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),o.decay=2,Dt(o,r),void 0!==r.intensity&&(o.intensity=r.intensity),o.name=i.createUniqueName(r.name||"light_"+e),n=Promise.resolve(o),i.cache.add(s,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],n=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then((function(e){return i._getNodeRef(t.cache,n,e)}))}}let Ve=class{constructor(){this.name=ze.KHR_MATERIALS_UNLIT}getMaterialType(){return t.MeshBasicMaterial}extendParams(e,i,s){const n=[];e.color=new t.Color(1,1,1),e.opacity=1;const a=i.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const i=a.baseColorFactor;e.color.setRGB(i[0],i[1],i[2],t.LinearSRGBColorSpace),e.opacity=i[3]}void 0!==a.baseColorTexture&&n.push(s.assignTexture(e,"map",a.baseColorTexture,t.SRGBColorSpace))}return Promise.all(n)}},Ke=class{constructor(e){this.parser=e,this.name=ze.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}},We=class{constructor(e){this.parser=e,this.name=ze.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(i.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&a.push(s.assignTexture(i,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(i.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&a.push(s.assignTexture(i,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(a.push(s.assignTexture(i,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new t.Vector2(e,e)}return Promise.all(a)}},Je=class{constructor(e){this.parser=e,this.name=ze.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=void 0!==s.dispersion?s.dispersion:0,Promise.resolve()}},Ye=class{constructor(e){this.parser=e,this.name=ze.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&n.push(i.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&n.push(i.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(n)}},Xe=class{constructor(e){this.parser=e,this.name=ze.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[];i.sheenColor=new t.Color(0,0,0),i.sheenRoughness=0,i.sheen=1;const r=n.extensions[this.name];if(void 0!==r.sheenColorFactor){const e=r.sheenColorFactor;i.sheenColor.setRGB(e[0],e[1],e[2],t.LinearSRGBColorSpace)}return void 0!==r.sheenRoughnessFactor&&(i.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&a.push(s.assignTexture(i,"sheenColorMap",r.sheenColorTexture,t.SRGBColorSpace)),void 0!==r.sheenRoughnessTexture&&a.push(s.assignTexture(i,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(a)}},$e=class{constructor(e){this.parser=e,this.name=ze.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)}},Ze=class{constructor(e){this.parser=e,this.name=ze.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];i.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&a.push(s.assignTexture(i,"thicknessMap",r.thicknessTexture)),i.attenuationDistance=r.attenuationDistance||1/0;const o=r.attenuationColor||[1,1,1];return i.attenuationColor=(new t.Color).setRGB(o[0],o[1],o[2],t.LinearSRGBColorSpace),Promise.all(a)}},et=class{constructor(e){this.parser=e,this.name=ze.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}},tt=class{constructor(e){this.parser=e,this.name=ze.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];i.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&a.push(s.assignTexture(i,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return i.specularColor=(new t.Color).setRGB(o[0],o[1],o[2],t.LinearSRGBColorSpace),void 0!==r.specularColorTexture&&a.push(s.assignTexture(i,"specularColorMap",r.specularColorTexture,t.SRGBColorSpace)),Promise.all(a)}},it=class{constructor(e){this.parser=e,this.name=ze.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return t.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&n.push(i.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(n)}},st=class{constructor(e){this.parser=e,this.name=ze.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&n.push(i.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(n)}};class nt{constructor(e){this.parser=e,this.name=ze.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const n=s.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,a)}}class at{constructor(e){this.parser=e,this.name=ze.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,n=s.textures[e];if(!n.extensions||!n.extensions[t])return null;const a=n.extensions[t],r=s.images[a.source];let o=i.textureLoader;if(r.uri){const e=i.options.manager.getHandler(r.uri);null!==e&&(o=e)}return this.detectSupport().then((function(n){if(n)return i.loadTextureImage(e,a.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class rt{constructor(e){this.parser=e,this.name=ze.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,n=s.textures[e];if(!n.extensions||!n.extensions[t])return null;const a=n.extensions[t],r=s.images[a.source];let o=i.textureLoader;if(r.uri){const e=i.options.manager.getHandler(r.uri);null!==e&&(o=e)}return this.detectSupport().then((function(n){if(n)return i.loadTextureImage(e,a.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class ot{constructor(e){this.name=ze.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const e=i.extensions[this.name],s=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then((function(t){const i=e.byteOffset||0,s=e.byteLength||0,a=e.count,r=e.byteStride,o=new Uint8Array(t,i,s);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(a,r,o,e.mode,e.filter).then((function(e){return e.buffer})):n.ready.then((function(){const t=new ArrayBuffer(a*r);return n.decodeGltfBuffer(new Uint8Array(t),a,r,o,e.mode,e.filter),t}))}))}return null}}let lt=class{constructor(e){this.name=ze.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const i=this.parser.json,s=i.nodes[e];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;const n=i.meshes[s.mesh];for(const e of n.primitives)if(e.mode!==yt.TRIANGLES&&e.mode!==yt.TRIANGLE_STRIP&&e.mode!==yt.TRIANGLE_FAN&&void 0!==e.mode)return null;const a=s.extensions[this.name].attributes,r=[],o={};for(const e in a)r.push(this.parser.getDependency("accessor",a[e]).then((t=>(o[e]=t,o[e]))));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then((e=>{const i=e.pop(),s=i.isGroup?i.children:[i],n=e[0].count,a=[];for(const e of s){const i=new t.Matrix4,s=new t.Vector3,r=new t.Quaternion,l=new t.Vector3(1,1,1),A=new t.InstancedMesh(e.geometry,e.material,n);for(let e=0;e<n;e++)o.TRANSLATION&&s.fromBufferAttribute(o.TRANSLATION,e),o.ROTATION&&r.fromBufferAttribute(o.ROTATION,e),o.SCALE&&l.fromBufferAttribute(o.SCALE,e),A.setMatrixAt(e,i.compose(s,r,l));for(const i in o)if("_COLOR_0"===i){const e=o[i];A.instanceColor=new t.InstancedBufferAttribute(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&e.geometry.setAttribute(i,o[i]);t.Object3D.prototype.copy.call(A,e),this.parser.assignFinalMaterial(A),a.push(A)}return i.isGroup?(i.clear(),i.add(...a),i):a[0]})))}};const At="glTF",ct=1313821514,ht=5130562;class ut{constructor(e){this.name=ze.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==At)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,n=new DataView(e,12);let a=0;for(;a<s;){const t=n.getUint32(a,!0);a+=4;const s=n.getUint32(a,!0);if(a+=4,s===ct){const s=new Uint8Array(e,12+a,t);this.content=i.decode(s)}else if(s===ht){const i=12+a;this.body=e.slice(i,i+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class dt{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ze.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,i){const s=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},l={},A={};for(const e in r){const t=Bt[e]||e.toLowerCase();o[t]=r[e]}for(const t in e.attributes){const i=Bt[t]||t.toLowerCase();if(void 0!==r[t]){const n=s.accessors[e.attributes[t]],a=Ct[n.componentType];A[i]=a.name,l[i]=!0===n.normalized}}return i.getDependency("bufferView",a).then((function(e){return new Promise((function(i,s){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const i=e.attributes[t],s=l[t];void 0!==s&&(i.normalized=s)}i(e)}),o,A,t.LinearSRGBColorSpace,s)}))}))}}class pt{constructor(){this.name=ze.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class gt{constructor(){this.name=ze.KHR_MESH_QUANTIZATION}}class mt extends t.Interpolant{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=e*s*3+s;for(let e=0;e!==s;e++)t[e]=i[n+e];return t}interpolate_(e,t,i,s){const n=this.resultBuffer,a=this.sampleValues,r=this.valueSize,o=2*r,l=3*r,A=s-t,c=(i-t)/A,h=c*c,u=h*c,d=e*l,p=d-l,g=-2*u+3*h,m=u-h,f=1-g,b=m-h+c;for(let e=0;e!==r;e++){const t=a[p+e+r],i=a[p+e+o]*A,s=a[d+e+r],l=a[d+e]*A;n[e]=f*t+b*i+g*s+m*l}return n}}const ft=new t.Quaternion;class bt extends mt{interpolate_(e,t,i,s){const n=super.interpolate_(e,t,i,s);return ft.fromArray(n).normalize().toArray(n),n}}const yt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ct={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},It={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},Et={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},wt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Bt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},vt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},xt={CUBICSPLINE:void 0,LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete},St="OPAQUE",Qt="MASK",Mt="BLEND";function Tt(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new t.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:t.FrontSide})),e.DefaultMaterial}function Rt(e,t,i){for(const s in i.extensions)void 0===e[s]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=i.extensions[s])}function Dt(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function kt(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,s=t.weights.length;i<s;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,s=i.length;t<s;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ft(e){let t;const i=e.extensions&&e.extensions[ze.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+Lt(i.attributes):e.indices+":"+Lt(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,s=e.targets.length;i<s;i++)t+=":"+Lt(e.targets[i]);return t}function Lt(e){let t="";const i=Object.keys(e).sort();for(let s=0,n=i.length;s<n;s++)t+=i[s]+":"+e[i[s]]+";";return t}function _t(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Pt=new t.Matrix4;class Ot{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new He,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=-1,a=!1,r=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;s=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);n=s&&t?parseInt(t[1],10):-1,a=e.indexOf("Firefox")>-1,r=a?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||s&&n<17||a&&r<98?this.textureLoader=new t.TextureLoader(this.options.manager):this.textureLoader=new t.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new t.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(t){const a={scene:t[0][s.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:s.asset,parser:i,userData:{}};return Rt(n,a,s),Dt(a,s),Promise.all(i._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){for(const e of a.scenes)e.updateMatrixWorld();e(a)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const s=t[i].joints;for(let t=0,i=s.length;t<i;t++)e[s[t]].isBone=!0}for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0!==s.mesh&&(this._addNodeRef(this.meshCache,s.mesh),void 0!==s.skin&&(i[s.mesh].isSkinnedMesh=!0)),void 0!==s.camera&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),n=(e,t)=>{const i=this.associations.get(e);null!=i&&this.associations.set(t,i);for(const[i,s]of e.children.entries())n(s,t.children[i])};return n(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const n=e(t[s]);n&&i.push(n)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":s=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":s=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)})),!s)throw new Error("Unknown type: "+e)}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(s.map((function(t,s){return i.getDependency(e,s)}))),this.cache.add(e,t)}return t}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&"arraybuffer"!==i.type)throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(void 0===i.uri&&0===e)return Promise.resolve(this.extensions[ze.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,a){s.load(t.LoaderUtils.resolveURL(i.uri,n.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const i=t.byteLength||0,s=t.byteOffset||0;return e.slice(s,s+i)}))}loadAccessor(e){const i=this,s=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse){const e=wt[n.type],i=Ct[n.componentType],s=!0===n.normalized,a=new i(n.count*e);return Promise.resolve(new t.BufferAttribute(a,e,s))}const a=[];return void 0!==n.bufferView?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),void 0!==n.sparse&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then((function(e){const a=e[0],r=wt[n.type],o=Ct[n.componentType],l=o.BYTES_PER_ELEMENT,A=l*r,c=n.byteOffset||0,h=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,u=!0===n.normalized;let d,p;if(h&&h!==A){const e=Math.floor(c/h),s="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let A=i.cache.get(s);A||(d=new o(a,e*h,n.count*h/l),A=new t.InterleavedBuffer(d,h/l),i.cache.add(s,A)),p=new t.InterleavedBufferAttribute(A,r,c%h/l,u)}else d=null===a?new o(n.count*r):new o(a,c,n.count*r),p=new t.BufferAttribute(d,r,u);if(void 0!==n.sparse){const i=wt.SCALAR,s=Ct[n.sparse.indices.componentType],l=n.sparse.indices.byteOffset||0,A=n.sparse.values.byteOffset||0,c=new s(e[1],l,n.sparse.count*i),h=new o(e[2],A,n.sparse.count*r);null!==a&&(p=new t.BufferAttribute(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(p.setX(t,h[e*r]),r>=2&&p.setY(t,h[e*r+1]),r>=3&&p.setZ(t,h[e*r+2]),r>=4&&p.setW(t,h[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=u}return p}))}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,n=t.images[s];let a=this.textureLoader;if(n.uri){const e=i.manager.getHandler(n.uri);null!==e&&(a=e)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,i,s){const n=this,a=this.json,r=a.textures[e],o=a.images[i],l=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[l])return this.textureCache[l];const A=this.loadImageSource(i,s).then((function(i){i.flipY=!1,i.name=r.name||o.name||"",""===i.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(i.name=o.uri);const s=(a.samplers||{})[r.sampler]||{};return i.magFilter=It[s.magFilter]||t.LinearFilter,i.minFilter=It[s.minFilter]||t.LinearMipmapLinearFilter,i.wrapS=Et[s.wrapS]||t.RepeatWrapping,i.wrapT=Et[s.wrapT]||t.RepeatWrapping,i.generateMipmaps=!i.isCompressedTexture&&i.minFilter!==t.NearestFilter&&i.minFilter!==t.LinearFilter,n.associations.set(i,{textures:e}),i})).catch((function(){return null}));return this.textureCache[l]=A,A}loadImageSource(e,i){const s=this,n=this.json,a=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const r=n.images[e],o=self.URL||self.webkitURL;let l=r.uri||"",A=!1;if(void 0!==r.bufferView)l=s.getDependency("bufferView",r.bufferView).then((function(e){A=!0;const t=new Blob([e],{type:r.mimeType});return l=o.createObjectURL(t),l}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(l).then((function(e){return new Promise((function(s,n){let r=s;!0===i.isImageBitmapLoader&&(r=function(e){const i=new t.Texture(e);i.needsUpdate=!0,s(i)}),i.load(t.LoaderUtils.resolveURL(e,a.path),r,void 0,n)}))})).then((function(e){var t;return!0===A&&o.revokeObjectURL(l),Dt(e,r),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),e}));return this.sourceCache[e]=c,c}assignTexture(e,t,i,s){const n=this;return this.getDependency("texture",i.index).then((function(a){if(!a)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((a=a.clone()).channel=i.texCoord),n.extensions[ze.KHR_TEXTURE_TRANSFORM]){const e=void 0!==i.extensions?i.extensions[ze.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(a);a=n.extensions[ze.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return void 0!==s&&(a.colorSpace=s),e[t]=a,a}))}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const n=void 0===i.attributes.tangent,a=void 0!==i.attributes.color,r=void 0===i.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let i=this.cache.get(e);i||(i=new t.PointsMaterial,t.Material.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,i.sizeAttenuation=!1,this.cache.add(e,i)),s=i}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let i=this.cache.get(e);i||(i=new t.LineBasicMaterial,t.Material.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,this.cache.add(e,i)),s=i}if(n||a||r){let e="ClonedMaterial:"+s.uuid+":";n&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),a&&(t.vertexColors=!0),r&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}e.material=s}getMaterialType(){return t.MeshStandardMaterial}loadMaterial(e){const i=this,s=this.json,n=this.extensions,a=s.materials[e];let r;const o={},l=[];if((a.extensions||{})[ze.KHR_MATERIALS_UNLIT]){const e=n[ze.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),l.push(e.extendParams(o,a,i))}else{const s=a.pbrMetallicRoughness||{};if(o.color=new t.Color(1,1,1),o.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],t.LinearSRGBColorSpace),o.opacity=e[3]}void 0!==s.baseColorTexture&&l.push(i.assignTexture(o,"map",s.baseColorTexture,t.SRGBColorSpace)),o.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,o.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(l.push(i.assignTexture(o,"metalnessMap",s.metallicRoughnessTexture)),l.push(i.assignTexture(o,"roughnessMap",s.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===a.doubleSided&&(o.side=t.DoubleSide);const A=a.alphaMode||St;if(A===Mt?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,A===Qt&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&r!==t.MeshBasicMaterial&&(l.push(i.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new t.Vector2(1,1),void 0!==a.normalTexture.scale)){const e=a.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==a.occlusionTexture&&r!==t.MeshBasicMaterial&&(l.push(i.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&r!==t.MeshBasicMaterial){const e=a.emissiveFactor;o.emissive=(new t.Color).setRGB(e[0],e[1],e[2],t.LinearSRGBColorSpace)}return void 0!==a.emissiveTexture&&r!==t.MeshBasicMaterial&&l.push(i.assignTexture(o,"emissiveMap",a.emissiveTexture,t.SRGBColorSpace)),Promise.all(l).then((function(){const t=new r(o);return a.name&&(t.name=a.name),Dt(t,a),i.associations.set(t,{materials:e}),a.extensions&&Rt(n,t,a),t}))}createUniqueName(e){const i=t.PropertyBinding.sanitizeNodeName(e||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(e){const i=this,s=this.extensions,n=this.primitiveCache;function a(e){return s[ze.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then((function(t){return Gt(t,e,i)}))}const r=[];for(let s=0,o=e.length;s<o;s++){const o=e[s],l=Ft(o),A=n[l];if(A)r.push(A.promise);else{let e;e=o.extensions&&o.extensions[ze.KHR_DRACO_MESH_COMPRESSION]?a(o):Gt(new t.BufferGeometry,o,i),n[l]={primitive:o,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const i=this,s=this.json,n=this.extensions,a=s.meshes[e],r=a.primitives,o=[];for(let e=0,t=r.length;e<t;e++){const t=void 0===r[e].material?Tt(this.cache):this.getDependency("material",r[e].material);o.push(t)}return o.push(i.loadGeometries(r)),Promise.all(o).then((function(s){const o=s.slice(0,s.length-1),l=s[s.length-1],A=[];for(let s=0,c=l.length;s<c;s++){const c=l[s],h=r[s];let u;const d=o[s];if(h.mode===yt.TRIANGLES||h.mode===yt.TRIANGLE_STRIP||h.mode===yt.TRIANGLE_FAN||void 0===h.mode)u=!0===a.isSkinnedMesh?new t.SkinnedMesh(c,d):new t.Mesh(c,d),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),h.mode===yt.TRIANGLE_STRIP?u.geometry=Ne(u.geometry,t.TriangleStripDrawMode):h.mode===yt.TRIANGLE_FAN&&(u.geometry=Ne(u.geometry,t.TriangleFanDrawMode));else if(h.mode===yt.LINES)u=new t.LineSegments(c,d);else if(h.mode===yt.LINE_STRIP)u=new t.Line(c,d);else if(h.mode===yt.LINE_LOOP)u=new t.LineLoop(c,d);else{if(h.mode!==yt.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);u=new t.Points(c,d)}Object.keys(u.geometry.morphAttributes).length>0&&kt(u,a),u.name=i.createUniqueName(a.name||"mesh_"+e),Dt(u,a),h.extensions&&Rt(n,u,h),i.assignFinalMaterial(u),A.push(u)}for(let t=0,s=A.length;t<s;t++)i.associations.set(A[t],{meshes:e,primitives:t});if(1===A.length)return a.extensions&&Rt(n,A[0],a),A[0];const c=new t.Group;a.extensions&&Rt(n,c,a),i.associations.set(c,{meshes:e});for(let e=0,t=A.length;e<t;e++)c.add(A[e]);return c}))}loadCamera(e){let i;const s=this.json.cameras[e],n=s[s.type];if(n)return"perspective"===s.type?i=new t.PerspectiveCamera(t.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===s.type&&(i=new t.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),Dt(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const i=this.json.skins[e],s=[];for(let e=0,t=i.joints.length;e<t;e++)s.push(this._loadNodeShallow(i.joints[e]));return void 0!==i.inverseBindMatrices?s.push(this.getDependency("accessor",i.inverseBindMatrices)):s.push(null),Promise.all(s).then((function(e){const s=e.pop(),n=e,a=[],r=[];for(let e=0,o=n.length;e<o;e++){const o=n[e];if(o){a.push(o);const i=new t.Matrix4;null!==s&&i.fromArray(s.array,16*e),r.push(i)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[e])}return new t.Skeleton(a,r)}))}loadAnimation(e){const i=this.json,s=this,n=i.animations[e],a=n.name?n.name:"animation_"+e,r=[],o=[],l=[],A=[],c=[];for(let e=0,t=n.channels.length;e<t;e++){const t=n.channels[e],i=n.samplers[t.sampler],s=t.target,a=s.node,h=void 0!==n.parameters?n.parameters[i.input]:i.input,u=void 0!==n.parameters?n.parameters[i.output]:i.output;void 0!==s.node&&(r.push(this.getDependency("node",a)),o.push(this.getDependency("accessor",h)),l.push(this.getDependency("accessor",u)),A.push(i),c.push(s))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(l),Promise.all(A),Promise.all(c)]).then((function(e){const i=e[0],n=e[1],r=e[2],o=e[3],l=e[4],A=[];for(let e=0,t=i.length;e<t;e++){const t=i[e],a=n[e],c=r[e],h=o[e],u=l[e];if(void 0===t)continue;t.updateMatrix&&t.updateMatrix();const d=s._createAnimationTracks(t,a,c,h,u);if(d)for(let e=0;e<d.length;e++)A.push(d[e])}return new t.AnimationClip(a,void 0,A)}))}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return void 0===s.mesh?null:i.getDependency("mesh",s.mesh).then((function(e){const t=i._getNodeRef(i.meshCache,s.mesh,e);return void 0!==s.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,i=s.weights.length;t<i;t++)e.morphTargetInfluences[t]=s.weights[t]})),t}))}loadNode(e){const t=this,i=this.json.nodes[e],s=t._loadNodeShallow(e),n=[],a=i.children||[];for(let e=0,i=a.length;e<i;e++)n.push(t.getDependency("node",a[e]));const r=void 0===i.skin?Promise.resolve(null):t.getDependency("skin",i.skin);return Promise.all([s,Promise.all(n),r]).then((function(e){const t=e[0],i=e[1],s=e[2];null!==s&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(s,Pt)}));for(let e=0,s=i.length;e<s;e++)t.add(i[e]);return t}))}_loadNodeShallow(e){const i=this.json,s=this.extensions,n=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const a=i.nodes[e],r=a.name?n.createUniqueName(a.name):"",o=[],l=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return l&&o.push(l),void 0!==a.camera&&o.push(n.getDependency("camera",a.camera).then((function(e){return n._getNodeRef(n.cameraCache,a.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){o.push(e)})),this.nodeCache[e]=Promise.all(o).then((function(i){let o;if(o=!0===a.isBone?new t.Bone:i.length>1?new t.Group:1===i.length?i[0]:new t.Object3D,o!==i[0])for(let e=0,t=i.length;e<t;e++)o.add(i[e]);if(a.name&&(o.userData.name=a.name,o.name=r),Dt(o,a),a.extensions&&Rt(s,o,a),void 0!==a.matrix){const e=new t.Matrix4;e.fromArray(a.matrix),o.applyMatrix4(e)}else void 0!==a.translation&&o.position.fromArray(a.translation),void 0!==a.rotation&&o.quaternion.fromArray(a.rotation),void 0!==a.scale&&o.scale.fromArray(a.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=e,o})),this.nodeCache[e]}loadScene(e){const i=this.extensions,s=this.json.scenes[e],n=this,a=new t.Group;s.name&&(a.name=n.createUniqueName(s.name)),Dt(a,s),s.extensions&&Rt(i,a,s);const r=s.nodes||[],o=[];for(let e=0,t=r.length;e<t;e++)o.push(n.getDependency("node",r[e]));return Promise.all(o).then((function(e){for(let t=0,i=e.length;t<i;t++)a.add(e[t]);return n.associations=(e=>{const i=new Map;for(const[e,s]of n.associations)(e instanceof t.Material||e instanceof t.Texture)&&i.set(e,s);return e.traverse((e=>{const t=n.associations.get(e);null!=t&&i.set(e,t)})),i})(a),a}))}_createAnimationTracks(e,i,s,n,a){const r=[],o=e.name?e.name:e.uuid,l=[];let A;switch(vt[a.path]===vt.weights?e.traverse((function(e){e.morphTargetInfluences&&l.push(e.name?e.name:e.uuid)})):l.push(o),vt[a.path]){case vt.weights:A=t.NumberKeyframeTrack;break;case vt.rotation:A=t.QuaternionKeyframeTrack;break;case vt.position:case vt.scale:A=t.VectorKeyframeTrack;break;default:if(1===s.itemSize)A=t.NumberKeyframeTrack;else A=t.VectorKeyframeTrack}const c=void 0!==n.interpolation?xt[n.interpolation]:t.InterpolateLinear,h=this._getArrayFromAccessor(s);for(let e=0,t=l.length;e<t;e++){const t=new A(l[e]+"."+vt[a.path],i.array,h,c);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(t),r.push(t)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=_t(t.constructor),i=new Float32Array(t.length);for(let s=0,n=t.length;s<n;s++)i[s]=t[s]*e;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof t.QuaternionKeyframeTrack?bt:mt)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Gt(e,i,s){const n=i.attributes,a=[];function r(t,i){return s.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in n){const i=Bt[t]||t.toLowerCase();i in e.attributes||a.push(r(n[t],i))}if(void 0!==i.indices&&!e.index){const t=s.getDependency("accessor",i.indices).then((function(t){e.setIndex(t)}));a.push(t)}return t.ColorManagement.workingColorSpace!==t.LinearSRGBColorSpace&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${t.ColorManagement.workingColorSpace}" not supported.`),Dt(e,i),function(e,i,s){const n=i.attributes,a=new t.Box3;if(void 0===n.POSITION)return;{const e=s.json.accessors[n.POSITION],i=e.min,r=e.max;if(void 0===i||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(a.set(new t.Vector3(i[0],i[1],i[2]),new t.Vector3(r[0],r[1],r[2])),e.normalized){const t=_t(Ct[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}const r=i.targets;if(void 0!==r){const e=new t.Vector3,i=new t.Vector3;for(let t=0,n=r.length;t<n;t++){const n=r[t];if(void 0!==n.POSITION){const t=s.json.accessors[n.POSITION],a=t.min,r=t.max;if(void 0!==a&&void 0!==r){if(i.setX(Math.max(Math.abs(a[0]),Math.abs(r[0]))),i.setY(Math.max(Math.abs(a[1]),Math.abs(r[1]))),i.setZ(Math.max(Math.abs(a[2]),Math.abs(r[2]))),t.normalized){const e=_t(Ct[t.componentType]);i.multiplyScalar(e)}e.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;const o=new t.Sphere;a.getCenter(o.center),o.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=o}(e,i,s),Promise.all(a).then((function(){return void 0!==i.targets?function(e,t,i){let s=!1,n=!1,a=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(void 0!==i.POSITION&&(s=!0),void 0!==i.NORMAL&&(n=!0),void 0!==i.COLOR_0&&(a=!0),s&&n&&a)break}if(!s&&!n&&!a)return Promise.resolve(e);const r=[],o=[],l=[];for(let A=0,c=t.length;A<c;A++){const c=t[A];if(s){const t=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;r.push(t)}if(n){const t=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal;o.push(t)}if(a){const t=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(l)]).then((function(t){const i=t[0],r=t[1],o=t[2];return s&&(e.morphAttributes.position=i),n&&(e.morphAttributes.normal=r),a&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e}))}(e,i.targets,s):e}))}class Ut{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:t,msg:i,transfer:s}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(i,s)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((i=>{const s=this._getIdleWorker();-1!==s?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Nt=9,jt=15,Ht=16,zt=22,qt=37,Vt=43,Kt=76,Wt=83,Jt=97,Yt=100,Xt=103,$t=109,Zt=165,ei=166,ti=1000066e3;class ii{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class si{constructor(e,t,i,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}const ni=[171,75,84,88,32,50,48,187,13,10,26,10];function ai(e){return(new TextDecoder).decode(e)}let ri,oi,li;const Ai={env:{emscripten_notify_memory_growth:function(e){li=new Uint8Array(oi.exports.memory.buffer)}}};class ci{init(){return ri||(ri="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+hi).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,Ai))).then(this._init):WebAssembly.instantiate(Buffer.from(hi,"base64"),Ai).then(this._init),ri)}_init(e){oi=e.instance,Ai.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!oi)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,s=oi.exports.malloc(i);li.set(e,s),t=t||Number(oi.exports.ZSTD_findDecompressedSize(s,i));const n=oi.exports.malloc(t),a=oi.exports.ZSTD_decompress(n,t,s,i),r=li.slice(n,n+a);return oi.exports.free(s),oi.exports.free(n),r}}const hi="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",ui=new WeakMap;let di,pi=0;class gi extends t.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Ut,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new t.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new t.FileLoader(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const n=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,n]).then((([e,t])=>{const i=gi.BasisWorker.toString(),s=["/* constants */","let _EngineFormat = "+JSON.stringify(gi.EngineFormat),"let _EngineType = "+JSON.stringify(gi.EngineType),"let _TranscoderFormat = "+JSON.stringify(gi.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(gi.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),pi>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),pi++}return this.transcoderPending}load(e,i,s,n){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const a=new t.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials),a.load(e,(e=>{this.parse(e,i,n)}),s,n)}parse(e,t,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(ui.has(e)){return ui.get(e).promise.then(t).catch(i)}this._createTexture(e).then((e=>t?t(e):null)).catch(i)}_createTextureFrom(e,i){const{type:s,error:n,data:{faces:a,width:r,height:o,format:l,type:A,dfdFlags:c}}=e;if("error"===s)return Promise.reject(n);let h;if(6===i.faceCount)h=new t.CompressedCubeTexture(a,l,A);else{const e=a[0].mipmaps;h=i.layerCount>1?new t.CompressedArrayTexture(e,r,o,i.layerCount,l,A):new t.CompressedTexture(e,r,o,l,A)}return h.minFilter=1===a[0].mipmaps.length?t.LinearFilter:t.LinearMipmapLinearFilter,h.magFilter=t.LinearFilter,h.generateMipmaps=!1,h.needsUpdate=!0,h.colorSpace=yi(i),h.premultiplyAlpha=!!(1&c),h}async _createTexture(e,i={}){const s=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,ni.length);if(t[0]!==ni[0]||t[1]!==ni[1]||t[2]!==ni[2]||t[3]!==ni[3]||t[4]!==ni[4]||t[5]!==ni[5]||t[6]!==ni[6]||t[7]!==ni[7]||t[8]!==ni[8]||t[9]!==ni[9]||t[10]!==ni[10]||t[11]!==ni[11])throw new Error("Missing KTX 2.0 identifier.");const i=new ii,s=17*Uint32Array.BYTES_PER_ELEMENT,n=new si(e,ni.length,s,!0);i.vkFormat=n._nextUint32(),i.typeSize=n._nextUint32(),i.pixelWidth=n._nextUint32(),i.pixelHeight=n._nextUint32(),i.pixelDepth=n._nextUint32(),i.layerCount=n._nextUint32(),i.faceCount=n._nextUint32();const a=n._nextUint32();i.supercompressionScheme=n._nextUint32();const r=n._nextUint32(),o=n._nextUint32(),l=n._nextUint32(),A=n._nextUint32(),c=n._nextUint64(),h=n._nextUint64(),u=new si(e,ni.length+s,3*a*8,!0);for(let t=0;t<a;t++)i.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const d=new si(e,r,o,!0),p={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},g=(p.descriptorBlockSize/4-6)/4;for(let e=0;e<g;e++){const t={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=d._nextInt32(),t.sampleUpper=d._nextInt32()):(t.sampleLower=d._nextUint32(),t.sampleUpper=d._nextUint32()),p.samples[e]=t}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(p);const m=new si(e,l,A,!0);for(;m._offset<A;){const e=m._nextUint32(),t=m._scan(e),s=ai(t);if(i.keyValue[s]=m._nextUint8Array(e-t.byteLength-1),s.match(/^ktx/i)){const e=ai(i.keyValue[s]);i.keyValue[s]=e.substring(0,e.lastIndexOf("\0"))}m._skip(e%4?4-e%4:0)}if(h<=0)return i;const f=new si(e,c,h,!0),b=f._nextUint16(),y=f._nextUint16(),C=f._nextUint32(),I=f._nextUint32(),E=f._nextUint32(),w=f._nextUint32(),B=[];for(let e=0;e<a;e++)B.push({imageFlags:f._nextUint32(),rgbSliceByteOffset:f._nextUint32(),rgbSliceByteLength:f._nextUint32(),alphaSliceByteOffset:f._nextUint32(),alphaSliceByteLength:f._nextUint32()});const v=c+f._offset,x=v+C,S=x+I,Q=S+E,M=new Uint8Array(e.buffer,e.byteOffset+v,C),T=new Uint8Array(e.buffer,e.byteOffset+x,I),R=new Uint8Array(e.buffer,e.byteOffset+S,E),D=new Uint8Array(e.buffer,e.byteOffset+Q,w);return i.globalData={endpointCount:b,selectorCount:y,imageDescs:B,endpointsData:M,selectorsData:T,tablesData:R,extendedData:D},i}(new Uint8Array(e)),n=s.vkFormat===ti&&167===s.dataFormatDescriptor[0].colorModel;if(!(0===s.vkFormat||n&&!this.workerConfig.astcHDRSupported))return async function(e){const{vkFormat:i}=e;if(void 0===fi[i])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let s;2===e.supercompressionScheme&&(di||(di=new Promise((async e=>{const t=new ci;await t.init(),e(t)}))),s=await di);const n=[];for(let a=0;a<e.levels.length;a++){const r=Math.max(1,e.pixelWidth>>a),o=Math.max(1,e.pixelHeight>>a),l=e.pixelDepth?Math.max(1,e.pixelDepth>>a):0,A=e.levels[a];let c,h;if(0===e.supercompressionScheme)c=A.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");c=s.decode(A.levelData,A.uncompressedByteLength)}h=bi[i]===t.FloatType?new Float32Array(c.buffer,c.byteOffset,c.byteLength/Float32Array.BYTES_PER_ELEMENT):bi[i]===t.HalfFloatType?new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT):c,n.push({data:h,width:r,height:o,depth:l})}let a;if(mi.has(fi[i]))a=0===e.pixelDepth?new t.DataTexture(n[0].data,e.pixelWidth,e.pixelHeight):new t.Data3DTexture(n[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");a=new t.CompressedTexture(n,e.pixelWidth,e.pixelHeight),a.minFilter=1===n.length?t.LinearFilter:t.LinearMipmapLinearFilter,a.magFilter=t.LinearFilter}return a.mipmaps=n,a.type=bi[i],a.format=fi[i],a.colorSpace=yi(e),a.needsUpdate=!0,Promise.resolve(a)}(s);const a=i,r=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:a},[e]))).then((e=>this._createTextureFrom(e.data,s)));return ui.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),pi--,this}}gi.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},gi.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},gi.EngineFormat={RGBAFormat:t.RGBAFormat,RGBA_ASTC_4x4_Format:t.RGBA_ASTC_4x4_Format,RGB_BPTC_UNSIGNED_Format:t.RGB_BPTC_UNSIGNED_Format,RGBA_BPTC_Format:t.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:t.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:t.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:t.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:t.RGB_ETC1_Format,RGB_ETC2_Format:t.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:t.RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:t.RGBA_S3TC_DXT1_Format},gi.EngineType={UnsignedByteType:t.UnsignedByteType,HalfFloatType:t.HalfFloatType,FloatType:t.FloatType},gi.BasisWorker=function(){let e,t,i;const s=_EngineFormat,n=_EngineType,a=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",(function(s){const a=s.data;switch(a.type){case"init":e=a.config,o=a.transcoderBinary,t=new Promise((e=>{i={wasmBinary:o,onRuntimeInitialized:e},BASIS(i)})).then((()=>{i.initializeBasis(),void 0===i.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{faces:t,buffers:s,width:o,height:h,hasAlpha:u,format:d,type:p,dfdFlags:g}=function(t){const s=new i.KTX2File(new Uint8Array(t));function a(){s.close(),s.delete()}if(!s.isValid())throw a(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");let o;if(s.isUASTC())o=r.UASTC;else if(s.isETC1S())o=r.ETC1S;else{if(!s.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");o=r.UASTC_HDR}const h=s.getWidth(),u=s.getHeight(),d=s.getLayers()||1,p=s.getLevels(),g=s.getFaces(),m=s.getHasAlpha(),f=s.getDFDFlags(),{transcoderFormat:b,engineFormat:y,engineType:C}=function(t,i,s,n){const a=l[t];for(let r=0;r<a.length;r++){const o=a[r];if(o.if&&!e[o.if])continue;if(!o.basisFormat.includes(t))continue;if(n&&o.transcoderFormat.length<2)continue;if(o.needsPowerOfTwo&&(!A(i)||!A(s)))continue;return{transcoderFormat:o.transcoderFormat[n?1:0],engineFormat:o.engineFormat[n?1:0],engineType:o.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(o,h,u,m);if(!h||!u||!p)throw a(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!s.startTranscoding())throw a(),new Error("THREE.KTX2Loader: .startTranscoding failed");const I=[],E=[];for(let e=0;e<g;e++){const t=[];for(let i=0;i<p;i++){const r=[];let o,l;for(let t=0;t<d;t++){const A=s.getImageLevelInfo(i,t,e);0!==e||0!==i||0!==t||A.origWidth%4==0&&A.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),p>1?(o=A.origWidth,l=A.origHeight):(o=A.width,l=A.height);let c=new Uint8Array(s.getImageTranscodedSizeInBytes(i,t,0,b));const h=s.transcodeImage(c,i,t,e,b,0,-1,-1);if(C===n.HalfFloatType&&(c=new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!h)throw a(),new Error("THREE.KTX2Loader: .transcodeImage failed.");r.push(c)}const A=c(r);t.push({data:A,width:o,height:l}),E.push(A.buffer)}I.push({mipmaps:t,width:h,height:u,format:y,type:C})}return a(),{faces:I,buffers:E,width:h,height:u,hasAlpha:m,dfdFlags:f,format:y,type:C}}(a.buffer);self.postMessage({type:"transcode",id:a.id,data:{faces:t,width:o,height:h,hasAlpha:u,format:d,type:p,dfdFlags:g}},s)}catch(e){console.error(e),self.postMessage({type:"error",id:a.id,error:e.message})}}))}var o}));const o=[{if:"astcSupported",basisFormat:[r.UASTC],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],engineType:[n.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],engineType:[n.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.BC1,a.BC3],engineFormat:[s.RGBA_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],engineType:[n.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],engineType:[n.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.ETC1],engineFormat:[s.RGB_ETC1_Format],engineType:[n.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],engineType:[n.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[r.UASTC_HDR],transcoderFormat:[a.BC6H],engineFormat:[s.RGB_BPTC_UNSIGNED_Format],engineType:[n.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.RGBA32,a.RGBA32],engineFormat:[s.RGBAFormat,s.RGBAFormat],engineType:[n.UnsignedByteType,n.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[r.UASTC_HDR],transcoderFormat:[a.RGBA_HALF],engineFormat:[s.RGBAFormat],engineType:[n.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],l={[r.ETC1S]:o.filter((e=>e.basisFormat.includes(r.ETC1S))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[r.UASTC]:o.filter((e=>e.basisFormat.includes(r.UASTC))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[r.UASTC_HDR]:o.filter((e=>e.basisFormat.includes(r.UASTC_HDR))).sort(((e,t)=>e.priorityHDR-t.priorityHDR))};function A(e){return e<=2||!(e&e-1)&&0!==e}function c(e){if(1===e.length)return e[0];let t=0;for(let i=0;i<e.length;i++){t+=e[i].byteLength}const i=new Uint8Array(t);let s=0;for(let t=0;t<e.length;t++){const n=e[t];i.set(n,s),s+=n.byteLength}return i}};const mi=new Set([t.RGBAFormat,t.RGFormat,t.RedFormat]),fi={[$t]:t.RGBAFormat,[Jt]:t.RGBAFormat,[qt]:t.RGBAFormat,[Vt]:t.RGBAFormat,[Xt]:t.RGFormat,[Wt]:t.RGFormat,[Ht]:t.RGFormat,[zt]:t.RGFormat,[Yt]:t.RedFormat,[Kt]:t.RedFormat,[jt]:t.RedFormat,[Nt]:t.RedFormat,[ti]:t.RGBA_ASTC_4x4_Format,[ei]:t.RGBA_ASTC_6x6_Format,[Zt]:t.RGBA_ASTC_6x6_Format},bi={[$t]:t.FloatType,[Jt]:t.HalfFloatType,[qt]:t.UnsignedByteType,[Vt]:t.UnsignedByteType,[Xt]:t.FloatType,[Wt]:t.HalfFloatType,[Ht]:t.UnsignedByteType,[zt]:t.UnsignedByteType,[Yt]:t.FloatType,[Kt]:t.HalfFloatType,[jt]:t.UnsignedByteType,[Nt]:t.UnsignedByteType,[ti]:t.HalfFloatType,[ei]:t.UnsignedByteType,[Zt]:t.UnsignedByteType};function yi(e){const i=e.dataFormatDescriptor[0];return 1===i.colorPrimaries?2===i.transferFunction?t.SRGBColorSpace:t.LinearSRGBColorSpace:10===i.colorPrimaries?2===i.transferFunction?"display-p3":"display-p3-linear":(0===i.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${i.colorPrimaries}"`),t.NoColorSpace)}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Ci,Ii;const Ei=Symbol("retainerCount"),wi=Symbol("recentlyUsed"),Bi=Symbol("evict"),vi=Symbol("evictionThreshold"),xi=Symbol("cache");class Si{constructor(e,t=5){this[Ci]=new Map,this[Ii]=[],this[xi]=e,this[vi]=t}set evictionThreshold(e){this[vi]=e,this[Bi]()}get evictionThreshold(){return this[vi]}get cache(){return this[xi]}retainerCount(e){return this[Ei].get(e)||0}reset(){this[Ei].clear(),this[wi]=[]}retain(e){this[Ei].has(e)||this[Ei].set(e,0),this[Ei].set(e,this[Ei].get(e)+1);const t=this[wi].indexOf(e);-1!==t&&this[wi].splice(t,1),this[wi].unshift(e),this[Bi]()}release(e){this[Ei].has(e)&&this[Ei].set(e,Math.max(this[Ei].get(e)-1,0)),this[Bi]()}[(Ci=Ei,Ii=wi,Bi)](){if(!(this[wi].length<this[vi]))for(let e=this[wi].length-1;e>=this[vi];--e){const t=this[wi][e];0===this[Ei].get(t)&&(this[xi].delete(t),this[wi].splice(e,1))}}}
/* @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Qi=e=>{const t=new Map;for(const i of e.mappings)for(const e of i.variants)t.set(e,{material:null,gltfMaterialIndex:i.material});return t};class Mi{constructor(e){this.parser=e,this.name="KHR_materials_variants"}afterRoot(e){const t=this.parser,i=t.json;if(void 0===i.extensions||void 0===i.extensions[this.name])return null;const s=(e=>{const t=[],i=new Set;for(const s of e){let e=s,n=0;for(;i.has(e);)e=s+"."+ ++n;i.add(e),t.push(e)}return t})((i.extensions[this.name].variants||[]).map((e=>e.name)));for(const s of e.scenes)s.traverse((e=>{const s=e;if(!s.material)return;const n=t.associations.get(s);if(null==n||null==n.meshes||null==n.primitives)return;const a=i.meshes[n.meshes].primitives[n.primitives].extensions;a&&a[this.name]&&(s.userData.variantMaterials=Qi(a[this.name]))}));return e.userData.variants=s,Promise.resolve()}}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Ti,Ri;t.Texture.DEFAULT_ANISOTROPY=4;const Di=new Map,ki=new Map;let Fi;const Li=new Ge;let _i;const Pi=new gi;let Oi,Gi;const Ui=Symbol("loader"),Ni=Symbol("evictionPolicy"),ji=Symbol("GLTFInstance");class Hi extends t.EventDispatcher{static setDRACODecoderLocation(e){Fi=e,Li.setDecoderPath(e)}static getDRACODecoderLocation(){return Fi}static setKTX2TranscoderLocation(e){_i=e,Pi.setTranscoderPath(e)}static getKTX2TranscoderLocation(){return _i}static setMeshoptDecoderLocation(e){var t;Oi!==e&&(Oi=e,Gi=(t=e,new Promise(((e,i)=>{const s=document.createElement("script");document.body.appendChild(s),s.onload=e,s.onerror=i,s.async=!0,s.src=t}))).then((()=>Pe.ready)).then((()=>Pe)))}static getMeshoptDecoderLocation(){return Oi}static initializeKTX2Loader(e){Pi.detectSupport(e)}static get cache(){return Di}static clearCache(){Di.forEach(((e,t)=>{this.delete(t)})),this[Ni].reset()}static has(e){return Di.has(e)}static async delete(e){if(!this.has(e))return;const t=Di.get(e);ki.delete(e),Di.delete(e);(await t).dispose()}static hasFinishedLoading(e){return!!ki.get(e)}constructor(e){super(),this[Ri]=(new je).register((e=>new Mi(e))),this[ji]=e,this[Ui].setDRACOLoader(Li),this[Ui].setKTX2Loader(Pi)}get[(Ti=Ni,Ri=Ui,Ni)](){return this.constructor[Ni]}async preload(e,t,i=()=>{}){if(this[Ui].setWithCredentials(t.withCredentials),this.dispatchEvent({type:"preload",element:t,src:e}),!Di.has(e)){null!=Gi&&this[Ui].setMeshoptDecoder(await Gi);const t=((e,t,i=()=>{})=>{const s=e=>{const t=e.loaded/e.total;i(Math.max(0,Math.min(1,isFinite(t)?t:1)))};return new Promise(((i,n)=>{t.load(e,i,s,n)}))})(e,this[Ui],(e=>{i(.8*e)})),s=this[ji],n=t.then((e=>s.prepare(e))).then((e=>(i(.9),new s(e)))).catch((e=>(console.error(e),new s)));Di.set(e,n)}await Di.get(e),ki.set(e,!0),i&&i(1)}async load(e,t,i=()=>{}){await this.preload(e,t,i);const s=await Di.get(e),n=await s.clone();return this[Ni].retain(e),n.dispose=()=>{this[Ni].release(e)},n}}Hi[Ti]=new Si(Hi);class zi extends t.Object3D{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new t.Vector2(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&null!==e.element.parentNode&&e.element.remove()}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const qi=new t.Vector3,Vi=new t.Matrix4,Ki=new t.Matrix4,Wi=new t.Vector3,Ji=new t.Vector3;class Yi{constructor(e={}){const t=this;let i,s,n,a;const r={objects:new WeakMap},o=void 0!==e.element?e.element:document.createElement("div");function l(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,i=e.children.length;t<i;t++)l(e.children[t])}function A(e,i,s){if(!1!==e.visible){if(e.isCSS2DObject){qi.setFromMatrixPosition(e.matrixWorld),qi.applyMatrix4(Ki);const l=qi.z>=-1&&qi.z<=1&&!0===e.layers.test(s.layers),A=e.element;A.style.display=!0===l?"":"none",!0===l&&(e.onBeforeRender(t,i,s),A.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(qi.x*n+n)+"px,"+(-qi.y*a+a)+"px)",A.parentNode!==o&&o.appendChild(A),e.onAfterRender(t,i,s));const h={distanceToCameraSquared:c(s,e)};r.objects.set(e,h)}for(let t=0,n=e.children.length;t<n;t++)A(e.children[t],i,s)}else l(e)}function c(e,t){return Wi.setFromMatrixPosition(e.matrixWorld),Ji.setFromMatrixPosition(t.matrixWorld),Wi.distanceToSquared(Ji)}o.style.overflow="hidden",this.domElement=o,this.getSize=function(){return{width:i,height:s}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),Vi.copy(t.matrixWorldInverse),Ki.multiplyMatrices(t.projectionMatrix,Vi),A(e,e,t),function(e){const t=function(e){const t=[];return e.traverseVisible((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return r.objects.get(e).distanceToCameraSquared-r.objects.get(t).distanceToCameraSquared})),i=t.length;for(let e=0,s=t.length;e<s;e++)t[e].element.style.zIndex=i-e}(e)},this.setSize=function(e,t){i=e,s=t,n=i/2,a=s/2,o.style.width=e+"px",o.style.height=t+"px"}}}function Xi(e,i,s){let n=s;const a=new t.Vector3;return e.updateWorldMatrix(!0,!0),e.traverseVisible((e=>{const{geometry:t}=e;if(void 0!==t){const{position:s}=t.attributes;if(void 0!==s)for(let t=0,r=s.count;t<r;t++)e.isMesh?e.getVertexPosition(t,a):a.fromBufferAttribute(s,t),e.isSkinnedMesh||a.applyMatrix4(e.matrixWorld),n=i(n,a)}})),n}const $i={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Zi{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register((function(e){return new ks(e)})),this.register((function(e){return new Fs(e)})),this.register((function(e){return new Os(e)})),this.register((function(e){return new Gs(e)})),this.register((function(e){return new Us(e)})),this.register((function(e){return new Ns(e)})),this.register((function(e){return new Ls(e)})),this.register((function(e){return new _s(e)})),this.register((function(e){return new Ps(e)})),this.register((function(e){return new js(e)})),this.register((function(e){return new Hs(e)})),this.register((function(e){return new zs(e)})),this.register((function(e){return new qs(e)})),this.register((function(e){return new Vs(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}setTextureUtils(e){return this.textureUtils=e,this}parse(e,t,i,s){const n=new Ds,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](n));n.setPlugins(a),n.setTextureUtils(this.textureUtils),n.writeAsync(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise((function(s,n){i.parse(e,s,n,t)}))}}const es=0,ts=1,is=2,ss=3,ns=4,as=5120,rs=5121,os=5122,ls=5123,As=5124,cs=5125,hs=5126,us=34962,ds=34963,ps=9728,gs=9729,ms=9984,fs=9985,bs=9986,ys=9987,Cs=33071,Is=33648,Es=10497,ws="KHR_mesh_quantization",Bs={};Bs[t.NearestFilter]=ps,Bs[t.NearestMipmapNearestFilter]=ms,Bs[t.NearestMipmapLinearFilter]=bs,Bs[t.LinearFilter]=gs,Bs[t.LinearMipmapNearestFilter]=fs,Bs[t.LinearMipmapLinearFilter]=ys,Bs[t.ClampToEdgeWrapping]=Cs,Bs[t.RepeatWrapping]=Es,Bs[t.MirroredRepeatWrapping]=Is;const vs={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},xs=new t.Color;function Ss(e,t){return e.length===t.length&&e.every((function(e,i){return e===t[i]}))}function Qs(e){return 4*Math.ceil(e/4)}function Ms(e,t=0){const i=Qs(e.byteLength);if(i!==e.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<i;n++)s[n]=t;return s.buffer}return e}function Ts(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Rs(e,t){if(void 0!==e.toBlob)return new Promise((i=>e.toBlob(i,t)));let i;return"image/jpeg"===t?i=.92:"image/webp"===t&&(i=.8),e.convertToBlob({type:t,quality:i})}let Ds=class{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+t.REVISION}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(e){this.plugins=e}setTextureUtils(e){this.textureUtils=e}async writeAsync(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(e),await Promise.all(this.pending);const s=this,n=s.buffers,a=s.json;i=s.options;const r=s.extensionsUsed,o=s.extensionsRequired,l=new Blob(n,{type:"application/octet-stream"}),A=Object.keys(r),c=Object.keys(o);if(A.length>0&&(a.extensionsUsed=A),c.length>0&&(a.extensionsRequired=c),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=l.size),!0===i.binary){const e=new FileReader;e.readAsArrayBuffer(l),e.onloadend=function(){const i=Ms(e.result),s=new DataView(new ArrayBuffer(8));s.setUint32(0,i.byteLength,!0),s.setUint32(4,5130562,!0);const n=Ms((r=JSON.stringify(a),(new TextEncoder).encode(r).buffer),32);var r;const o=new DataView(new ArrayBuffer(8));o.setUint32(0,n.byteLength,!0),o.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),A=new DataView(l);A.setUint32(0,1179937895,!0),A.setUint32(4,2,!0);const c=12+o.byteLength+n.byteLength+s.byteLength+i.byteLength;A.setUint32(8,c,!0);const h=new Blob([l,o,n,s,i],{type:"application/octet-stream"}),u=new FileReader;u.readAsArrayBuffer(h),u.onloadend=function(){t(u.result)}}}else if(a.buffers&&a.buffers.length>0){const e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){const i=e.result;a.buffers[0].uri=i,t(a)}}else t(a)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const i=this.options,s=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&n.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],s[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new t.Vector3;for(let t=0,s=e.count;t<s;t++)if(Math.abs(i.fromBufferAttribute(e,t).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),n=new t.Vector3;for(let e=0,t=s.count;e<t;e++)n.fromBufferAttribute(s,e),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),s.setXYZ(e,n.x,n.y,n.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let i=!1;const s={};0===t.offset.x&&0===t.offset.y||(s.offset=t.offset.toArray(),i=!0),0!==t.rotation&&(s.rotation=t.rotation,i=!0),1===t.repeat.x&&1===t.repeat.y||(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(e,i){if(e===i)return e;function s(e){return e.colorSpace===t.SRGBColorSpace?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}e instanceof t.CompressedTexture&&(e=await this.decompressTextureAsync(e)),i instanceof t.CompressedTexture&&(i=await this.decompressTextureAsync(i));const n=e?e.image:null,a=i?i.image:null,r=Math.max(n?n.width:0,a?a.width:0),o=Math.max(n?n.height:0,a?a.height:0),l=Ts();l.width=r,l.height=o;const A=l.getContext("2d",{willReadFrequently:!0});A.fillStyle="#00ffff",A.fillRect(0,0,r,o);const c=A.getImageData(0,0,r,o);if(n){A.drawImage(n,0,0,r,o);const t=s(e),i=A.getImageData(0,0,r,o).data;for(let e=2;e<i.length;e+=4)c.data[e]=256*t(i[e]/256)}if(a){A.drawImage(a,0,0,r,o);const e=s(i),t=A.getImageData(0,0,r,o).data;for(let i=1;i<t.length;i+=4)c.data[i]=256*e(t[i]/256)}A.putImageData(c,0,0);const h=(e||i).clone();return h.source=new t.Source(l),h.colorSpace=t.NoColorSpace,h.channel=(e||i).channel,e&&i&&e.channel!==i.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),h}async decompressTextureAsync(e,t=1/0){if(null===this.textureUtils)throw new Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(e,t)}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,i,s,n,a){const r=this.json;let o;switch(r.bufferViews||(r.bufferViews=[]),i){case as:case rs:o=1;break;case os:case ls:o=2;break;default:o=4}let l=e.itemSize*o;a===us&&(l=4*Math.ceil(l/4));const A=Qs(n*l),c=new DataView(new ArrayBuffer(A));let h=0;for(let a=s;a<s+n;a++){for(let s=0;s<e.itemSize;s++){let n;e.itemSize>4?n=e.array[a*e.itemSize+s]:(0===s?n=e.getX(a):1===s?n=e.getY(a):2===s?n=e.getZ(a):3===s&&(n=e.getW(a)),!0===e.normalized&&(n=t.MathUtils.normalize(n,e.array))),i===hs?c.setFloat32(h,n,!0):i===As?c.setInt32(h,n,!0):i===cs?c.setUint32(h,n,!0):i===os?c.setInt16(h,n,!0):i===ls?c.setUint16(h,n,!0):i===as?c.setInt8(h,n):i===rs&&c.setUint8(h,n),h+=o}h%l!==0&&(h+=l-h%l)}const u={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:A};void 0!==a&&(u.target=a),a===us&&(u.byteStride=l),this.byteOffset+=A,r.bufferViews.push(u);return{id:r.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise((function(s){const n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){const e=Ms(n.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,s(i.bufferViews.push(a)-1)}}))}processAccessor(e,i,s,n){const a=this.json;let r;if(e.array.constructor===Float32Array)r=hs;else if(e.array.constructor===Int32Array)r=As;else if(e.array.constructor===Uint32Array)r=cs;else if(e.array.constructor===Int16Array)r=os;else if(e.array.constructor===Uint16Array)r=ls;else if(e.array.constructor===Int8Array)r=as;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);r=rs}if(void 0===s&&(s=0),void 0!==n&&n!==1/0||(n=e.count),0===n)return null;const o=function(e,i,s){const n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let a=i;a<i+s;a++)for(let i=0;i<e.itemSize;i++){let s;e.itemSize>4?s=e.array[a*e.itemSize+i]:(0===i?s=e.getX(a):1===i?s=e.getY(a):2===i?s=e.getZ(a):3===i&&(s=e.getW(a)),!0===e.normalized&&(s=t.MathUtils.normalize(s,e.array))),n.min[i]=Math.min(n.min[i],s),n.max[i]=Math.max(n.max[i],s)}return n}(e,s,n);let l;void 0!==i&&(l=e===i.index?ds:us);const A=this.processBufferView(e,r,s,n,l),c={bufferView:A.id,byteOffset:A.byteOffset,componentType:r,count:n,max:o.max,min:o.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(c)-1}processImage(e,i,s,n="image/png"){if(null!==e){const a=this,r=a.cache,o=a.json,l=a.options,A=a.pending;r.images.has(e)||r.images.set(e,{});const c=r.images.get(e),h=n+":flipY/"+s.toString();if(void 0!==c[h])return c[h];o.images||(o.images=[]);const u={mimeType:n},d=Ts();d.width=Math.min(e.width,l.maxTextureSize),d.height=Math.min(e.height,l.maxTextureSize);const p=d.getContext("2d",{willReadFrequently:!0});if(!0===s&&(p.translate(0,d.height),p.scale(1,-1)),void 0!==e.data){i!==t.RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported.",i),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const s=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<s.length;t+=4)s[t+0]=e.data[t+0],s[t+1]=e.data[t+1],s[t+2]=e.data[t+2],s[t+3]=e.data[t+3];p.putImageData(new ImageData(s,e.width,e.height),0,0)}else{if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");p.drawImage(e,0,0,d.width,d.height)}!0===l.binary?A.push(Rs(d,n).then((e=>a.processBufferViewImage(e))).then((e=>{u.bufferView=e}))):void 0!==d.toDataURL?u.uri=d.toDataURL(n):A.push(Rs(d,n).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{u.uri=e})));const g=o.images.push(u)-1;return c[h]=g,g}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:Bs[e.magFilter],minFilter:Bs[e.minFilter],wrapS:Bs[e.wrapS],wrapT:Bs[e.wrapT]};return t.samplers.push(i)-1}async processTextureAsync(e){const i=this.options,s=this.cache,n=this.json;if(s.textures.has(e))return s.textures.get(e);n.textures||(n.textures=[]),e instanceof t.CompressedTexture&&(e=await this.decompressTextureAsync(e,i.maxTextureSize));let a=e.userData.mimeType;"image/webp"===a&&(a="image/png");const r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(r.name=e.name),await this._invokeAllAsync((async function(t){t.writeTexture&&await t.writeTexture(e,r)}));const o=n.textures.push(r)-1;return s.textures.set(e,o),o}async processMaterialAsync(e){const i=this.cache,s=this.json;if(i.materials.has(e))return i.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const n={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const a=e.color.toArray().concat([e.opacity]);if(Ss(a,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=a),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=0,n.pbrMetallicRoughness.roughnessFactor=1),e.metalnessMap||e.roughnessMap){const t=await this.buildMetalRoughTextureAsync(e.metalnessMap,e.roughnessMap),i={index:await this.processTextureAsync(t),texCoord:t.channel};this.applyTextureTransform(i,t),n.pbrMetallicRoughness.metallicRoughnessTexture=i}if(e.map){const t={index:await this.processTextureAsync(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),n.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(n.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:await this.processTextureAsync(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),n.emissiveTexture=t}}if(e.normalMap){const t={index:await this.processTextureAsync(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),n.normalTexture=t}if(e.aoMap){const t={index:await this.processTextureAsync(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),n.occlusionTexture=t}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===t.DoubleSide&&(n.doubleSided=!0),""!==e.name&&(n.name=e.name),this.serializeUserData(e,n),await this._invokeAllAsync((async function(t){t.writeMaterialAsync&&await t.writeMaterialAsync(e,n)}));const r=s.materials.push(n)-1;return i.materials.set(e,r),r}async processMeshAsync(e){const i=this.cache,s=this.json,n=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)n.push(e.material[t].uuid);else n.push(e.material.uuid);const a=n.join(":");if(i.meshes.has(a))return i.meshes.get(a);const r=e.geometry;let o;o=e.isLineSegments?ts:e.isLineLoop?is:e.isLine?ss:e.isPoints?es:e.material.wireframe?ts:ns;const l={},A={},c=[],h=[],u={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=r.getAttribute("normal");void 0===d||this.isNormalizedNormalAttribute(d)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),r.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let p=null;for(let e in r.attributes){if("morph"===e.slice(0,5))continue;const s=r.attributes[e];e=u[e]||e.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),i.attributes.has(this.getUID(s))){A[e]=i.attributes.get(this.getUID(s));continue}p=null;const n=s.array;"JOINTS_0"!==e||n instanceof Uint16Array||n instanceof Uint8Array?(n instanceof Uint32Array||n instanceof Int32Array)&&!e.startsWith("_")&&(console.warn(`GLTFExporter: Attribute "${e}" converted to type FLOAT.`),p=Zi.Utils.toFloat32BufferAttribute(s)):(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new t.BufferAttribute(new Uint16Array(n),s.itemSize,s.normalized));const a=this.processAccessor(p||s,r);null!==a&&(e.startsWith("_")||this.detectMeshQuantization(e,s),A[e]=a,i.attributes.set(this.getUID(s),a))}if(void 0!==d&&r.setAttribute("normal",d),0===Object.keys(A).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const t=[],s=[],n={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let a=0;a<e.morphTargetInfluences.length;++a){const o={};let l=!1;for(const e in r.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const t=r.morphAttributes[e][a],s=e.toUpperCase(),n=r.attributes[e];if(i.attributes.has(this.getUID(t,!0))){o[s]=i.attributes.get(this.getUID(t,!0));continue}const A=t.clone();if(!r.morphTargetsRelative)for(let e=0,i=t.count;e<i;e++)for(let i=0;i<t.itemSize;i++)0===i&&A.setX(e,t.getX(e)-n.getX(e)),1===i&&A.setY(e,t.getY(e)-n.getY(e)),2===i&&A.setZ(e,t.getZ(e)-n.getZ(e)),3===i&&A.setW(e,t.getW(e)-n.getW(e));o[s]=this.processAccessor(A,r),i.attributes.set(this.getUID(n,!0),o[s])}h.push(o),t.push(e.morphTargetInfluences[a]),void 0!==e.morphTargetDictionary&&s.push(n[a])}l.weights=t,s.length>0&&(l.extras={},l.extras.targetNames=s)}const g=Array.isArray(e.material);if(g&&0===r.groups.length)return null;let m=!1;if(g&&null===r.index){const e=[];for(let t=0,i=r.attributes.position.count;t<i;t++)e[t]=t;r.setIndex(e),m=!0}const f=g?e.material:[e.material],b=g?r.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,t=b.length;e<t;e++){const t={mode:o,attributes:A};if(this.serializeUserData(r,t),h.length>0&&(t.targets=h),null!==r.index){let s=this.getUID(r.index);void 0===b[e].start&&void 0===b[e].count||(s+=":"+b[e].start+":"+b[e].count),i.attributes.has(s)?t.indices=i.attributes.get(s):(t.indices=this.processAccessor(r.index,r,b[e].start,b[e].count),i.attributes.set(s,t.indices)),null===t.indices&&delete t.indices}const s=await this.processMaterialAsync(f[b[e].materialIndex]);null!==s&&(t.material=s),c.push(t)}!0===m&&r.setIndex(null),l.primitives=c,s.meshes||(s.meshes=[]),await this._invokeAllAsync((function(t){t.writeMesh&&t.writeMesh(e,l)}));const y=s.meshes.push(l)-1;return i.meshes.set(a,y),y}detectMeshQuantization(e,t){if(this.extensionsUsed[ws])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const s=e.split("_",1)[0];$i[s]&&$i[s].includes(i)&&(this.extensionsUsed[ws]=!0,this.extensionsRequired[ws]=!0)}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,n={type:s?"orthographic":"perspective"};return s?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:t.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(n.name=e.type),i.cameras.push(n)-1}processAnimation(e,i){const s=this.json,n=this.nodeMap;s.animations||(s.animations=[]);const a=(e=Zi.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks,r=[],o=[];for(let e=0;e<a.length;++e){const s=a[e],l=t.PropertyBinding.parseTrackName(s.name);let A=t.PropertyBinding.findNode(i,l.nodeName);const c=vs[l.propertyName];if("bones"===l.objectName&&(A=!0===A.isSkinnedMesh?A.skeleton.getBoneByName(l.objectIndex):void 0),!A||!c){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',s.name);continue}const h=1;let u,d=s.values.length/s.times.length;c===vs.morphTargetInfluences&&(d/=A.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(u="CUBICSPLINE",d/=3):u=s.getInterpolation()===t.InterpolateDiscrete?"STEP":"LINEAR",o.push({input:this.processAccessor(new t.BufferAttribute(s.times,h)),output:this.processAccessor(new t.BufferAttribute(s.values,d)),interpolation:u}),r.push({sampler:o.length-1,target:{node:n.get(A),path:c}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:o,channels:r}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,n=i.nodes[s.get(e)],a=e.skeleton;if(void 0===a)return null;const r=e.skeleton.bones[0];if(void 0===r)return null;const o=[],l=new Float32Array(16*a.bones.length),A=new t.Matrix4;for(let t=0;t<a.bones.length;++t)o.push(s.get(a.bones[t])),A.copy(a.boneInverses[t]),A.multiply(e.bindMatrix).toArray(l,16*t);void 0===i.skins&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new t.BufferAttribute(l,16)),joints:o,skeleton:s.get(r)});return n.skin=i.skins.length-1}async processNodeAsync(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const n={};if(i.trs){const t=e.quaternion.toArray(),i=e.position.toArray(),s=e.scale.toArray();Ss(t,[0,0,0,1])||(n.rotation=t),Ss(i,[0,0,0])||(n.translation=i),Ss(s,[1,1,1])||(n.scale=s)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Ss(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){const t=await this.processMeshAsync(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let s=0,n=e.children.length;s<n;s++){const n=e.children[s];if(n.visible||!1===i.onlyVisible){const e=await this.processNodeAsync(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}await this._invokeAllAsync((function(t){t.writeNode&&t.writeNode(e,n)}));const a=t.nodes.push(n)-1;return s.set(e,a),a}async processSceneAsync(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};""!==e.name&&(s.name=e.name),t.scenes.push(s);const n=[];for(let t=0,s=e.children.length;t<s;t++){const s=e.children[t];if(s.visible||!1===i.onlyVisible){const e=await this.processNodeAsync(s);null!==e&&n.push(e)}}n.length>0&&(s.nodes=n),this.serializeUserData(e,s)}async processObjectsAsync(e){const i=new t.Scene;i.name="AuxScene";for(let t=0;t<e.length;t++)i.children.push(e[t]);await this.processSceneAsync(i)}async processInputAsync(e){const i=this.options;e=e instanceof Array?e:[e],await this._invokeAllAsync((function(t){t.beforeParse&&t.beforeParse(e)}));const s=[];for(let i=0;i<e.length;i++)e[i]instanceof t.Scene?await this.processSceneAsync(e[i]):s.push(e[i]);s.length>0&&await this.processObjectsAsync(s);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let t=0;t<i.animations.length;++t)this.processAnimation(i.animations[t],e[0]);await this._invokeAllAsync((function(t){t.afterParse&&t.afterParse(e)}))}async _invokeAllAsync(e){for(let t=0,i=this.plugins.length;t<i;t++)await e(this.plugins[t])}},ks=class{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const i=this.writer,s=i.json,n=i.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},n[this.name]=!0);const r=s.extensions[this.name].lights;r.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:r.length-1}}},Fs=class{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}async writeMaterialAsync(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}},Ls=class{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:await i.processTextureAsync(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:await i.processTextureAsync(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:await i.processTextureAsync(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};1!==e.clearcoatNormalScale.x&&(t.scale=e.clearcoatNormalScale.x),i.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}};class _s{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.dispersion)return;const i=this.writer.extensionsUsed,s={};s.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}let Ps=class{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:await i.processTextureAsync(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:await i.processTextureAsync(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},Os=class{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){const t={index:await i.processTextureAsync(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},Gs=class{constructor(e){this.writer=e,this.name="KHR_materials_volume"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){const t={index:await i.processTextureAsync(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}e.attenuationDistance!==1/0&&(n.attenuationDistance=e.attenuationDistance),n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},Us=class{constructor(e){this.writer=e,this.name="KHR_materials_ior"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const i=this.writer.extensionsUsed,s={};s.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}},Ns=class{constructor(e){this.writer=e,this.name="KHR_materials_specular"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(xs)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.specularIntensityMap){const t={index:await i.processTextureAsync(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(t,e.specularIntensityMap),n.specularTexture=t}if(e.specularColorMap){const t={index:await i.processTextureAsync(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(t,e.specularColorMap),n.specularColorTexture=t}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},js=class{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.sheenRoughnessMap){const t={index:await i.processTextureAsync(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:await i.processTextureAsync(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},Hs=class{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.anisotropyMap){const t={index:await i.processTextureAsync(e.anisotropyMap)};i.applyTextureTransform(t,e.anisotropyMap),n.anisotropyTexture=t}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},zs=class{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const i=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}},qs=class{constructor(e){this.writer=e,this.name="EXT_materials_bump"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.bumpMap){const t={index:await i.processTextureAsync(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(t,e.bumpMap),n.bumpTexture=t}n.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},Vs=class{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,i){if(!e.isInstancedMesh)return;const s=this.writer,n=e,a=new Float32Array(3*n.count),r=new Float32Array(4*n.count),o=new Float32Array(3*n.count),l=new t.Matrix4,A=new t.Vector3,c=new t.Quaternion,h=new t.Vector3;for(let e=0;e<n.count;e++)n.getMatrixAt(e,l),l.decompose(A,c,h),A.toArray(a,3*e),c.toArray(r,4*e),h.toArray(o,3*e);const u={TRANSLATION:s.processAccessor(new t.BufferAttribute(a,3)),ROTATION:s.processAccessor(new t.BufferAttribute(r,4)),SCALE:s.processAccessor(new t.BufferAttribute(o,3))};n.instanceColor&&(u._COLOR_0=s.processAccessor(n.instanceColor)),i.extensions=i.extensions||{},i.extensions[this.name]={attributes:u},s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0}};Zi.Utils={insertKeyframe:function(e,t){const i=.001,s=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+s),r=e.createInterpolant(new e.ValueBufferType(s));let o;if(0===e.times.length){n[0]=t;for(let e=0;e<s;e++)a[e]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<i)return 0;n[0]=t,n.set(e.times,1),a.set(r.evaluate(t),0),a.set(e.values,s),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<i)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),a.set(e.values,0),a.set(r.evaluate(t),e.values.length),o=n.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<i)return l;if(e.times[l]<t&&e.times[l+1]>t){n.set(e.times.slice(0,l+1),0),n[l+1]=t,n.set(e.times.slice(l+1),l+2),a.set(e.values.slice(0,(l+1)*s),0),a.set(r.evaluate(t),(l+1)*s),a.set(e.values.slice((l+1)*s),(l+2)*s),o=l+1;break}}return e.times=n,e.values=a,o},mergeMorphTargetTracks:function(e,i){const s=[],n={},a=e.tracks;for(let e=0;e<a.length;++e){let r=a[e];const o=t.PropertyBinding.parseTrackName(r.name),l=t.PropertyBinding.findNode(i,o.nodeName);if("morphTargetInfluences"!==o.propertyName||void 0===o.propertyIndex){s.push(r);continue}if(r.createInterpolant!==r.InterpolantFactoryMethodDiscrete&&r.createInterpolant!==r.InterpolantFactoryMethodLinear){if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),r=r.clone(),r.setInterpolation(t.InterpolateLinear)}const A=l.morphTargetInfluences.length,c=l.morphTargetDictionary[o.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let h;if(void 0===n[l.uuid]){h=r.clone();const e=new h.ValueBufferType(A*h.times.length);for(let t=0;t<h.times.length;t++)e[t*A+c]=h.values[t];h.name=(o.nodeName||"")+".morphTargetInfluences",h.values=e,n[l.uuid]=h,s.push(h);continue}const u=r.createInterpolant(new r.ValueBufferType(1));h=n[l.uuid];for(let e=0;e<h.times.length;e++)h.values[e*A+c]=u.evaluate(h.times[e]);for(let e=0;e<r.times.length;e++){const t=this.insertKeyframe(h,r.times[e]);h.values[t*A+c]=r.values[e]}}return e.tracks=s,e},toFloat32BufferAttribute:function(e){const i=new t.BufferAttribute(new Float32Array(e.count*e.itemSize),e.itemSize,!1);if(!e.normalized&&!e.isInterleavedBufferAttribute)return i.array.set(e.array),i;for(let t=0,s=e.count;t<s;t++)for(let s=0;s<e.itemSize;s++)i.setComponent(t,s,e.getComponent(t,s));return i}};
/* @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Ks=e=>void 0!==e.material&&e.userData&&e.userData.variantMaterials&&!!Array.from(e.userData.variantMaterials.values()).filter((e=>Ws(e.material))),Ws=e=>e&&e.isMaterial&&!Array.isArray(e);class Js{constructor(e){this.writer=e,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(e){const t=new Set,i=e=>{if(!Ks(e))return;const i=e.userData.variantMaterials,s=e.userData.variantData;for(const[e,n]of s){const s=i.get(n.index);s&&Ws(s.material)&&t.add(e)}};if(Array.isArray(e))for(const t of e)t.traverse(i);else e.traverse(i);t.forEach((e=>this.variantNames.push(e)))}async writeMesh(e,t){if(!Ks(e))return;const i=e.userData,s=i.variantMaterials,n=i.variantData,a=new Map,r=new Map,o=Array.from(n.values()).sort(((e,t)=>e.index-t.index));for(const[e,t]of o.entries())r.set(t.index,e);for(const e of n.values()){const t=s.get(e.index);if(!t||!Ws(t.material))continue;const i=await this.writer.processMaterialAsync(t.material);a.has(i)||a.set(i,{material:i,variants:[]}),a.get(i).variants.push(r.get(e.index))}const l=Array.from(a.values()).map((e=>e.variants.sort(((e,t)=>e-t))&&e)).sort(((e,t)=>e.material-t.material));if(0===l.length)return;const A=Ws(i.originalMaterial)?await this.writer.processMaterialAsync(i.originalMaterial):-1;for(const e of t.primitives)A>=0&&(e.material=A),e.extensions=e.extensions||{},e.extensions[this.name]={mappings:l}}afterParse(){if(0===this.variantNames.length)return;const e=this.writer.json;e.extensions=e.extensions||{};const t=this.variantNames.map((e=>({name:e})));e.extensions[this.name]={variants:t},this.writer.extensionsUsed[this.name]=!0}}class Ys{constructor(e,i,s,n,a){this.xrLight=e,this.renderer=i,this.lightProbe=s,this.xrWebGLBinding=null,this.estimationStartCallback=a,this.frameCallback=this.onXRFrame.bind(this);const r=i.xr.getSession();if(n&&"XRWebGLBinding"in window){const s=new t.WebGLCubeRenderTarget(16);e.environment=s.texture;const n=i.getContext();switch(r.preferredReflectionFormat){case"srgba8":n.getExtension("EXT_sRGB");break;case"rgba16f":n.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(r,n),this.lightProbe.addEventListener("reflectionchange",(()=>{this.updateReflection()}))}r.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const i=t.getLightEstimate(this.lightProbe);if(i){this.xrLight.lightProbe.sh.fromArray(i.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const e=Math.max(1,Math.max(i.primaryLightIntensity.x,Math.max(i.primaryLightIntensity.y,i.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(i.primaryLightIntensity.x/e,i.primaryLightIntensity.y/e,i.primaryLightIntensity.z/e),this.xrLight.directionalLight.intensity=e,this.xrLight.directionalLight.position.copy(i.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class Xs extends t.Group{constructor(e,i=!0){super(),this.lightProbe=new t.LightProbe,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new t.DirectionalLight,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let s=null,n=!1;e.xr.addEventListener("sessionstart",(()=>{const t=e.xr.getSession();"requestLightProbe"in t&&t.requestLightProbe({reflectionFormat:t.preferredReflectionFormat}).then((t=>{s=new Ys(this,e,t,i,(()=>{n=!0,this.dispatchEvent({type:"estimationstart"})}))}))})),e.xr.addEventListener("sessionend",(()=>{s&&(s.dispose(),s=null),n&&this.dispatchEvent({type:"estimationend"})})),this.dispose=()=>{s&&(s.dispose(),s=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class $s{constructor(e=50){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,t,i,s){const n=2e-4*this.naturalFrequency;if(null==e||0===s)return t;if(e===t&&0===this.velocity)return t;if(i<0)return e;const a=e-t,r=this.velocity+this.naturalFrequency*a,o=a+i*r,l=Math.exp(-this.naturalFrequency*i),A=(r-this.naturalFrequency*o)*l,c=-this.naturalFrequency*(A+r*l);return Math.abs(A)<n*Math.abs(s)&&c*a>=0?(this.velocity=0,t):(this.velocity=A,t+o*l)}}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Zs=.2,en=Math.PI/24,tn=new t.Vector2,sn=(e,t,i)=>{let s=t>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let n=0;n<=12;++n)e.push(t+.17*Math.cos(s),i+.17*Math.sin(s),0,t+Zs*Math.cos(s),i+Zs*Math.sin(s),0),s+=en};class nn extends t.Mesh{constructor(e,i){const s=new t.BufferGeometry,n=[],a=[],{size:r,boundingBox:o}=e,l=r.x/2,A=("back"===i?r.y:r.z)/2;sn(a,l,A),sn(a,-l,A),sn(a,-l,-A),sn(a,l,-A);const c=a.length/3;for(let e=0;e<c-2;e+=2)n.push(e,e+1,e+3,e,e+3,e+2);const h=c-2;n.push(h,h+1,1,h,1,0),s.setAttribute("position",new t.Float32BufferAttribute(a,3)),s.setIndex(n),super(s),this.side=i;const u=this.material;switch(u.side=t.DoubleSide,u.transparent=!0,u.opacity=0,this.goalOpacity=0,this.opacityDamper=new $s,this.hitPlane=new t.Mesh(new t.PlaneGeometry(2*(l+Zs),2*(A+Zs))),this.hitPlane.visible=!1,this.hitPlane.material.side=t.DoubleSide,this.add(this.hitPlane),this.hitBox=new t.Mesh(new t.BoxGeometry(r.x+.4,r.y+Zs,r.z+.4)),this.hitBox.visible=!1,this.hitBox.material.side=t.DoubleSide,this.add(this.hitBox),o.getCenter(this.position),i){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=o.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=o.min.z,this.position.z=this.shadowHeight}e.target.add(this),this.hitBox.position.y=(r.y+Zs)/2+o.min.y,e.target.add(this.hitBox),this.offsetHeight=0}getHit(e,t,i){tn.set(t,-i),this.hitPlane.visible=!0;const s=e.positionAndNormalFromPoint(tn,this.hitPlane);return this.hitPlane.visible=!1,null==s?null:s.position}getExpandedHit(e,t,i){this.hitPlane.scale.set(1e3,1e3,1e3),this.hitPlane.updateMatrixWorld();const s=this.getHit(e,t,i);return this.hitPlane.scale.set(1,1,1),s}controllerIntersection(e,t){this.hitBox.visible=!0;const i=e.hitFromController(t,this.hitBox);return this.hitBox.visible=!1,i}set offsetHeight(e){e-=.001,"back"===this.side?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return"back"===this.side?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.goalOpacity=e?.75:0}updateOpacity(e){const t=this.material;t.opacity=this.opacityDamper.update(t.opacity,this.goalOpacity,e,1),this.visible=t.opacity>0}dispose(){const{geometry:e,material:t}=this.hitPlane;e.dispose(),t.dispose(),this.hitBox.geometry.dispose(),this.hitBox.material.dispose(),this.geometry.dispose(),this.material.dispose(),this.hitBox.removeFromParent(),this.removeFromParent()}}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const an=(e,t)=>({type:"number",number:e,unit:t}),rn=(()=>{const e={};return t=>{const i=t;if(i in e)return e[i];const s=[];let n=0;for(;t;){if(++n>1e3){t="";break}const e=on(t),i=e.nodes[0];if(null==i||0===i.terms.length)break;s.push(i),t=e.remainingInput}return e[i]=s}})(),on=(()=>{const e=/^(\-\-|[a-z\u0240-\uffff])/i,t=/^([\*\+\/]|[\-]\s)/i,i=/^[\),]/;return s=>{const n=[];for(;s.length&&(s=s.trim(),!i.test(s));)if("("===s[0]){const{nodes:e,remainingInput:t}=hn(s);s=t,n.push({type:"function",name:{type:"ident",value:"calc"},arguments:e})}else if(e.test(s)){const e=ln(s),t=e.nodes[0];if("("===(s=e.remainingInput)[0]){const{nodes:e,remainingInput:i}=hn(s);n.push({type:"function",name:t,arguments:e}),s=i}else n.push(t)}else if(t.test(s))n.push({type:"operator",value:s[0]}),s=s.slice(1);else{const{nodes:e,remainingInput:t}="#"===s[0]?cn(s):An(s);if(0===e.length)break;n.push(e[0]),s=t}return{nodes:[{type:"expression",terms:n}],remainingInput:s}}})(),ln=(()=>{const e=/[^a-z0-9_\-\u0240-\uffff]/i;return t=>{const i=t.match(e);return{nodes:[{type:"ident",value:null==i?t:t.substr(0,i.index)}],remainingInput:null==i?"":t.substr(i.index)}}})(),An=(()=>{const e=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,t=/^[a-z%]+/i,i=/^(m|mm|cm|rad|deg|[%])$/;return s=>{const n=s.match(e),a=null==n?"0":n[0],r=(s=null==a?s:s.slice(a.length)).match(t);let o=null!=r&&""!==r[0]?r[0]:null;const l=null==r?s:s.slice(o.length);return null==o||i.test(o)||(o=null),{nodes:[{type:"number",number:parseFloat(a)||0,unit:o}],remainingInput:l}}})(),cn=(()=>{const e=/^[a-f0-9]*/i;return t=>{const i=(t=t.slice(1).trim()).match(e);return{nodes:null==i?[]:[{type:"hex",value:i[0]}],remainingInput:null==i?t:t.slice(i[0].length)}}})(),hn=e=>{const t=[];for(e=e.slice(1).trim();e.length;){const i=on(e);if(t.push(i.nodes[0]),","===(e=i.remainingInput.trim())[0])e=e.slice(1).trim();else if(")"===e[0]){e=e.slice(1);break}}return{nodes:t,remainingInput:e}},un=Symbol("visitedTypes");class dn{constructor(e){this[un]=e}walk(e,t){const i=e.slice();for(;i.length;){const e=i.shift();switch(this[un].indexOf(e.type)>-1&&t(e),e.type){case"expression":i.unshift(...e.terms);break;case"function":i.unshift(e.name,...e.arguments)}}}}const pn=Object.freeze({type:"number",number:0,unit:null}),gn=(e,t=0)=>{let{number:i,unit:s}=e;if(isFinite(i)){if("rad"===e.unit||null==e.unit)return e}else i=t,s="rad";return{type:"number",number:("deg"===s&&null!=i?i:0)*Math.PI/180,unit:"rad"}},mn=(e,t=0)=>{let i,{number:s,unit:n}=e;if(isFinite(s)){if("m"===e.unit)return e}else s=t,n="m";switch(n){default:i=1;break;case"cm":i=.01;break;case"mm":i=.001}return{type:"number",number:i*s,unit:"m"}},fn=(()=>{const e=e=>e,t={rad:e,deg:gn,m:e,mm:mn,cm:mn};return(e,i=pn)=>{isFinite(e.number)||(e.number=i.number,e.unit=i.unit);const{unit:s}=e;if(null==s)return e;const n=t[s];return null==n?i:n(e)}})();
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var bn,yn,Cn;const In=Symbol("evaluate"),En=Symbol("lastValue");class wn{constructor(){this[bn]=null}static evaluatableFor(e,t=pn){if(e instanceof wn)return e;if("number"===e.type)return"%"===e.unit?new xn(e,t):e;switch(e.name.value){case"calc":return new Rn(e,t);case"env":return new Qn(e)}return pn}static evaluate(e){return e instanceof wn?e.evaluate():e}static isConstant(e){return!(e instanceof wn)||e.isConstant}static applyIntrinsics(e,t){const{basis:i,keywords:s}=t,{auto:n}=s;return i.map(((t,i)=>{const a=null==n[i]?t:n[i];let r=e[i]?e[i]:a;if("ident"===r.type){const e=r.value;e in s&&(r=s[e][i])}return null!=r&&"ident"!==r.type||(r=a),"%"===r.unit?an(r.number/100*t.number,t.unit):(r=fn(r,t),r.unit!==t.unit?t:r)}))}get isConstant(){return!1}evaluate(){return this.isConstant&&null!=this[En]||(this[En]=this[In]()),this[En]}}bn=En;const Bn=Symbol("percentage"),vn=Symbol("basis");class xn extends wn{constructor(e,t){super(),this[Bn]=e,this[vn]=t}get isConstant(){return!0}[In](){return an(this[Bn].number/100*this[vn].number,this[vn].unit)}}const Sn=Symbol("identNode");class Qn extends wn{constructor(e){super(),this[yn]=null;const t=e.arguments.length?e.arguments[0].terms[0]:null;null!=t&&"ident"===t.type&&(this[Sn]=t)}get isConstant(){return!1}[(yn=Sn,In)](){if(null!=this[Sn]&&"window-scroll-y"===this[Sn].value){return{type:"number",number:window.pageYOffset/(Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight)||0,unit:null}}return pn}}const Mn=/[\*\/]/,Tn=Symbol("evaluator");class Rn extends wn{constructor(e,t=pn){if(super(),this[Cn]=null,1!==e.arguments.length)return;const i=e.arguments[0].terms.slice(),s=[];for(;i.length;){const e=i.shift();if(s.length>0){const i=s[s.length-1];if("operator"===i.type&&Mn.test(i.value)){const i=s.pop(),n=s.pop();if(null==n)return;s.push(new Ln(i,wn.evaluatableFor(n,t),wn.evaluatableFor(e,t)));continue}}s.push("operator"===e.type?e:wn.evaluatableFor(e,t))}for(;s.length>2;){const[e,i,n]=s.splice(0,3);if("operator"!==i.type)return;s.unshift(new Ln(i,wn.evaluatableFor(e,t),wn.evaluatableFor(n,t)))}1===s.length&&(this[Tn]=s[0])}get isConstant(){return null==this[Tn]||wn.isConstant(this[Tn])}[(Cn=Tn,In)](){return null!=this[Tn]?wn.evaluate(this[Tn]):pn}}const Dn=Symbol("operator"),kn=Symbol("left"),Fn=Symbol("right");class Ln extends wn{constructor(e,t,i){super(),this[Dn]=e,this[kn]=t,this[Fn]=i}get isConstant(){return wn.isConstant(this[kn])&&wn.isConstant(this[Fn])}[In](){const e=fn(wn.evaluate(this[kn])),t=fn(wn.evaluate(this[Fn])),{number:i,unit:s}=e,{number:n,unit:a}=t;if(null!=a&&null!=s&&a!=s)return pn;const r=s||a;let o;switch(this[Dn].value){case"+":o=i+n;break;case"-":o=i-n;break;case"/":o=i/n;break;case"*":o=i*n;break;default:return pn}return{type:"number",number:o,unit:r}}}const _n=Symbol("evaluatables"),Pn=Symbol("intrinsics");class On extends wn{constructor(e,t){super(),this[Pn]=t;const i=e[0],s=null!=i?i.terms:[];this[_n]=t.basis.map(((e,t)=>{const i=s[t];return null==i?{type:"ident",value:"auto"}:"ident"===i.type?i:wn.evaluatableFor(i,e)}))}get isConstant(){for(const e of this[_n])if(!wn.isConstant(e))return!1;return!0}[In](){const e=this[_n].map((e=>wn.evaluate(e)));return wn.applyIntrinsics(e,this[Pn]).map((e=>e.number))}}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Gn,Un,Nn,jn;const Hn=Symbol("instances"),zn=Symbol("activateListener"),qn=Symbol("deactivateListener"),Vn=Symbol("notifyInstances"),Kn=Symbol("notify"),Wn=Symbol("callback");class Jn{static[Vn](){for(const e of Jn[Hn])e[Kn]()}static[(Gn=Hn,zn)](){window.addEventListener("scroll",this[Vn],{passive:!0})}static[qn](){window.removeEventListener("scroll",this[Vn])}constructor(e){this[Wn]=e}observe(){0===Jn[Hn].size&&Jn[zn](),Jn[Hn].add(this)}disconnect(){Jn[Hn].delete(this),0===Jn[Hn].size&&Jn[qn]()}[Kn](){this[Wn]()}}Jn[Gn]=new Set;const Yn=Symbol("computeStyleCallback"),Xn=Symbol("astWalker"),$n=Symbol("dependencies"),Zn=Symbol("onScroll");class ea{constructor(e){this[Un]={},this[Nn]=new dn(["function"]),this[jn]=()=>{this[Yn]({relatedState:"window-scroll"})},this[Yn]=e}observeEffectsFor(e){const t={},i=this[$n];this[Xn].walk(e,(e=>{const{name:s}=e,n=e.arguments[0].terms[0];if("env"===s.value&&null!=n&&"ident"===n.type&&"window-scroll-y"===n.value)if(null==t["window-scroll"]){const e="window-scroll"in i?i["window-scroll"]:new Jn(this[Zn]);e.observe(),delete i["window-scroll"],t["window-scroll"]=e}}));for(const e in i){i[e].disconnect()}this[$n]=t}dispose(){for(const e in this[$n]){this[$n][e].disconnect()}}}Un=$n,Nn=Xn,jn=Zn;
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const ta=e=>{const t=e.observeEffects||!1,i=e.intrinsics instanceof Function?e.intrinsics:()=>e.intrinsics;return(s,n)=>{const a=s.updated,r=s.connectedCallback,o=s.disconnectedCallback,l=Symbol(`${n}StyleEffector`),A=Symbol(`${n}StyleEvaluator`),c=Symbol(`${n}UpdateEvaluator`),h=Symbol(`${n}EvaluateAndSync`);Object.defineProperties(s,{[l]:{value:null,writable:!0},[A]:{value:null,writable:!0},[c]:{value:function(){const e=rn(this[n]);this[A]=new On(e,i(this)),null==this[l]&&t&&(this[l]=new ea((()=>this[h]()))),null!=this[l]&&this[l].observeEffectsFor(e)}},[h]:{value:function(){if(null==this[A])return;const t=this[A].evaluate();this[e.updateHandler](t)}},updated:{value:function(e){e.has(n)&&(this[c](),this[h]()),a.call(this,e)}},connectedCallback:{value:function(){r.call(this),this.requestUpdate(n,this[n])}},disconnectedCallback:{value:function(){o.call(this),null!=this[l]&&(this[l].dispose(),this[l]=null)}}})}},ia=e=>e<.5?2*e*e:(4-2*e)*e-1,sa=(e,t,i=ia)=>s=>e+(t-e)*i(s),na=e=>{const t=[],i=[];let s=e.initialValue;for(let n=0;n<e.keyframes.length;++n){const a=e.keyframes[n],{value:r,frames:o}=a,l=a.ease||ia,A=sa(s,r,l);t.push(A),i.push(o),s=r}return((e,t)=>{const i=t.map((s=0,e=>s+=e));var s;return t=>{t=Me(t,0,1),t*=i[i.length-1];const s=i.findIndex((e=>e>=t)),n=s<1?0:i[s-1],a=i[s];return e[s]((t-n)/(a-n))}})(t,i)};
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var aa=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const ra=na({initialValue:0,keyframes:[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]}),oa=na({initialValue:0,keyframes:[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]}),la="0deg 75deg 105%",Aa=["front","right","back","left"],ca=["upper-","","lower-"],ha="auto",ua="basic",da="wiggle",pa="none",ga=()=>({basis:[gn(an(30,"deg"))],keywords:{auto:[null]}}),ma=()=>({basis:[gn(an(12,"deg"))],keywords:{auto:[null]}}),fa=(()=>{const e=rn(la)[0].terms,t=fn(e[0]),i=fn(e[1]);return e=>{const s=e[ec].idealCameraDistance();return{basis:[t,i,an(s,"m")],keywords:{auto:[null,null,an(105,"%")]}}}})(),ba=e=>{const t=2.2*e[ec].boundingSphere.radius;return{basis:[an(-1/0,"rad"),an(0,"rad"),an(t,"m")],keywords:{auto:[null,null,null]}}},ya=e=>{const t=fa(e),i=new On([],t).evaluate()[2];return{basis:[an(1/0,"rad"),an(Math.PI,"rad"),an(i,"m")],keywords:{auto:[null,null,null]}}},Ca=e=>{const i=e[ec].boundingBox.getCenter(new t.Vector3);return{basis:[an(i.x,"m"),an(i.y,"m"),an(i.z,"m")],keywords:{auto:[null,null,null]}}},Ia=Math.PI/2,Ea=Math.PI/3,wa=Ia/2,Ba=2*Math.PI,va=Symbol("controls"),xa=Symbol("panElement"),Sa=Symbol("promptElement"),Qa=Symbol("promptAnimatedContainer"),Ma=Symbol("fingerAnimatedContainers"),Ta=Symbol("deferInteractionPrompt"),Ra=Symbol("updateAria"),Da=Symbol("a11y"),ka=Symbol("updateA11y"),Fa=Symbol("updateCameraForRadius"),La=Symbol("cancelPrompts"),_a=Symbol("onChange"),Pa=Symbol("onPointerChange"),Oa=Symbol("waitingToPromptUser"),Ga=Symbol("userHasInteracted"),Ua=Symbol("promptElementVisibleTime"),Na=Symbol("lastPromptOffset"),ja=Symbol("cancellationSource"),Ha=Symbol("lastSpherical"),za=Symbol("jumpCamera"),qa=Symbol("initialized"),Va=Symbol("maintainThetaPhi"),Ka=Symbol("syncCameraOrbit"),Wa=Symbol("syncFieldOfView"),Ja=Symbol("syncCameraTarget"),Ya=Symbol("syncMinCameraOrbit"),Xa=Symbol("syncMaxCameraOrbit"),$a=Symbol("syncMinFieldOfView"),Za=Symbol("syncMaxFieldOfView"),er=new t.Vector2,tr=new t.Vector3,ir=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:0,maximumPolarAngle:Math.PI,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,touchAction:"none"}),sr=Math.PI/8,nr=.04,ar={USER_INTERACTION:"user-interaction",NONE:"none",AUTOMATIC:"automatic"};class rr extends t.EventDispatcher{constructor(e,i,s){super(),this.camera=e,this.element=i,this.scene=s,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.inputSensitivity=1,this.changeSource=ar.NONE,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserPointing=!1,this.enablePan=!0,this.enableTap=!0,this.panProjection=new t.Matrix3,this.panPerPixel=0,this.spherical=new t.Spherical,this.goalSpherical=new t.Spherical,this.thetaDamper=new $s,this.phiDamper=new $s,this.radiusDamper=new $s,this.logFov=Math.log(ir.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new $s,this.touchMode=null,this.pointers=[],this.startTime=0,this.startPointerPosition={clientX:0,clientY:0},this.lastSeparation=0,this.touchDecided=!1,this.onContext=e=>{if(this.enablePan)e.preventDefault();else for(const e of this.pointers)this.onPointerUp(new PointerEvent("pointercancel",Object.assign(Object.assign({},this.startPointerPosition),{pointerId:e.id})))},this.touchModeZoom=(e,t)=>{if(!this._disableZoom){const e=this.twoTouchDistance(this.pointers[0],this.pointers[1]),t=nr*this.zoomSensitivity*(this.lastSeparation-e)*50/this.scene.height;this.lastSeparation=e,this.userAdjustOrbit(0,0,t)}this.panPerPixel>0&&this.movePan(e,t)},this.disableScroll=e=>{e.preventDefault()},this.touchModeRotate=(e,t)=>{const{touchAction:i}=this._options;if(!this.touchDecided&&"none"!==i){this.touchDecided=!0;const s=Math.abs(e),n=Math.abs(t);if(this.changeSource===ar.USER_INTERACTION&&("pan-y"===i&&n>s||"pan-x"===i&&s>n))return void(this.touchMode=null);this.element.addEventListener("touchmove",this.disableScroll,{passive:!1})}this.handleSinglePointerMove(e,t)},this.onPointerDown=e=>{if(this.pointers.length>2)return;const{element:t}=this;0===this.pointers.length&&(t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.touchMode=null,this.touchDecided=!1,this.startPointerPosition.clientX=e.clientX,this.startPointerPosition.clientY=e.clientY,this.startTime=performance.now());try{t.setPointerCapture(e.pointerId)}catch(e){}this.pointers.push({clientX:e.clientX,clientY:e.clientY,id:e.pointerId}),this.isUserPointing=!1,"touch"===e.pointerType?(this.changeSource=e.altKey?ar.AUTOMATIC:ar.USER_INTERACTION,this.onTouchChange(e)):(this.changeSource=ar.USER_INTERACTION,this.onMouseDown(e)),this.changeSource===ar.USER_INTERACTION&&this.dispatchEvent({type:"user-interaction"})},this.onPointerMove=e=>{const t=this.pointers.find((t=>t.id===e.pointerId));if(null==t)return;if("mouse"===e.pointerType&&0===e.buttons)return void this.onPointerUp(e);const i=this.pointers.length,s=(e.clientX-t.clientX)/i,n=(e.clientY-t.clientY)/i;0===s&&0===n||(t.clientX=e.clientX,t.clientY=e.clientY,"touch"===e.pointerType?(this.changeSource=e.altKey?ar.AUTOMATIC:ar.USER_INTERACTION,null!==this.touchMode&&this.touchMode(s,n)):(this.changeSource=ar.USER_INTERACTION,this.panPerPixel>0?this.movePan(s,n):this.handleSinglePointerMove(s,n)))},this.onPointerUp=e=>{const{element:t}=this,i=this.pointers.findIndex((t=>t.id===e.pointerId));-1!==i&&this.pointers.splice(i,1),this.panPerPixel>0&&!e.altKey&&this.resetRadius(),0===this.pointers.length?(t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("touchmove",this.disableScroll),this.enablePan&&this.enableTap&&this.recenter(e)):null!==this.touchMode&&this.onTouchChange(e),this.scene.element[xa].style.opacity=0,t.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end"})},this.onWheel=e=>{this.changeSource=ar.USER_INTERACTION;const t=e.deltaY*(1==e.deltaMode?18:1)*nr*this.zoomSensitivity/30;this.userAdjustOrbit(0,0,t),e.preventDefault(),this.dispatchEvent({type:"user-interaction"})},this.onKeyDown=e=>{const{changeSource:t}=this;this.changeSource=ar.USER_INTERACTION;(e.shiftKey&&this.enablePan?this.panKeyCodeHandler(e):this.orbitZoomKeyCodeHandler(e))?(e.preventDefault(),this.dispatchEvent({type:"user-interaction"})):this.changeSource=t},this._options=Object.assign({},ir),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(!1===this._interactionEnabled){const{element:e}=this;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointercancel",this.onPointerUp),this._disableZoom||e.addEventListener("wheel",this.onWheel),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("touchmove",(()=>{}),{passive:!1}),e.addEventListener("contextmenu",this.onContext),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(!0===this._interactionEnabled){const{element:e}=this;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointercancel",this.onPointerUp),e.removeEventListener("wheel",this.onWheel),e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("contextmenu",this.onContext),e.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(e){this._disableZoom!=e&&(this._disableZoom=e,!0===e?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(e=new t.Spherical){return e.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(e){Object.assign(this._options,e),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(e,t){this.camera.far=0===t?2:t,this.camera.near=.1,this.camera.updateProjectionMatrix()}updateAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setOrbit(e=this.goalSpherical.theta,t=this.goalSpherical.phi,i=this.goalSpherical.radius){const{minimumAzimuthalAngle:s,maximumAzimuthalAngle:n,minimumPolarAngle:a,maximumPolarAngle:r,minimumRadius:o,maximumRadius:l}=this._options,{theta:A,phi:c,radius:h}=this.goalSpherical,u=Me(e,s,n);isFinite(s)||isFinite(n)||(this.spherical.theta=this.wrapAngle(this.spherical.theta-u)+u);const d=Me(t,a,r),p=Me(i,o,l);return(u!==A||d!==c||p!==h)&&(!!(isFinite(u)&&isFinite(d)&&isFinite(p))&&(this.goalSpherical.theta=u,this.goalSpherical.phi=d,this.goalSpherical.radius=p,this.goalSpherical.makeSafe(),!0))}setRadius(e){this.goalSpherical.radius=e,this.setOrbit()}setFieldOfView(e){const{minimumFieldOfView:t,maximumFieldOfView:i}=this._options;e=Me(e,t,i),this.goalLogFov=Math.log(e)}setDamperDecayTime(e){this.thetaDamper.setDecayTime(e),this.phiDamper.setDecayTime(e),this.radiusDamper.setDecayTime(e),this.fovDamper.setDecayTime(e)}adjustOrbit(e,t,i){const{theta:s,phi:n,radius:a}=this.goalSpherical,{minimumRadius:r,maximumRadius:o,minimumFieldOfView:l,maximumFieldOfView:A}=this._options,c=this.spherical.theta-s,h=Math.PI-.001,u=s-Me(e,-h-c,h-c),d=n-t,p=0===i?0:((i>0?o:r)-a)/(Math.log(i>0?A:l)-this.goalLogFov),g=a+i*(isFinite(p)?p:2*(o-r));if(this.setOrbit(u,d,g),0!==i){const e=this.goalLogFov+i;this.setFieldOfView(Math.exp(e))}}jumpToGoal(){this.update(0,1e4)}update(e,t){if(this.isStationary())return!1;const{maximumPolarAngle:i,maximumRadius:s}=this._options,n=this.spherical.theta-this.goalSpherical.theta;return Math.abs(n)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=2*Math.sign(n)*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,t,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,t,i),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,t,s),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,t,1),this.moveCamera(),!0}updateTouchActionStyle(){const{style:e}=this.element;if(this._interactionEnabled){const{touchAction:t}=this._options;this._disableZoom&&"none"!==t?e.touchAction="manipulation":e.touchAction=t}else e.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new t.Euler(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix())}userAdjustOrbit(e,t,i){this.adjustOrbit(e*this.orbitSensitivity*this.inputSensitivity,t*this.orbitSensitivity*this.inputSensitivity,i*this.inputSensitivity)}wrapAngle(e){const t=(e+Math.PI)/(2*Math.PI);return 2*(t-Math.floor(t))*Math.PI-Math.PI}pixelLengthToSphericalAngle(e){return 2*Math.PI*e/this.scene.height}twoTouchDistance(e,t){const{clientX:i,clientY:s}=e,{clientX:n,clientY:a}=t,r=n-i,o=a-s;return Math.sqrt(r*r+o*o)}handleSinglePointerMove(e,t){const i=this.pixelLengthToSphericalAngle(e),s=this.pixelLengthToSphericalAngle(t);!1===this.isUserPointing&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start"})),this.userAdjustOrbit(i,s,0)}initializePan(){const{theta:e,phi:t}=this.spherical,i=e-this.scene.yaw;this.panPerPixel=.018*this.panSensitivity/this.scene.height,this.panProjection.set(-Math.cos(i),-Math.cos(t)*Math.sin(i),0,0,Math.sin(t),0,Math.sin(i),-Math.cos(t)*Math.cos(i),0)}movePan(e,t){const{scene:i}=this,s=tr.set(e,t,0).multiplyScalar(this.inputSensitivity),n=this.spherical.radius*Math.exp(this.logFov)*this.panPerPixel;s.multiplyScalar(n);const a=i.getTarget();a.add(s.applyMatrix3(this.panProjection)),i.boundingSphere.clampPoint(a,a),i.setTarget(a.x,a.y,a.z)}recenter(e){if(performance.now()>this.startTime+300||Math.abs(e.clientX-this.startPointerPosition.clientX)>2||Math.abs(e.clientY-this.startPointerPosition.clientY)>2)return;const{scene:t}=this,i=t.positionAndNormalFromPoint(t.getNDC(e.clientX,e.clientY));if(null==i){const{cameraTarget:e}=t.element;t.element.cameraTarget="",t.element.cameraTarget=e,this.userAdjustOrbit(0,0,1)}else t.target.worldToLocal(i.position),t.setTarget(i.position.x,i.position.y,i.position.z)}resetRadius(){const{scene:e}=this,t=e.positionAndNormalFromPoint(er.set(0,0));if(null==t)return;e.target.worldToLocal(t.position);const i=e.getTarget(),{theta:s,phi:n}=this.spherical,a=s-e.yaw,r=tr.set(Math.sin(n)*Math.sin(a),Math.cos(n),Math.sin(n)*Math.cos(a)),o=r.dot(t.position.sub(i));i.add(r.multiplyScalar(o)),e.setTarget(i.x,i.y,i.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-o)}onTouchChange(e){if(1===this.pointers.length)this.touchMode=this.touchModeRotate;else{if(this._disableZoom)return this.touchMode=null,void this.element.removeEventListener("touchmove",this.disableScroll);this.touchMode=this.touchDecided&&null===this.touchMode?null:this.touchModeZoom,this.touchDecided=!0,this.element.addEventListener("touchmove",this.disableScroll,{passive:!1}),this.lastSeparation=this.twoTouchDistance(this.pointers[0],this.pointers[1]),this.enablePan&&null!=this.touchMode&&(this.initializePan(),e.altKey||(this.scene.element[xa].style.opacity=1))}}onMouseDown(e){this.panPerPixel=0,this.enablePan&&(2===e.button||e.ctrlKey||e.metaKey||e.shiftKey)&&(this.initializePan(),this.scene.element[xa].style.opacity=1),this.element.style.cursor="grabbing"}orbitZoomKeyCodeHandler(e){let t=!0;switch(e.key){case"PageUp":this.userAdjustOrbit(0,0,nr*this.zoomSensitivity);break;case"PageDown":this.userAdjustOrbit(0,0,-.04*this.zoomSensitivity);break;case"ArrowUp":this.userAdjustOrbit(0,-sr,0);break;case"ArrowDown":this.userAdjustOrbit(0,sr,0);break;case"ArrowLeft":this.userAdjustOrbit(-sr,0,0);break;case"ArrowRight":this.userAdjustOrbit(sr,0,0);break;default:t=!1}return t}panKeyCodeHandler(e){this.initializePan();let t=!0;switch(e.key){case"ArrowUp":this.movePan(0,-10);break;case"ArrowDown":this.movePan(0,10);break;case"ArrowLeft":this.movePan(-10,0);break;case"ArrowRight":this.movePan(10,0);break;default:t=!1}return t}}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const or=150,lr="not-presenting",Ar="session-started",cr="object-placed",hr="failed",ur="tracking",dr="not-tracking",pr=new t.Vector3,gr=new t.Quaternion,mr=new t.Matrix4,fr=new t.Vector3,br=new t.PerspectiveCamera(45,1,.1,100),yr=(new t.BufferGeometry).setFromPoints([new t.Vector3(0,0,0),new t.Vector3(0,0,-1)]),Cr=new t.BoxGeometry;class Ir extends t.EventDispatcher{constructor(e){super(),this.renderer=e,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.xrMode=null,this.controller1=null,this.controller2=null,this.selectedController=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new t.Vector3,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new t.Vector3,this.relativeOrientation=new t.Quaternion,this.scaleLine=new t.Line(yr),this.firstRatio=0,this.lastAngle=0,this.goalPosition=new t.Vector3,this.goalYaw=0,this.goalScale=1,this.xDamper=new $s,this.yDamper=new $s,this.zDamper=new $s,this.yawDamper=new $s,this.pitchDamper=new $s,this.rollDamper=new $s,this.scaleDamper=new $s,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onControllerSelectStart=e=>{const t=this.presentedScene,i=e.target;if(null!=this.placementBox.controllerIntersection(t,i))null!=this.selectedController&&(this.selectedController.userData.line.visible=!1,t.canScale&&(this.isTwoFingering=!0,this.firstRatio=this.controllerSeparation()/t.pivot.scale.x,this.scaleLine.visible=!0)),i.attach(t.pivot),this.selectedController=i,t.setShadowIntensity(.01);else{const e=i===this.controller1?this.controller2:this.controller1;this.relativeOrientation.copy(i.quaternion).invert().multiply(t.pivot.getWorldQuaternion(gr)),e.userData.turning=!1,i.userData.turning=!0,i.userData.line.visible=!1}},this.onControllerSelectEnd=e=>{const t=e.target;if(t.userData.turning=!1,t.userData.line.visible=!0,this.isTwoFingering=!1,this.scaleLine.visible=!1,null!=this.selectedController&&this.selectedController!=t)return;const i=this.presentedScene;i.attach(i.pivot),this.selectedController=null,this.goalYaw=Math.atan2(i.pivot.matrix.elements[8],i.pivot.matrix.elements[10]),this.goalPosition.x=i.pivot.position.x,this.goalPosition.z=i.pivot.position.z},this.onUpdateScene=()=>{null!=this.placementBox&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new nn(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=e=>{const t=this.transientHitTestSource;if(null==t)return;const i=this.frame.getHitTestResultsForTransientInput(t),s=this.presentedScene,n=this.placementBox;if(1===i.length){this.inputSource=e.inputSource;const{axes:t}=this.inputSource.gamepad,i=n.getHit(this.presentedScene,t[0],t[1]);n.show=!0,null!=i?(this.isTranslating=!0,this.lastDragPosition.copy(i)):!1===this.placeOnWall&&(this.isRotating=!0,this.lastAngle=1.5*t[0])}else if(2===i.length){n.show=!0,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(i);this.firstRatio=e/s.pivot.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=e.threeRenderer,this.threeRenderer.xr.enabled=!0}async resolveARSession(){ve();const e=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:[],optionalFeatures:["hit-test","dom-overlay","light-estimation"],domOverlay:this.overlay?{root:this.overlay}:void 0});return this.threeRenderer.xr.setReferenceSpaceType("local"),await this.threeRenderer.xr.setSession(e),this.threeRenderer.xr.cameraAutoUpdate=!1,e}get presentedScene(){return this._presentedScene}async supportsPresentation(){try{return ve(),await navigator.xr.isSessionSupported("immersive-ar")}catch(e){return console.warn("Request to present in WebXR denied:"),console.warn(e),console.warn("Falling back to next ar-mode"),!1}}async present(e,t=!1){this.isPresenting&&console.warn("Cannot present while a model is already presenting");let i=new Promise(((e,t)=>{requestAnimationFrame((()=>e()))}));e.setHotspotsVisibility(!1),e.queueRender(),await i,this._presentedScene=e,this.overlay=e.element.shadowRoot.querySelector("div.default"),!0===t&&(this.xrLight=new Xs(this.threeRenderer),this.xrLight.addEventListener("estimationstart",(()=>{if(!this.isPresenting||null==this.xrLight)return;const e=this.presentedScene;e.add(this.xrLight),e.environment=this.xrLight.environment})));const s=await this.resolveARSession();s.addEventListener("end",(()=>{this.postSessionCleanup()}),{once:!0});const n=e.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");n.classList.add("enabled"),n.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=n;const a=await s.requestReferenceSpace("viewer");this.xrMode=s.interactionMode,this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=e.yaw,this.goalYaw=e.yaw,this.goalScale=1,e.setBackground(null),this.oldShadowIntensity=e.shadowIntensity,e.setShadowIntensity(.01),this.oldTarget.copy(e.getTarget()),e.element.addEventListener("load",this.onUpdateScene);const r=20*Math.PI/180,o=!0===this.placeOnWall?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(r),z:-Math.cos(r)});s.requestHitTestSource({space:a,offsetRay:o}).then((e=>{this.initialHitSource=e})),"screen-space"!==this.xrMode&&(this.setupControllers(),this.xDamper.setDecayTime(or),this.yDamper.setDecayTime(or),this.zDamper.setDecayTime(or),this.yawDamper.setDecayTime(or),this.pitchDamper.setDecayTime(or),this.rollDamper.setDecayTime(or)),this.currentSession=s,this.placementBox=new nn(e,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:Ar})}setupControllers(){this.controller1=this.threeRenderer.xr.getController(0),this.controller1.addEventListener("selectstart",this.onControllerSelectStart),this.controller1.addEventListener("selectend",this.onControllerSelectEnd),this.controller2=this.threeRenderer.xr.getController(1),this.controller2.addEventListener("selectstart",this.onControllerSelectStart),this.controller2.addEventListener("selectend",this.onControllerSelectEnd);const e=this.presentedScene;if(e.add(this.controller1),e.add(this.controller2),!this.controller1.userData.line){const i=new t.Line(yr);i.name="line",i.scale.z=5,this.controller1.userData.turning=!1,this.controller1.userData.line=i,this.controller1.add(i),this.controller2.userData.turning=!1;const s=i.clone();this.controller2.userData.line=s,this.controller2.add(s),this.scaleLine.name="scale line",this.scaleLine.visible=!1,this.controller1.add(this.scaleLine);const{size:n}=e,a=.1/Math.max(n.x,n.y,n.z),r=new t.Mesh(Cr);r.name="box",r.scale.copy(n).multiplyScalar(a),r.visible=!1,this.controller1.userData.box=r,e.add(r);const o=r.clone();this.controller2.userData.box=o,e.add(o)}}hover(e){if("screen-space"===this.xrMode||this.selectedController==e)return!1;const t=this.presentedScene,i=this.placementBox.controllerIntersection(t,e);return e.userData.box.visible=(null==i||e.userData.turning)&&!this.isTwoFingering,e.userData.line.scale.z=null==i?5:i.distance,null!=i}controllerSeparation(){return this.controller1.position.distanceTo(this.controller2.position)}async stopPresenting(){if(!this.isPresenting)return;const e=new Promise((e=>{this.resolveCleanup=e}));try{await this.currentSession.end(),await e}catch(e){console.warn("Error while trying to end WebXR AR session"),console.warn(e),this.postSessionCleanup()}}get isPresenting(){return null!=this.presentedScene}get target(){return this.oldTarget}updateTarget(){const e=this.presentedScene;if(null!=e){const t=e.getTarget();this.oldTarget.copy(t),this.placeOnWall?t.z=e.boundingBox.min.z:t.y=e.boundingBox.min.y,e.setTarget(t.x,t.y,t.z)}}postSessionCleanup(){const e=this.currentSession;null!=e&&(e.removeEventListener("selectstart",this.onSelectStart),e.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const t=this.presentedScene;if(this._presentedScene=null,null!=t){const{element:e}=t;null!=this.xrLight&&(t.remove(this.xrLight),this.xrLight.dispose(),this.xrLight=null),t.add(t.pivot),t.pivot.quaternion.set(0,0,0,1),t.pivot.position.set(0,0,0),t.pivot.scale.set(1,1,1),t.setShadowOffset(0);const i=this.turntableRotation;null!=i&&(t.yaw=i);const s=this.oldShadowIntensity;null!=s&&t.setShadowIntensity(s),t.setEnvironmentAndSkybox(e[De],e[ke]);const n=this.oldTarget;t.setTarget(n.x,n.y,n.z),t.xrCamera=null,t.element.removeEventListener("load",this.onUpdateScene),t.orientHotspots(0);const{width:a,height:r}=e.getBoundingClientRect();t.setSize(a,r),requestAnimationFrame((()=>{t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:ar.NONE}}))}))}this.renderer.height=0;const i=this.exitWebXRButtonContainer;null!=i&&(i.classList.remove("enabled"),i.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const s=this.transientHitTestSource;null!=s&&(s.cancel(),this.transientHitTestSource=null);const n=this.initialHitSource;null!=n&&(n.cancel(),this.initialHitSource=null),null!=this.placementBox&&(this.placementBox.dispose(),this.placementBox=null),"screen-space"!==this.xrMode&&(null!=this.controller1&&(this.controller1.userData.turning=!1,this.controller1.userData.box.visible=!1,this.controller1.userData.line.visible=!0,this.controller1.removeEventListener("selectstart",this.onControllerSelectStart),this.controller1.removeEventListener("selectend",this.onControllerSelectEnd),this.controller1.removeFromParent(),this.controller1=null),null!=this.controller2&&(this.controller2.userData.turning=!1,this.controller2.userData.box.visible=!1,this.controller2.userData.line.visible=!0,this.controller2.removeEventListener("selectstart",this.onControllerSelectStart),this.controller2.removeEventListener("selectend",this.onControllerSelectEnd),this.controller2.removeFromParent(),this.controller2=null),this.selectedController=null,this.scaleLine.visible=!1),this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.inputSource=null,this.overlay=null,null!=this.resolveCleanup&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:lr})}updateView(e){const t=this.presentedScene,i=this.threeRenderer.xr;i.updateCamera(br),t.xrCamera=i.getCamera();const{elements:s}=t.getCamera().matrixWorld;if(t.orientHotspots(Math.atan2(s[1],s[5])),this.initialized||(this.placeInitially(),this.initialized=!0),e.requestViewportScale&&e.recommendedViewportScale){const t=e.recommendedViewportScale;e.requestViewportScale(Math.max(t,.25))}const n=i.getBaseLayer();if(null!=n){const t=n instanceof XRWebGLLayer?n.getViewport(e):i.getBinding().getViewSubImage(n,e).viewport;this.threeRenderer.setViewport(t.x,t.y,t.width,t.height)}}placeInitially(){const e=this.presentedScene,{pivot:t,element:i}=e,{position:s}=t,n=e.getCamera(),{width:a,height:r}=this.overlay.getBoundingClientRect();e.setSize(a,r),n.projectionMatrixInverse.copy(n.projectionMatrix).invert();const{theta:o}=i.getCameraOrbit(),l=n.getWorldDirection(pr);e.yaw=Math.atan2(-l.x,-l.z)-o,this.goalYaw=e.yaw;const A=Math.max(1,2*e.boundingSphere.radius);s.copy(n.position).add(l.multiplyScalar(A)),this.updateTarget();const c=e.getTarget();if(s.add(c).sub(this.oldTarget),this.goalPosition.copy(s),e.setHotspotsVisibility(!0),"screen-space"===this.xrMode){const{session:e}=this.frame;e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd),e.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then((e=>{this.transientHitTestSource=e}))}}getTouchLocation(){const{axes:e}=this.inputSource.gamepad;let t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return null!=t&&(pr.copy(t).sub(this.presentedScene.getCamera().position),pr.length()>10)?null:t}getHitPoint(e){const t=this.threeRenderer.xr.getReferenceSpace(),i=e.getPose(t);if(null==i)return null;const s=mr.fromArray(i.transform.matrix);return!0===this.placeOnWall&&(this.goalYaw=Math.atan2(s.elements[4],s.elements[6])),s.elements[5]>.75!==this.placeOnWall?fr.setFromMatrixPosition(s):null}moveToFloor(e){const t=this.initialHitSource;if(null==t)return;const i=e.getHitTestResults(t);if(0==i.length)return;const s=i[0],n=this.getHitPoint(s);null!=n&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(n):this.goalPosition.y=n.y),t.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:cr}))}fingerPolar(e){const t=e[0].inputSource.gamepad.axes,i=e[1].inputSource.gamepad.axes,s=i[0]-t[0],n=i[1]-t[1],a=Math.atan2(n,s);let r=this.lastAngle-a;return r>Math.PI?r-=2*Math.PI:r<-Math.PI&&(r+=2*Math.PI),this.lastAngle=a,{separation:Math.sqrt(s*s+n*n),deltaYaw:r}}setScale(e){const t=e/this.firstRatio;this.goalScale=Math.abs(t-1)<.2?1:t}processInput(e){const t=this.transientHitTestSource;if(null==t)return;if(!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const i=e.getHitTestResultsForTransientInput(t),s=this.presentedScene,n=s.pivot.scale.x;if(this.isTwoFingering)if(i.length<2)this.isTwoFingering=!1;else{const{separation:e,deltaYaw:t}=this.fingerPolar(i);!1===this.placeOnWall&&(this.goalYaw+=t),s.canScale&&this.setScale(e)}else if(2!==i.length)if(this.isRotating){const e=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=e-this.lastAngle,this.lastAngle=e}else this.isTranslating&&i.forEach((e=>{if(e.inputSource!==this.inputSource)return;let t=null;if(e.results.length>0&&(t=this.getHitPoint(e.results[0])),null==t&&(t=this.getTouchLocation()),null!=t){if(this.goalPosition.sub(this.lastDragPosition),!1===this.placeOnWall){const e=t.y-this.lastDragPosition.y;if(e<0){this.placementBox.offsetHeight=e/n,this.presentedScene.setShadowOffset(e);const i=pr.copy(s.getCamera().position),a=-e/(i.y-t.y);i.multiplyScalar(a),t.multiplyScalar(1-a).add(i)}}this.goalPosition.add(t),this.lastDragPosition.copy(t)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(i);this.firstRatio=e/n}}moveScene(e){const t=this.presentedScene,{pivot:i}=t,s=this.placementBox;if(s.updateOpacity(e),this.controller1&&(this.controller1.userData.turning&&(i.quaternion.copy(this.controller1.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller2&&i.quaternion.premultiply(gr.copy(this.controller2.quaternion).invert())),this.controller1.userData.box.position.copy(this.controller1.position),i.getWorldQuaternion(this.controller1.userData.box.quaternion)),this.controller2&&(this.controller2.userData.turning&&(i.quaternion.copy(this.controller2.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller1&&i.quaternion.premultiply(gr.copy(this.controller1.quaternion).invert())),this.controller2.userData.box.position.copy(this.controller2.position),i.getWorldQuaternion(this.controller2.userData.box.quaternion)),this.controller1&&this.controller2&&this.isTwoFingering){const e=this.controllerSeparation();this.setScale(e),this.scaleLine.scale.z=-e,this.scaleLine.lookAt(this.controller2.position)}const n=t.pivot.scale.x;if(this.goalScale!==n){const i=this.scaleDamper.update(n,this.goalScale,e,1);t.pivot.scale.set(i,i,i)}if(i.parent!==t)return;const{position:a}=i,r=t.boundingSphere.radius,o=this.goalPosition;let l=ar.NONE;if(!o.equals(a)){l=ar.USER_INTERACTION;let{x:i,y:n,z:A}=a;if(i=this.xDamper.update(i,o.x,e,r),n=this.yDamper.update(n,o.y,e,r),A=this.zDamper.update(A,o.z,e,r),a.set(i,n,A),"screen-space"===this.xrMode&&!this.isTranslating){const e=o.y-n;this.placementComplete&&!1===this.placeOnWall?(s.offsetHeight=e/t.pivot.scale.x,t.setShadowOffset(e)):0===e&&(this.placementComplete=!0,s.show=!1,t.setShadowIntensity(.8))}"screen-space"!==this.xrMode&&o.equals(a)&&t.setShadowIntensity(.8)}t.updateTarget(e),gr.setFromAxisAngle(pr.set(0,1,0),this.goalYaw);const A=t.pivot.quaternion.angleTo(gr),c=A-this.yawDamper.update(A,0,e,Math.PI);t.pivot.quaternion.rotateTowards(gr,c),t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:l}}))}onWebXRFrame(e,t){if("screen-space"!==this.xrMode){const e=this.hover(this.controller1),t=this.hover(this.controller2);this.placementBox.show=(e||t)&&!this.isTwoFingering}this.frame=t,++this.frames;const i=this.threeRenderer.xr.getReferenceSpace(),s=t.getViewerPose(i);null==s&&!0===this.tracking&&this.frames>30&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:dr}));const n=this.presentedScene;if(null==s||null==n||!n.element.loaded)return void this.threeRenderer.clear();!1===this.tracking&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:ur}));let a=!0;for(const i of s.views){if(this.updateView(i),a){this.moveToFloor(t),this.processInput(t);const i=e-this.lastTick;this.moveScene(i),this.renderer.preRender(n,e,i),this.lastTick=e,n.renderShadow(this.threeRenderer)}this.threeRenderer.render(n,n.getCamera()),a=!1}}}function Er(e){const t=new Map,i=new Map,s=e.clone();return wr(e,s,(function(e,s){t.set(s,e),i.set(e,s)})),s.traverse((function(e){if(!e.isSkinnedMesh)return;const s=e,n=t.get(e),a=n.skeleton.bones;s.skeleton=n.skeleton.clone(),s.bindMatrix.copy(n.bindMatrix),s.skeleton.bones=a.map((function(e){return i.get(e)})),s.bind(s.skeleton,s.bindMatrix)})),s}function wr(e,t,i){i(e,t);for(let s=0;s<e.children.length;s++)wr(e.children[s],t.children[s],i)}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Br=Symbol("prepared"),vr=Symbol("prepare"),xr=Symbol("preparedGLTF"),Sr=Symbol("clone");class Qr{static prepare(e){if(null==e.scene)throw new Error("Model does not have a scene");if(e[Br])return e;const t=this[vr](e);return t[Br]=!0,t}static[vr](e){const{scene:t}=e,i=[t];return Object.assign(Object.assign({},e),{scene:t,scenes:i})}get parser(){return this[xr].parser}get animations(){return this[xr].animations}get scene(){return this[xr].scene}get scenes(){return this[xr].scenes}get cameras(){return this[xr].cameras}get asset(){return this[xr].asset}get userData(){return this[xr].userData}constructor(e){this[xr]=e}clone(){return new(0,this.constructor)(this[Sr]())}dispose(){this.scenes.forEach((e=>{e.traverse((e=>{const i=e;if(!i.material)return;(Array.isArray(i.material)?i.material:[i.material]).forEach((e=>{for(const i in e){const s=e[i];if(s instanceof t.Texture){const e=s.source.data;null!=e.close&&e.close(),s.dispose()}}e.dispose()})),i.geometry.dispose()}))}))}[Sr](){const e=this[xr],t=Er(this.scene);Mr(t,this.scene);const i=[t],s=e.userData?Object.assign({},e.userData):{};return Object.assign(Object.assign({},e),{scene:t,scenes:i,userData:s})}}const Mr=(e,t)=>{Tr(e,t,((e,t)=>{void 0!==t.userData.variantMaterials&&(e.userData.variantMaterials=new Map(t.userData.variantMaterials)),void 0!==t.userData.variantData&&(e.userData.variantData=t.userData.variantData),void 0!==t.userData.originalMaterial&&(e.userData.originalMaterial=t.userData.originalMaterial)}))},Tr=(e,t,i)=>{i(e,t);for(let s=0;s<e.children.length;s++)Tr(e.children[s],t.children[s],i)},Rr=Symbol("threeGLTF"),Dr=Symbol("gltf"),kr=Symbol("gltfElementMap"),Fr=Symbol("threeObjectMap"),Lr=Symbol("parallelTraverseThreeScene"),_r=Symbol("correlateOriginalThreeGLTF"),Pr=Symbol("correlateCloneThreeGLTF");class Or{static from(e,t){return null!=t?this[Pr](e,t):this[_r](e)}static[_r](e){const i=e.parser.json,s=e.parser.associations,n=new Map,a={name:"Default"},r={index:-1};for(const e of s.keys())e instanceof t.Material&&null==s.get(e)&&(r.index<0&&(null==i.materials&&(i.materials=[]),r.index=i.materials.length,i.materials.push(a)),e.name=a.name,s.set(e,{materials:r.index}));for(const[e,t]of s){t&&(e.userData=e.userData||{},e.userData.associations=t);for(const s in t)if(null!=s&&"primitives"!==s){const a=s,r=(i[a]||[])[t[a]];if(null==r)continue;let o=n.get(r);null==o&&(o=new Set,n.set(r,o)),o.add(e)}}return new Or(e,i,s,n)}static[Pr](e,t){const i=t.threeGLTF,s=t.gltf,n=JSON.parse(JSON.stringify(s)),a=new Map,r=new Map;for(let s=0;s<i.scenes.length;s++)this[Lr](i.scenes[s],e.scenes[s],((e,i)=>{const s=t.threeObjectMap.get(e);if(null!=s)for(const e in s)if(null!=e&&"primitives"!==e){const t=e,o=s[t],l=n[t][o],A=a.get(i)||{};A[t]=o,a.set(i,A);const c=r.get(l)||new Set;c.add(i),r.set(l,c)}}));return new Or(e,n,a,r)}static[Lr](e,t,i){const s=(e,t)=>{if(i(e,t),e.isObject3D){const n=e,a=t;if(n.material)if(Array.isArray(n.material))for(let e=0;e<n.material.length;++e)i(n.material[e],a.material[e]);else i(n.material,a.material);for(let i=0;i<e.children.length;++i)s(e.children[i],t.children[i])}};s(e,t)}get threeGLTF(){return this[Rr]}get gltf(){return this[Dr]}get gltfElementMap(){return this[kr]}get threeObjectMap(){return this[Fr]}constructor(e,t,i,s){this[Rr]=e,this[Dr]=t,this[kr]=s,this[Fr]=i}}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Gr=Symbol("correlatedSceneGraph");class Ur extends Qr{static[vr](e){const i=super[vr](e);null==i[Gr]&&(i[Gr]=Or.from(i));const{scene:s}=i,n=new t.Sphere(void 0,1/0);return s.traverse((e=>{e.renderOrder=1e3,e.frustumCulled=!1,e.name||(e.name=e.uuid);const s=e;if(s.material){const{geometry:e}=s;s.castShadow=!0,s.isSkinnedMesh&&(e.boundingSphere=n,e.boundingBox=null);const a=s.material;if(!0===a.isMeshBasicMaterial&&(a.toneMapped=!1),a.shadowSide=t.FrontSide,a.aoMap){const{gltf:t,threeObjectMap:s}=i[Gr],n=s.get(a);if(null!=t.materials&&null!=n&&null!=n.materials){const i=t.materials[n.materials];i.occlusionTexture&&0===i.occlusionTexture.texCoord&&null!=e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv)}}}})),i}get correlatedSceneGraph(){return this[xr][Gr]}[Sr](){const e=super[Sr](),t=new Map;return e.scene.traverse((e=>{const i=e;if(i.material){const e=i.material;if(null!=e){if(t.has(e.uuid))return void(i.material=t.get(e.uuid));i.material=e.clone(),t.set(e.uuid,i.material)}}const s=e;void 0!==s.target&&s.add(s.target)})),e[Gr]=Or.from(e,this.correlatedSceneGraph),e}}const Nr=(e,i,s)=>{let n;switch(e){case t.UnsignedByteType:n=new Uint8ClampedArray(i*s*4);break;case t.HalfFloatType:n=new Uint16Array(i*s*4);break;case t.UnsignedIntType:n=new Uint32Array(i*s*4);break;case t.ByteType:n=new Int8Array(i*s*4);break;case t.ShortType:n=new Int16Array(i*s*4);break;case t.IntType:n=new Int32Array(i*s*4);break;case t.FloatType:n=new Float32Array(i*s*4);break;default:throw new Error("Unsupported data type")}return n};let jr;class Hr{constructor(e){var i,s,n,a,r,o,l,A,c,h,u,d,p,g,m,f;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const b={format:t.RGBAFormat,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:void 0!==(null===(i=e.renderTargetOptions)||void 0===i?void 0:i.anisotropy)?null===(s=e.renderTargetOptions)||void 0===s?void 0:s.anisotropy:1,generateMipmaps:void 0!==(null===(n=e.renderTargetOptions)||void 0===n?void 0:n.generateMipmaps)&&(null===(a=e.renderTargetOptions)||void 0===a?void 0:a.generateMipmaps),magFilter:void 0!==(null===(r=e.renderTargetOptions)||void 0===r?void 0:r.magFilter)?null===(o=e.renderTargetOptions)||void 0===o?void 0:o.magFilter:t.LinearFilter,minFilter:void 0!==(null===(l=e.renderTargetOptions)||void 0===l?void 0:l.minFilter)?null===(A=e.renderTargetOptions)||void 0===A?void 0:A.minFilter:t.LinearFilter,samples:void 0!==(null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples)?null===(h=e.renderTargetOptions)||void 0===h?void 0:h.samples:void 0,wrapS:void 0!==(null===(u=e.renderTargetOptions)||void 0===u?void 0:u.wrapS)?null===(d=e.renderTargetOptions)||void 0===d?void 0:d.wrapS:t.ClampToEdgeWrapping,wrapT:void 0!==(null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapT)?null===(g=e.renderTargetOptions)||void 0===g?void 0:g.wrapT:t.ClampToEdgeWrapping};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=Hr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new t.Scene,this._camera=new t.OrthographicCamera,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,i,s,n)=>{if(void 0!==jr)return jr;const a=new t.WebGLRenderTarget(1,1,n);i.setRenderTarget(a);const r=new t.Mesh(new t.PlaneGeometry,new t.MeshBasicMaterial({color:16777215}));i.render(r,s),i.setRenderTarget(null);const o=Nr(e,a.width,a.height);return i.readRenderTargetPixels(a,0,0,a.width,a.height,o),a.dispose(),r.geometry.dispose(),r.material.dispose(),jr=0!==o[0],jr})(this._type,this._renderer,this._camera,b)){let e;if(this._type===t.HalfFloatType)e=this._renderer.extensions.has("EXT_color_buffer_float")?t.FloatType:void 0;void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${t.FloatType}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new t.Mesh(new t.PlaneGeometry,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new t.WebGLRenderTarget(this.width,this.height,b),this._renderTarget.texture.mapping=void 0!==(null===(m=e.renderTargetOptions)||void 0===m?void 0:m.mapping)?null===(f=e.renderTargetOptions)||void 0===f?void 0:f.mapping:t.UVMapping}static instantiateRenderer(){const e=new t.WebGLRenderer;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Nr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const i=new t.DataTexture(this.toArray(),this.width,this.height,t.RGBAFormat,this._type,(null==e?void 0:e.mapping)||t.UVMapping,(null==e?void 0:e.wrapS)||t.ClampToEdgeWrapping,(null==e?void 0:e.wrapT)||t.ClampToEdgeWrapping,(null==e?void 0:e.magFilter)||t.LinearFilter,(null==e?void 0:e.minFilter)||t.LinearFilter,(null==e?void 0:e.anisotropy)||1,t.LinearSRGBColorSpace);return i.generateMipmaps=void 0!==(null==e?void 0:e.generateMipmaps)&&(null==e?void 0:e.generateMipmaps),i}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof t.ShaderMaterial&&Object.values(this.material.uniforms).forEach((e=>{e.value instanceof t.Texture&&e.value.dispose()})),Object.values(this.material).forEach((e=>{e instanceof t.Texture&&e.dispose()})),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class zr extends t.ShaderMaterial{constructor({gamma:e,offsetHdr:i,offsetSdr:s,gainMapMin:n,gainMapMax:a,maxDisplayBoost:r,hdrCapacityMin:o,hdrCapacityMax:l,sdr:A,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n// min half float value\n#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )\n// max half float value\n#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )\n\nuniform sampler2D sdr;\nuniform sampler2D gainMap;\nuniform vec3 gamma;\nuniform vec3 offsetHdr;\nuniform vec3 offsetSdr;\nuniform vec3 gainMapMin;\nuniform vec3 gainMapMax;\nuniform float weightFactor;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 rgb = texture2D( sdr, vUv ).rgb;\n  vec3 recovery = texture2D( gainMap, vUv ).rgb;\n  vec3 logRecovery = pow( recovery, gamma );\n  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;\n  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;\n  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));\n  gl_FragColor = vec4( clampedHdrColor , 1.0 );\n}\n",uniforms:{sdr:{value:A},gainMap:{value:c},gamma:{value:new t.Vector3(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:(new t.Vector3).fromArray(i)},offsetSdr:{value:(new t.Vector3).fromArray(s)},gainMapMin:{value:(new t.Vector3).fromArray(n)},gainMapMax:{value:(new t.Vector3).fromArray(a)},weightFactor:{value:(Math.log2(r)-o)/(l-o)}},blending:t.NoBlending,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=r,this._hdrCapacityMin=o,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class qr extends Error{}class Vr extends Error{}const Kr=(e,t,i)=>{const s=new RegExp(`${t}="([^"]*)"`,"i").exec(e);if(s)return s[1];const n=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(n){const e=n[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map((e=>e.replace(/<\/?rdf:li>/g,""))):n[1].trim()}if(void 0!==i)return i;throw new Error(`Can't find ${t} in gainmap metadata`)};class Wr{constructor(e){this.options={debug:!(!e||void 0===e.debug)&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise(((t,i)=>{const s=this.options.debug,n=new DataView(e.buffer);if(65496!==n.getUint16(0))return void i(new Error("Not a valid jpeg"));const a=n.byteLength;let r,o=2,l=0;for(;o<a;){if(++l>250)return void i(new Error(`Found no marker after ${l} loops 😵`));if(255!==n.getUint8(o))return void i(new Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${n.getUint8(o).toString(16)}`));if(r=n.getUint8(o+1),s&&console.log(`Marker: ${r.toString(16)}`),226===r){s&&console.log("Found APP2 marker (0xffe2)");const e=o+4;if(1297106432===n.getUint32(e)){const s=e+4;let a;if(18761===n.getUint16(s))a=!1;else{if(19789!==n.getUint16(s))return void i(new Error("No valid endianness marker found in TIFF header"));a=!0}if(42!==n.getUint16(s+2,!a))return void i(new Error("Not valid TIFF data! (no 0x002A marker)"));const r=n.getUint32(s+4,!a);if(r<8)return void i(new Error("Not valid TIFF data! (First offset less than 8)"));const o=s+r,l=n.getUint16(o,!a),A=o+2;let c=0;for(let e=A;e<A+12*l;e+=12)45057===n.getUint16(e,!a)&&(c=n.getUint32(e+8,!a));const h=o+2+12*l+4,u=[];for(let e=h;e<h+16*c;e+=16){const t={MPType:n.getUint32(e,!a),size:n.getUint32(e+4,!a),dataOffset:n.getUint32(e+8,!a),dependantImages:n.getUint32(e+12,!a),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=s+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,u.push(t)}if(this.options.extractNonFII&&u.length){const e=new Blob([n]),i=[];for(const t of u){if(t.isFII&&!this.options.extractFII)continue;const s=e.slice(t.start,t.end+1,"image/jpeg");i.push(s)}t(i)}}}o+=2+n.getUint16(o+2)}}))}}const Jr=async e=>{const t=(e=>{let t;t="undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):e.toString();let i=t.indexOf("<x:xmpmeta");for(;-1!==i;){const e=t.indexOf("x:xmpmeta>",i),s=t.slice(i,e+10);try{const e=Kr(s,"hdrgm:GainMapMin","0"),t=Kr(s,"hdrgm:GainMapMax"),i=Kr(s,"hdrgm:Gamma","1"),n=Kr(s,"hdrgm:OffsetSDR","0.015625"),a=Kr(s,"hdrgm:OffsetHDR","0.015625"),r=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(s),o=r?r[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(s);if(!l)throw new Error("Incomplete gainmap metadata");const A=l[1];return{gainMapMin:Array.isArray(e)?e.map((e=>parseFloat(e))):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map((e=>parseFloat(e))):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(i)?i.map((e=>parseFloat(e))):[parseFloat(i),parseFloat(i),parseFloat(i)],offsetSdr:Array.isArray(n)?n.map((e=>parseFloat(e))):[parseFloat(n),parseFloat(n),parseFloat(n)],offsetHdr:Array.isArray(a)?a.map((e=>parseFloat(e))):[parseFloat(a),parseFloat(a),parseFloat(a)],hdrCapacityMin:parseFloat(o),hdrCapacityMax:parseFloat(A)}}catch(e){}i=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new Vr("Gain map XMP metadata not found");const i=new Wr({extractFII:!0,extractNonFII:!0}),s=await i.extract(e);if(2!==s.length)throw new qr("Gain map recovery image not found");return{sdr:new Uint8Array(await s[0].arrayBuffer()),gainMap:new Uint8Array(await s[1].arrayBuffer()),metadata:t}},Yr=e=>new Promise(((t,i)=>{const s=document.createElement("img");s.onload=()=>{t(s)},s.onerror=e=>{i(e)},s.src=URL.createObjectURL(e)}));class Xr extends t.Loader{constructor(e,i){super(i),e&&(this._renderer=e),this._internalLoadingManager=new t.LoadingManager}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new zr({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new t.Texture,sdr:new t.Texture});return new Hr({width:16,height:16,type:t.HalfFloatType,colorSpace:t.LinearSRGBColorSpace,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,i,s,n){const a=n?new Blob([n],{type:"image/jpeg"}):void 0,r=new Blob([s],{type:"image/jpeg"});let o,l,A=!1;if("undefined"==typeof createImageBitmap){const e=await Promise.all([a?Yr(a):Promise.resolve(void 0),Yr(r)]);l=e[0],o=e[1],A=!0}else{const e=await Promise.all([a?createImageBitmap(a,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(r,{imageOrientation:"flipY"})]);l=e[0],o=e[1]}const c=new t.Texture(l||new ImageData(2,2),t.UVMapping,t.ClampToEdgeWrapping,t.ClampToEdgeWrapping,t.LinearFilter,t.LinearMipMapLinearFilter,t.RGBAFormat,t.UnsignedByteType,1,t.LinearSRGBColorSpace);c.flipY=A,c.needsUpdate=!0;const h=new t.Texture(o,t.UVMapping,t.ClampToEdgeWrapping,t.ClampToEdgeWrapping,t.LinearFilter,t.LinearMipMapLinearFilter,t.RGBAFormat,t.UnsignedByteType,1,t.SRGBColorSpace);h.flipY=A,h.needsUpdate=!0,e.width=o.width,e.height=o.height,e.material.gainMap=c,e.material.sdr=h,e.material.gainMapMin=i.gainMapMin,e.material.gainMapMax=i.gainMapMax,e.material.offsetHdr=i.offsetHdr,e.material.offsetSdr=i.offsetSdr,e.material.gamma=i.gamma,e.material.hdrCapacityMin=i.hdrCapacityMin,e.material.hdrCapacityMax=i.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,i.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class $r extends Xr{load(e,i,s,n){const a=this.prepareQuadRenderer(),r=new t.FileLoader(this._internalLoadingManager);return r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setPath(this.path),r.setWithCredentials(this.withCredentials),this.manager.itemStart(e),r.load(e,(async t=>{if("string"==typeof t)throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const s=new Uint8Array(t);let r,o,l;try{const e=await Jr(s);r=e.sdr,o=e.gainMap,l=e.metadata}catch(t){if(!(t instanceof Vr||t instanceof qr))throw t;console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),l={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},r=s}try{await this.render(a,l,r,o)}catch(t){return this.manager.itemError(e),"function"==typeof n&&n(t),void a.disposeOnDemandRenderer()}"function"==typeof i&&i(a),this.manager.itemEnd(e),a.disposeOnDemandRenderer()}),s,(t=>{this.manager.itemError(e),"function"==typeof n&&n(t)})),a}}class Zr extends t.DataTextureLoader{constructor(e){super(e),this.type=t.HalfFloatType}parse(e){const i=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},s=function(e,t,i){t=t||1024;let s=e.pos,n=-1,a=0,r="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));for(;0>(n=o.indexOf("\n"))&&a<t&&s<e.byteLength;)r+=o,a+=o.length,s+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));return-1<n&&(e.pos+=a+n+1,r+o.slice(0,n))},n=function(e,t,i,s){const n=e[t+3],a=Math.pow(2,n-128)/255;i[s+0]=e[t+0]*a,i[s+1]=e[t+1]*a,i[s+2]=e[t+2]*a,i[s+3]=1},a=function(e,i,s,n){const a=e[i+3],r=Math.pow(2,a-128)/255;s[n+0]=t.DataUtils.toHalfFloat(Math.min(e[i+0]*r,65504)),s[n+1]=t.DataUtils.toHalfFloat(Math.min(e[i+1]*r,65504)),s[n+2]=t.DataUtils.toHalfFloat(Math.min(e[i+2]*r,65504)),s[n+3]=t.DataUtils.toHalfFloat(1)},r=new Uint8Array(e);r.pos=0;const o=function(e){const t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,r=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,A;for((e.pos>=e.byteLength||!(l=s(e)))&&i(1,"no header found"),(A=l.match(/^#\?(\S+)/))||i(3,"bad initial token"),o.valid|=1,o.programtype=A[1],o.string+=l+"\n";l=s(e),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((A=l.match(t))&&(o.gamma=parseFloat(A[1])),(A=l.match(n))&&(o.exposure=parseFloat(A[1])),(A=l.match(a))&&(o.valid|=2,o.format=A[1]),(A=l.match(r))&&(o.valid|=4,o.height=parseInt(A[1],10),o.width=parseInt(A[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid||i(3,"missing format specifier"),4&o.valid||i(3,"missing image size specifier"),o}(r),l=o.width,A=o.height,c=function(e,t,s){const n=t;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);n!==(e[2]<<8|e[3])&&i(3,"wrong scanline width");const a=new Uint8Array(4*t*s);a.length||i(4,"unable to allocate buffer space");let r=0,o=0;const l=4*n,A=new Uint8Array(4),c=new Uint8Array(l);let h=s;for(;h>0&&o<e.byteLength;){o+4>e.byteLength&&i(1),A[0]=e[o++],A[1]=e[o++],A[2]=e[o++],A[3]=e[o++],2==A[0]&&2==A[1]&&(A[2]<<8|A[3])==n||i(3,"bad rgbe scanline format");let t,s=0;for(;s<l&&o<e.byteLength;){t=e[o++];const n=t>128;if(n&&(t-=128),(0===t||s+t>l)&&i(3,"bad scanline data"),n){const i=e[o++];for(let e=0;e<t;e++)c[s++]=i}else c.set(e.subarray(o,o+t),s),s+=t,o+=t}const u=n;for(let e=0;e<u;e++){let t=0;a[r]=c[e+t],t+=n,a[r+1]=c[e+t],t+=n,a[r+2]=c[e+t],t+=n,a[r+3]=c[e+t],r+=4}h--}return a}(r.subarray(r.pos),l,A);let h,u,d;switch(this.type){case t.FloatType:d=c.length/4;const e=new Float32Array(4*d);for(let t=0;t<d;t++)n(c,4*t,e,4*t);h=e,u=t.FloatType;break;case t.HalfFloatType:d=c.length/4;const i=new Uint16Array(4*d);for(let e=0;e<d;e++)a(c,4*e,i,4*e);h=i,u=t.HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:l,height:A,data:h,header:o.string,gamma:o.gamma,exposure:o.exposure,type:u}}setDataType(e){return this.type=e,this}load(e,i,s,n){return super.load(e,(function(e,s){switch(e.type){case t.FloatType:case t.HalfFloatType:e.colorSpace=t.LinearSRGBColorSpace,e.minFilter=t.LinearFilter,e.magFilter=t.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}i&&i(e,s)}),s,n)}}
/* @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const eo={topLight:{intensity:500,position:[.418,16.199,.3]},room:{position:[-.757,13.219,.717],scale:[31.713,28.305,28.591]},boxes:[{position:[-10.906,2.009,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,.857,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:50,position:[-16.116,14.37,8.208],scale:[.1,2.428,2.739]},{intensity:50,position:[-16.109,18.021,-8.207],scale:[.1,2.425,2.751]},{intensity:17,position:[14.904,12.198,-1.832],scale:[.15,4.265,6.331]},{intensity:43,position:[-.462,8.89,14.52],scale:[4.38,5.441,.088]},{intensity:20,position:[3.235,11.486,-12.541],scale:[2.5,2,.1]},{intensity:100,position:[0,20,0],scale:[1,.1,1]}]},to={topLight:{intensity:400,position:[.5,14,.5]},room:{position:[0,13.2,0],scale:[31.5,28.5,31.5]},boxes:[{position:[-10.906,-1,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,-.16,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:80,position:[-14,10,8],scale:[.1,2.5,2.5]},{intensity:80,position:[-14,14,-4],scale:[.1,2.5,2.5]},{intensity:23,position:[14,12,0],scale:[.1,5,5]},{intensity:16,position:[0,9,14],scale:[5,5,.1]},{intensity:80,position:[7,8,-14],scale:[2.5,2.5,.1]},{intensity:80,position:[-7,16,-14],scale:[2.5,2.5,.1]},{intensity:1,position:[0,20,0],scale:[.1,.1,.1]}]};class io extends t.Scene{constructor(e){super(),this.position.y=-3.5;const i=new t.BoxGeometry;i.deleteAttribute("uv");const s=new t.MeshStandardMaterial({metalness:0,side:t.BackSide}),n=new t.MeshStandardMaterial({metalness:0}),a="legacy"==e?eo:to,r=new t.PointLight(16777215,a.topLight.intensity,28,2);r.position.set(...a.topLight.position),this.add(r);const o=new t.Mesh(i,s);o.position.set(...a.room.position),o.scale.set(...a.room.scale),this.add(o);for(const e of a.boxes){const s=new t.Mesh(i,n);s.position.set(...e.position),s.rotation.set(0,e.rotation,0),s.scale.set(...e.scale),this.add(s)}for(const e of a.lights){const s=new t.Mesh(i,this.createAreaLightMaterial(e.intensity));s.position.set(...e.position),s.scale.set(...e.scale),this.add(s)}}createAreaLightMaterial(e){const i=new t.MeshBasicMaterial;return i.color.setScalar(e),i}}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const so=20,no=/\.hdr(\.js)?$/;class ao{constructor(e){this.threeRenderer=e,this.lottieLoaderUrl="",this._ldrLoader=null,this._imageLoader=null,this._hdrLoader=null,this._lottieLoader=null,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}ldrLoader(e){return null==this._ldrLoader&&(this._ldrLoader=new t.TextureLoader),this._ldrLoader.setWithCredentials(e),this._ldrLoader}imageLoader(e){return null==this._imageLoader&&(this._imageLoader=new $r(this.threeRenderer)),this._imageLoader.setWithCredentials(e),this._imageLoader}hdrLoader(e){return null==this._hdrLoader&&(this._hdrLoader=new Zr,this._hdrLoader.setDataType(t.HalfFloatType)),this._hdrLoader.setWithCredentials(e),this._hdrLoader}async getLottieLoader(e){if(null==this._lottieLoader){const{LottieLoader:e}=await import(this.lottieLoaderUrl);this._lottieLoader=new e}return this._lottieLoader.setWithCredentials(e),this._lottieLoader}async loadImage(e,t){const i=await new Promise(((i,s)=>this.ldrLoader(t).load(e,i,(()=>{}),s)));return i.name=e,i.flipY=!1,i}async loadLottie(e,t,i){const s=await this.getLottieLoader(i);s.setQuality(t);const n=await new Promise(((t,i)=>s.load(e,t,(()=>{}),i)));return n.name=e,n}async loadEquirect(e,i=!1,s=()=>{}){try{const n=no.test(e),a=n?this.hdrLoader(i):this.imageLoader(i),r=await new Promise(((t,i)=>a.load(e,(e=>{const{renderTarget:i}=e;if(null!=i){const{texture:s}=i;e.dispose(!1),t(s)}else t(e)}),(e=>{s(e.loaded/e.total*.9)}),i)));return s(1),r.name=e,r.mapping=t.EquirectangularReflectionMapping,n||(r.colorSpace=t.SRGBColorSpace),r}finally{s&&s(1)}}async generateEnvironmentMapAndSkybox(e=null,t=null,i=()=>{},s=!1){const n="legacy"!==t;"legacy"!==t&&"neutral"!==t||(t=null),t=Be(t);let a,r=Promise.resolve(null);e&&(r=this.loadEquirectFromUrl(e,s,i)),a=t?this.loadEquirectFromUrl(t,s,i):e?this.loadEquirectFromUrl(e,s,i):n?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();const[o,l]=await Promise.all([a,r]);if(null==o)throw new Error("Failed to load environment map.");return{environmentMap:o,skybox:l}}async loadEquirectFromUrl(e,t,i){if(!this.skyboxCache.has(e)){const s=this.loadEquirect(e,t,i);this.skyboxCache.set(e,s)}return this.skyboxCache.get(e)}async GenerateEnvironmentMap(e,i){await((e=0)=>new Promise((t=>setTimeout(t,e))))();const s=this.threeRenderer,n=new t.WebGLCubeRenderTarget(256,{generateMipmaps:!1,type:t.HalfFloatType,format:t.RGBAFormat,colorSpace:t.LinearSRGBColorSpace,depthBuffer:!0}),a=new t.CubeCamera(.1,100,n),r=a.renderTarget.texture;r.name=i;const o=s.outputColorSpace,l=s.toneMapping;return s.toneMapping=t.NoToneMapping,s.outputColorSpace=t.LinearSRGBColorSpace,a.update(s,e),this.blurCubemap(n,.04),s.toneMapping=l,s.outputColorSpace=o,r}async loadGeneratedEnvironmentMap(){return null==this.generatedEnvironmentMap&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new io("legacy"),"legacy")),this.generatedEnvironmentMap}async loadGeneratedEnvironmentMapAlt(){return null==this.generatedEnvironmentMapAlt&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new io("neutral"),"neutral")),this.generatedEnvironmentMapAlt}blurCubemap(e,i){if(null==this.blurMaterial){this.blurMaterial=this.getBlurShader(so);const e=new t.BoxGeometry,i=new t.Mesh(e,this.blurMaterial);this.blurScene=new t.Scene,this.blurScene.add(i)}const s=e.clone();this.halfblur(e,s,i,"latitudinal"),this.halfblur(s,e,i,"longitudinal")}halfblur(e,i,s,n){const a=e.width,r=isFinite(s)?Math.PI/(2*a):2*Math.PI/39,o=s/r,l=isFinite(s)?1+Math.floor(3*o):so;l>so&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${l} samples when the maximum is set to 20`);const A=[];let c=0;for(let e=0;e<so;++e){const t=e/o,i=Math.exp(-t*t/2);A.push(i),0==e?c+=i:e<l&&(c+=2*i)}for(let e=0;e<A.length;e++)A[e]=A[e]/c;const h=this.blurMaterial.uniforms;h.envMap.value=e.texture,h.samples.value=l,h.weights.value=A,h.latitudinal.value="latitudinal"===n,h.dTheta.value=r;new t.CubeCamera(.1,100,i).update(this.threeRenderer,this.blurScene)}getBlurShader(e){const i=new Float32Array(e),s=new t.Vector3(0,1,0);return new t.ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:s}},vertexShader:"\n      \n      varying vec3 vOutputDirection;\n  \n      void main() {\n  \n        vOutputDirection = vec3( position );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  \n      }\n    ",fragmentShader:"\n        varying vec3 vOutputDirection;\n  \n        uniform samplerCube envMap;\n        uniform int samples;\n        uniform float weights[ n ];\n        uniform bool latitudinal;\n        uniform float dTheta;\n        uniform vec3 poleAxis;\n  \n        vec3 getSample( float theta, vec3 axis ) {\n  \n          float cosTheta = cos( theta );\n          // Rodrigues' axis-angle rotation\n          vec3 sampleDirection = vOutputDirection * cosTheta\n            + cross( axis, vOutputDirection ) * sin( theta )\n            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n  \n          return vec3( textureCube( envMap, sampleDirection ) );\n  \n        }\n  \n        void main() {\n  \n          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n  \n          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n  \n            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n  \n          }\n  \n          axis = normalize( axis );\n  \n          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n  \n          for ( int i = 1; i < n; i++ ) {\n  \n            if ( i >= samples ) {\n  \n              break;\n  \n            }\n  \n            float theta = dTheta * float( i );\n            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n  \n          }\n        }\n      ",blending:t.NoBlending,depthTest:!1,depthWrite:!1,side:t.BackSide})}async dispose(){for(const[,e]of this.skyboxCache){(await e).dispose()}null!=this.generatedEnvironmentMap&&((await this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),null!=this.generatedEnvironmentMapAlt&&((await this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),null!=this.blurMaterial&&this.blurMaterial.dispose()}}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const ro=[1,.79,.62,.5,.4,.31,.25],oo="high-performance";class lo extends t.EventDispatcher{static get singleton(){return this._singleton||(this._singleton=new lo({powerPreference:(self.ModelViewerElement||{}).powerPreference||oo,debug:Te()})),this._singleton}static resetSingleton(){const e=this._singleton.dispose();for(const t of e)t.disconnectedCallback();this._singleton=new lo({powerPreference:(self.ModelViewerElement||{}).powerPreference||oo,debug:Te()});for(const t of e)t.connectedCallback()}get canRender(){return null!=this.threeRenderer}get scaleFactor(){return ro[this.scaleStep]}set minScale(e){let t=1;for(;t<ro.length&&!(ro[t]<e);)++t;this.lastStep=t-1}constructor(e){super(),this.loader=new Hi(Ur),this.width=0,this.height=0,this.dpr=1,this.scenes=new Set,this.multipleScenesVisible=!1,this.lastTick=performance.now(),this.renderedLastFrame=!1,this.scaleStep=0,this.lastStep=3,this.avgFrameDuration=50,this.onWebGLContextLost=e=>{this.dispatchEvent({type:"contextlost",sourceEvent:e})},this.onWebGLContextRestored=()=>{var e;null===(e=this.textureUtils)||void 0===e||e.dispose(),this.textureUtils=new ao(this.threeRenderer);for(const e of this.scenes)e.element[Fe]()},this.dpr=window.devicePixelRatio,this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas",this.canvas3D.classList.add("show");try{this.threeRenderer=new t.WebGLRenderer({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:e.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.setPixelRatio(1),this.threeRenderer.debug={checkShaderErrors:!!e.debug,onShaderError:null},this.threeRenderer.toneMapping=t.NeutralToneMapping}catch(e){console.warn(e)}this.arRenderer=new Ir(this),this.textureUtils=this.canRender?new ao(this.threeRenderer):null,Hi.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize()}registerScene(e){this.scenes.add(e),e.forceRescale();const i=new t.Vector2;this.threeRenderer.getSize(i),e.canvas.width=i.x,e.canvas.height=i.y,this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop(((e,t)=>this.render(e,t)))}unregisterScene(e){this.scenes.delete(e),this.canvas3D.parentElement===e.canvas.parentElement&&e.canvas.parentElement.removeChild(this.canvas3D),this.canRender&&0===this.scenes.size&&this.threeRenderer.setAnimationLoop(null)}displayCanvas(e){return e.element.modelIsVisible&&!this.multipleScenesVisible?this.canvas3D:e.element[ZA]}countVisibleScenes(){const{canvas3D:e}=this;let t=0,i=null;for(const s of this.scenes){const{element:n}=s;n.modelIsVisible&&null==s.externalRenderer&&++t,e.parentElement===s.canvas.parentElement&&(i=s)}const s=t>1;if(null!=i){const t=s&&!this.multipleScenesVisible,n=!i.element.modelIsVisible;if(t||n){const{width:t,height:s}=this.sceneSize(i);this.copyPixels(i,t,s),e.parentElement.removeChild(e)}}this.multipleScenesVisible=s}updateRendererSize(){var e;const t=window.devicePixelRatio;if(t!==this.dpr)for(const e of this.scenes){const{element:t}=e;t[UA](t.getBoundingClientRect())}let i=0,s=0;for(const e of this.scenes)i=Math.max(i,e.width),s=Math.max(s,e.height);if(i!==this.width||s!==this.height||t!==this.dpr){this.width=i,this.height=s,this.dpr=t,i=Math.ceil(i*t),s=Math.ceil(s*t),this.canRender&&this.threeRenderer.setSize(i,s,!1);for(const t of this.scenes){const{canvas:n}=t;n.width=i,n.height=s,t.forceRescale(),null===(e=t.effectRenderer)||void 0===e||e.setSize(i,s)}}}updateRendererScale(e){const t=this.scaleStep;this.avgFrameDuration+=Me(.2*(e-this.avgFrameDuration),-5,5),this.avgFrameDuration>60?++this.scaleStep:this.avgFrameDuration<40&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),t!==this.scaleStep&&(this.avgFrameDuration=50)}shouldRender(e){if(e.shouldRender())e.scaleStep!=this.scaleStep&&(e.scaleStep=this.scaleStep,this.rescaleCanvas(e));else{if(0==e.scaleStep)return!1;e.scaleStep=0,this.rescaleCanvas(e)}return!0}rescaleCanvas(e){const t=ro[e.scaleStep],i=Math.ceil(this.width/t),s=Math.ceil(this.height/t),{style:n}=e.canvas;n.width=`${i}px`,n.height=`${s}px`,this.canvas3D.style.width=`${i}px`,this.canvas3D.style.height=`${s}px`;const a=this.dpr*t,r=t<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";e.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:a,minimumDpr:this.dpr*ro[this.lastStep],pixelWidth:Math.ceil(e.width*a),pixelHeight:Math.ceil(e.height*a),reason:r}}))}sceneSize(e){const{dpr:t}=this,i=ro[e.scaleStep];return{width:Math.min(Math.ceil(e.width*i*t),this.canvas3D.width),height:Math.min(Math.ceil(e.height*i*t),this.canvas3D.height)}}copyPixels(e,t,i){const s=e.context;null!=s?(s.clearRect(0,0,t,i),s.drawImage(this.canvas3D,0,0,t,i,0,0,t,i),e.canvas.classList.add("show")):console.log("could not acquire 2d context")}orderedScenes(){const e=[];for(const t of[!1,!0])for(const i of this.scenes)i.element.modelIsVisible===t&&e.push(i);return e}get isPresenting(){return this.arRenderer.isPresenting}preRender(e,i,s){const{element:n,exposure:a,toneMapping:r}=e;n[ic](i,s);const o="number"==typeof a&&!Number.isNaN(a),l=n.environmentImage,A=n.skyboxImage,c=r===t.NeutralToneMapping&&("neutral"===l||"legacy"===l||!l&&!A);this.threeRenderer.toneMappingExposure=(o?a:1)*(c?1.3:1)}render(e,t){if(null!=t)return void this.arRenderer.onWebXRFrame(e,t);const i=e-this.lastTick;if(this.lastTick=e,!this.canRender||this.isPresenting)return;this.countVisibleScenes(),this.updateRendererSize(),this.renderedLastFrame&&(this.updateRendererScale(i),this.renderedLastFrame=!1);const{canvas3D:s}=this;for(const t of this.orderedScenes()){const{element:n}=t;if(!n.loaded||!n.modelIsVisible&&t.renderCount>0)continue;if(this.preRender(t,e,i),!this.shouldRender(t))continue;if(null!=t.externalRenderer){const e=t.getCamera();e.updateMatrix();const{matrix:i,projectionMatrix:s}=e,n=i.elements.slice(),a=t.getTarget();n[12]+=a.x,n[13]+=a.y,n[14]+=a.z,t.externalRenderer.render({viewMatrix:n,projectionMatrix:s.elements});continue}if(!n.modelIsVisible&&!this.multipleScenesVisible)for(const e of this.scenes)e.element.modelIsVisible&&e.queueRender();const{width:a,height:r}=this.sceneSize(t);t.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.ceil(this.height*this.dpr)-r,a,r),null!=t.effectRenderer?t.effectRenderer.render(i):(this.threeRenderer.autoClear=!0,this.threeRenderer.toneMapping=t.toneMapping,this.threeRenderer.render(t,t.camera)),this.multipleScenesVisible||!t.element.modelIsVisible&&0===t.renderCount?this.copyPixels(t,a,r):s.parentElement!==t.canvas.parentElement&&(t.canvas.parentElement.appendChild(s),t.canvas.classList.remove("show")),t.hasRendered(),++t.renderCount,this.renderedLastFrame=!0}}dispose(){null!=this.textureUtils&&this.textureUtils.dispose(),null!=this.threeRenderer&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const e=[];for(const t of this.scenes)e.push(t.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),e}}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ao=Symbol("correlatedObjects"),co=Symbol("onUpdate");class ho{constructor(e,t){this[co]=e,this[Ao]=t}}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const uo=new t.MeshBasicMaterial,po=new t.PlaneGeometry(2,2);let go=0;const mo=Symbol("threeTexture"),fo=Symbol("threeTextures");let bo=class extends ho{get[mo](){var e;return null===(e=this[Ao])||void 0===e?void 0:e.values().next().value}get[fo](){return this[Ao]}constructor(e,t){super(e,new Set(t?[t]:[])),this[mo].image.src||(this[mo].image.src=t.name?t.name:"adhoc_image"+go++),this[mo].image.name||(this[mo].image.name=t&&t.image&&t.image.src?t.image.src.split("/").pop():"adhoc_image")}get name(){return this[mo].image.name||""}get uri(){return this[mo].image.src}get bufferView(){return this[mo].image.bufferView}get element(){const e=this[mo];if(e&&(e.isCanvasTexture||e.isVideoTexture))return e.image}get animation(){const e=this[mo];if(e&&e.isCanvasTexture&&e.animation)return e.animation}get type(){return null!=this.uri?"external":"embedded"}set name(e){for(const t of this[fo])t.image.name=e}update(){const e=this[mo];e&&e.isCanvasTexture&&!e.animation&&(this[mo].needsUpdate=!0,this[co]())}async createThumbnail(e,i){const s=new t.Scene;uo.map=this[mo];const n=new t.Mesh(po,uo);s.add(n);const a=new t.OrthographicCamera(-1,1,1,-1,0,1),{threeRenderer:r}=lo.singleton,o=new t.WebGLRenderTarget(e,i);r.setRenderTarget(o),r.render(s,a),r.setRenderTarget(null);const l=new Uint8Array(e*i*4);r.readRenderTargetPixels(o,0,0,e,i,l),TA.width=e,TA.height=i;const A=TA.getContext("2d"),c=A.createImageData(e,i);return c.data.set(l),A.putImageData(c,0,0),new Promise((async(e,t)=>{TA.toBlob((i=>{if(!i)return t("Failed to capture thumbnail.");e(URL.createObjectURL(i))}),"image/png")}))}};var yo,Co;!function(e){e[e.Nearest=9728]="Nearest",e[e.Linear=9729]="Linear",e[e.NearestMipmapNearest=9984]="NearestMipmapNearest",e[e.LinearMipmapNearest=9985]="LinearMipmapNearest",e[e.NearestMipmapLinear=9986]="NearestMipmapLinear",e[e.LinearMipmapLinear=9987]="LinearMipmapLinear"}(yo||(yo={})),function(e){e[e.ClampToEdge=33071]="ClampToEdge",e[e.MirroredRepeat=33648]="MirroredRepeat",e[e.Repeat=10497]="Repeat"}(Co||(Co={}));
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Io=new Map([[Co.Repeat,t.RepeatWrapping],[Co.ClampToEdge,t.ClampToEdgeWrapping],[Co.MirroredRepeat,t.MirroredRepeatWrapping]]),Eo=new Map([[t.RepeatWrapping,Co.Repeat],[t.ClampToEdgeWrapping,Co.ClampToEdge],[t.MirroredRepeatWrapping,Co.MirroredRepeat]]),wo=new Map([[yo.Nearest,t.NearestFilter],[yo.Linear,t.LinearFilter],[yo.NearestMipmapNearest,t.NearestMipmapNearestFilter],[yo.LinearMipmapNearest,t.LinearMipmapNearestFilter],[yo.NearestMipmapLinear,t.NearestMipmapLinearFilter],[yo.LinearMipmapLinear,t.LinearMipmapLinearFilter]]),Bo=new Map([[t.NearestFilter,yo.Nearest],[t.LinearFilter,yo.Linear],[t.NearestMipmapNearestFilter,yo.NearestMipmapNearest],[t.LinearMipmapNearestFilter,yo.LinearMipmapNearest],[t.NearestMipmapLinearFilter,yo.NearestMipmapLinear],[t.LinearMipmapLinearFilter,yo.LinearMipmapLinear]]),vo=new Map([[yo.Nearest,t.NearestFilter],[yo.Linear,t.LinearFilter]]),xo=new Map([[t.NearestFilter,yo.Nearest],[t.LinearFilter,yo.Linear]]),So=e=>Bo.has(e),Qo=e=>xo.has(e),Mo=e=>Eo.has(e),To=Symbol("threeTexture"),Ro=Symbol("threeTextures"),Do=Symbol("setProperty");class ko extends ho{get[To](){var e;return null===(e=this[Ao])||void 0===e?void 0:e.values().next().value}get[Ro](){return this[Ao]}constructor(e,t){super(e,new Set(t?[t]:[]))}get name(){return this[To].name||""}get minFilter(){return Bo.get(this[To].minFilter)}get magFilter(){return xo.get(this[To].magFilter)}get wrapS(){return Eo.get(this[To].wrapS)}get wrapT(){return Eo.get(this[To].wrapT)}get rotation(){return this[To].rotation}get scale(){return hc(this[To].repeat)}get offset(){return hc(this[To].offset)}setMinFilter(e){this[Do]("minFilter",wo.get(e))}setMagFilter(e){this[Do]("magFilter",vo.get(e))}setWrapS(e){this[Do]("wrapS",Io.get(e))}setWrapT(e){this[Do]("wrapT",Io.get(e))}setRotation(e){null==e&&(e=0),this[Do]("rotation",e)}setScale(e){null==e&&(e={u:1,v:1}),this[Do]("repeat",new t.Vector2(e.u,e.v))}setOffset(e){null==e&&(e={u:0,v:0}),this[Do]("offset",new t.Vector2(e.u,e.v))}[Do](e,t){if(((e,t)=>{switch(e){case"minFilter":return So(t);case"magFilter":return Qo(t);case"wrapS":case"wrapT":return Mo(t);case"rotation":case"repeat":case"offset":return!0;default:throw new Error(`Cannot configure property "${e}" on Sampler`)}})(e,t))for(const i of this[Ro])i[e]=t,i.needsUpdate=!0;this[co]()}}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Fo=Symbol("image"),Lo=Symbol("sampler"),_o=Symbol("threeTexture");class Po extends ho{get[_o](){var e;return null===(e=this[Ao])||void 0===e?void 0:e.values().next().value}constructor(e,t){super(e,new Set(t?[t]:[])),this[Lo]=new ko(e,t),this[Fo]=new bo(e,t)}get name(){return this[_o].name||""}set name(e){for(const t of this[Ao])t.name=e}get sampler(){return this[Lo]}get source(){return this[Fo]}}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Oo,Go,Uo;const No=Symbol("texture"),jo=Symbol("transform"),Ho=Symbol("materials"),zo=Symbol("usage"),qo=Symbol("onUpdate"),Vo=Symbol("activeVideo");var Ko;!function(e){e[e.Base=0]="Base",e[e.MetallicRoughness=1]="MetallicRoughness",e[e.Normal=2]="Normal",e[e.Occlusion=3]="Occlusion",e[e.Emissive=4]="Emissive",e[e.Clearcoat=5]="Clearcoat",e[e.ClearcoatRoughness=6]="ClearcoatRoughness",e[e.ClearcoatNormal=7]="ClearcoatNormal",e[e.SheenColor=8]="SheenColor",e[e.SheenRoughness=9]="SheenRoughness",e[e.Transmission=10]="Transmission",e[e.Thickness=11]="Thickness",e[e.Specular=12]="Specular",e[e.SpecularColor=13]="SpecularColor",e[e.Iridescence=14]="Iridescence",e[e.IridescenceThickness=15]="IridescenceThickness",e[e.Anisotropy=16]="Anisotropy"}(Ko||(Ko={}));class Wo{constructor(e,i,s,n){this[Oo]=null,this[Go]={rotation:0,scale:new t.Vector2(1,1),offset:new t.Vector2(0,0)},this[Uo]=!1,s&&(this[jo].rotation=s.rotation,this[jo].scale.copy(s.repeat),this[jo].offset.copy(s.offset),this[No]=new Po(e,s)),this[qo]=e,this[Ho]=n,this[zo]=i}get texture(){return this[No]}setTexture(e){var i,s;const n=null!=e?e.source[mo]:null,a=null===(i=this[No])||void 0===i?void 0:i.source[mo];if(null!=a&&a.isVideoTexture?this[Vo]=!1:(null===(s=this[No])||void 0===s?void 0:s.source.animation)&&this[No].source.animation.removeEventListener("enterFrame",this[qo]),this[No]=e,null!=n&&n.isVideoTexture){const e=n.image;if(this[Vo]=!0,null!=e.requestVideoFrameCallback){const t=()=>{this[Vo]&&(this[qo](),e.requestVideoFrameCallback(t))};e.requestVideoFrameCallback(t)}else{const e=()=>{this[Vo]&&(this[qo](),requestAnimationFrame(e))};requestAnimationFrame(e)}}else null!=(null==e?void 0:e.source.animation)&&e.source.animation.addEventListener("enterFrame",this[qo]);let r=t.SRGBColorSpace;if(this[Ho])for(const e of this[Ho]){switch(this[zo]){case Ko.Base:e.map=n;break;case Ko.MetallicRoughness:r=t.LinearSRGBColorSpace,e.metalnessMap=n,e.roughnessMap=n;break;case Ko.Normal:r=t.LinearSRGBColorSpace,e.normalMap=n;break;case Ko.Occlusion:r=t.LinearSRGBColorSpace,e.aoMap=n;break;case Ko.Emissive:e.emissiveMap=n;break;case Ko.Clearcoat:e.clearcoatMap=n;break;case Ko.ClearcoatRoughness:e.clearcoatRoughnessMap=n;break;case Ko.ClearcoatNormal:e.clearcoatNormalMap=n;break;case Ko.SheenColor:e.sheenColorMap=n;break;case Ko.SheenRoughness:e.sheenRoughnessMap=n;break;case Ko.Transmission:e.transmissionMap=n;break;case Ko.Thickness:e.thicknessMap=n;break;case Ko.Specular:e.specularIntensityMap=n;break;case Ko.SpecularColor:e.specularColorMap=n;break;case Ko.Iridescence:e.iridescenceMap=n;break;case Ko.IridescenceThickness:e.iridescenceThicknessMap=n;break;case Ko.Anisotropy:e.anisotropyMap=n}e.needsUpdate=!0}n&&(n.colorSpace=r,n.rotation=this[jo].rotation,n.repeat=this[jo].scale,n.offset=this[jo].offset),this[qo]()}}Oo=No,Go=jo,Uo=Vo;
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Jo=Symbol("threeMaterial"),Yo=Symbol("threeMaterials"),Xo=Symbol("baseColorTexture"),$o=Symbol("metallicRoughnessTexture");class Zo extends ho{get[Yo](){return this[Ao]}get[Jo](){var e;return null===(e=this[Ao])||void 0===e?void 0:e.values().next().value}constructor(e,t){super(e,t);const{map:i,metalnessMap:s}=t.values().next().value;this[Xo]=new Wo(e,Ko.Base,i,t),this[$o]=new Wo(e,Ko.MetallicRoughness,s,t)}get baseColorFactor(){const e=[0,0,0,this[Jo].opacity];return this[Jo].color.toArray(e),e}get metallicFactor(){return this[Jo].metalness}get roughnessFactor(){return this[Jo].roughness}get baseColorTexture(){return this[Xo]}get metallicRoughnessTexture(){return this[$o]}setBaseColorFactor(e){const i=new t.Color;e instanceof Array?i.fromArray(e):i.set(e);for(const t of this[Yo])t.color.set(i),e instanceof Array&&e.length>3?t.opacity=e[3]:(e=[0,0,0,t.opacity],i.toArray(e));this[co]()}setMetallicFactor(e){for(const t of this[Yo])t.metalness=e;this[co]()}setRoughnessFactor(e){for(const t of this[Yo])t.roughness=e;this[co]()}}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var el,tl;const il=Symbol("pbrMetallicRoughness"),sl=Symbol("normalTexture"),nl=Symbol("occlusionTexture"),al=Symbol("emissiveTexture"),rl=Symbol("backingThreeMaterial"),ol=Symbol("applyAlphaCutoff"),ll=Symbol("getAlphaMode"),Al=Symbol("lazyLoadGLTFInfo"),cl=Symbol("initialize"),hl=Symbol("getLoadedMaterial"),ul=Symbol("ensureMaterialIsLoaded"),dl=Symbol("gltfIndex"),pl=Symbol("setActive"),gl=Symbol("variantIndices"),ml=Symbol("isActive"),fl=Symbol("modelVariants"),bl=Symbol("name"),yl=Symbol("pbrTextures");class Cl extends ho{get[(el=gl,tl=yl,rl)](){return this[Ao].values().next().value}constructor(e,t,i,s,n,a,r=void 0){super(e,n),this[el]=new Set,this[tl]=new Map,this[dl]=t,this[ml]=i,this[fl]=s,this[bl]=a,null==r?this[cl]():this[Al]=r}[cl](){const e=this[co],t=this[Ao];this[il]=new Zo(e,t);const{normalMap:i,aoMap:s,emissiveMap:n}=t.values().next().value;this[sl]=new Wo(e,Ko.Normal,i,t),this[nl]=new Wo(e,Ko.Occlusion,s,t),this[al]=new Wo(e,Ko.Emissive,n,t);const a=i=>{this[yl].set(i,new Wo(e,i,null,t))};a(Ko.Clearcoat),a(Ko.ClearcoatRoughness),a(Ko.ClearcoatNormal),a(Ko.SheenColor),a(Ko.SheenRoughness),a(Ko.Transmission),a(Ko.Thickness),a(Ko.Specular),a(Ko.SpecularColor),a(Ko.Iridescence),a(Ko.IridescenceThickness),a(Ko.Anisotropy)}async[hl](){if(null!=this[Al]){const e=await this[Al].doLazyLoad();return this[cl](),this[Al]=void 0,this.ensureLoaded=async()=>{},e}return null}colorFromRgb(e){const i=new t.Color;return e instanceof Array?i.fromArray(e):i.set(e),i}[ul](){if(null!=this[Al])throw new Error(`Material "${this.name}" has not been loaded, call 'await\n    myMaterial.ensureLoaded()' before using an unloaded material.`)}async ensureLoaded(){await this[hl]()}get isLoaded(){return null==this[Al]}get isActive(){return this[ml]}[pl](e){this[ml]=e}get name(){return this[bl]||""}set name(e){if(this[bl]=e,null!=this[Ao])for(const t of this[Ao])t.name=e}get pbrMetallicRoughness(){return this[ul](),this[il]}get normalTexture(){return this[ul](),this[sl]}get occlusionTexture(){return this[ul](),this[nl]}get emissiveTexture(){return this[ul](),this[al]}get emissiveFactor(){return this[ul](),this[rl].emissive.toArray()}get index(){return this[dl]}hasVariant(e){const t=this[fl].get(e);return null!=t&&this[gl].has(t.index)}setEmissiveFactor(e){this[ul]();const t=this.colorFromRgb(e);for(const e of this[Ao])e.emissive.set(t);this[co]()}[ll](){return this[rl].transparent?"BLEND":this[rl].alphaTest>0?"MASK":"OPAQUE"}[ol](){this[ul]();for(const e of this[Ao])"MASK"===this[ll]()?null==e.alphaTest&&(e.alphaTest=.5):e.alphaTest=void 0,e.needsUpdate=!0}setAlphaCutoff(e){this[ul]();for(const t of this[Ao])t.alphaTest=e,t.needsUpdate=!0;this[ol](),this[co]()}getAlphaCutoff(){return this[ul](),this[rl].alphaTest}setDoubleSided(e){this[ul]();for(const i of this[Ao])i.side=e?t.DoubleSide:t.FrontSide,i.needsUpdate=!0;this[co]()}getDoubleSided(){return this[ul](),this[rl].side==t.DoubleSide}setAlphaMode(e){this[ul]();const t=(e,t)=>{e.transparent=t,e.depthWrite=!t};for(const i of this[Ao])t(i,"BLEND"===e),i.alphaTest="MASK"===e?.5:void 0,i.needsUpdate=!0;this[co]()}getAlphaMode(){return this[ul](),this[ll]()}get emissiveStrength(){return this[ul](),this[rl].emissiveIntensity}setEmissiveStrength(e){this[ul]();for(const t of this[Ao])t.emissiveIntensity=e;this[co]()}get clearcoatFactor(){return this[ul](),this[rl].clearcoat}get clearcoatRoughnessFactor(){return this[ul](),this[rl].clearcoatRoughness}get clearcoatTexture(){return this[ul](),this[yl].get(Ko.Clearcoat)}get clearcoatRoughnessTexture(){return this[ul](),this[yl].get(Ko.ClearcoatRoughness)}get clearcoatNormalTexture(){return this[ul](),this[yl].get(Ko.ClearcoatNormal)}get clearcoatNormalScale(){return this[ul](),this[rl].clearcoatNormalScale.x}setClearcoatFactor(e){this[ul]();for(const t of this[Ao])t.clearcoat=e;this[co]()}setClearcoatRoughnessFactor(e){this[ul]();for(const t of this[Ao])t.clearcoatRoughness=e;this[co]()}setClearcoatNormalScale(e){this[ul]();for(const i of this[Ao])i.clearcoatNormalScale=new t.Vector2(e,e);this[co]()}get ior(){return this[ul](),this[rl].ior}setIor(e){this[ul]();for(const t of this[Ao])t.ior=e;this[co]()}get sheenColorFactor(){return this[ul](),this[rl].sheenColor.toArray()}get sheenColorTexture(){return this[ul](),this[yl].get(Ko.SheenColor)}get sheenRoughnessFactor(){return this[ul](),this[rl].sheenRoughness}get sheenRoughnessTexture(){return this[ul](),this[yl].get(Ko.SheenRoughness)}setSheenColorFactor(e){this[ul]();const t=this.colorFromRgb(e);for(const e of this[Ao])e.sheenColor.set(t),e.sheen=1;this[co]()}setSheenRoughnessFactor(e){this[ul]();for(const t of this[Ao])t.sheenRoughness=e,t.sheen=1;this[co]()}get transmissionFactor(){return this[ul](),this[rl].transmission}get transmissionTexture(){return this[ul](),this[yl].get(Ko.Transmission)}setTransmissionFactor(e){this[ul]();for(const t of this[Ao])t.transmission=e;this[co]()}get thicknessFactor(){return this[ul](),this[rl].thickness}get thicknessTexture(){return this[ul](),this[yl].get(Ko.Thickness)}get attenuationDistance(){return this[ul](),this[rl].attenuationDistance}get attenuationColor(){return this[ul](),this[rl].attenuationColor.toArray()}setThicknessFactor(e){this[ul]();for(const t of this[Ao])t.thickness=e;this[co]()}setAttenuationDistance(e){this[ul]();for(const t of this[Ao])t.attenuationDistance=e;this[co]()}setAttenuationColor(e){this[ul]();const t=this.colorFromRgb(e);for(const e of this[Ao])e.attenuationColor.set(t);this[co]()}get specularFactor(){return this[ul](),this[rl].specularIntensity}get specularTexture(){return this[ul](),this[yl].get(Ko.Specular)}get specularColorFactor(){return this[ul](),this[rl].specularColor.toArray()}get specularColorTexture(){return this[ul](),this[yl].get(Ko.SheenColor)}setSpecularFactor(e){this[ul]();for(const t of this[Ao])t.specularIntensity=e;this[co]()}setSpecularColorFactor(e){this[ul]();const t=this.colorFromRgb(e);for(const e of this[Ao])e.specularColor.set(t);this[co]()}get iridescenceFactor(){return this[ul](),this[rl].iridescence}get iridescenceTexture(){return this[ul](),this[yl].get(Ko.Iridescence)}get iridescenceIor(){return this[ul](),this[rl].iridescenceIOR}get iridescenceThicknessMinimum(){return this[ul](),this[rl].iridescenceThicknessRange[0]}get iridescenceThicknessMaximum(){return this[ul](),this[rl].iridescenceThicknessRange[1]}get iridescenceThicknessTexture(){return this[ul](),this[yl].get(Ko.IridescenceThickness)}setIridescenceFactor(e){this[ul]();for(const t of this[Ao])t.iridescence=e;this[co]()}setIridescenceIor(e){this[ul]();for(const t of this[Ao])t.iridescenceIOR=e;this[co]()}setIridescenceThicknessMinimum(e){this[ul]();for(const t of this[Ao])t.iridescenceThicknessRange[0]=e;this[co]()}setIridescenceThicknessMaximum(e){this[ul]();for(const t of this[Ao])t.iridescenceThicknessRange[1]=e;this[co]()}get anisotropyStrength(){return this[ul](),this[rl].anisotropy}get anisotropyRotation(){return this[ul](),this[rl].anisotropyRotation}get anisotropyTexture(){return this[ul](),this[yl].get(Ko.Anisotropy)}setAnisotropyStrength(e){this[ul]();for(const t of this[Ao])t.anisotropy=e;this[co]()}setAnisotropyRotation(e){this[ul]();for(const t of this[Ao])t.anisotropyRotation=e;this[co]()}}let Il=class{constructor(e){this.name="",this.children=new Array,this.name=e}};class El extends Il{constructor(e,t,i,s){super(e.name),this.materials=new Map,this.variantToMaterialMap=new Map,this.initialMaterialIdx=0,this.activeMaterialIdx=0,this.mesh=e;const{gltf:n,threeGLTF:a,threeObjectMap:r}=s;this.parser=a.parser,this.modelVariants=i,this.mesh.userData.variantData=i;const o=r.get(e.material);null!=o.materials?this.initialMaterialIdx=this.activeMaterialIdx=o.materials:console.error(`Primitive (${e.name}) missing initial material reference.`);const l=e.userData.associations||{};if(null==l.meshes)return void console.error("Mesh is missing primitive index association");const A=((n.meshes||[])[l.meshes].primitives||[])[l.primitives];if(null!=A){if(null!=A.material)this.materials.set(A.material,t[A.material]);else{const e=t.findIndex((e=>"Default"===e.name));e>=0?this.materials.set(e,t[e]):console.warn("gltfPrimitive has no material!")}if(A.extensions&&A.extensions.KHR_materials_variants){const e=A.extensions.KHR_materials_variants,s=a.parser.json.extensions.KHR_materials_variants.variants;for(const n of e.mappings){const e=t[n.material];this.materials.set(n.material,e);for(const t of n.variants){const{name:n}=s[t];this.variantToMaterialMap.set(t,e),e[gl].add(t),i.has(n)||i.set(n,{name:n,index:t})}}}}else console.error("Mesh primitive definition is missing.")}async setActiveMaterial(e){const t=this.materials.get(e);if(e!==this.activeMaterialIdx){const i=t[Ao],s=await t[hl]();this.mesh.material=null!=s?s:i.values().next().value,this.parser.assignFinalMaterial(this.mesh),i.add(this.mesh.material),this.activeMaterialIdx=e}return this.mesh.material}getActiveMaterial(){return this.materials.get(this.activeMaterialIdx)}getMaterial(e){return this.materials.get(e)}async enableVariant(e){if(null==e)return this.setActiveMaterial(this.initialMaterialIdx);if(null!=this.variantToMaterialMap&&this.modelVariants.has(e)){const t=this.modelVariants.get(e);return this.enableVariantHelper(t.index)}return null}async enableVariantHelper(e){if(null!=this.variantToMaterialMap&&null!=e){const t=this.variantToMaterialMap.get(e);if(null!=t)return this.setActiveMaterial(t.index)}return null}async instantiateVariants(){if(null!=this.variantToMaterialMap)for(const e of this.variantToMaterialMap.keys()){const t=this.mesh.userData.variantMaterials.get(e);if(null!=t.material)continue;const i=await this.enableVariantHelper(e);null!=i&&(t.material=i)}}get variantInfo(){return this.variantToMaterialMap}addVariant(e,t){if(!this.ensureVariantIsUnused(t))return!1;this.modelVariants.has(t)||this.modelVariants.set(t,{name:t,index:this.modelVariants.size});const i=this.modelVariants.get(t).index;return e[gl].add(i),this.variantToMaterialMap.set(i,e),this.materials.set(e.index,e),this.updateVariantUserData(i,e),!0}deleteVariant(e){if(this.variantInfo.has(e)){this.variantInfo.delete(e);const t=this.mesh.userData.variantMaterials;null!=t&&t.delete(e)}}updateVariantUserData(e,t){t[gl].add(e),this.mesh.userData.variantData=this.modelVariants,this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map;this.mesh.userData.variantMaterials.set(e,{material:t[Ao].values().next().value,gltfMaterialIndex:t.index})}ensureVariantIsUnused(e){const t=this.modelVariants.get(e);return null==t||!this.variantInfo.has(t.index)||(console.warn(`Primitive cannot add variant '${e}' for this material, it already exists.`),!1)}}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var wl,Bl,vl,xl,Sl,Ql;const Ml=Symbol("materials"),Tl=Symbol("hierarchy"),Rl=Symbol("roots"),Dl=Symbol("primitives"),kl=Symbol("prepareVariantsForExport"),Fl=Symbol("switchVariant"),Ll=Symbol("materialFromPoint"),_l=Symbol("nodeFromPoint"),Pl=Symbol("nodeFromIndex"),Ol=Symbol("variantData"),Gl=Symbol("availableVariants"),Ul=Symbol("modelOnUpdate"),Nl=Symbol("cloneMaterial");class jl{constructor(e,t,i,s){this.gltf=e,this.gltfElementMap=t,this.mapKey=i,this.doLazyLoad=s}}class Hl{constructor(e,i=()=>{}){this[wl]=new Array,this[Bl]=new Array,this[vl]=new Array,this[xl]=new Array,this[Sl]=()=>{},this[Ql]=new Map,this[Ul]=i;const{gltf:s,threeGLTF:n,gltfElementMap:a}=e;for(const[e,t]of s.materials.entries()){const r=a.get(t);if(null!=r)this[Ml].push(new Cl(i,e,!0,this[Ol],r,t.name));else{const r=(s.materials||[])[e],o=new Set;a.set(r,o);const l=async()=>{const t=await n.parser.getDependency("material",e);return o.add(t),t};this[Ml].push(new Cl(i,e,!1,this[Ol],o,t.name,new jl(s,a,r,l)))}}const r=new Map,o=new Array;for(const e of n.scene.children)o.push(e);for(;o.length>0;){const i=o.pop();let s=null;i instanceof t.Mesh?(s=new El(i,this.materials,this[Ol],e),this[Dl].push(s)):s=new Il(i.name);const n=r.get(i);null!=n?n.children.push(s):this[Rl].push(s),this[Tl].push(s);for(const e of i.children)o.push(e),r.set(i,s)}}get materials(){return this[Ml]}[(wl=Ml,Bl=Tl,vl=Rl,xl=Dl,Sl=Ul,Ql=Ol,Gl)](){const e=Array.from(this[Ol].values());return e.sort(((e,t)=>e.index-t.index)),e.map((e=>e.name))}getMaterialByName(e){const t=this[Ml].filter((t=>t.name===e));return t.length>0?t[0]:null}[Pl](e,t){const i=this[Tl].find((i=>{if(i instanceof El){const{meshes:s,primitives:n}=i.mesh.userData.associations;if(s==e&&n==t)return!0}return!1}));return null==i?null:i}[_l](e){return this[Tl].find((t=>{if(t instanceof El){if(t.mesh===e.object)return!0}return!1}))}[Ll](e){return this[_l](e).getActiveMaterial()}async[Fl](e){for(const t of this[Dl])await t.enableVariant(e);for(const e of this.materials)e[pl](!1);for(const e of this[Dl])this.materials[e.getActiveMaterial().index][pl](!0)}async[kl](){const e=new Array;for(const t of this[Dl])e.push(t.instantiateVariants());await Promise.all(e)}[Nl](e,t){const i=this.materials[e];i.isLoaded||console.error("Cloning an unloaded material,\n           call 'material.ensureLoaded() before cloning the material.");const s=i[Ao],n=new Set;for(const[e,i]of s.entries()){const a=i.clone();a.name=t+(s.size>1?"_inst"+e:""),n.add(a)}const a=new Cl(this[Ul],this[Ml].length,!1,this[Ol],n,t);return this[Ml].push(a),a}createMaterialInstanceForVariant(e,t,i,s=!0){let n=null;for(const s of this[Dl]){const a=this[Ol].get(i);null!=a&&s.variantInfo.has(a.index)||null!=s.getMaterial(e)&&(this.hasVariant(i)||this.createVariant(i),null==n&&(n=this[Nl](e,t)),s.addVariant(n,i))}if(s&&null!=n){n[pl](!0),this.materials[e][pl](!1);for(const e of this[Dl])e.enableVariant(i)}return n}createVariant(e){this[Ol].has(e)?console.warn(`Variant '${e}'' already exists`):this[Ol].set(e,{name:e,index:this[Ol].size})}hasVariant(e){return this[Ol].has(e)}setMaterialToVariant(e,t){if(null!=this[Gl]().find((e=>e===t)))if(e<0||e>=this.materials.length)console.error("setMaterialToVariant(): materialIndex is out of bounds.");else for(const i of this[Dl]){const s=i.getMaterial(e);null!=s&&i.addVariant(s,t)}else console.warn(`Can't add material to '${t}', the variant does not exist.'`)}updateVariantName(e,t){const i=this[Ol].get(e);null!=i&&(i.name=t,this[Ol].set(t,i),this[Ol].delete(e))}deleteVariant(e){const t=this[Ol].get(e);if(null!=t){for(const i of this.materials)i.hasVariant(e)&&i[gl].delete(t.index);for(const e of this[Dl])e.deleteVariant(t.index);this[Ol].delete(e)}}}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var zl=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const ql=Symbol("currentGLTF"),Vl=Symbol("originalGltfJson"),Kl=Symbol("model"),Wl=Symbol("getOnUpdateMethod"),Jl=Symbol("buildTexture");
/* @license
     * Copyright 2023 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Yl extends t.Mesh{constructor(){super(void 0,new t.MeshBasicMaterial({depthWrite:!1})),this.height=0,this.radius=0,this.resolution=0,this.userData.noHit=!0}get map(){return this.material.map}set map(e){this.material.map=e}isUsable(){return this.height>0&&this.radius>0&&null!=this.geometry&&null!=this.map}updateGeometry(e=this.height,i=this.radius,s=128){e==this.height&&i==this.radius&&s==this.resolution||(this.height=e,this.radius=i,this.resolution=s,e>0&&i>0&&(this.geometry.dispose(),this.geometry=function(e,i,s){const n=new t.SphereGeometry(i,2*s,s);n.scale(1,1,-1);const a=n.getAttribute("position"),r=new t.Vector3;for(let t=0;t<a.count;++t)if(r.fromBufferAttribute(a,t),r.y<0){const i=3*-e/2,s=r.y<i?-e/r.y:1-r.y*r.y/(3*i*i);r.multiplyScalar(s),r.toArray(a.array,3*t)}return a.needsUpdate=!0,n}
/* @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e,i,s)))}}const Xl=new t.Vector3,$l=new t.Vector3,Zl=new t.Vector3,eA=new t.Matrix3,tA=new t.Triangle,iA=new t.Quaternion;class sA extends zi{constructor(e){super(document.createElement("div")),this.normal=new t.Vector3(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=e.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(e.position),this.updateNormal(e.normal),this.surface=e.surface}get facingCamera(){return!this.element.classList.contains("hide")}show(){this.facingCamera&&this.initialized||this.updateVisibility(!0)}hide(){!this.facingCamera&&this.initialized||this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,0===this.referenceCount}updatePosition(e){if(null==e)return;const t=rn(e)[0].terms;for(let e=0;e<3;++e)this.position.setComponent(e,fn(t[e]).number);this.updateMatrixWorld()}updateNormal(e){if(null==e)return;const t=rn(e)[0].terms;for(let e=0;e<3;++e)this.normal.setComponent(e,t[e].number)}updateSurface(){const{mesh:e,tri:t,bary:i}=this;if(null==e||null==t||null==i)return;e.getVertexPosition(t.x,Xl),e.getVertexPosition(t.y,$l),e.getVertexPosition(t.z,Zl),Xl.toArray(eA.elements,0),$l.toArray(eA.elements,3),Zl.toArray(eA.elements,6),this.position.copy(i).applyMatrix3(eA);const s=this.parent;s.worldToLocal(e.localToWorld(this.position)),tA.set(Xl,$l,Zl),tA.getNormal(this.normal).transformDirection(e.matrixWorld);const n=s.parent;iA.setFromAxisAngle(Xl.set(0,1,0),-n.rotation.y),this.normal.applyQuaternion(iA)}orient(e){this.pivot.style.transform=`rotate(${e}rad)`}updateVisibility(e){this.element.classList.toggle("hide",!e),this.slot.assignedNodes().forEach((t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;const i=t,s=i.dataset.visibilityAttribute;if(null!=s){const t=`data-${s}`;i.toggleAttribute(t,e)}i.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:e}}))})),this.initialized=!0}}const nA={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},aA={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"};function rA(e,t,i){return(1-i)*e+i*t}
/* @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class oA extends t.Object3D{constructor(e,i,s){super(),this.camera=new t.OrthographicCamera,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new t.MeshDepthMaterial,this.horizontalBlurMaterial=new t.ShaderMaterial(nA),this.verticalBlurMaterial=new t.ShaderMaterial(aA),this.intensity=0,this.softness=1,this.boundingBox=new t.Box3,this.size=new t.Vector3,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:n}=this;n.rotation.x=Math.PI/2,n.left=-.5,n.right=.5,n.bottom=-.5,n.top=.5,this.add(n);const a=new t.PlaneGeometry,r=new t.MeshBasicMaterial({opacity:1,transparent:!0,side:t.BackSide});this.floor=new t.Mesh(a,r),this.floor.userData.noHit=!0,n.add(this.floor),this.blurPlane=new t.Mesh(a),this.blurPlane.visible=!1,n.add(this.blurPlane),e.target.add(this),this.depthMaterial.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.depthMaterial.side=t.DoubleSide,this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(e,i,s)}setScene(e,t,i){const{boundingBox:s,size:n,rotation:a,position:r}=this;if(this.isAnimated=e.animationNames.length>0,this.boundingBox.copy(e.boundingBox),this.size.copy(e.size),this.maxDimension=Math.max(n.x,n.y,n.z)*(this.isAnimated?2:1),this.boundingBox.getCenter(r),"back"===i){const{min:e,max:t}=s;[e.y,e.z]=[e.z,e.y],[t.y,t.z]=[t.z,t.y],[n.y,n.z]=[n.z,n.y],a.x=Math.PI/2,a.y=Math.PI}else a.x=0,a.y=0;if(this.isAnimated){const e=s.min.y,t=s.max.y;n.y=this.maxDimension,s.expandByVector(n.subScalar(this.maxDimension).multiplyScalar(-.5)),s.min.y=e,s.max.y=t,n.set(this.maxDimension,t-e,this.maxDimension)}"bottom"===i?r.y=s.min.y:r.z=s.min.y,this.setSoftness(t)}setSoftness(e){this.softness=e;const{size:t,camera:i}=this,s=this.isAnimated?2:1,n=s*Math.pow(2,9-3*e);this.setMapSize(n);const a=t.y/2,r=t.y*s;i.near=0,i.far=rA(r,a,e),this.depthMaterial.opacity=1/e,i.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(e){const{size:i}=this;this.isAnimated&&(e*=2);const s=Math.floor(i.x>i.z?e:e*i.x/i.z),n=Math.floor(i.x>i.z?e*i.z/i.x:e),a=10+s,r=10+n;if(null==this.renderTarget||this.renderTarget.width===a&&this.renderTarget.height===r||(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),null==this.renderTarget){const e={format:t.RGBAFormat};this.renderTarget=new t.WebGLRenderTarget(a,r,e),this.renderTargetBlur=new t.WebGLRenderTarget(a,r,e),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(i.x*(1+10/s),i.z*(1+10/n),1),this.needsUpdate=!0}setIntensity(e){this.intensity=e,e>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=e*rA(.3,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(e){this.floor.position.z=-e+this.gap()}gap(){return.001*this.maxDimension}render(e,t){t.overrideMaterial=this.depthMaterial;const i=e.getClearAlpha();e.setClearAlpha(0),this.floor.visible=!1;const s=e.xr.enabled;e.xr.enabled=!1;const n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.render(t,this.camera),t.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(e),e.xr.enabled=s,e.setRenderTarget(n),e.setClearAlpha(i)}blurShadow(e){const{camera:t,horizontalBlurMaterial:i,verticalBlurMaterial:s,renderTarget:n,renderTargetBlur:a,blurPlane:r}=this;r.visible=!0,r.material=i,i.uniforms.h.value=1/this.renderTarget.width,i.uniforms.tDiffuse.value=this.renderTarget.texture,e.setRenderTarget(a),e.render(r,t),r.material=s,s.uniforms.v.value=1/this.renderTarget.height,s.uniforms.tDiffuse.value=this.renderTargetBlur.texture,e.setRenderTarget(n),e.render(r,t),r.visible=!1}dispose(){null!=this.renderTarget&&this.renderTarget.dispose(),null!=this.renderTargetBlur&&this.renderTargetBlur.dispose(),this.depthMaterial.dispose(),this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose(),this.floor.material.dispose(),this.floor.geometry.dispose(),this.blurPlane.geometry.dispose(),this.removeFromParent()}}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const lA=new t.Vector3,AA=new t.Vector3,cA=new t.Vector3,hA=new t.Raycaster,uA=new t.Vector3,dA=new t.Vector2;class pA extends t.Scene{constructor({canvas:e,element:i,width:s,height:n}){super(),this.annotationRenderer=new Yi,this.effectRenderer=null,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.scaleStep=0,this.renderCount=0,this.externalRenderer=null,this.appendedAnimations=[],this.markedAnimations=[],this.camera=new t.PerspectiveCamera(45,1,.1,100),this.xrCamera=null,this.url=null,this.pivot=new t.Object3D,this.target=new t.Object3D,this.animationNames=[],this.boundingBox=new t.Box3,this.boundingSphere=new t.Sphere,this.size=new t.Vector3,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=new Set,this.exposure=1,this.toneMapping=t.NeutralToneMapping,this.canScale=!0,this.isDirty=!1,this.goalTarget=new t.Vector3,this.targetDamperX=new $s,this.targetDamperY=new $s,this.targetDamperZ=new $s,this._currentGLTF=null,this._model=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.groundedSkybox=new Yl,this.name="ModelScene",this.element=i,this.canvas=e,this.camera=new t.PerspectiveCamera(45,1,.1,100),this.camera.name="MainCamera",this.add(this.pivot),this.pivot.name="Pivot",this.pivot.add(this.target),this.setSize(s,n),this.target.name="Target",this.mixer=new t.AnimationMixer(this.target);const{domElement:a}=this.annotationRenderer,{style:r}=a;r.display="none",r.pointerEvents="none",r.position="absolute",r.top="0",this.element.shadowRoot.querySelector(".default").appendChild(a),this.schemaElement.setAttribute("type","application/ld+json")}get context(){return this.canvas.getContext("2d")}getCamera(){return null!=this.xrCamera?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}forceRescale(){this.scaleStep=-1,this.queueRender()}async setObject(e){this.reset(),this._model=e,this.target.add(e),await this.setupScene()}async setSource(e,t=()=>{}){if(!e||e===this.url)return void t(1);if(this.reset(),this.url=e,null!=this.externalRenderer){const e=await this.externalRenderer.load(t);return this.boundingSphere.radius=e.framedRadius,void(this.idealAspect=e.fieldOfViewAspect)}let i;null!=this.cancelPendingSourceChange&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);try{i=await new Promise((async(i,s)=>{this.cancelPendingSourceChange=()=>s();try{i(await this.element[ac].loader.load(e,this.element,t))}catch(e){s(e)}}))}catch(e){if(null==e)return;throw e}this.cancelPendingSourceChange=null,this.reset(),this.url=e,this._currentGLTF=i,null!=i&&(i.scene.userData.filepath=e,i.scene.userData.filename=e.split("/").pop()||"",this._model=i.scene,this.target.add(i.scene));const{animations:s}=i,n=new Map,a=[];for(const e of s)n.set(e.name,e),a.push(e.name);this.animations=s,this.animationsByName=n,this.animationNames=a,await this.setupScene()}async setupScene(){this.applyTransform(),this.updateBoundingBox(),await this.updateFraming(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity),this.setGroundedSkybox()}reset(){this.url=null,this.renderCount=0,this.queueRender(),null!=this.shadow&&this.shadow.setIntensity(0),this.bakedShadows.clear();const{_model:e}=this;null!=e&&(e.removeFromParent(),this._model=null);const t=this._currentGLTF;null!=t&&(t.dispose(),this._currentGLTF=null),null!=this.currentAnimationAction&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}dispose(){this.reset(),null!=this.shadow&&(this.shadow.dispose(),this.shadow=null),this.element[ql]=null,this.element[Vl]=null,this.element[Kl]=null}get currentGLTF(){return this._currentGLTF}setSize(e,t){if(this.width!==e||this.height!==t){if(this.width=Math.max(e,1),this.height=Math.max(t,1),this.annotationRenderer.setSize(e,t),this.aspect=this.width/this.height,null!=this.externalRenderer){const i=window.devicePixelRatio;this.externalRenderer.resize(e*i,t*i)}this.queueRender()}}markBakedShadow(e){e.userData.noHit=!0,this.bakedShadows.add(e)}unmarkBakedShadow(e){e.userData.noHit=!1,e.visible=!0,this.bakedShadows.delete(e),this.boundingBox.expandByObject(e)}findBakedShadows(e){const i=new t.Box3;e.traverse((e=>{const t=e;if(!t.material)return;if(!t.material.transparent)return;i.setFromObject(t);const s=i.getSize(uA),n=Math.min(s.x,s.y,s.z);Math.max(s.x,s.y,s.z)<100*n||this.markBakedShadow(t)}))}checkBakedShadows(){const{min:e,max:i}=this.boundingBox,s=new t.Box3;this.boundingBox.getSize(this.size);for(const t of this.bakedShadows)s.setFromObject(t),s.min.y<e.y+this.size.y/100&&s.min.x<=e.x&&s.max.x>=i.x&&s.min.z<=e.z&&s.max.z>=i.z||s.min.z<e.z+this.size.z/100&&s.min.x<=e.x&&s.max.x>=i.x&&s.min.y<=e.y&&s.max.y>=i.y||this.unmarkBakedShadow(t)}applyTransform(){const{model:e}=this;if(null==e)return;const i=rn(this.element.orientation)[0].terms,s=fn(i[0]).number,n=fn(i[1]).number,a=fn(i[2]).number;e.quaternion.setFromEuler(new t.Euler(n,a,s,"YXZ"));const r=rn(this.element.scale)[0].terms;e.scale.set(r[0].number,r[1].number,r[2].number)}updateBoundingBox(){const{model:e}=this;if(null==e)return;this.target.remove(e),this.findBakedShadows(e);const i=(e,t)=>e.expandByPoint(t);this.setBakedShadowVisibility(!1),this.boundingBox=Xi(e,i,new t.Box3),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows.forEach((e=>this.unmarkBakedShadow(e))),this.boundingBox=Xi(e,i,new t.Box3)),this.checkBakedShadows(),this.setBakedShadowVisibility(),this.boundingBox.getSize(this.size),this.target.add(e)}async updateFraming(){const{model:e}=this;if(null==e)return;this.target.remove(e),this.setBakedShadowVisibility(!1);const{center:t}=this.boundingSphere;this.element.requestUpdate("cameraTarget"),await this.element.updateComplete,t.copy(this.getTarget());this.boundingSphere.radius=Math.sqrt(Xi(e,((e,i)=>Math.max(e,t.distanceToSquared(i))),0));this.idealAspect=Xi(e,((e,i)=>{i.sub(t);const s=Math.sqrt(i.x*i.x+i.z*i.z);return Math.max(e,s/(this.idealCameraDistance()-Math.abs(i.y)))}),0)/Math.tan(this.framedFoVDeg/2*Math.PI/180),this.setBakedShadowVisibility(),this.target.add(e)}setBakedShadowVisibility(e=this.shadowIntensity<=0){for(const t of this.bakedShadows)t.visible=e}idealCameraDistance(){const e=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(e)}adjustedFoV(e){const t=Math.tan(e/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(t)*180/Math.PI}getNDC(e,t){if(null!=this.xrCamera)dA.set(e/window.screen.width,t/window.screen.height);else{const i=this.element.getBoundingClientRect();dA.set((e-i.x)/this.width,(t-i.y)/this.height)}return dA.multiplyScalar(2).subScalar(1),dA.y*=-1,dA}getSize(){return{width:this.width,height:this.height}}setEnvironmentAndSkybox(e,t){this.element[ac].arRenderer.presentedScene!==this&&(this.environment=e,this.setBackground(t),this.queueRender())}setBackground(e){this.groundedSkybox.map=e,this.groundedSkybox.isUsable()?(this.target.add(this.groundedSkybox),this.background=null):(this.target.remove(this.groundedSkybox),this.background=e)}farRadius(){return this.boundingSphere.radius*(null!=this.groundedSkybox.parent?10:1)+1e3}setGroundedSkybox(){const e=rn(this.element.skyboxHeight)[0].terms[0],t=fn(e).number,i=10*this.boundingSphere.radius;this.groundedSkybox.updateGeometry(t,i),this.groundedSkybox.position.y=t-(this.shadow?2*this.shadow.gap():0),this.setBackground(this.groundedSkybox.map)}setTarget(e,t,i){this.goalTarget.set(-e,-t,-i)}setTargetDamperDecayTime(e){this.targetDamperX.setDecayTime(e),this.targetDamperY.setDecayTime(e),this.targetDamperZ.setDecayTime(e)}getTarget(){return this.goalTarget.clone().multiplyScalar(-1)}getDynamicTarget(){return this.target.position.clone().multiplyScalar(-1)}jumpToGoal(){this.updateTarget(1e4)}updateTarget(e){const t=this.goalTarget,i=this.target.position;if(t.equals(i))return!1;{const s=this.boundingSphere.radius/10;let{x:n,y:a,z:r}=i;return n=this.targetDamperX.update(n,t.x,e,s),a=this.targetDamperY.update(a,t.y,e,s),r=this.targetDamperZ.update(r,t.z,e,s),this.groundedSkybox.position.x=-n,this.groundedSkybox.position.z=-r,this.target.position.set(n,a,r),this.target.updateMatrixWorld(),this.queueRender(),!0}}pointTowards(e,t){const{x:i,z:s}=this.position;this.yaw=Math.atan2(e-i,t-s)}get model(){return this._model}set yaw(e){this.pivot.rotation.y=e,this.groundedSkybox.rotation.y=-e,this.queueRender()}get yaw(){return this.pivot.rotation.y}set animationTime(e){this.mixer.setTime(e),this.queueShadowRender()}get animationTime(){if(null!=this.currentAnimationAction){const e=Math.max(this.currentAnimationAction._loopCount,0);return this.currentAnimationAction.loop!==t.LoopPingPong||1&~e?this.currentAnimationAction.time:this.duration-this.currentAnimationAction.time}return 0}set animationTimeScale(e){this.mixer.timeScale=e}get animationTimeScale(){return this.mixer.timeScale}get duration(){return null!=this.currentAnimationAction&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return null!=this.currentAnimationAction}playAnimation(e=null,i=0,s=t.LoopRepeat,n=1/0){if(null==this._currentGLTF)return;const{animations:a}=this;if(null==a||0===a.length)return;let r=null;if(null!=e&&(r=this.animationsByName.get(e),null==r)){const t=parseInt(e);!isNaN(t)&&t>=0&&t<a.length&&(r=a[t])}null==r&&(r=a[0]);try{const{currentAnimationAction:e}=this,t=this.mixer.clipAction(r,this);t.timeScale!=this.element.timeScale&&(t.timeScale=this.element.timeScale),this.currentAnimationAction=t,this.element.paused?this.mixer.stopAllAction():(t.paused=!1,null!=e&&t!==e?t.crossFadeFrom(e,i,!1):this.animationTimeScale>0&&this.animationTime==this.duration&&(this.animationTime=0)),t.setLoop(s,n),t.enabled=!0,t.clampWhenFinished=!0,t.play()}catch(e){console.error(e)}}appendAnimation(e="",i=t.LoopRepeat,s=1/0,n=1,a=1,r=!1,o=!1,l=!0,A=null,c=!1){if(null==this._currentGLTF||e===this.element.animationName)return;const{animations:h}=this;if(null==h||0===h.length)return;let u=null;if(e&&(u=this.animationsByName.get(e)),null!=u){"string"==typeof s?isNaN(s)?(s=1/0,console.warn("Invalid repetitionCount value, repetitionCount is set to Infinity")):s=Math.max(parseInt(s),1):"number"==typeof s&&s<1&&(s=1),1===s&&i!==t.LoopOnce&&(i=t.LoopOnce),"string"==typeof n&&(isNaN(n)?(n=1,console.warn("Invalid weight value, weight is set to 1")):n=parseFloat(n)),"string"==typeof a&&(isNaN(a)?(a=1,console.warn("Invalid timeScale value, timeScale is set to 1")):a=parseFloat(a)),"string"==typeof r&&("true"===r.toLowerCase().trim()?r=!0:"false"===r.toLowerCase().trim()?r=!1:isNaN(r)?(r=!1,console.warn("Invalid fade value, fade is set to false")):r=parseFloat(r)),"string"==typeof o&&("true"===o.toLowerCase().trim()?o=!0:"false"===o.toLowerCase().trim()?o=!1:isNaN(o)?(o=!1,console.warn("Invalid warp value, warp is set to false")):o=parseFloat(o)),"string"==typeof A&&(isNaN(A)||(A=parseFloat(A)));try{const t=this.mixer.existingAction(u)||this.mixer.clipAction(u,this),h=t.timeScale;c&&this.appendedAnimations.includes(e)&&(this.markedAnimations.map((e=>e.name)).includes(e)||this.markedAnimations.push({name:e,loopMode:i,repetitionCount:s})),"number"==typeof A&&(t.time=Math.min(Math.max(A,0),u.duration)),"boolean"==typeof r&&r?t.fadeIn(1.25):"number"==typeof r?t.fadeIn(Math.max(r,0)):n>=0&&(t.weight=Math.min(Math.max(n,0),1)),"boolean"==typeof o&&o?t.warp(l?h:0,a,1.25):"number"==typeof o?t.warp(l?h:0,a,Math.max(o,0)):t.timeScale=a,t.isRunning()||(t.time==u.duration&&t.stop(),t.setLoop(i,s),t.paused=!1,t.enabled=!0,t.clampWhenFinished=!0,t.play()),this.appendedAnimations.includes(e)||this.element[ec].appendedAnimations.push(e)}catch(e){console.error(e)}}}detachAnimation(e="",t=!0){if(null==this._currentGLTF||e===this.element.animationName)return;const{animations:i}=this;if(null==i||0===i.length)return;let s=null;if(e&&(s=this.animationsByName.get(e)),null!=s){"string"==typeof t&&("true"===t.toLowerCase().trim()?t=!0:"false"===t.toLowerCase().trim()?t=!1:isNaN(t)?(t=!0,console.warn("Invalid fade value, fade is set to true")):t=parseFloat(t));try{const i=this.mixer.existingAction(s)||this.mixer.clipAction(s,this);"boolean"==typeof t&&t?i.fadeOut(1.5):"number"==typeof t?i.fadeOut(Math.max(t,0)):i.stop();const n=this.element[ec].appendedAnimations.filter((t=>t!==e));this.element[ec].appendedAnimations=n}catch(e){console.error(e)}}}updateAnimationLoop(e="",i=t.LoopRepeat,s=1/0){if(null==this._currentGLTF||e===this.element.animationName)return;const{animations:n}=this;if(null==n||0===n.length)return;let a=null;if(e&&(a=this.animationsByName.get(e)),null!=a)try{const e=this.mixer.existingAction(a)||this.mixer.clipAction(a,this);e.stop(),e.setLoop(i,s),e.play()}catch(e){console.error(e)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(e){this.mixer.update(e),this.queueShadowRender()}subscribeMixerEvent(e,t){this.mixer.addEventListener(e,t)}updateShadow(){const e=this.shadow;if(null!=e){const t="wall"===this.element.arPlacement?"back":"bottom";e.setScene(this,this.shadowSoftness,t),e.needsUpdate=!0}}renderShadow(e){const t=this.shadow;null!=t&&1==t.needsUpdate&&(t.render(e,this),t.needsUpdate=!1)}queueShadowRender(){null!=this.shadow&&(this.shadow.needsUpdate=!0)}setShadowIntensity(e){if(this.shadowIntensity=e,null!=this._currentGLTF&&(this.setBakedShadowVisibility(),!(e<=0&&null==this.shadow))){if(null==this.shadow){const e="wall"===this.element.arPlacement?"back":"bottom";this.shadow=new oA(this,this.shadowSoftness,e)}this.shadow.setIntensity(e)}}setShadowSoftness(e){this.shadowSoftness=e;const t=this.shadow;null!=t&&t.setSoftness(e)}setShadowOffset(e){const t=this.shadow;null!=t&&t.setOffset(e)}getHit(e=this){return hA.intersectObject(e,!0).find((e=>e.object.visible&&!e.object.userData.noHit))}hitFromController(e,t=this){return hA.setFromXRController(e),this.getHit(t)}hitFromPoint(e,t=this){return hA.setFromCamera(e,this.getCamera()),this.getHit(t)}positionAndNormalFromPoint(e,i=this){var s;const n=this.hitFromPoint(e,i);if(null==n)return null;return{position:n.point,normal:null!=n.face?n.face.normal.clone().applyNormalMatrix((new t.Matrix3).getNormalMatrix(n.object.matrixWorld)):hA.ray.direction.clone().multiplyScalar(-1),uv:null!==(s=n.uv)&&void 0!==s?s:null}}surfaceFromPoint(e,i=this){const s=this.element.model;if(null==s)return null;const n=this.hitFromPoint(e,i);if(null==n||null==n.face)return null;const a=s[_l](n),{meshes:r,primitives:o}=a.mesh.userData.associations,l=new t.Vector3,A=new t.Vector3,c=new t.Vector3,{a:h,b:u,c:d}=n.face,p=n.object;p.getVertexPosition(h,l),p.getVertexPosition(u,A),p.getVertexPosition(d,c);const g=new t.Triangle(l,A,c),m=new t.Vector3;return g.getBarycoord(p.worldToLocal(n.point),m),`${r} ${o} ${h} ${u} ${d} ${m.x.toFixed(3)} ${m.y.toFixed(3)} ${m.z.toFixed(3)}`}addHotspot(e){this.target.add(e),this.annotationRenderer.domElement.appendChild(e.element),this.updateSurfaceHotspot(e)}removeHotspot(e){this.target.remove(e)}forHotspots(e){const{children:t}=this.target;for(let i=0,s=t.length;i<s;i++){const s=t[i];s instanceof sA&&e(s)}}updateSurfaceHotspot(e){if(null==e.surface||null==this.element.model)return;const i=rn(e.surface)[0].terms;if(8!=i.length)return void console.warn(e.surface+" does not have exactly 8 numbers.");const s=this.element.model[Pl](i[0].number,i[1].number);if(null==s)return void console.warn(e.surface+" does not match a node/primitive in this glTF! Skipping this hotspot.");const n=s.mesh.geometry.attributes.position.count,a=new t.Vector3(i[2].number,i[3].number,i[4].number);if(a.x>=n||a.y>=n||a.z>=n)return void console.warn(e.surface+" vertex indices out of range in this glTF! Skipping this hotspot.");const r=new t.Vector3(i[5].number,i[6].number,i[7].number);e.mesh=s.mesh,e.tri=a,e.bary=r,e.updateSurface()}animateSurfaceHotspots(){this.element.paused||this.forHotspots((e=>{e.updateSurface()}))}updateHotspotsVisibility(e){this.forHotspots((t=>{lA.copy(e),AA.setFromMatrixPosition(t.matrixWorld),lA.sub(AA),cA.copy(t.normal).transformDirection(this.target.matrixWorld),lA.dot(cA)<0?t.hide():t.show()}))}orientHotspots(e){this.forHotspots((t=>{t.orient(e)}))}setHotspotsVisibility(e){this.forHotspots((t=>{t.visible=e}))}updateSchema(e){var t;const{schemaElement:i,element:s}=this,{alt:n,poster:a,iosSrc:r}=s;if(null!=e){const s=[{"@type":"MediaObject",contentUrl:e,encodingFormat:"gltf"===(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())?"model/gltf+json":"model/gltf-binary"}];r&&s.push({"@type":"MediaObject",contentUrl:r,encodingFormat:"model/vnd.usdz+zip"});const o={"@context":"http://schema.org/","@type":"3DModel",image:null!=a?a:void 0,name:null!=n?n:void 0,encoding:s};i.textContent=JSON.stringify(o),document.head.appendChild(i)}else null!=i.parentElement&&i.parentElement.removeChild(i)}}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class gA extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(e){const t={progress:0,completed:!1};return this.ongoingActivities.add(t),1===this.ongoingActivityCount&&this.announceTotalProgress(t,0,e),i=>{let s;return s=Math.max(Me(i,0,1),t.progress),s!==t.progress&&this.announceTotalProgress(t,s,e),t.progress}}announceTotalProgress(e,t,i){let s=0,n=0;1==t&&(e.completed=!0);for(const e of this.ongoingActivities){const{progress:t}=e;s+=1-t,e.completed&&n++}const a=e.progress;e.progress=t,this.totalProgress+=(t-a)*(1-this.totalProgress)/s;const r=n===this.ongoingActivityCount?1:this.totalProgress;this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:r,reason:i}})),n===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var mA,fA,bA,yA,CA,IA,EA,wA,BA,vA,xA,SA,QA,MA=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const TA=document.createElement("canvas"),RA=Symbol("fallbackResizeHandler"),DA=Symbol("defaultAriaLabel"),kA=Symbol("resizeObserver"),FA=Symbol("clearModelTimeout"),LA=Symbol("onContextLost"),_A=Symbol("loaded"),PA=Symbol("status"),OA=Symbol("onFocus"),GA=Symbol("onBlur"),UA=Symbol("updateSize"),NA=Symbol("intersectionObserver"),jA=Symbol("isElementInViewport"),HA=Symbol("announceModelVisibility"),zA=Symbol("ariaLabel"),qA=Symbol("altDefaulted"),VA=Symbol("statusElement"),KA=Symbol("updateStatus"),WA=Symbol("loadedTime"),JA=Symbol("updateSource"),YA=Symbol("markLoaded"),XA=Symbol("container"),$A=Symbol("input"),ZA=Symbol("canvas"),ec=Symbol("scene"),tc=Symbol("needsRender"),ic=Symbol("tick"),sc=Symbol("onModelLoad"),nc=Symbol("onResize"),ac=Symbol("renderer"),rc=Symbol("progressTracker"),oc=Symbol("getLoaded"),lc=Symbol("getModelIsVisible"),Ac=Symbol("shouldAttemptPreload"),cc=e=>({x:e.x,y:e.y,z:e.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),hc=e=>({u:e.x,v:e.y,toString(){return`${this.u} ${this.v}`}});class uc extends E{static get is(){return"model-viewer"}static set modelCacheSize(e){Hi[Ni].evictionThreshold=e}static get modelCacheSize(){return Hi[Ni].evictionThreshold}static set minimumRenderScale(e){e>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),e<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),lo.singleton.minScale=e}static get minimumRenderScale(){return lo.singleton.minScale}get loaded(){return this[oc]()}get[(mA=jA,fA=_A,bA=WA,yA=PA,CA=FA,IA=RA,EA=HA,wA=kA,BA=NA,vA=rc,ac)](){return lo.singleton}get modelIsVisible(){return this[lc]()}constructor(){super(),this.alt=null,this.src=null,this.withCredentials=!1,this.generateSchema=!1,this[mA]=!1,this[fA]=!1,this[bA]=0,this[yA]="",this[CA]=null,this[IA]=Qe((()=>{const e=this.getBoundingClientRect();this[UA](e)}),50),this[EA]=Qe((e=>{const t=this.modelIsVisible;t!==e&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:t}}))}),0),this[wA]=null,this[BA]=null,this[vA]=new gA,this[xA]=()=>{this[VA].textContent=this[PA]},this[SA]=()=>{this[VA].textContent=""},this[QA]=e=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:e.sourceEvent}}))},this.attachShadow({mode:"open"});const e=this.shadowRoot;let t,i;if((e=>{le(_e,e)})(e),this[XA]=e.querySelector(".container"),this[$A]=e.querySelector(".userInput"),this[ZA]=e.querySelector("canvas"),this[VA]=e.querySelector("#status"),this[DA]=this[$A].getAttribute("aria-label"),this.isConnected){const e=this.getBoundingClientRect();t=e.width,i=e.height}else t=300,i=150;this[ec]=new pA({canvas:this[ZA],element:this,width:t,height:i}),Promise.resolve().then((()=>{this[UA](this.getBoundingClientRect())})),pe&&(this[kA]=new ResizeObserver((e=>{if(!this[ac].isPresenting)for(let t of e)t.target===this&&this[UA](t.contentRect)}))),ge?this[NA]=new IntersectionObserver((e=>{for(let t of e)if(t.target===this){const e=this.modelIsVisible;this[jA]=t.isIntersecting,this[HA](e),this[jA]&&!this.loaded&&this[JA]()}}),{root:null,rootMargin:"0px",threshold:1e-5}):this[jA]=!0}connectedCallback(){super.connectedCallback&&super.connectedCallback(),pe?this[kA].observe(this):self.addEventListener("resize",this[RA]),ge&&this[NA].observe(this),this.addEventListener("focus",this[OA]),this.addEventListener("blur",this[GA]);const e=this[ac];e.addEventListener("contextlost",this[LA]),e.registerScene(this[ec]),null!=this[FA]&&(self.clearTimeout(this[FA]),this[FA]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),pe?this[kA].unobserve(this):self.removeEventListener("resize",this[RA]),ge&&this[NA].unobserve(this),this.removeEventListener("focus",this[OA]),this.removeEventListener("blur",this[GA]);const e=this[ac];e.removeEventListener("contextlost",this[LA]),e.unregisterScene(this[ec]),this[FA]=self.setTimeout((()=>{this[ec].dispose(),this[FA]=null}),10)}updated(e){super.updated(e),e.has("src")&&(null==this.src?(this[_A]=!1,this[WA]=0,this[ec].reset()):this.src!==this[ec].url&&(this[_A]=!1,this[WA]=0,this[JA]())),e.has("alt")&&this[$A].setAttribute("aria-label",this[zA]),e.has("generateSchema")&&(this.generateSchema?this[ec].updateSchema(this.src):this[ec].updateSchema(null))}toDataURL(e,t){return this[ac].displayCanvas(this[ec]).toDataURL(e,t)}async toBlob(e){const t=e?e.mimeType:void 0,i=e?e.qualityArgument:void 0,s=e?e.idealAspect:void 0,{width:n,height:a,idealAspect:r,aspect:o}=this[ec],{dpr:l,scaleFactor:A}=this[ac];let c=n*A*l,h=a*A*l,u=0,d=0;if(!0===s)if(r>o){const e=h;h=Math.round(c/r),d=(e-h)/2}else{const e=c;c=Math.round(h*r),u=(e-c)/2}TA.width=c,TA.height=h;try{return new Promise((async(e,s)=>{TA.getContext("2d").drawImage(this[ac].displayCanvas(this[ec]),u,d,c,h,0,0,c,h),TA.toBlob((t=>{if(!t)return s(new Error("Unable to retrieve canvas blob"));e(t)}),t,i)}))}finally{this[UA]({width:n,height:a})}}registerEffectComposer(e){e.setRenderer(this[ac].threeRenderer),e.setMainCamera(this[ec].getCamera()),e.setMainScene(this[ec]),this[ec].effectRenderer=e}unregisterEffectComposer(){this[ec].effectRenderer=null}registerRenderer(e){this[ec].externalRenderer=e}unregisterRenderer(){this[ec].externalRenderer=null}get[zA](){return this[qA]}get[qA](){return null==this.alt||"null"===this.alt?this[DA]:this.alt}[oc](){return this[_A]}[lc](){return this.loaded&&this[jA]}[Ac](){return!!this.src&&this[jA]}[UA]({width:e,height:t}){0!==e&&0!==t&&(this[XA].style.width=`${e}px`,this[XA].style.height=`${t}px`,this[nc]({width:e,height:t}))}[ic](e,t){var i;null===(i=this[ec].effectRenderer)||void 0===i||i.beforeRender(e,t)}[YA](){this[_A]||(this[_A]=!0,this[WA]=performance.now())}[tc](){this[ec].queueRender()}[sc](){}[KA](e){this[PA]=e;const t=this.getRootNode();null!=t&&t.activeElement===this&&this[VA].textContent!=e&&(this[VA].textContent=e)}[(xA=OA,SA=GA,nc)](e){this[ec].setSize(e.width,e.height)}async[(QA=LA,JA)](){const e=this[ec];if(this.loaded||!this[Ac]()||this.src===e.url)return;this.generateSchema&&e.updateSchema(this.src),this[KA]("Loading"),e.stopAnimation();const t=this[rc].beginActivity("model-load"),i=this.src;try{const s=e.setSource(i,(e=>t(.95*Me(e,0,1)))),n=this[Fe]();await Promise.all([s,n]),this[YA](),this[sc](),this.updateComplete.then((()=>{this.dispatchEvent(new CustomEvent("before-render"))})),await new Promise((e=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>{this.dispatchEvent(new CustomEvent("load",{detail:{url:i}})),e()}))}))}))}catch(e){this.dispatchEvent(new CustomEvent("error",{detail:{type:"loadfailure",sourceError:e}}))}finally{t(1)}}}MA([v({type:String})],uc.prototype,"alt",void 0),MA([v({type:String})],uc.prototype,"src",void 0),MA([v({type:Boolean,attribute:"with-credentials"})],uc.prototype,"withCredentials",void 0),MA([v({type:Boolean,attribute:"generate-schema"})],uc.prototype,"generateSchema",void 0);
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var dc=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const pc=Symbol("changeAnimation"),gc=Symbol("appendAnimation"),mc=Symbol("detachAnimation"),fc=Symbol("paused"),bc={repetitions:1/0,pingpong:!1},yc={pingpong:!1,repetitions:null,weight:1,timeScale:1,fade:!1,warp:!1,relativeWarp:!0,time:null},Cc={fade:!0},Ic=Symbol("hotspotMap"),Ec=Symbol("mutationCallback"),wc=Symbol("observer"),Bc=Symbol("addHotspot"),vc=Symbol("removeHotspot"),xc=new t.Matrix4;
/*!
    fflate - fast JavaScript compression/decompression
    <https://101arrowz.github.io/fflate>
    Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
    version 0.8.2
    */
var Sc=Uint8Array,Qc=Uint16Array,Mc=Int32Array,Tc=new Sc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Rc=new Sc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Dc=new Sc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kc=function(e,t){for(var i=new Qc(31),s=0;s<31;++s)i[s]=t+=1<<e[s-1];var n=new Mc(i[30]);for(s=1;s<30;++s)for(var a=i[s];a<i[s+1];++a)n[a]=a-i[s]<<5|s;return{b:i,r:n}},Fc=kc(Tc,2),Lc=Fc.b,_c=Fc.r;Lc[28]=258,_c[258]=28;for(var Pc=kc(Rc,0).r,Oc=new Qc(32768),Gc=0;Gc<32768;++Gc){var Uc=(43690&Gc)>>1|(21845&Gc)<<1;Uc=(61680&(Uc=(52428&Uc)>>2|(13107&Uc)<<2))>>4|(3855&Uc)<<4,Oc[Gc]=((65280&Uc)>>8|(255&Uc)<<8)>>1}var Nc=function(e,t,i){for(var s=e.length,n=0,a=new Qc(t);n<s;++n)e[n]&&++a[e[n]-1];var r,o=new Qc(t);for(n=1;n<t;++n)o[n]=o[n-1]+a[n-1]<<1;if(i){r=new Qc(1<<t);var l=15-t;for(n=0;n<s;++n)if(e[n])for(var A=n<<4|e[n],c=t-e[n],h=o[e[n]-1]++<<c,u=h|(1<<c)-1;h<=u;++h)r[Oc[h]>>l]=A}else for(r=new Qc(s),n=0;n<s;++n)e[n]&&(r[n]=Oc[o[e[n]-1]++]>>15-e[n]);return r},jc=new Sc(288);for(Gc=0;Gc<144;++Gc)jc[Gc]=8;for(Gc=144;Gc<256;++Gc)jc[Gc]=9;for(Gc=256;Gc<280;++Gc)jc[Gc]=7;for(Gc=280;Gc<288;++Gc)jc[Gc]=8;var Hc=new Sc(32);for(Gc=0;Gc<32;++Gc)Hc[Gc]=5;var zc=Nc(jc,9,0),qc=Nc(Hc,5,0),Vc=function(e){return(e+7)/8|0},Kc=function(e,t,i){return(null==i||i>e.length)&&(i=e.length),new Sc(e.subarray(t,i))},Wc=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Jc=function(e,t,i){var s=new Error(t||Wc[e]);if(s.code=e,Error.captureStackTrace&&Error.captureStackTrace(s,Jc),!i)throw s;return s},Yc=function(e,t,i){i<<=7&t;var s=t/8|0;e[s]|=i,e[s+1]|=i>>8},Xc=function(e,t,i){i<<=7&t;var s=t/8|0;e[s]|=i,e[s+1]|=i>>8,e[s+2]|=i>>16},$c=function(e,t){for(var i=[],s=0;s<e.length;++s)e[s]&&i.push({s:s,f:e[s]});var n=i.length,a=i.slice();if(!n)return{t:ah,l:0};if(1==n){var r=new Sc(i[0].s+1);return r[i[0].s]=1,{t:r,l:1}}i.sort((function(e,t){return e.f-t.f})),i.push({s:-1,f:25001});var o=i[0],l=i[1],A=0,c=1,h=2;for(i[0]={s:-1,f:o.f+l.f,l:o,r:l};c!=n-1;)o=i[i[A].f<i[h].f?A++:h++],l=i[A!=c&&i[A].f<i[h].f?A++:h++],i[c++]={s:-1,f:o.f+l.f,l:o,r:l};var u=a[0].s;for(s=1;s<n;++s)a[s].s>u&&(u=a[s].s);var d=new Qc(u+1),p=Zc(i[c-1],d,0);if(p>t){s=0;var g=0,m=p-t,f=1<<m;for(a.sort((function(e,t){return d[t.s]-d[e.s]||e.f-t.f}));s<n;++s){var b=a[s].s;if(!(d[b]>t))break;g+=f-(1<<p-d[b]),d[b]=t}for(g>>=m;g>0;){var y=a[s].s;d[y]<t?g-=1<<t-d[y]++-1:++s}for(;s>=0&&g;--s){var C=a[s].s;d[C]==t&&(--d[C],++g)}p=t}return{t:new Sc(d),l:p}},Zc=function(e,t,i){return-1==e.s?Math.max(Zc(e.l,t,i+1),Zc(e.r,t,i+1)):t[e.s]=i},eh=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new Qc(++t),s=0,n=e[0],a=1,r=function(e){i[s++]=e},o=1;o<=t;++o)if(e[o]==n&&o!=t)++a;else{if(!n&&a>2){for(;a>138;a-=138)r(32754);a>2&&(r(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(r(n),--a;a>6;a-=6)r(8304);a>2&&(r(a-3<<5|8208),a=0)}for(;a--;)r(n);a=1,n=e[o]}return{c:i.subarray(0,s),n:t}},th=function(e,t){for(var i=0,s=0;s<t.length;++s)i+=e[s]*t[s];return i},ih=function(e,t,i){var s=i.length,n=Vc(t+2);e[n]=255&s,e[n+1]=s>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var a=0;a<s;++a)e[n+a+4]=i[a];return 8*(n+4+s)},sh=function(e,t,i,s,n,a,r,o,l,A,c){Yc(t,c++,i),++n[256];for(var h=$c(n,15),u=h.t,d=h.l,p=$c(a,15),g=p.t,m=p.l,f=eh(u),b=f.c,y=f.n,C=eh(g),I=C.c,E=C.n,w=new Qc(19),B=0;B<b.length;++B)++w[31&b[B]];for(B=0;B<I.length;++B)++w[31&I[B]];for(var v=$c(w,7),x=v.t,S=v.l,Q=19;Q>4&&!x[Dc[Q-1]];--Q);var M,T,R,D,k=A+5<<3,F=th(n,jc)+th(a,Hc)+r,L=th(n,u)+th(a,g)+r+14+3*Q+th(w,x)+2*w[16]+3*w[17]+7*w[18];if(l>=0&&k<=F&&k<=L)return ih(t,c,e.subarray(l,l+A));if(Yc(t,c,1+(L<F)),c+=2,L<F){M=Nc(u,d,0),T=u,R=Nc(g,m,0),D=g;var _=Nc(x,S,0);Yc(t,c,y-257),Yc(t,c+5,E-1),Yc(t,c+10,Q-4),c+=14;for(B=0;B<Q;++B)Yc(t,c+3*B,x[Dc[B]]);c+=3*Q;for(var P=[b,I],O=0;O<2;++O){var G=P[O];for(B=0;B<G.length;++B){var U=31&G[B];Yc(t,c,_[U]),c+=x[U],U>15&&(Yc(t,c,G[B]>>5&127),c+=G[B]>>12)}}}else M=zc,T=jc,R=qc,D=Hc;for(B=0;B<o;++B){var N=s[B];if(N>255){Xc(t,c,M[(U=N>>18&31)+257]),c+=T[U+257],U>7&&(Yc(t,c,N>>23&31),c+=Tc[U]);var j=31&N;Xc(t,c,R[j]),c+=D[j],j>3&&(Xc(t,c,N>>5&8191),c+=Rc[j])}else Xc(t,c,M[N]),c+=T[N]}return Xc(t,c,M[256]),c+T[256]},nh=new Mc([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ah=new Sc(0),rh=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var i=t,s=9;--s;)i=(1&i&&-306674912)^i>>>1;e[t]=i}return e}(),oh=function(){var e=-1;return{p:function(t){for(var i=e,s=0;s<t.length;++s)i=rh[255&i^t[s]]^i>>>8;e=i},d:function(){return~e}}},lh=function(e,t,i,s,n){if(!n&&(n={l:1},t.dictionary)){var a=t.dictionary.subarray(-32768),r=new Sc(a.length+e.length);r.set(a),r.set(e,a.length),e=r,n.w=a.length}return function(e,t,i,s,n,a){var r=a.z||e.length,o=new Sc(s+r+5*(1+Math.ceil(r/7e3))+n),l=o.subarray(s,o.length-n),A=a.l,c=7&(a.r||0);if(t){c&&(l[0]=a.r>>3);for(var h=nh[t-1],u=h>>13,d=8191&h,p=(1<<i)-1,g=a.p||new Qc(32768),m=a.h||new Qc(p+1),f=Math.ceil(i/3),b=2*f,y=function(t){return(e[t]^e[t+1]<<f^e[t+2]<<b)&p},C=new Mc(25e3),I=new Qc(288),E=new Qc(32),w=0,B=0,v=a.i||0,x=0,S=a.w||0,Q=0;v+2<r;++v){var M=y(v),T=32767&v,R=m[M];if(g[T]=R,m[M]=T,S<=v){var D=r-v;if((w>7e3||x>24576)&&(D>423||!A)){c=sh(e,l,0,C,I,E,B,x,Q,v-Q,c),x=w=B=0,Q=v;for(var k=0;k<286;++k)I[k]=0;for(k=0;k<30;++k)E[k]=0}var F=2,L=0,_=d,P=T-R&32767;if(D>2&&M==y(v-P))for(var O=Math.min(u,D)-1,G=Math.min(32767,v),U=Math.min(258,D);P<=G&&--_&&T!=R;){if(e[v+F]==e[v+F-P]){for(var N=0;N<U&&e[v+N]==e[v+N-P];++N);if(N>F){if(F=N,L=P,N>O)break;var j=Math.min(P,N-2),H=0;for(k=0;k<j;++k){var z=v-P+k&32767,q=z-g[z]&32767;q>H&&(H=q,R=z)}}}P+=(T=R)-(R=g[T])&32767}if(L){C[x++]=268435456|_c[F]<<18|Pc[L];var V=31&_c[F],K=31&Pc[L];B+=Tc[V]+Rc[K],++I[257+V],++E[K],S=v+F,++w}else C[x++]=e[v],++I[e[v]]}}for(v=Math.max(v,S);v<r;++v)C[x++]=e[v],++I[e[v]];c=sh(e,l,A,C,I,E,B,x,Q,v-Q,c),A||(a.r=7&c|l[c/8|0]<<3,c-=7,a.h=m,a.p=g,a.i=v,a.w=S)}else{for(v=a.w||0;v<r+A;v+=65535){var W=v+65535;W>=r&&(l[c/8|0]=A,W=r),c=ih(l,c+1,e.subarray(v,W))}a.i=r}return Kc(o,0,s+Vc(c)+n)}(e,null==t.level?6:t.level,null==t.mem?n.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,i,s,n)},Ah=function(e,t){var i={};for(var s in e)i[s]=e[s];for(var s in t)i[s]=t[s];return i},ch=function(e,t,i){for(;i;++t)e[t]=i,i>>>=8};function hh(e,t){return lh(e,t||{},0,0)}var uh=function(e,t,i,s){for(var n in e){var a=e[n],r=t+n,o=s;Array.isArray(a)&&(o=Ah(s,a[1]),a=a[0]),a instanceof Sc?i[r]=[a,o]:(i[r+="/"]=[new Sc(0),o],uh(a,r,i,s))}},dh="undefined"!=typeof TextEncoder&&new TextEncoder,ph="undefined"!=typeof TextDecoder&&new TextDecoder;try{ph.decode(ah,{stream:!0})}catch(M){}function gh(e,t){if(dh)return dh.encode(e);for(var i=e.length,s=new Sc(e.length+(e.length>>1)),n=0,a=function(e){s[n++]=e},r=0;r<i;++r){if(n+5>s.length){var o=new Sc(n+8+(i-r<<1));o.set(s),s=o}var l=e.charCodeAt(r);l<128||t?a(l):l<2048?(a(192|l>>6),a(128|63&l)):l>55295&&l<57344?(a(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++r))>>18),a(128|l>>12&63),a(128|l>>6&63),a(128|63&l)):(a(224|l>>12),a(128|l>>6&63),a(128|63&l))}return Kc(s,0,n)}var mh=function(e){var t=0;if(e)for(var i in e){var s=e[i].length;s>65535&&Jc(9),t+=s+4}return t},fh=function(e,t,i,s,n,a,r,o){var l=s.length,A=i.extra,c=o&&o.length,h=mh(A);ch(e,t,null!=r?33639248:67324752),t+=4,null!=r&&(e[t++]=20,e[t++]=i.os),e[t]=20,t+=2,e[t++]=i.flag<<1|(a<0&&8),e[t++]=n&&8,e[t++]=255&i.compression,e[t++]=i.compression>>8;var u=new Date(null==i.mtime?Date.now():i.mtime),d=u.getFullYear()-1980;if((d<0||d>119)&&Jc(10),ch(e,t,d<<25|u.getMonth()+1<<21|u.getDate()<<16|u.getHours()<<11|u.getMinutes()<<5|u.getSeconds()>>1),t+=4,-1!=a&&(ch(e,t,i.crc),ch(e,t+4,a<0?-a-2:a),ch(e,t+8,i.size)),ch(e,t+12,l),ch(e,t+14,h),t+=16,null!=r&&(ch(e,t,c),ch(e,t+6,i.attrs),ch(e,t+10,r),t+=14),e.set(s,t),t+=l,h)for(var p in A){var g=A[p],m=g.length;ch(e,t,+p),ch(e,t+2,m),e.set(g,t+4),t+=4+m}return c&&(e.set(o,t),t+=c),t};function bh(e,t){t||(t={});var i={},s=[];uh(e,"",i,t);var n=0,a=0;for(var r in i){var o=i[r],l=o[0],A=o[1],c=0==A.level?0:8,h=(w=gh(r)).length,u=A.comment,d=u&&gh(u),p=d&&d.length,g=mh(A.extra);h>65535&&Jc(11);var m=c?hh(l,A):l,f=m.length,b=oh();b.p(l),s.push(Ah(A,{size:l.length,crc:b.d(),c:m,f:w,m:d,u:h!=r.length||d&&u.length!=p,o:n,compression:c})),n+=30+h+g+f,a+=76+2*(h+g)+(p||0)+f}for(var y=new Sc(a+22),C=n,I=a-n,E=0;E<s.length;++E){var w=s[E];fh(y,w.o,w,w.f,w.u,w.c.length);var B=30+w.f.length+mh(w.extra);y.set(w.c,w.o+B),fh(y,n,w,w.f,w.u,w.c.length,w.o,w.m),n+=16+B+(w.m?w.m.length:0)}return function(e,t,i,s,n){ch(e,t,101010256),ch(e,t+8,i),ch(e,t+10,i),ch(e,t+12,s),ch(e,t+16,n)}(y,n,s.length,I,C),y}class yh{constructor(){this.textureUtils=null}setTextureUtils(e){this.textureUtils=e}parse(e,t,i,s){this.parseAsync(e,s).then(t).catch(i)}async parseAsync(e,t={}){t=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},includeAnchoringProperties:!0,quickLookCompatible:!1,maxTextureSize:1024},t);const i={},s="model.usda";i[s]=null;let n=Eh();n+=function(e){const t=!0===e.includeAnchoringProperties?`\n\t\ttoken preliminary:anchoring:type = "${e.ar.anchoring.type}"\n\t\ttoken preliminary:planeAnchoring:alignment = "${e.ar.planeAnchoring.alignment}"\n\t`:"";return`def Xform "Root"\n{\n\tdef Scope "Scenes" (\n\t\tkind = "sceneLibrary"\n\t)\n\t{\n\t\tdef Xform "Scene" (\n\t\t\tcustomData = {\n\t\t\t\tbool preliminary_collidesWithEnvironment = 0\n\t\t\t\tstring sceneName = "Scene"\n\t\t\t}\n\t\t\tsceneName = "Scene"\n\t\t)\n\t\t{${t}\n`}(t);const a={},r={};e.traverseVisible((e=>{if(e.isMesh){const t=e.geometry,s=e.material;if(s.isMeshStandardMaterial){const r="geometries/Geometry_"+t.id+".usda";if(!(r in i)){const e=function(e){const t=function(e){const t="Geometry",i=e.attributes,s=i.position.count;return`\n\tdef Mesh "${t}"\n\t{\n\t\tint[] faceVertexCounts = [${function(e){const t=null!==e.index?e.index.count:e.attributes.position.count;return Array(t/3).fill(3).join(", ")}(e)}]\n\t\tint[] faceVertexIndices = [${function(e){const t=e.index,i=[];if(null!==t)for(let e=0;e<t.count;e++)i.push(t.getX(e));else{const t=e.attributes.position.count;for(let e=0;e<t;e++)i.push(e)}return i.join(", ")}(e)}]\n\t\tnormal3f[] normals = [${vh(i.normal,s)}] (\n\t\t\tinterpolation = "vertex"\n\t\t)\n\t\tpoint3f[] points = [${vh(i.position,s)}]\n${function(e){let t="";for(let i=0;i<4;i++){const s=i>0?i:"",n=e["uv"+s];void 0!==n&&(t+=`\n\t\ttexCoord2f[] primvars:st${s} = [${xh(n)}] (\n\t\t\tinterpolation = "vertex"\n\t\t)`)}const i=e.color;if(void 0!==i){t+=`\n\tcolor3f[] primvars:displayColor = [${vh(i,i.count)}] (\n\t\tinterpolation = "vertex"\n\t\t)`}return t}(i)}\n\t\tuniform token subdivisionScheme = "none"\n\t}\n`}(e);return`\ndef "Geometry"\n{\n${t}\n}\n`}(t);i[r]=function(e){let t=Eh();return t+=e,gh(t)}(e)}s.uuid in a||(a[s.uuid]=s),n+=function(e,t,i){const s="Object_"+e.id,n=wh(e.matrixWorld);e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e);return`def Xform "${s}" (\n\tprepend references = @./geometries/Geometry_${t.id}.usda@</Geometry>\n\tprepend apiSchemas = ["MaterialBindingAPI"]\n)\n{\n\tmatrix4d xformOp:transform = ${n}\n\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\trel material:binding = </Materials/Material_${i.id}>\n}\n\n`}(e,t,s)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",e)}else e.isCamera&&(n+=function(e){const t=e.name?e.name:"Camera_"+e.id,i=wh(e.matrixWorld);e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e);return e.isOrthographicCamera?`def Camera "${t}"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ${i}\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\t\t\tfloat2 clippingRange = (${e.near.toPrecision(Ih)}, ${e.far.toPrecision(Ih)})\n\t\t\tfloat horizontalAperture = ${(10*(Math.abs(e.left)+Math.abs(e.right))).toPrecision(Ih)}\n\t\t\tfloat verticalAperture = ${(10*(Math.abs(e.top)+Math.abs(e.bottom))).toPrecision(Ih)}\n\t\t\ttoken projection = "orthographic"\n\t\t}\n\t\n\t`:`def Camera "${t}"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ${i}\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\t\t\tfloat2 clippingRange = (${e.near.toPrecision(Ih)}, ${e.far.toPrecision(Ih)})\n\t\t\tfloat focalLength = ${e.getFocalLength().toPrecision(Ih)}\n\t\t\tfloat focusDistance = ${e.focus.toPrecision(Ih)}\n\t\t\tfloat horizontalAperture = ${e.getFilmWidth().toPrecision(Ih)}\n\t\t\ttoken projection = "perspective"\n\t\t\tfloat verticalAperture = ${e.getFilmHeight().toPrecision(Ih)}\n\t\t}\n\t\n\t`}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e))})),n+="\n\t\t}\n\t}\n}\n\n",n+=function(e,t,i=!1){const s=[];for(const n in e){const a=e[n];s.push(Sh(a,t,i))}return`def "Materials"\n{\n${s.join("")}\n}\n\n`}(a,r,t.quickLookCompatible),i[s]=gh(n),n=null;for(const e in r){let s=r[e];if(!0===s.isCompressedTexture){if(null===this.textureUtils)throw new Error("THREE.USDZExporter: setTextureUtils() must be called to process compressed textures.");s=await this.textureUtils.decompress(s)}const n=Ch(s.image,s.flipY,t.maxTextureSize),a=await new Promise((e=>n.toBlob(e,"image/png",1)));i[`textures/Texture_${e}.png`]=new Uint8Array(await a.arrayBuffer())}let o=0;for(const e in i){const t=i[e];o+=34+e.length;const s=63&o;if(4!==s){const n=new Uint8Array(64-s);i[e]=[t,{extra:{12345:n}}]}o=t.length}return bh(i,{level:0})}}function Ch(e,t,i){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const s=i/Math.max(e.width,e.height),n=document.createElement("canvas");n.width=e.width*Math.min(1,s),n.height=e.height*Math.min(1,s);const a=n.getContext("2d");return!0===t&&(a.translate(0,n.height),a.scale(1,-1)),a.drawImage(e,0,0,n.width,n.height),n}throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const Ih=7;function Eh(){return'#usda 1.0\n(\n\tcustomLayerData = {\n\t\tstring creator = "Three.js USDZExporter"\n\t}\n\tdefaultPrim = "Root"\n\tmetersPerUnit = 1\n\tupAxis = "Y"\n)\n\n'}function wh(e){const t=e.elements;return`( ${Bh(t,0)}, ${Bh(t,4)}, ${Bh(t,8)}, ${Bh(t,12)} )`}function Bh(e,t){return`(${e[t+0]}, ${e[t+1]}, ${e[t+2]}, ${e[t+3]})`}function vh(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");const i=[];for(let t=0;t<e.count;t++){const s=e.getX(t),n=e.getY(t),a=e.getZ(t);i.push(`(${s.toPrecision(Ih)}, ${n.toPrecision(Ih)}, ${a.toPrecision(Ih)})`)}return i.join(", ")}function xh(e){const t=[];for(let i=0;i<e.count;i++){const s=e.getX(i),n=e.getY(i);t.push(`(${s.toPrecision(Ih)}, ${1-n.toPrecision(Ih)})`)}return t.join(", ")}function Sh(e,i,s=!1){const n="\t\t\t",a=[],r=[];function o(n,a,r){const o=n.source.id+"_"+n.flipY;i[o]=n;const l=n.channel>0?"st"+n.channel:"st",A={1e3:"repeat",1001:"clamp",1002:"mirror"},c=n.repeat.clone(),h=n.offset.clone(),u=n.rotation,d=Math.sin(u),p=Math.cos(u);return h.y=1-h.y-c.y,s?(h.x=h.x/c.x,h.y=h.y/c.y,h.x+=d/c.x,h.y+=p-1):(h.x+=d*c.x,h.y+=(1-p)*c.y),`\n\t\tdef Shader "PrimvarReader_${a}"\n\t\t{\n\t\t\tuniform token info:id = "UsdPrimvarReader_float2"\n\t\t\tfloat2 inputs:fallback = (0.0, 0.0)\n\t\t\ttoken inputs:varname = "${l}"\n\t\t\tfloat2 outputs:result\n\t\t}\n\n\t\tdef Shader "Transform2d_${a}"\n\t\t{\n\t\t\tuniform token info:id = "UsdTransform2d"\n\t\t\ttoken inputs:in.connect = </Materials/Material_${e.id}/PrimvarReader_${a}.outputs:result>\n\t\t\tfloat inputs:rotation = ${(u*(180/Math.PI)).toFixed(Ih)}\n\t\t\tfloat2 inputs:scale = ${Mh(c)}\n\t\t\tfloat2 inputs:translation = ${Mh(h)}\n\t\t\tfloat2 outputs:result\n\t\t}\n\n\t\tdef Shader "Texture_${n.id}_${a}"\n\t\t{\n\t\t\tuniform token info:id = "UsdUVTexture"\n\t\t\tasset inputs:file = @textures/Texture_${o}.png@\n\t\t\tfloat2 inputs:st.connect = </Materials/Material_${e.id}/Transform2d_${a}.outputs:result>\n\t\t\t${void 0!==r?"float4 inputs:scale = "+function(e){return`(${e.r}, ${e.g}, ${e.b}, 1.0)`}(r):""}\n\t\t\ttoken inputs:sourceColorSpace = "${n.colorSpace===t.NoColorSpace?"raw":"sRGB"}"\n\t\t\ttoken inputs:wrapS = "${A[n.wrapS]}"\n\t\t\ttoken inputs:wrapT = "${A[n.wrapT]}"\n\t\t\tfloat outputs:r\n\t\t\tfloat outputs:g\n\t\t\tfloat outputs:b\n\t\t\tfloat3 outputs:rgb\n\t\t\t${e.transparent||e.alphaTest>0?"float outputs:a":""}\n\t\t}`}return e.side===t.DoubleSide&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",e),null!==e.map?(a.push(`${n}color3f inputs:diffuseColor.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:rgb>`),e.transparent?a.push(`${n}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:a>`):e.alphaTest>0&&(a.push(`${n}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:a>`),a.push(`${n}float inputs:opacityThreshold = ${e.alphaTest}`)),r.push(o(e.map,"diffuse",e.color))):a.push(`${n}color3f inputs:diffuseColor = ${Qh(e.color)}`),null!==e.emissiveMap?(a.push(`${n}color3f inputs:emissiveColor.connect = </Materials/Material_${e.id}/Texture_${e.emissiveMap.id}_emissive.outputs:rgb>`),r.push(o(e.emissiveMap,"emissive",new t.Color(e.emissive.r*e.emissiveIntensity,e.emissive.g*e.emissiveIntensity,e.emissive.b*e.emissiveIntensity)))):e.emissive.getHex()>0&&a.push(`${n}color3f inputs:emissiveColor = ${Qh(e.emissive)}`),null!==e.normalMap&&(a.push(`${n}normal3f inputs:normal.connect = </Materials/Material_${e.id}/Texture_${e.normalMap.id}_normal.outputs:rgb>`),r.push(o(e.normalMap,"normal"))),null!==e.aoMap&&(a.push(`${n}float inputs:occlusion.connect = </Materials/Material_${e.id}/Texture_${e.aoMap.id}_occlusion.outputs:r>`),r.push(o(e.aoMap,"occlusion",new t.Color(e.aoMapIntensity,e.aoMapIntensity,e.aoMapIntensity)))),null!==e.roughnessMap?(a.push(`${n}float inputs:roughness.connect = </Materials/Material_${e.id}/Texture_${e.roughnessMap.id}_roughness.outputs:g>`),r.push(o(e.roughnessMap,"roughness",new t.Color(e.roughness,e.roughness,e.roughness)))):a.push(`${n}float inputs:roughness = ${e.roughness}`),null!==e.metalnessMap?(a.push(`${n}float inputs:metallic.connect = </Materials/Material_${e.id}/Texture_${e.metalnessMap.id}_metallic.outputs:b>`),r.push(o(e.metalnessMap,"metallic",new t.Color(e.metalness,e.metalness,e.metalness)))):a.push(`${n}float inputs:metallic = ${e.metalness}`),null!==e.alphaMap?(a.push(`${n}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.alphaMap.id}_opacity.outputs:r>`),a.push(`${n}float inputs:opacityThreshold = 0.0001`),r.push(o(e.alphaMap,"opacity"))):a.push(`${n}float inputs:opacity = ${e.opacity}`),e.isMeshPhysicalMaterial&&(null!==e.clearcoatMap?(a.push(`${n}float inputs:clearcoat.connect = </Materials/Material_${e.id}/Texture_${e.clearcoatMap.id}_clearcoat.outputs:r>`),r.push(o(e.clearcoatMap,"clearcoat",new t.Color(e.clearcoat,e.clearcoat,e.clearcoat)))):a.push(`${n}float inputs:clearcoat = ${e.clearcoat}`),null!==e.clearcoatRoughnessMap?(a.push(`${n}float inputs:clearcoatRoughness.connect = </Materials/Material_${e.id}/Texture_${e.clearcoatRoughnessMap.id}_clearcoatRoughness.outputs:g>`),r.push(o(e.clearcoatRoughnessMap,"clearcoatRoughness",new t.Color(e.clearcoatRoughness,e.clearcoatRoughness,e.clearcoatRoughness)))):a.push(`${n}float inputs:clearcoatRoughness = ${e.clearcoatRoughness}`),a.push(`${n}float inputs:ior = ${e.ior}`)),`\n\tdef Material "Material_${e.id}"\n\t{\n\t\tdef Shader "PreviewSurface"\n\t\t{\n\t\t\tuniform token info:id = "UsdPreviewSurface"\n${a.join("\n")}\n\t\t\tint inputs:useSpecularWorkflow = 0\n\t\t\ttoken outputs:surface\n\t\t}\n\n\t\ttoken outputs:surface.connect = </Materials/Material_${e.id}/PreviewSurface.outputs:surface>\n\n${r.join("\n")}\n\n\t}\n`}function Qh(e){return`(${e.r}, ${e.g}, ${e.b})`}function Mh(e){return`(${e.x}, ${e.y})`}
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var Th=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};let Rh=!1,Dh=!1;const kh="#model-viewer-no-ar-fallback",Fh=(Lh=["quick-look","scene-viewer","webxr","none"],e=>{try{const t=rn(e),i=(t.length?t[0].terms:[]).filter((e=>e&&"ident"===e.type)).map((e=>e.value)).filter((e=>Lh.indexOf(e)>-1));return new Set(i)}catch(e){}return new Set});var Lh;const _h="quick-look",Ph="scene-viewer",Oh="webxr",Gh="none",Uh=Symbol("arButtonContainer"),Nh=Symbol("enterARWithWebXR"),jh=Symbol("openSceneViewer"),Hh=Symbol("openIOSARQuickLook"),zh=Symbol("canActivateAR"),qh=Symbol("arMode"),Vh=Symbol("arModes"),Kh=Symbol("arAnchor"),Wh=Symbol("preload"),Jh=Symbol("onARButtonContainerClick"),Yh=Symbol("onARStatus"),Xh=Symbol("onARTracking"),$h=Symbol("onARTap"),Zh=Symbol("selectARMode"),eu=Symbol("triggerLoad");
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var tu=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const iu="auto",su="auto",nu="eager",au=Symbol("defaultProgressBarElement"),ru=Symbol("posterContainerElement"),ou=Symbol("defaultPosterElement"),lu=Symbol("shouldDismissPoster"),Au=Symbol("hidePoster"),cu=Symbol("modelIsRevealed"),hu=Symbol("updateProgressBar"),uu=Symbol("ariaLabelCallToAction"),du=Symbol("onProgress");
/* @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var pu=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const gu=Math.PI/32,mu={basis:[gn(an(gu,"rad"))],keywords:{auto:[null]}},fu=Symbol("autoRotateStartTime"),bu=Symbol("radiansPerSecond"),yu=Symbol("syncRotationRate"),Cu=Symbol("onCameraChange"),Iu=Symbol("meshRoot"),Eu=Symbol("meshes"),wu=Symbol("objects"),Bu=Symbol("updateFramingThrottled");class vu extends t.Mesh{constructor(e,i={}){super(e),this.isWater=!0;const s=this,n=void 0!==i.textureWidth?i.textureWidth:512,a=void 0!==i.textureHeight?i.textureHeight:512,r=void 0!==i.clipBias?i.clipBias:0,o=void 0!==i.alpha?i.alpha:1,l=void 0!==i.time?i.time:0,A=void 0!==i.waterNormals?i.waterNormals:null,c=void 0!==i.sunDirection?i.sunDirection:new t.Vector3(.70707,.70707,0),h=new t.Color(void 0!==i.sunColor?i.sunColor:16777215),u=new t.Color(void 0!==i.waterColor?i.waterColor:8355711),d=void 0!==i.eye?i.eye:new t.Vector3(0,0,0),p=void 0!==i.distortionScale?i.distortionScale:20,g=void 0!==i.side?i.side:t.FrontSide,m=void 0!==i.fog&&i.fog,f=new t.Plane,b=new t.Vector3,y=new t.Vector3,C=new t.Vector3,I=new t.Matrix4,E=new t.Vector3(0,0,-1),w=new t.Vector4,B=new t.Vector3,v=new t.Vector3,x=new t.Vector4,S=new t.Matrix4,Q=new t.PerspectiveCamera,M=new t.WebGLRenderTarget(n,a),T={name:"MirrorShader",uniforms:t.UniformsUtils.merge([t.UniformsLib.fog,t.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new t.Matrix4},sunColor:{value:new t.Color(8355711)},sunDirection:{value:new t.Vector3(.70707,.70707,0)},eye:{value:new t.Vector3},waterColor:{value:new t.Color(5592405)}}]),vertexShader:"\n\t\t\t\tuniform mat4 textureMatrix;\n\t\t\t\tuniform float time;\n\n\t\t\t\tvarying vec4 mirrorCoord;\n\t\t\t\tvarying vec4 worldPosition;\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tmirrorCoord = modelMatrix * vec4( position, 1.0 );\n\t\t\t\t\tworldPosition = mirrorCoord.xyzw;\n\t\t\t\t\tmirrorCoord = textureMatrix * mirrorCoord;\n\t\t\t\t\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t\t#include <beginnormal_vertex>\n\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t#include <fog_vertex>\n\t\t\t\t#include <shadowmap_vertex>\n\t\t\t}",fragmentShader:"\n\t\t\t\tuniform sampler2D mirrorSampler;\n\t\t\t\tuniform float alpha;\n\t\t\t\tuniform float time;\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float distortionScale;\n\t\t\t\tuniform sampler2D normalSampler;\n\t\t\t\tuniform vec3 sunColor;\n\t\t\t\tuniform vec3 sunDirection;\n\t\t\t\tuniform vec3 eye;\n\t\t\t\tuniform vec3 waterColor;\n\n\t\t\t\tvarying vec4 mirrorCoord;\n\t\t\t\tvarying vec4 worldPosition;\n\n\t\t\t\tvec4 getNoise( vec2 uv ) {\n\t\t\t\t\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n\t\t\t\t\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );\n\t\t\t\t\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n\t\t\t\t\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n\t\t\t\t\tvec4 noise = texture2D( normalSampler, uv0 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv1 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv2 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv3 );\n\t\t\t\t\treturn noise * 0.5 - 1.0;\n\t\t\t\t}\n\n\t\t\t\tvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n\t\t\t\t\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n\t\t\t\t\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );\n\t\t\t\t\tspecularColor += pow( direction, shiny ) * sunColor * spec;\n\t\t\t\t\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n\t\t\t\t}\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <packing>\n\t\t\t\t#include <bsdfs>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <lights_pars_begin>\n\t\t\t\t#include <shadowmap_pars_fragment>\n\t\t\t\t#include <shadowmask_pars_fragment>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\t\t\t\t\tvec4 noise = getNoise( worldPosition.xz * size );\n\t\t\t\t\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\n\n\t\t\t\t\tvec3 diffuseLight = vec3(0.0);\n\t\t\t\t\tvec3 specularLight = vec3(0.0);\n\n\t\t\t\t\tvec3 worldToEye = eye-worldPosition.xyz;\n\t\t\t\t\tvec3 eyeDirection = normalize( worldToEye );\n\t\t\t\t\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\n\t\t\t\t\tfloat distance = length(worldToEye);\n\n\t\t\t\t\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;\n\t\t\t\t\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );\n\n\t\t\t\t\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );\n\t\t\t\t\tfloat rf0 = 0.3;\n\t\t\t\t\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );\n\t\t\t\t\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;\n\t\t\t\t\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);\n\t\t\t\t\tvec3 outgoingLight = albedo;\n\t\t\t\t\tgl_FragColor = vec4( outgoingLight, alpha );\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <colorspace_fragment>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t}"},R=new t.ShaderMaterial({name:T.name,uniforms:t.UniformsUtils.clone(T.uniforms),vertexShader:T.vertexShader,fragmentShader:T.fragmentShader,lights:!0,side:g,fog:m});R.uniforms.mirrorSampler.value=M.texture,R.uniforms.textureMatrix.value=S,R.uniforms.alpha.value=o,R.uniforms.time.value=l,R.uniforms.normalSampler.value=A,R.uniforms.sunColor.value=h,R.uniforms.waterColor.value=u,R.uniforms.sunDirection.value=c,R.uniforms.distortionScale.value=p,R.uniforms.eye.value=d,s.material=R,s.onBeforeRender=function(e,t,i){if(y.setFromMatrixPosition(s.matrixWorld),C.setFromMatrixPosition(i.matrixWorld),I.extractRotation(s.matrixWorld),b.set(0,0,1),b.applyMatrix4(I),B.subVectors(y,C),B.dot(b)>0)return;B.reflect(b).negate(),B.add(y),I.extractRotation(i.matrixWorld),E.set(0,0,-1),E.applyMatrix4(I),E.add(C),v.subVectors(y,E),v.reflect(b).negate(),v.add(y),Q.position.copy(B),Q.up.set(0,1,0),Q.up.applyMatrix4(I),Q.up.reflect(b),Q.lookAt(v),Q.far=i.far,Q.updateMatrixWorld(),Q.projectionMatrix.copy(i.projectionMatrix),S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(Q.projectionMatrix),S.multiply(Q.matrixWorldInverse),f.setFromNormalAndCoplanarPoint(b,y),f.applyMatrix4(Q.matrixWorldInverse),w.set(f.normal.x,f.normal.y,f.normal.z,f.constant);const n=Q.projectionMatrix;x.x=(Math.sign(w.x)+n.elements[8])/n.elements[0],x.y=(Math.sign(w.y)+n.elements[9])/n.elements[5],x.z=-1,x.w=(1+n.elements[10])/n.elements[14],w.multiplyScalar(2/w.dot(x)),n.elements[2]=w.x,n.elements[6]=w.y,n.elements[10]=w.z+1-r,n.elements[14]=w.w,d.setFromMatrixPosition(i.matrixWorld);const a=e.getRenderTarget(),o=e.xr.enabled,l=e.shadowMap.autoUpdate;s.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(M),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,Q),s.visible=!0,e.xr.enabled=o,e.shadowMap.autoUpdate=l,e.setRenderTarget(a);const A=i.viewport;void 0!==A&&e.state.viewport(A)}}animate(){this.material.uniforms.time.value+=.1/60}}class xu extends t.Mesh{constructor(){const e=xu.SkyShader,i=new t.ShaderMaterial({name:e.name,uniforms:t.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:t.BackSide,depthWrite:!1});super(new t.BoxGeometry(1,1,1),i),this.isSky=!0}}xu.SkyShader={name:"SkyShader",uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new t.Vector3},up:{value:new t.Vector3(0,1,0)}},vertexShader:"\n\t\tuniform vec3 sunPosition;\n\t\tuniform float rayleigh;\n\t\tuniform float turbidity;\n\t\tuniform float mieCoefficient;\n\t\tuniform vec3 up;\n\n\t\tvarying vec3 vWorldPosition;\n\t\tvarying vec3 vSunDirection;\n\t\tvarying float vSunfade;\n\t\tvarying vec3 vBetaR;\n\t\tvarying vec3 vBetaM;\n\t\tvarying float vSunE;\n\n\t\t// constants for atmospheric scattering\n\t\tconst float e = 2.71828182845904523536028747135266249775724709369995957;\n\t\tconst float pi = 3.141592653589793238462643383279502884197169;\n\n\t\t// wavelength of used primaries, according to preetham\n\t\tconst vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n\t\t// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n\t\t// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n\t\tconst vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n\t\t// mie stuff\n\t\t// K coefficient for the primaries\n\t\tconst float v = 4.0;\n\t\tconst vec3 K = vec3( 0.686, 0.678, 0.666 );\n\t\t// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n\t\tconst vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n\t\t// earth shadow hack\n\t\t// cutoffAngle = pi / 1.95;\n\t\tconst float cutoffAngle = 1.6110731556870734;\n\t\tconst float steepness = 1.5;\n\t\tconst float EE = 1000.0;\n\n\t\tfloat sunIntensity( float zenithAngleCos ) {\n\t\t\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n\t\t\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n\t\t}\n\n\t\tvec3 totalMie( float T ) {\n\t\t\tfloat c = ( 0.2 * T ) * 10E-18;\n\t\t\treturn 0.434 * c * MieConst;\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\tvWorldPosition = worldPosition.xyz;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n\t\t\tvSunDirection = normalize( sunPosition );\n\n\t\t\tvSunE = sunIntensity( dot( vSunDirection, up ) );\n\n\t\t\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n\t\t\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n\t\t\t// extinction (absorbtion + out scattering)\n\t\t\t// rayleigh coefficients\n\t\t\tvBetaR = totalRayleigh * rayleighCoefficient;\n\n\t\t\t// mie coefficients\n\t\t\tvBetaM = totalMie( turbidity ) * mieCoefficient;\n\n\t\t}",fragmentShader:"\n\t\tvarying vec3 vWorldPosition;\n\t\tvarying vec3 vSunDirection;\n\t\tvarying float vSunfade;\n\t\tvarying vec3 vBetaR;\n\t\tvarying vec3 vBetaM;\n\t\tvarying float vSunE;\n\n\t\tuniform float mieDirectionalG;\n\t\tuniform vec3 up;\n\n\t\t// constants for atmospheric scattering\n\t\tconst float pi = 3.141592653589793238462643383279502884197169;\n\n\t\tconst float n = 1.0003; // refractive index of air\n\t\tconst float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\n\n\t\t// optical length at zenith for molecules\n\t\tconst float rayleighZenithLength = 8.4E3;\n\t\tconst float mieZenithLength = 1.25E3;\n\t\t// 66 arc seconds -> degrees, and the cosine of that\n\t\tconst float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n\t\t// 3.0 / ( 16.0 * pi )\n\t\tconst float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n\t\t// 1.0 / ( 4.0 * pi )\n\t\tconst float ONE_OVER_FOURPI = 0.07957747154594767;\n\n\t\tfloat rayleighPhase( float cosTheta ) {\n\t\t\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n\t\t}\n\n\t\tfloat hgPhase( float cosTheta, float g ) {\n\t\t\tfloat g2 = pow( g, 2.0 );\n\t\t\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n\t\t\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec3 direction = normalize( vWorldPosition - cameraPosition );\n\n\t\t\t// optical length\n\t\t\t// cutoff angle at 90 to avoid singularity in next formula.\n\t\t\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );\n\t\t\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n\t\t\tfloat sR = rayleighZenithLength * inverse;\n\t\t\tfloat sM = mieZenithLength * inverse;\n\n\t\t\t// combined extinction factor\n\t\t\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n\t\t\t// in scattering\n\t\t\tfloat cosTheta = dot( direction, vSunDirection );\n\n\t\t\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n\t\t\tvec3 betaRTheta = vBetaR * rPhase;\n\n\t\t\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );\n\t\t\tvec3 betaMTheta = vBetaM * mPhase;\n\n\t\t\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n\t\t\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n\t\t\t// nightsky\n\t\t\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n\t\t\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n\t\t\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n\t\t\tvec3 L0 = vec3( 0.1 ) * Fex;\n\n\t\t\t// composition + solar disc\n\t\t\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n\t\t\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n\t\t\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n\t\t\tvec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n\t\t\tgl_FragColor = vec4( retColor, 1.0 );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <colorspace_fragment>\n\n\t\t}"};var Su=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const Qu=Symbol("justAddWater"),Mu=Symbol("addSky"),Tu=Symbol("updateSun"),Ru=Symbol("animateEnvironment"),Du=Symbol("water"),ku=Symbol("sun"),Fu=Symbol("sky"),Lu=Symbol("pmremGenerator"),_u=Symbol("sceneEnv"),Pu=Symbol("renderTarget");
/* @license
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var Ou=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const Gu=Symbol("modularControlsContainer"),Uu=Symbol("selectedObject"),Nu=Symbol("updateModularControls"),ju=Symbol("worldToScreen"),Hu=Symbol("selectObjectForControls"),zu=Symbol("clearSelectedObject");var qu=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const Vu=Symbol("traverseAndToggleLights"),Ku=(e,t,i=2)=>{switch(t){case"ft":return((e,t=1)=>(3.28084*e).toFixed(t))(e,i);case"in":return((e,t=1)=>(39.3701*e).toFixed(t))(e,i);case"yd":return((e,t=1)=>(1.09361*e).toFixed(t))(e,i);case"mi":return((e,t=1)=>(621371e-9*e).toFixed(t))(e,i);case"cm":return((e,t=1)=>(100*e).toFixed(t))(e,i);case"mm":return((e,t=1)=>(1e3*e).toFixed(t))(e,i);default:return e.toFixed(i)}},Wu=["front","front-right","right","back-right","back","back-left","left","front-left"],Ju=2*Math.PI,Yu=Math.PI/4,Xu=Math.PI/2;var $u=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const Zu=Symbol("measureContainer");let ed=class extends t.Object3D{constructor(e,i){super(),this.needsRender=null,this.element=null,this.scene=null,this.targetObject=null,this.worldPlacementPosition=new t.Vector3,this.name="cursor",this.visible=!1,this.scene=e,this.targetObject=i,i.add(this),this.positionAtPlacementLevel()}getPosition(){return this.worldPlacementPosition.clone()}setVisible(e){this.visible=e,e&&this.element&&this.needsRender?this.startMouseTracking():this.stopMouseTracking()}setupMouseTracking(e,t){this.element=e,this.needsRender=t,this.visible&&this.startMouseTracking()}cleanup(){var e;this.stopMouseTracking(),this.visible=!1,this.element=null,null===(e=this.needsRender)||void 0===e||e.call(this),this.needsRender=null}positionAtPlacementLevel(){this.scene&&this.scene.boundingBox&&(this.position.y=this.scene.boundingBox.min.y)}startMouseTracking(){!this.mouseMoveHandler&&this.element&&(this.mouseMoveHandler=e=>{this.updatePosition(e.clientX,e.clientY,this.element,this.needsRender)},this.dragOverHandler=e=>{e.preventDefault(),this.updatePosition(e.clientX,e.clientY,this.element,this.needsRender)},this.element.addEventListener("mousemove",this.mouseMoveHandler),this.element.addEventListener("dragover",this.dragOverHandler))}stopMouseTracking(){this.mouseMoveHandler&&this.element&&(this.element.removeEventListener("mousemove",this.mouseMoveHandler),this.mouseMoveHandler=void 0),this.dragOverHandler&&this.element&&(this.element.removeEventListener("dragover",this.dragOverHandler),this.dragOverHandler=void 0)}updatePosition(e,i,s,n){var a;if(!this.scene)return;const r=s.getBoundingClientRect(),o=e-r.left,l=i-r.top,A=o/r.width*2-1,c=-l/r.height*2+1,h=new t.Raycaster;h.setFromCamera(new t.Vector2(A,c),this.scene.camera);const u=this.scene.boundingBox?this.scene.boundingBox.min.y:0,d=h.ray,p=d.direction.y;if(Math.abs(p)>1e-4){const e=(u-d.origin.y)/p;if(e>0){const i=d.origin.clone().add(d.direction.clone().multiplyScalar(e));if(this.worldPlacementPosition.copy(i),this.targetObject){const e=i.clone();this.targetObject.worldToLocal(e),this.position.copy(e);const s=new t.Vector3(0,(null===(a=this.scene.boundingBox)||void 0===a?void 0:a.min.y)||0,0);this.targetObject.worldToLocal(s),this.position.y=s.y+.01}else this.position.copy(i),this.position.y=u+.01;this.setVisible(!0)}else this.setVisible(!1)}else this.setVisible(!1);n()}};const td=.618;let id=class extends ed{constructor(e,i,s=.1){super(e,i),this.baseY=.01,this.elapsedTime=0,this.radius=s,this.group=new t.Group;const n=new t.MeshStandardMaterial({color:16777215,metalness:.1,roughness:.3});this.shaft=this.createShaft(n),this.head=this.createHead(n),this.group.add(this.shaft),this.group.add(this.head),this.add(this.group),this.position.set(0,this.baseY,0)}setVisible(e){super.setVisible(e),e||this.stopAnimation()}cleanup(){this.clear(),this.stopAnimation(),super.cleanup()}createShaft(e){const i=this.radius*td,s=this.radius,n=.33*this.radius,a=new Float32Array([-i/2,s/2,n/2,i/2,s/2,n/2,-i/2,-s/2,n/2,i/2,-s/2,n/2,-i/2,s/2,-n/2,i/2,s/2,-n/2,-i/2,-s/2,-n/2,i/2,-s/2,-n/2]),r=new t.BufferGeometry;r.setAttribute("position",new t.Float32BufferAttribute(a,3)),r.setIndex([0,1,2,1,3,2,1,5,3,5,7,3,5,4,7,4,6,7,4,0,6,0,2,6,4,5,0,5,1,0]),r.computeVertexNormals();const o=new t.Mesh(r,e);return o.castShadow=!0,o.receiveShadow=!0,o.position.y=s/2+this.radius*td,o}createHead(e){const i=this.radius,s=this.radius*td,n=.33*this.radius,a=this.radius*td,r=new Float32Array([-i/2,0,n/2,-a/2,0,n/2,a/2,0,n/2,i/2,0,n/2,0,-s,n/2,-i/2,0,-n/2,-a/2,0,-n/2,a/2,0,-n/2,i/2,0,-n/2,0,-s,-n/2]),o=new t.BufferGeometry;o.setAttribute("position",new t.Float32BufferAttribute(r,3)),o.setIndex([0,1,4,1,2,4,2,3,4,5,9,6,6,9,7,7,9,8,4,9,5,4,5,0,4,3,8,4,8,9,0,5,1,1,5,6,1,6,2,2,6,7,2,7,3,3,7,8,3,8,4,4,8,9]),o.computeVertexNormals();const l=new t.Mesh(o,e);return l.castShadow=!0,l.receiveShadow=!0,l.position.y=s,l}tick(e,i){if(!this.visible)return;this.elapsedTime+=i,this.group.rotation.y=this.elapsedTime/1e3*t.MathUtils.DEG2RAD*45;const s=.5*(Math.sin(this.elapsedTime/1500*2*Math.PI)+1)*(.2*this.radius);this.group.position.y=this.baseY+s,this.needsRender&&this.needsRender()}stopAnimation(){this.elapsedTime=0}};class sd extends ed{constructor(e,t,i=.1){super(e,t),this.baseRadius=.1,this.contourLine=null,this.darkContourLine=null,this.elapsedTime=0,this.mesh=null,this.radius=.1,this.radius=i,this.baseRadius=i,this.createCursorGeometry()}setRadius(e){e<=0?console.warn("Cursor radius must be greater than 0"):(this.radius=e,this.baseRadius=e,this.createCursorGeometry())}getRadius(){return this.radius}createCursorGeometry(){this.clear();const e=new t.CircleGeometry(this.radius,32),i=new t.MeshBasicMaterial({color:16119285,transparent:!0,opacity:.5,depthTest:!1});this.mesh=new t.Mesh(e,i),this.mesh.rotation.x=-Math.PI/2,this.mesh.position.set(0,.01,0),this.mesh.castShadow=!1,this.add(this.mesh);const s=new t.BufferGeometry,n=[];for(let e=0;e<=64;e++){const i=e/64*Math.PI*2;n.push(new t.Vector3(Math.cos(i)*this.radius,0,Math.sin(i)*this.radius))}s.setFromPoints(n);const a=new t.LineBasicMaterial({color:13882323,transparent:!0,opacity:.8,depthTest:!1});this.contourLine=new t.LineLoop(s,a),this.contourLine.position.set(0,.011,0),this.contourLine.castShadow=!1,this.add(this.contourLine);const r=new t.LineBasicMaterial({color:3355443,transparent:!0,opacity:.6,depthTest:!1});this.darkContourLine=new t.LineLoop(s.clone(),r),this.darkContourLine.position.set(0,.012,0),this.darkContourLine.castShadow=!1,this.add(this.darkContourLine)}setVisible(e){super.setVisible(e),e||this.stopAnimation()}tick(e,t){if(!this.visible)return;this.elapsedTime+=t;const i=this.elapsedTime%1500/1500,s=.1*Math.sin(2*i*Math.PI);this.radius=this.baseRadius*(1+s),this.createCursorGeometry(),this.needsRender&&this.needsRender()}cleanup(){this.clear(),this.stopAnimation(),super.cleanup()}stopAnimation(){this.radius=this.baseRadius,this.elapsedTime=0}}
/* @license
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var nd=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const ad=Symbol("arrowCursor"),rd=Symbol("discCursor"),od=Symbol("updateCursors"),ld=Symbol("getArrowCursorPosition"),Ad=Symbol("getDiscCursorPosition"),cd=Symbol("setArrowCursorVisible"),hd=Symbol("setDiscCursorVisible"),ud=Symbol("findTargetObject");let dd,pd,gd,md;function fd(e,i=1/0,s=null){pd||(pd=new t.PlaneGeometry(2,2,1,1)),gd||(gd=new t.ShaderMaterial({uniforms:{blitTexture:new t.Uniform(e)},vertexShader:"\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main(){\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = vec4(position.xy * 1.0,0.,.999999);\n\t\t\t}",fragmentShader:"\n\t\t\tuniform sampler2D blitTexture; \n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main(){ \n\t\t\t\tgl_FragColor = vec4(vUv.xy, 0, 1);\n\t\t\t\t\n\t\t\t\t#ifdef IS_SRGB\n\t\t\t\tgl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );\n\t\t\t\t#else\n\t\t\t\tgl_FragColor = texture2D( blitTexture, vUv);\n\t\t\t\t#endif\n\t\t\t}"})),gd.uniforms.blitTexture.value=e,gd.defines.IS_SRGB=e.colorSpace==t.SRGBColorSpace,gd.needsUpdate=!0,md||(md=new t.Mesh(pd,gd),md.frustumCulled=!1);const n=new t.PerspectiveCamera,a=new t.Scene;a.add(md),null===s&&(s=dd=new t.WebGLRenderer({antialias:!1}));const r=Math.min(e.image.width,i),o=Math.min(e.image.height,i);s.setSize(r,o),s.clear(),s.render(a,n);const l=document.createElement("canvas"),A=l.getContext("2d");l.width=r,l.height=o,A.drawImage(s.domElement,0,0,r,o);const c=new t.CanvasTexture(l);return c.minFilter=e.minFilter,c.magFilter=e.magFilter,c.wrapS=e.wrapS,c.wrapT=e.wrapT,c.colorSpace=e.colorSpace,c.name=e.name,dd&&(dd.forceContextLoss(),dd.dispose(),dd=null),c}const bd=/\ \([0-9]+\)$/,yd={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Cd{constructor(){this.pluginCallbacks=[],this.register((function(e){return new ep(e)})),this.register((function(e){return new tp(e)})),this.register((function(e){return new np(e)})),this.register((function(e){return new ap(e)})),this.register((function(e){return new rp(e)})),this.register((function(e){return new op(e)})),this.register((function(e){return new ip(e)})),this.register((function(e){return new sp(e)})),this.register((function(e){return new lp(e)})),this.register((function(e){return new Ap(e)})),this.register((function(e){return new cp(e)})),this.register((function(e){return new hp(e)})),this.register((function(e){return new up(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){const n=new Zd,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](n));n.setPlugins(a),n.write(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise((function(s,n){i.parse(e,s,n,t)}))}}const Id=0,Ed=1,wd=2,Bd=3,vd=4,xd=5120,Sd=5121,Qd=5122,Md=5123,Td=5124,Rd=5125,Dd=5126,kd=34962,Fd=34963,Ld=9728,_d=9729,Pd=9984,Od=9985,Gd=9986,Ud=9987,Nd=33071,jd=33648,Hd=10497,zd="KHR_mesh_quantization",qd={};qd[t.NearestFilter]=Ld,qd[t.NearestMipmapNearestFilter]=Pd,qd[t.NearestMipmapLinearFilter]=Gd,qd[t.LinearFilter]=_d,qd[t.LinearMipmapNearestFilter]=Od,qd[t.LinearMipmapLinearFilter]=Ud,qd[t.ClampToEdgeWrapping]=Nd,qd[t.RepeatWrapping]=Hd,qd[t.MirroredRepeatWrapping]=jd;const Vd={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Kd=new t.Color;function Wd(e,t){return e.length===t.length&&e.every((function(e,i){return e===t[i]}))}function Jd(e){return 4*Math.ceil(e/4)}function Yd(e,t=0){const i=Jd(e.byteLength);if(i!==e.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<i;n++)s[n]=t;return s.buffer}return e}function Xd(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function $d(e,t){if(void 0!==e.toBlob)return new Promise((i=>e.toBlob(i,t)));let i;return"image/jpeg"===t?i=.92:"image/webp"===t&&(i=.8),e.convertToBlob({type:t,quality:i})}class Zd{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.LDExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,n=s.buffers,a=s.json;i=s.options;const r=s.extensionsUsed,o=s.extensionsRequired,l=new Blob(n,{type:"application/octet-stream"}),A=Object.keys(r),c=Object.keys(o);if(A.length>0&&(a.extensionsUsed=A),c.length>0&&(a.extensionsRequired=c),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=l.size),!0===i.binary){const e=new FileReader;e.readAsArrayBuffer(l),e.onloadend=function(){const i=Yd(e.result),s=new DataView(new ArrayBuffer(8));s.setUint32(0,i.byteLength,!0),s.setUint32(4,5130562,!0);const n=Yd((r=JSON.stringify(a),(new TextEncoder).encode(r).buffer),32);var r;const o=new DataView(new ArrayBuffer(8));o.setUint32(0,n.byteLength,!0),o.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),A=new DataView(l);A.setUint32(0,1179937895,!0),A.setUint32(4,2,!0);const c=12+o.byteLength+n.byteLength+s.byteLength+i.byteLength;A.setUint32(8,c,!0);const h=new Blob([l,o,n,s,i],{type:"application/octet-stream"}),u=new FileReader;u.readAsArrayBuffer(h),u.onloadend=function(){t(u.result)}}}else if(a.buffers&&a.buffers.length>0){const e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){const i=e.result;a.buffers[0].uri=i,t(a)}}else t(a)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const i=this.options,s=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&n.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],s[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.LDExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new t.Vector3;for(let t=0,s=e.count;t<s;t++)if(Math.abs(i.fromBufferAttribute(e,t).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),n=new t.Vector3;for(let e=0,t=s.count;e<t;e++)n.fromBufferAttribute(s,e),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),s.setXYZ(e,n.x,n.y,n.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let i=!1;const s={};0===t.offset.x&&0===t.offset.y||(s.offset=t.offset.toArray(),i=!0),0!==t.rotation&&(s.rotation=t.rotation,i=!0),1===t.repeat.x&&1===t.repeat.y||(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(e){return e.colorSpace===t.SRGBColorSpace?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.LDExporter: Merged metalnessMap and roughnessMap textures."),e instanceof t.CompressedTexture&&(e=fd(e)),i instanceof t.CompressedTexture&&(i=fd(i));const n=e?e.image:null,a=i?i.image:null,r=Math.max(n?n.width:0,a?a.width:0),o=Math.max(n?n.height:0,a?a.height:0),l=Xd();l.width=r,l.height=o;const A=l.getContext("2d");A.fillStyle="#00ffff",A.fillRect(0,0,r,o);const c=A.getImageData(0,0,r,o);if(n){A.drawImage(n,0,0,r,o);const t=s(e),i=A.getImageData(0,0,r,o).data;for(let e=2;e<i.length;e+=4)c.data[e]=256*t(i[e]/256)}if(a){A.drawImage(a,0,0,r,o);const e=s(i),t=A.getImageData(0,0,r,o).data;for(let i=1;i<t.length;i+=4)c.data[i]=256*e(t[i]/256)}A.putImageData(c,0,0);const h=(e||i).clone();return h.source=new t.Source(l),h.colorSpace=t.NoColorSpace,h.channel=(e||i).channel,e&&i&&e.channel!==i.channel&&console.warn("THREE.LDExporter: UV channels for metalnessMap and roughnessMap textures must match."),h}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,i,s,n,a){const r=this.json;let o;switch(r.bufferViews||(r.bufferViews=[]),i){case xd:case Sd:o=1;break;case Qd:case Md:o=2;break;default:o=4}let l=e.itemSize*o;a===kd&&(l=4*Math.ceil(l/4));const A=Jd(n*l),c=new DataView(new ArrayBuffer(A));let h=0;for(let a=s;a<s+n;a++){for(let s=0;s<e.itemSize;s++){let n;e.itemSize>4?n=e.array[a*e.itemSize+s]:(0===s?n=e.getX(a):1===s?n=e.getY(a):2===s?n=e.getZ(a):3===s&&(n=e.getW(a)),!0===e.normalized&&(n=t.MathUtils.normalize(n,e.array))),i===Dd?c.setFloat32(h,n,!0):i===Td?c.setInt32(h,n,!0):i===Rd?c.setUint32(h,n,!0):i===Qd?c.setInt16(h,n,!0):i===Md?c.setUint16(h,n,!0):i===xd?c.setInt8(h,n):i===Sd&&c.setUint8(h,n),h+=o}h%l!==0&&(h+=l-h%l)}const u={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:A};void 0!==a&&(u.target=a),a===kd&&(u.byteStride=l),this.byteOffset+=A,r.bufferViews.push(u);return{id:r.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise((function(s){const n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){const e=Yd(n.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,s(i.bufferViews.push(a)-1)}}))}processAccessor(e,i,s,n){const a=this.json;let r;if(e.array.constructor===Float32Array)r=Dd;else if(e.array.constructor===Int32Array)r=Td;else if(e.array.constructor===Uint32Array)r=Rd;else if(e.array.constructor===Int16Array)r=Qd;else if(e.array.constructor===Uint16Array)r=Md;else if(e.array.constructor===Int8Array)r=xd;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.LDExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);r=Sd}if(void 0===s&&(s=0),void 0!==n&&n!==1/0||(n=e.count),0===n)return null;const o=function(e,i,s){const n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let a=i;a<i+s;a++)for(let i=0;i<e.itemSize;i++){let s;e.itemSize>4?s=e.array[a*e.itemSize+i]:(0===i?s=e.getX(a):1===i?s=e.getY(a):2===i?s=e.getZ(a):3===i&&(s=e.getW(a)),!0===e.normalized&&(s=t.MathUtils.normalize(s,e.array))),n.min[i]=Math.min(n.min[i],s),n.max[i]=Math.max(n.max[i],s)}return n}(e,s,n);let l;void 0!==i&&(l=e===i.index?Fd:kd);const A=this.processBufferView(e,r,s,n,l),c={bufferView:A.id,byteOffset:A.byteOffset,componentType:r,count:n,max:o.max,min:o.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(c)-1}processImage(e,i,s,n="image/png"){if(null!==e){const a=this,r=a.cache,o=a.json,l=a.options,A=a.pending;r.images.has(e)||r.images.set(e,{});const c=r.images.get(e),h=n+":flipY/"+s.toString();if(void 0!==c[h])return c[h];o.images||(o.images=[]);const u={mimeType:n},d=Xd();d.width=Math.min(e.width,l.maxTextureSize),d.height=Math.min(e.height,l.maxTextureSize);const p=d.getContext("2d");if(!0===s&&(p.translate(0,d.height),p.scale(1,-1)),void 0!==e.data){i!==t.RGBAFormat&&console.error("LDExporter: Only RGBAFormat is supported.",i),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("LDExporter: Image size is bigger than maxTextureSize",e);const s=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<s.length;t+=4)s[t+0]=e.data[t+0],s[t+1]=e.data[t+1],s[t+2]=e.data[t+2],s[t+3]=e.data[t+3];p.putImageData(new ImageData(s,e.width,e.height),0,0)}else{if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("THREE.LDExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");p.drawImage(e,0,0,d.width,d.height)}!0===l.binary?A.push($d(d,n).then((e=>a.processBufferViewImage(e))).then((e=>{u.bufferView=e}))):void 0!==d.toDataURL?u.uri=d.toDataURL(n):A.push($d(d,n).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{u.uri=e})));const g=o.images.push(u)-1;return c[h]=g,g}throw new Error("THREE.LDExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:qd[e.magFilter],minFilter:qd[e.minFilter],wrapS:qd[e.wrapS],wrapT:qd[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const i=this.options,s=this.cache,n=this.json;if(s.textures.has(e))return s.textures.get(e);n.textures||(n.textures=[]),e instanceof t.CompressedTexture&&(e=fd(e,i.maxTextureSize));let a=e.userData.mimeType;"image/webp"===a&&(a="image/png");const r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(r.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,r)}));const o=n.textures.push(r)-1;return s.textures.set(e,o),o}processMaterial(e){const i=this.cache,s=this.json;if(i.materials.has(e))return i.materials.get(e);if(e.isShaderMaterial)return console.warn("LDExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const n={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("LDExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const a=e.color.toArray().concat([e.opacity]);if(Wd(a,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=a),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),i={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(i,t),n.pbrMetallicRoughness.metallicRoughnessTexture=i}if(e.map){const t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),n.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(n.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),n.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),n.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),n.occlusionTexture=t}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===t.DoubleSide&&(n.doubleSided=!0),""!==e.name&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,n)}));const r=s.materials.push(n)-1;return i.materials.set(e,r),r}processMesh(e){const i=this.cache,s=this.json,n=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)n.push(e.material[t].uuid);else n.push(e.material.uuid);const a=n.join(":");if(i.meshes.has(a))return i.meshes.get(a);const r=e.geometry;let o;o=e.isLineSegments?Ed:e.isLineLoop?wd:e.isLine?Bd:e.isPoints?Id:e.material.wireframe?Ed:vd;const l={},A={},c=[],h=[],u={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=r.getAttribute("normal");void 0===d||this.isNormalizedNormalAttribute(d)||(console.warn("THREE.LDExporter: Creating normalized normal attribute from the non-normalized one."),r.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let p=null;for(let e in r.attributes){if("morph"===e.slice(0,5))continue;const s=r.attributes[e];e=u[e]||e.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),i.attributes.has(this.getUID(s))){A[e]=i.attributes.get(this.getUID(s));continue}p=null;const n=s.array;"JOINTS_0"!==e||n instanceof Uint16Array||n instanceof Uint8Array||(console.warn('LDExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new t.BufferAttribute(new Uint16Array(n),s.itemSize,s.normalized));const a=this.processAccessor(p||s,r);null!==a&&(e.startsWith("_")||this.detectMeshQuantization(e,s),A[e]=a,i.attributes.set(this.getUID(s),a))}if(void 0!==d&&r.setAttribute("normal",d),0===Object.keys(A).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const t=[],s=[],n={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let a=0;a<e.morphTargetInfluences.length;++a){const o={};let l=!1;for(const e in r.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("LDExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const t=r.morphAttributes[e][a],s=e.toUpperCase(),n=r.attributes[e];if(i.attributes.has(this.getUID(t,!0))){o[s]=i.attributes.get(this.getUID(t,!0));continue}const A=t.clone();if(!r.morphTargetsRelative)for(let e=0,i=t.count;e<i;e++)for(let i=0;i<t.itemSize;i++)0===i&&A.setX(e,t.getX(e)-n.getX(e)),1===i&&A.setY(e,t.getY(e)-n.getY(e)),2===i&&A.setZ(e,t.getZ(e)-n.getZ(e)),3===i&&A.setW(e,t.getW(e)-n.getW(e));o[s]=this.processAccessor(A,r),i.attributes.set(this.getUID(n,!0),o[s])}h.push(o),t.push(e.morphTargetInfluences[a]),void 0!==e.morphTargetDictionary&&s.push(n[a])}l.weights=t,s.length>0&&(l.extras={},l.extras.targetNames=s)}const g=Array.isArray(e.material);if(g&&0===r.groups.length)return null;let m=!1;if(g&&null===r.index){const e=[];for(let t=0,i=r.attributes.position.count;t<i;t++)e[t]=t;r.setIndex(e),m=!0}const f=g?e.material:[e.material],b=g?r.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,t=b.length;e<t;e++){const t={mode:o,attributes:A};if(this.serializeUserData(r,t),h.length>0&&(t.targets=h),null!==r.index){let s=this.getUID(r.index);void 0===b[e].start&&void 0===b[e].count||(s+=":"+b[e].start+":"+b[e].count),i.attributes.has(s)?t.indices=i.attributes.get(s):(t.indices=this.processAccessor(r.index,r,b[e].start,b[e].count),i.attributes.set(s,t.indices)),null===t.indices&&delete t.indices}const s=this.processMaterial(f[b[e].materialIndex]);null!==s&&(t.material=s),c.push(t)}!0===m&&r.setIndex(null),l.primitives=c,bd.test(e.name)?l.name=e.name.split(" ").slice(0,-1).join(" "):l.name=e.name,s.meshes||(s.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,l)}));const y=s.meshes.push(l)-1;return i.meshes.set(a,y),y}detectMeshQuantization(e,t){if(this.extensionsUsed[zd])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const s=e.split("_",1)[0];yd[s]&&yd[s].includes(i)&&(this.extensionsUsed[zd]=!0,this.extensionsRequired[zd]=!0)}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,n={type:s?"orthographic":"perspective"};return s?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:t.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(n.name=e.type),i.cameras.push(n)-1}processAnimation(e,i){const s=this.json,n=this.nodeMap;s.animations||(s.animations=[]);const a=(e=Cd.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks,r=[],o=[];for(let e=0;e<a.length;++e){const s=a[e],l=t.PropertyBinding.parseTrackName(s.name);let A=t.PropertyBinding.findNode(i,l.nodeName);const c=Vd[l.propertyName];if("bones"===l.objectName&&(A=!0===A.isSkinnedMesh?A.skeleton.getBoneByName(l.objectIndex):void 0),!A||!c)return console.warn('THREE.LDExporter: Could not export animation track "%s".',s.name),null;const h=1;let u,d=s.values.length/s.times.length;c===Vd.morphTargetInfluences&&(d/=A.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(u="CUBICSPLINE",d/=3):u=s.getInterpolation()===t.InterpolateDiscrete?"STEP":"LINEAR",o.push({input:this.processAccessor(new t.BufferAttribute(s.times,h)),output:this.processAccessor(new t.BufferAttribute(s.values,d)),interpolation:u}),r.push({sampler:o.length-1,target:{node:n.get(A),path:c}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:o,channels:r}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,n=i.nodes[s.get(e)],a=e.skeleton;if(void 0===a)return null;const r=e.skeleton.bones[0];if(void 0===r)return null;const o=[],l=new Float32Array(16*a.bones.length),A=new t.Matrix4;for(let t=0;t<a.bones.length;++t)o.push(s.get(a.bones[t])),A.copy(a.boneInverses[t]),A.multiply(e.bindMatrix).toArray(l,16*t);void 0===i.skins&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new t.BufferAttribute(l,16)),joints:o,skeleton:s.get(r)});return n.skin=i.skins.length-1}processNode(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const n={};if(i.trs){const t=e.quaternion.toArray(),i=e.position.toArray(),s=e.scale.toArray();Wd(t,[0,0,0,1])||(n.rotation=t),Wd(i,[0,0,0])||(n.translation=i),Wd(s,[1,1,1])||(n.scale=s)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Wd(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let s=0,n=e.children.length;s<n;s++){const n=e.children[s];if(n.visible||!1===i.onlyVisible){const e=this.processNode(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,n)}));const a=t.nodes.push(n)-1;return s.set(e,a),a}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};""!==e.name&&(s.name=e.name),t.scenes.push(s);const n=[];for(let t=0,s=e.children.length;t<s;t++){const s=e.children[t];if(s.visible||!1===i.onlyVisible){const e=this.processNode(s);null!==e&&n.push(e)}}n.length>0&&(s.nodes=n),this.serializeUserData(e,s)}processObjects(e){const i=new t.Scene;i.name="AuxScene";for(let t=0;t<e.length;t++)i.children.push(e[t]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const s=[];for(let i=0;i<e.length;i++)e[i]instanceof t.Scene?this.processScene(e[i]):s.push(e[i]);s.length>0&&this.processObjects(s);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let t=0;t<i.animations.length;++t)this.processAnimation(i.animations[t],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class ep{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.LDExporter: Only directional, point, and spot lights are supported.",e);const i=this.writer,s=i.json,n=i.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.LDExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.LDExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},n[this.name]=!0);const r=s.extensions[this.name].lights;r.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:r.length-1}}}class tp{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class ip{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class sp{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class np{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){const t={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class ap{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){const t={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}n.attenuationDistance=e.attenuationDistance,n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class rp{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const i=this.writer.extensionsUsed,s={};s.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class op{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(Kd)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.specularIntensityMap){const t={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(t,e.specularIntensityMap),n.specularTexture=t}if(e.specularColorMap){const t={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(t,e.specularColorMap),n.specularColorTexture=t}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class lp{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.sheenRoughnessMap){const t={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Ap{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.anisotropyMap){const t={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(t,e.anisotropyMap),n.anisotropyTexture=t}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class cp{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const i=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class hp{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.bumpMap){const t={index:i.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(t,e.bumpMap),n.bumpTexture=t}n.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class up{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,i){if(!e.isInstancedMesh)return;const s=this.writer,n=e,a=new Float32Array(3*n.count),r=new Float32Array(4*n.count),o=new Float32Array(3*n.count),l=new t.Matrix4,A=new t.Vector3,c=new t.Quaternion,h=new t.Vector3;for(let e=0;e<n.count;e++)n.getMatrixAt(e,l),l.decompose(A,c,h),A.toArray(a,3*e),c.toArray(r,4*e),h.toArray(o,3*e);const u={TRANSLATION:s.processAccessor(new t.BufferAttribute(a,3)),ROTATION:s.processAccessor(new t.BufferAttribute(r,4)),SCALE:s.processAccessor(new t.BufferAttribute(o,3))};n.instanceColor&&(u._COLOR_0=s.processAccessor(n.instanceColor)),i.extensions=i.extensions||{},i.extensions[this.name]={attributes:u},s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0}}Cd.Utils={insertKeyframe:function(e,t){const i=.001,s=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+s),r=e.createInterpolant(new e.ValueBufferType(s));let o;if(0===e.times.length){n[0]=t;for(let e=0;e<s;e++)a[e]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<i)return 0;n[0]=t,n.set(e.times,1),a.set(r.evaluate(t),0),a.set(e.values,s),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<i)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),a.set(e.values,0),a.set(r.evaluate(t),e.values.length),o=n.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<i)return l;if(e.times[l]<t&&e.times[l+1]>t){n.set(e.times.slice(0,l+1),0),n[l+1]=t,n.set(e.times.slice(l+1),l+2),a.set(e.values.slice(0,(l+1)*s),0),a.set(r.evaluate(t),(l+1)*s),a.set(e.values.slice((l+1)*s),(l+2)*s),o=l+1;break}}return e.times=n,e.values=a,o},mergeMorphTargetTracks:function(e,i){const s=[],n={},a=e.tracks;for(let e=0;e<a.length;++e){let r=a[e];const o=t.PropertyBinding.parseTrackName(r.name),l=t.PropertyBinding.findNode(i,o.nodeName);if("morphTargetInfluences"!==o.propertyName||void 0===o.propertyIndex){s.push(r);continue}if(r.createInterpolant!==r.InterpolantFactoryMethodDiscrete&&r.createInterpolant!==r.InterpolantFactoryMethodLinear){if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.LDExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.LDExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),r=r.clone(),r.setInterpolation(t.InterpolateLinear)}const A=l.morphTargetInfluences.length,c=l.morphTargetDictionary[o.propertyIndex];if(void 0===c)throw new Error("THREE.LDExporter: Morph target name not found: "+o.propertyIndex);let h;if(void 0===n[l.uuid]){h=r.clone();const e=new h.ValueBufferType(A*h.times.length);for(let t=0;t<h.times.length;t++)e[t*A+c]=h.values[t];h.name=(o.nodeName||"")+".morphTargetInfluences",h.values=e,n[l.uuid]=h,s.push(h);continue}const u=r.createInterpolant(new r.ValueBufferType(1));h=n[l.uuid];for(let e=0;e<h.times.length;e++)h.values[e*A+c]=u.evaluate(h.times[e]);for(let e=0;e<r.times.length;e++){const t=this.insertKeyframe(h,r.times[e]);h.values[t*A+c]=r.values[e]}}return e.tracks=s,e}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     */
class dp{constructor(e){this.url=e}get unsafeUrl(){return this.url}}function pp(e){return t=new Blob([new Uint8Array(e)]),new dp(URL.createObjectURL(t));var t}const gp=.2;function mp(e){const i=(new t.Box3).setFromObject(e),s=i.getCenter(new t.Vector3),n=i.getSize(new t.Vector3),a=e.worldToLocal(s.clone());return[{position:{x:a.x,y:a.y,z:a.z+n.z/2},rotation:{x:0,y:0,z:0},attraction:gp},{position:{x:a.x,y:a.y,z:a.z-n.z/2},rotation:{x:0,y:Math.PI,z:0},attraction:gp},{position:{x:a.x+n.x/2,y:a.y,z:a.z},rotation:{x:0,y:Math.PI/2,z:0},attraction:gp},{position:{x:a.x-n.x/2,y:a.y,z:a.z},rotation:{x:0,y:-Math.PI/2,z:0},attraction:gp}]}function fp(e,i){const s=new t.Vector3(i.position.x,i.position.y,i.position.z);return e.localToWorld(s)}function bp(e){var t;return e.userData.isSnappedGroup?e:(null===(t=e.parent)||void 0===t?void 0:t.userData.isSnappedGroup)?e.parent:null}function yp(e,t){const{slotMap:i,owner:s,container:n,scene:a,camera:r,onUpdate:o,onCreate:l}=t,A=new Set;e.forEach((e=>{const{name:t,worldPosition:c}=e,h=c.clone();h.project(r);const u=a.width/2,d=a.height/2,p=h.x*u+u,g=-h.y*d+d;if(h.z<1&&p>=-50&&p<=a.width+50&&g>=-50&&g<=a.height+50){A.add(t);let a=i.get(t);a||(a=l(e),n?n.appendChild(a):s.appendChild(a),i.set(t,a)),a.style.display="block",a.style.position="absolute",a.style.left=p-a.offsetWidth/2+"px",a.style.top=g-a.offsetHeight/2+"px",a.style.zIndex="10",o(a,e)}})),i.forEach(((e,t)=>{A.has(t)||(e.style.display="none")}))}function Cp(e,t,i,s,n=null){const a=document.createElement("div");if(a.setAttribute("aria-hidden","true"),s&&i){const e=s.querySelector(`slot[name="${i}"]`);if(e){const t=e.assignedNodes({flatten:!0}).find((e=>{if(e.nodeType!==Node.ELEMENT_NODE)return!1;const t=e;return!("hidden"===t.style.visibility||"none"===t.style.display)}));if(t)return a.innerHTML=t.outerHTML,a;const i=e.innerHTML;if(i&&i.trim())return a.innerHTML=i,a}}return n&&(a.innerHTML=n),a}const Ip=(e=>{var i,s;class n extends e{constructor(){super(...arguments),this.floatingControlsEnabled=!1,this[i]=null,this[s]=null}[(i=Gu,s=Uu,sc)](){var e;super[sc](),this[Gu]=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector('slot[name="floating-control-strip"]')}[Hu](e){this[Uu]=e,this[Nu]()}[zu](){this[Uu]=null,this[Nu]()}[ic](e,t){super[ic](e,t),this.floatingControlsEnabled&&this[Uu]&&this[Nu]()}[ju](e){const t=this[ec].width,i=this[ec].height,s=e.clone().project(this[ec].camera);return{x:(.5*s.x+.5)*t,y:(-.5*s.y+.5)*i}}[Nu](){if(!this[Gu]||!this.floatingControlsEnabled)return void(this[Gu]&&(this[Gu].style.display="none"));if(!this[Uu])return void(this[Gu].style.display="none");const e=(new t.Box3).setFromObject(this[Uu]),i=e.getCenter(new t.Vector3).clone();i.y=e.min.y-.2;const s=this[ju](i);i.clone().project(this[ec].camera).z<1?(this[Gu].style.display="block",this[Gu].style.position="absolute",this[Gu].style.left=`${s.x}px`,this[Gu].style.top=`${s.y}px`,this[Gu].style.transform="translate(-50%, -50%)",this[Gu].style.zIndex="100",this[Gu].style.pointerEvents="auto"):this[Gu].style.display="none",this[tc]()}}return Ou([v({type:Boolean,attribute:"floating-controls-enabled"})],n.prototype,"floatingControlsEnabled",void 0),n})((e=>{class t extends e{constructor(){super(...arguments),this.floorArrowCursor=!1,this.floorDiscCursor=!1,this.floorArrowCursorSize=.5,this.floorDiscCursorSize=.5}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback(),this[ad]&&(this[ad].cleanup(),this[ad]=void 0),this[rd]&&(this[rd].cleanup(),this[rd]=void 0)}updated(e){super.updated(e),(e.has("floorArrowCursor")||e.has("floorArrowCursorSize")||e.has("floorDiscCursor")||e.has("floorDiscCursorSize"))&&this[od]()}getArrowCursorPosition(){return this[ld]()}getDiscCursorPosition(){return this[Ad]()}setArrowCursorVisible(e){this[cd](e)}setDiscCursorVisible(e){this[hd](e)}[ld](){return this[ad]?this[ad].getPosition():null}[Ad](){return this[rd]?this[rd].getPosition():null}[cd](e){this[ad]&&this[ad].setVisible(e)}[hd](e){this[rd]&&this[rd].setVisible(e)}[ud](){let e;try{this[ec].traverse((t=>{if("Target"===t.name)throw e=t,new Error("found target object")}))}catch(e){if("found target object"!==e.message)throw e}return e}[od](){try{const e=this[ec];if(!e)return;this[ad]&&(this[ad].cleanup(),this[ad].parent&&this[ad].parent.remove(this[ad]),this[ad]=void 0),this[rd]&&(this[rd].cleanup(),this[rd].parent&&this[rd].parent.remove(this[rd]),this[rd]=void 0);const t=this[ud]();if(t){if(this.floorArrowCursor){const i=this.floorArrowCursorSize/2;this[ad]=new id(e,t,i),this[ad].setVisible(!0),this[ad].setupMouseTracking(this,(()=>this[tc]()))}if(this.floorDiscCursor){const i=this.floorDiscCursorSize/2;this[rd]=new sd(e,t,i),this[rd].setVisible(!0),this[rd].setupMouseTracking(this,(()=>this[tc]()))}(this.floorArrowCursor||this.floorDiscCursor)&&this[tc]()}}catch(e){console.warn("Error updating placement cursors:",e)}}[ic](e,t){super[ic](e,t),this[ad]&&this[ad].tick(e,t),this[rd]&&this[rd].tick(e,t)}}return nd([v({type:Boolean,attribute:"floor-arrow-cursor"})],t.prototype,"floorArrowCursor",void 0),nd([v({type:Boolean,attribute:"floor-disc-cursor"})],t.prototype,"floorDiscCursor",void 0),nd([v({type:Number,attribute:"floor-arrow-cursor-size"})],t.prototype,"floorArrowCursorSize",void 0),nd([v({type:Number,attribute:"floor-disc-cursor-size"})],t.prototype,"floorDiscCursorSize",void 0),t})((e=>{var i;class s extends e{constructor(){super(...arguments),this.measure=!1,this.measureObjects="",this.measurementUnit="m",this.measurementPrecision=2,this.measurementOverrides="",this.disableMeasurementLines=!1,this[i]=this.shadowRoot.querySelector(".slot.ld-measure"),this._measureWidthElement=null,this._measureHeightElement=null,this._measureDepthElement=null,this._widthElementAnchorIndex=-1,this._heightElementAnchorIndex=-1,this._depthElementAnchorIndex=-1,this._pointerDwn=[0,0],this._pointerUp=[0,0],this._lineGroups=[],this._lastClickedObject=null,this._lastCameraAngle="",this._extensionLineLength=.2,this._modelLoaded=!1}_worldToScreen(e){const t=this[ec].width,i=this[ec].height,s=e.clone().project(this[ec].camera);return{x:(.5*s.x+.5)*t,y:(-.5*s.y+.5)*i}}_updateMarkerVisibility(){if(!this._lineGroups.length||!this._lastCameraAngle.length)return;this._lineGroups.forEach((e=>{e.lines.forEach((e=>{e.visible=!1}))}));const e=[],[t,i,s,n,a,r,o,l,A,c,h,u]=this._lineGroups;switch(this._lastCameraAngle){case"front":e.push(s,h,i),this._widthElementAnchorIndex=2,this._heightElementAnchorIndex=10,this._depthElementAnchorIndex=1;break;case"front-right":e.push(s,r,i),this._widthElementAnchorIndex=2,this._heightElementAnchorIndex=5,this._depthElementAnchorIndex=1;break;case"right":e.push(t,A,i),this._widthElementAnchorIndex=0,this._heightElementAnchorIndex=8,this._depthElementAnchorIndex=1;break;case"back-right":e.push(t,u,i),this._widthElementAnchorIndex=0,this._heightElementAnchorIndex=11,this._depthElementAnchorIndex=1;break;case"back":e.push(t,o,n),this._widthElementAnchorIndex=0,this._heightElementAnchorIndex=6,this._depthElementAnchorIndex=3;break;case"back-left":e.push(t,c,n),this._widthElementAnchorIndex=0,this._heightElementAnchorIndex=9,this._depthElementAnchorIndex=3;break;case"left":e.push(s,a,n),this._widthElementAnchorIndex=2,this._heightElementAnchorIndex=4,this._depthElementAnchorIndex=3;break;case"front-left":e.push(s,l,n),this._widthElementAnchorIndex=2,this._heightElementAnchorIndex=7,this._depthElementAnchorIndex=3}this.disableMeasurementLines||e.forEach((e=>{e.lines.forEach((e=>{e.visible=!0}))})),this._updateMarkerPosition(),this[tc]()}_parseMeasurementOverrides(){return this.measurementOverrides?this.measurementOverrides.split(",").map((e=>{const[t,i,s]=e.trim().split(" ").map(Number);return{w:t,h:i,d:s}})).filter((e=>e.w&&e.h&&e.d)):[]}_parseMeasureObjects(){return this.measureObjects.split(",").map((e=>e.trim())).filter((e=>e.length>0))}_updateMarkerText(e,i){if(!this._measureWidthElement||!this._measureHeightElement||!this._measureDepthElement)return;const s=this[ec],n=this.measurementUnit,a=this.measurementPrecision,r=this._parseMeasurementOverrides(),o=this._parseMeasureObjects();const[l,A,c]=function(){const n=e.getSize(new t.Vector3);if(r.length&&!o.length&&i===s)return[r[0].w,r[0].h,r[0].d];if(r.length&&"*"!==o[0]&&1==o.length)return[r[0].w,r[0].h,r[0].d];if(r.length&&o.length){const e=o.indexOf(i.name);if(-1!==e&&r[e])return[r[e].w,r[e].h,r[e].d]}return[n.x,n.y,n.z]}();let h=null;h=Ku(l,n,a),this._measureWidthElement.textContent=`${h} ${n}`,this._measureWidthElement.style.display="block",this._measureWidthElement.setAttribute("aria-label",`Width: ${h} ${n}`),h=Ku(A,n,a),this._measureHeightElement.textContent=`${h} ${n}`,this._measureHeightElement.style.display="block",this._measureHeightElement.setAttribute("aria-label",`Height: ${h} ${n}`),h=Ku(c,n,a),this._measureDepthElement.textContent=`${h} ${n}`,this._measureDepthElement.style.display="block",this._measureDepthElement.setAttribute("aria-label",`Depth: ${h} ${n}`)}_updateMarkerPosition(){var e,i,s,n,a,r,o,l,A;if(-1===this._widthElementAnchorIndex||-1===this._heightElementAnchorIndex||-1===this._depthElementAnchorIndex)return;if(!this._lineGroups.length)return;const c=this[ec].width;if(-1!==this._widthElementAnchorIndex&&this._measureWidthElement){const s=this._lineGroups[this._widthElementAnchorIndex].lines[0],n=new t.Vector3;s.geometry.computeBoundingBox(),null===(e=s.geometry.boundingBox)||void 0===e||e.getCenter(n),s.localToWorld(n);const a=this._worldToScreen(n),r=this._measureWidthElement.offsetWidth/2;a.x=Math.max(r,Math.min(a.x,c-r)),null===(i=this._measureWidthElement)||void 0===i||i.setAttribute("style",`left: ${a.x}px; top: ${a.y}px; transform: translate(-50%, -50%);`)}else null===(s=this._measureWidthElement)||void 0===s||s.setAttribute("style","display: none;");if(-1!==this._heightElementAnchorIndex&&this._measureHeightElement){const e=this._lineGroups[this._heightElementAnchorIndex].lines[0],i=new t.Vector3;e.geometry.computeBoundingBox(),null===(n=e.geometry.boundingBox)||void 0===n||n.getCenter(i),e.localToWorld(i);const s=this._worldToScreen(i),r=this._measureHeightElement.offsetWidth/2;s.x=Math.max(r,Math.min(s.x,c-r)),null===(a=this._measureHeightElement)||void 0===a||a.setAttribute("style",`left: ${s.x}px; top: ${s.y}px; transform: translate(-50%, -50%);`)}else null===(r=this._measureHeightElement)||void 0===r||r.setAttribute("style","display: none;");if(-1!==this._depthElementAnchorIndex&&this._measureDepthElement){const e=this._lineGroups[this._depthElementAnchorIndex].lines[0],i=new t.Vector3;e.geometry.computeBoundingBox(),null===(o=e.geometry.boundingBox)||void 0===o||o.getCenter(i),e.localToWorld(i);const s=this._worldToScreen(i),n=this._measureDepthElement.offsetWidth/2;s.x=Math.max(n,Math.min(s.x,c-n)),null===(l=this._measureDepthElement)||void 0===l||l.setAttribute("style",`left: ${s.x}px; top: ${s.y}px; transform: translate(-50%, -50%);`)}else null===(A=this._measureDepthElement)||void 0===A||A.setAttribute("style","display: none;")}_getBoundingBox(e,i){const s=new t.Box3,n=this._parseMeasureObjects();if(0===n.length)return e.boundingBox;if(!n.includes("*")){let e=i;for(;e&&e.parent;){if(n.includes(e.name))return s.setFromObject(e),s;e=e.parent}return s}return s.expandByObject(i),s}_setExtensionLineLength(){const e=this[ec],i=new t.Vector3;e.boundingBox.getSize(i);const s=Math.min(i.x,i.y,i.z);this._extensionLineLength=s/10}_clearMeasurements(e=!1){e&&(this._lastClickedObject=null);const t=this[ec];try{t.traverse((e=>{var t;if("ld-measurements"===e.name)throw null===(t=e.parent)||void 0===t||t.remove(e),new Error("Line parent found and removed")}))}catch(e){if("Line parent found and removed"!==e.message)throw e}this._lineGroups=[],this._measureWidthElement&&(this._measureWidthElement.style.display="none"),this._measureHeightElement&&(this._measureHeightElement.style.display="none"),this._measureDepthElement&&(this._measureDepthElement.style.display="none"),this[tc]()}_getEdgeGroups(e,t,i,s){const n=e.map((e=>e.clone().applyMatrix4(s.matrixWorld)));return[[[n[0].clone().setZ(n[0].z-t-i),n[1].clone().setZ(n[1].z-t-i)],[n[0].clone().setZ(n[0].z-i),n[0].clone().setZ(n[0].z-t-i)],[n[1].clone().setZ(n[1].z-i),n[1].clone().setZ(n[1].z-t-i)]],[[n[1].clone().setX(n[1].x+t+i),n[5].clone().setX(n[5].x+t+i)],[n[1].clone().setX(n[1].x+i),n[1].clone().setX(n[1].x+t+i)],[n[5].clone().setX(n[5].x+i),n[5].clone().setX(n[5].x+t+i)]],[[n[4].clone().setZ(n[4].z+t+i),n[5].clone().setZ(n[5].z+t+i)],[n[4].clone().setZ(n[4].z+i),n[4].clone().setZ(n[4].z+t+i)],[n[5].clone().setZ(n[5].z+i),n[5].clone().setZ(n[5].z+t+i)]],[[n[0].clone().setX(n[0].x-t-i),n[4].clone().setX(n[4].x-t-i)],[n[0].clone().setX(n[0].x-i),n[0].clone().setX(n[0].x-t-i)],[n[4].clone().setX(n[4].x-i),n[4].clone().setX(n[4].x-t-i)]],[[n[0].clone().setZ(n[0].z-t-i),n[3].clone().setZ(n[3].z-t-i)],[n[0].clone().setZ(n[0].z-i),n[0].clone().setZ(n[0].z-t-i)],[n[3].clone().setZ(n[3].z-i),n[3].clone().setZ(n[3].z-t-i)]],[[n[1].clone().setZ(n[1].z-t-i),n[2].clone().setZ(n[2].z-t-i)],[n[1].clone().setZ(n[1].z-i),n[1].clone().setZ(n[1].z-t-i)],[n[2].clone().setZ(n[2].z-i),n[2].clone().setZ(n[2].z-t-i)]],[[n[1].clone().setX(n[1].x+t+i),n[2].clone().setX(n[2].x+t+i)],[n[1].clone().setX(n[1].x+i),n[1].clone().setX(n[1].x+t+i)],[n[2].clone().setX(n[2].x+i),n[2].clone().setX(n[2].x+t+i)]],[[n[5].clone().setX(n[5].x+t+i),n[6].clone().setX(n[6].x+t+i)],[n[5].clone().setX(n[5].x+i),n[5].clone().setX(n[5].x+t+i)],[n[6].clone().setX(n[6].x+i),n[6].clone().setX(n[6].x+t+i)]],[[n[5].clone().setZ(n[5].z+t+i),n[6].clone().setZ(n[6].z+t+i)],[n[5].clone().setZ(n[5].z+i),n[5].clone().setZ(n[5].z+t+i)],[n[6].clone().setZ(n[6].z+i),n[6].clone().setZ(n[6].z+t+i)]],[[n[4].clone().setZ(n[4].z+t+i),n[7].clone().setZ(n[7].z+t+i)],[n[4].clone().setZ(n[4].z+i),n[4].clone().setZ(n[4].z+t+i)],[n[7].clone().setZ(n[7].z+i),n[7].clone().setZ(n[7].z+t+i)]],[[n[4].clone().setX(n[4].x-t-i),n[7].clone().setX(n[7].x-t-i)],[n[4].clone().setX(n[4].x-i),n[4].clone().setX(n[4].x-t-i)],[n[7].clone().setX(n[7].x-i),n[7].clone().setX(n[7].x-t-i)]],[[n[0].clone().setX(n[0].x-t-i),n[3].clone().setX(n[3].x-t-i)],[n[0].clone().setX(n[0].x-i),n[0].clone().setX(n[0].x-t-i)],[n[3].clone().setX(n[3].x-i),n[3].clone().setX(n[3].x-t-i)]]]}_measureObject(e,i){this[va];const s=this[ec];if(!i&&e===this._lastClickedObject)return;this._lastClickedObject=e,this._clearMeasurements();const n=this._getBoundingBox(s,e);if(n.min.equals(new t.Vector3(1/0,1/0,1/0))||n.max.equals(new t.Vector3(-1/0,-1/0,-1/0)))return void console.warn("Bounding box is empty.");const a=n.min.clone(),r=n.max.clone(),o=[new t.Vector3(a.x,a.y,a.z),new t.Vector3(r.x,a.y,a.z),new t.Vector3(r.x,r.y,a.z),new t.Vector3(a.x,r.y,a.z),new t.Vector3(a.x,a.y,r.z),new t.Vector3(r.x,a.y,r.z),new t.Vector3(r.x,r.y,r.z),new t.Vector3(a.x,r.y,r.z)].map((t=>e.worldToLocal(t.clone()))),l=new t.LineBasicMaterial({color:0});l.transparent=!0,l.opacity=.75,l.depthTest=!1;const A=this._extensionLineLength,c=A/2,h=this._getEdgeGroups(o,A,c,e),u=new t.Object3D;u.name="ld-measurements";const d=(new t.Matrix4).copy(e.matrixWorld).invert();if(u.applyMatrix4(d),e===s){let e;try{s.traverse((t=>{if("Target"===t.name)throw e=t,new Error("found target object")}))}catch(e){if("found target object"!==e.message)throw e}e?e.add(u):(console.warn("Target object not found in the scene."),s.add(u))}else e.add(u);h.forEach((e=>{const i=[];e.forEach((e=>{const s=(new t.BufferGeometry).setFromPoints(e),n=new t.LineSegments(s,l);n.userData.noHit=!0,n.renderOrder=9999,n.visible=!1,u.add(n),i.push(n)})),this._lineGroups.push({lines:i})})),this._updateMarkerVisibility(),this._updateMarkerText(n,e)}_measureScene(){const e=this[ec];this._measureObject(e,!0)}objectFromPoint(e,t){const i=this[ec],s=i.getNDC(e,t),n=i.hitFromPoint(s);return(null==n?void 0:n.object)||null}_measureModelAtPoint(e,t){const i=this.objectFromPoint(e,t);i&&this._measureObject(i)}_handleCameraChange(){const{theta:e,phi:t}=this.getCameraOrbit(),i=(8+Math.floor((e%Ju+Yu/2)/(Xu/2)))%8,s=Wu[i];this._lastCameraAngle!==s&&(this._lastCameraAngle=s,this._updateMarkerVisibility()),this._updateMarkerPosition()}_findObjectByName(e){const t=this[ec];let i=null;try{t.traverse((t=>{if(t.name===e)throw i=t,new Error("Object found")}))}catch(e){if("Object found"!==e.message)throw e}return i}_handleClick(e){const{_pointerDwn:t,_pointerUp:i}=this;if(Math.hypot(i[0]-t[0],i[1]-t[1])>4)return;const s=this._parseMeasureObjects();this.measure&&s.length>0&&this._measureModelAtPoint(e.clientX,e.clientY)}_handleProgress(e){const t=e.detail.totalProgress,i=e.detail.reason;this._modelLoaded&&"model-load"===i&&t<1&&(this._modelLoaded=!1)}_handleLoad(){this._modelLoaded=!0,this._setExtensionLineLength(),this.handleNewAttributes()}handleNewAttributes(e=!1){this._clearMeasurements(e);if(!!this.measure){this._handleCameraChange();const e=this._parseMeasureObjects();if(this._lastClickedObject)this._measureObject(this._lastClickedObject,!0);else if(e.length){if(1==e.length){const t=this._findObjectByName(e[0]);t&&this._measureObject(t)}}else this._measureScene()}}updated(e){super.updated(e),this._modelLoaded&&(e.has("measure")||e.has("measureObjects")?this.handleNewAttributes(!0):(e.has("disableMeasurementLines")||e.has("measurementUnit")||e.has("measurementPrecision")||e.has("measurementOverrides"))&&this.measure&&this.handleNewAttributes())}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this._handleCameraChange),this.addEventListener("load",this._handleLoad),this.addEventListener("progress",this._handleProgress);const e=this.shadowRoot;if(e){const t=e.querySelector('slot[name="ruler-width"]'),i=e.querySelector('slot[name="ruler-height"]'),s=e.querySelector('slot[name="ruler-depth"]');if(t){const e=t.assignedNodes({flatten:!0});this._measureWidthElement=e.find((e=>e.nodeType===Node.ELEMENT_NODE))}if(i){const e=i.assignedNodes({flatten:!0});this._measureHeightElement=e.find((e=>e.nodeType===Node.ELEMENT_NODE))}if(s){const e=s.assignedNodes({flatten:!0});this._measureDepthElement=e.find((e=>e.nodeType===Node.ELEMENT_NODE))}}}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this._handleCameraChange),this.removeEventListener("load",this._handleLoad),this.removeEventListener("progress",this._handleProgress),this._measureWidthElement=null,this._measureHeightElement=null,this._measureDepthElement=null}[(i=Zu,sc)](){super[sc](),this.addEventListener("pointerdown",(e=>{this._pointerDwn=[e.offsetX,e.offsetY]})),this.addEventListener("pointerup",(e=>{this._pointerUp=[e.offsetX,e.offsetY]})),this.addEventListener("click",this._handleClick)}}return $u([v({type:Boolean,attribute:"measure"})],s.prototype,"measure",void 0),$u([v({type:String,attribute:"measure-objects"})],s.prototype,"measureObjects",void 0),$u([v({type:String,attribute:"measurement-unit"})],s.prototype,"measurementUnit",void 0),$u([v({type:String,attribute:"measurement-precision"})],s.prototype,"measurementPrecision",void 0),$u([v({type:String,attribute:"measurement-overrides"})],s.prototype,"measurementOverrides",void 0),$u([v({type:Boolean,attribute:"disable-measurement-lines"})],s.prototype,"disableMeasurementLines",void 0),s})((e=>{return class extends e{constructor(){super(...arguments),this.addedGLBs=new Set,this._modelLoaded=!1,this.selectedObjects=[],this.selectedGroups=new Set,this.isDragging=!1,this.dragStartPosition=new t.Vector3,this.dragStartMousePosition=new t.Vector2,this.dragOffset=new t.Vector3,this.currentMousePosition=new t.Vector2,this.floorPlane=new t.Plane(new t.Vector3(0,1,0),0),this.raycaster=new t.Raycaster,this.lastClickTime=0,this.lastClickPosition=new t.Vector2,this.outlineEffect=null,this.snappingPointSpheres=new Set,this.snappingEnabled=!0,this.pendingSnapConnection=null,this.snappingPointSlots=new Map,this.snappingPointsVisible=!1,this.breakLinkSlots=new Map,this.breakLinkSlotsVisible=!1,this.rotationSlots=new Map,this.rotationSlotsVisible=!1,this.originalSensitivities={orbit:1,zoom:1,pan:1,input:1}}updateSnappingPointSlots(){var e;if(!this.snappingPointsVisible)return void this.snappingPointSlots.forEach((e=>{e.style.display="none"}));const i=this[ec],s=i.getCamera();if(!s)return;const n=[],a=this.findTargetObject();a&&a.traverse((e=>{if(e.userData.isPlacedObject&&e.userData.snappingPoints){e.userData.snappingPoints.forEach(((i,a)=>{if(i.isUsed)return;const r=new t.Vector3(i.position.x,i.position.y,i.position.z),o=e.localToWorld(r.clone()),l=new t.Euler(i.rotation.x,i.rotation.y,i.rotation.z),A=new t.Vector3(0,0,1).applyEuler(l).clone().transformDirection(e.matrixWorld),c=(new t.Vector3).copy(s.position).sub(o).dot(A)>0;n.push({name:`${e.uuid}_${a}`,worldPosition:o,isFacingCamera:c})}))}})),yp(n,{slotMap:this.snappingPointSlots,owner:this,container:null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".slot.ld-puzzler"),scene:i,camera:s,onCreate:e=>Cp(0,0,"snapping-point",this.shadowRoot,null),onUpdate:(e,t)=>{t.isFacingCamera?e.classList.remove("back-facing"):e.classList.add("back-facing")}})}setSnappingPointSlotsVisible(e){this.snappingPointsVisible=e,this.updateSnappingPointSlots()}clearSnappingPointSlots(){this.clearSlots(this.snappingPointSlots)}updateBreakLinkSlots(){var e;if(!this.breakLinkSlotsVisible||0===this.selectedObjects.length)return void this.breakLinkSlots.forEach((e=>{e.style.display="none"}));const i=this[ec],s=i.getCamera();if(!s)return;const n=this.selectedObjects[0];if(!n.userData.isSnappedGroup||!n.userData.snapConnections)return void this.breakLinkSlots.forEach((e=>{e.style.display="none"}));yp(n.userData.snapConnections.map(((e,i)=>{const s=`connection-${i}`;if(!e.object1||!e.object2)return null;const n=fp(e.object1,e.snapPoint1),a=fp(e.object2,e.snapPoint2);return{name:s,worldPosition:(new t.Vector3).addVectors(n,a).multiplyScalar(.5),data:{connectionId:s}}})).filter((e=>null!==e)),{slotMap:this.breakLinkSlots,owner:this,container:null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".slot.ld-puzzler"),scene:i,camera:s,onCreate:e=>{const t=Cp(0,0,"break-link",this.shadowRoot,null);return t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),this.breakSpecificConnection(e.data.connectionId)})),t},onUpdate:(e,t)=>{e.style.zIndex="20"}})}setBreakLinkSlotsVisible(e){this.breakLinkSlotsVisible=e,this.updateBreakLinkSlots()}clearBreakLinkSlots(){this.clearSlots(this.breakLinkSlots)}breakSpecificConnection(e){if(1!==this.selectedObjects.length)return;const t=this.selectedObjects[0];if(!t.userData.isSnappedGroup||!t.userData.snapConnections)return;const i=parseInt(e.replace("connection-","")),s=t.userData.snapConnections;if(i<0||i>=s.length)return;const n=s[i];n.snapPoint1&&(n.snapPoint1.isUsed=!1),n.snapPoint2&&(n.snapPoint2.isUsed=!1),s.splice(i,1),this.clearBreakLinkSlots(),this.setBreakLinkSlotsVisible(!1),0!==s.length?(this.reorganizeGroupAfterBreakLink(t,n),this[tc]()):this.ungroupSelectedObject()}reorganizeGroupAfterBreakLink(e,i){const s=this.findTargetObject();if(!s)return;const n=e.userData.snapConnections,a=[];n.forEach((e=>{const t=e.object1,i=e.object2;let s=a.find((e=>e.has(t))),n=a.find((e=>e.has(i)));if(s&&n&&s!==n){n.forEach((e=>s.add(e)));const e=a.indexOf(n);a.splice(e,1)}else if(s)s.add(i);else if(n)n.add(t);else{const e=new Set([t,i]);a.push(e)}}));const r=[...e.children],o=new Map;if(r.forEach((e=>{const i=new t.Vector3,s=new t.Quaternion,n=new t.Vector3;e.getWorldPosition(i),e.getWorldQuaternion(s),e.getWorldScale(n),o.set(e,{position:i,quaternion:s,scale:n})})),r.forEach((e=>{if(!a.some((t=>t.has(e)))){const t=new Set([e]);a.push(t)}})),r.forEach((t=>e.remove(t))),e.parent&&e.parent.remove(e),this.selectedObjects=[],1===a.length){const e=new t.Group;e.name=`SnappedGroup_${Date.now()}`,e.userData.isSnappedGroup=!0,s.add(e),a[0].forEach((t=>{const i=o.get(t);if(i){e.add(t);const s=i.position.clone();e.worldToLocal(s),t.position.copy(s),t.quaternion.copy(i.quaternion),t.scale.copy(i.scale)}else e.add(t)})),e.userData.snapConnections=[...n],e.userData.isPlacedObject=!0,e.userData.meshes=[],e.traverse((t=>{"Mesh"===t.type&&"SnappingPointSphere"!==t.name&&e.userData.meshes.push(t)})),this.selectObject(e)}else if(a.length>1){let e=null;a.forEach((i=>{if(i.size>1){const a=new t.Group;a.name=`SnappedGroup_${Date.now()}`,a.userData.isSnappedGroup=!0,s.add(a),i.forEach((e=>{const t=o.get(e);if(t){a.add(e);const i=t.position.clone();a.worldToLocal(i),e.position.copy(i),e.quaternion.copy(t.quaternion),e.scale.copy(t.scale)}else a.add(e)}));const r=n.filter((e=>i.has(e.object1)&&i.has(e.object2)));a.userData.snapConnections=r,a.userData.isPlacedObject=!0,a.userData.meshes=[],a.traverse((e=>{"Mesh"===e.type&&"SnappingPointSphere"!==e.name&&a.userData.meshes.push(e)})),e||(e=a)}else{const t=i.values().next().value,n=o.get(t);if(n){s.add(t);const e=n.position.clone();s.worldToLocal(e),t.position.copy(e),t.quaternion.copy(n.quaternion),t.scale.copy(n.scale)}else s.add(t);t.userData.isPlacedObject=!0,delete t.userData.isInGroup,t.userData.meshes=[],t.traverse((e=>{"Mesh"===e.type&&"SnappingPointSphere"!==e.name&&t.userData.meshes.push(e)})),t.userData.snappingPoints=mp(t),e||(e=t)}})),e&&this.selectObject(e)}else r.forEach((e=>{const t=o.get(e);if(t){s.add(e);const i=t.position.clone();s.worldToLocal(i),e.position.copy(i),e.quaternion.copy(t.quaternion),e.scale.copy(t.scale)}else s.add(e);e.userData.isPlacedObject=!0,delete e.userData.isInGroup,e.userData.meshes=[],e.traverse((t=>{"Mesh"===t.type&&"SnappingPointSphere"!==t.name&&e.userData.meshes.push(t)})),e.userData.snappingPoints=mp(e)})),r.length>0&&this.selectObject(r[0]);setTimeout((()=>{this.setSnappingPointSlotsVisible(!0),this.updateSnappingPointSlots(),this.selectedObjects.length>0&&this.selectedObjects[0].userData.isSnappedGroup?(this.setBreakLinkSlotsVisible(!0),this.updateBreakLinkSlots()):this.setBreakLinkSlotsVisible(!1),this.dispatchEvent(new CustomEvent("render"))}),10)}updateShadowsWithGLBs(){if(this[ec].boundingBox&&this.addedGLBs.size>0){void 0===this.originalFloorY&&(this.originalFloorY=this[ec].boundingBox.min.y);const e=this[ec].boundingBox.clone();this.addedGLBs.forEach((t=>{e.expandByObject(t)})),e.min.y=this.originalFloorY,this[ec].boundingBox.copy(e),this[ec].boundingBox.getSize(this[ec].size),this[ec].updateShadow()}}async setSrcFromBuffer(e){try{const t=pp(e);this.setAttribute("src",t.url)}catch(e){console.error(e)}}_handleProgress(e){const t=e.detail.totalProgress,i=e.detail.reason;this._modelLoaded&&"model-load"===i&&t<1&&(this._modelLoaded=!1)}_handleLoad(){this._modelLoaded=!0}setupOutlineSystem(){this.outlineEffect=this.querySelector("outline-effect"),this.outlineEffect||console.warn("ld-puzzler: No outline-effect element found. Outline functionality will be disabled. Please add <outline-effect> inside your <model-viewer> element.")}updateOutlineSelection(){if(this.outlineEffect||this.setupOutlineSystem(),this.outlineEffect){if(this.selectedObjects.length>0){const e=this.collectMeshesFromObjects(this.selectedObjects);this.outlineEffect.selection=e,this.outlineEffect.setAttribute("blend-mode","default")}else this.outlineEffect.setAttribute("blend-mode","skip"),this.outlineEffect.selection=[];this[tc]()}}collectMeshesFromObjects(e){const t=[];return e.forEach((e=>{if("Mesh"!==e.type||this.isSnappingPointMesh(e)){if("Group"===e.type||e.userData.isSnappedGroup)if(e.userData.meshes&&Array.isArray(e.userData.meshes)){const i=e.userData.meshes.filter((e=>!this.isSnappingPointMesh(e)));t.push(...i)}else e.traverse((e=>{"Mesh"!==e.type||this.isSnappingPointMesh(e)||t.push(e)}))}else t.push(e)})),t}isSnappingPointMesh(e){if("SnappingPointSphere"===e.name)return!0;let t=e.parent;for(;t;){if("SnappingPointSphere"===t.name)return!0;t=t.parent}return!1}selectObjects(e){this.deselectObject(),this.selectedObjects=[...e],e.forEach((e=>{"Group"===e.type&&this.selectedGroups.add(e)})),this.updateOutlineSelection(),this[va]&&(this[va].enablePan=!1),this[tc]()}findTargetObject(){let e;try{this[ec].traverse((t=>{if("Target"===t.name)throw e=t,new Error("found target object")}))}catch(e){if("found target object"!==e.message)throw e}return e}positionModelAtFloor(e,i=0){if(!this[ec]||!this[ec].boundingBox)return;void 0===this.originalFloorY&&(this.originalFloorY=this[ec].boundingBox.min.y);const s=(new t.Box3).setFromObject(e),n=this.originalFloorY-s.min.y+i;e.position.y+=n}removeObject3D(e){return e instanceof t.Object3D&&(e.geometry&&e.geometry.dispose(),e.material&&(e.material instanceof Array?e.material.forEach((e=>e.dispose())):e.material.dispose()),e.removeFromParent(),!0)}deleteObject(e){try{this.deselectObject(),e.userData.isPlacedObject&&this.addedGLBs.delete(e),this.removeObject3D(e),this[ec].updateShadow(),this[tc]()}catch(e){console.error("Error deleting object:",e)}}deleteObjectByFileName(e){try{this[ec].traverse((t=>{var i;if((null===(i=t.userData)||void 0===i?void 0:i.filename)===e)throw this.deleteObject(t),new Error("Object deleted")}))}catch(e){if("Object deleted"!==e.message)throw e}}deleteSelected(){0!==this.selectedObjects.length&&this.selectedObjects.forEach((e=>{this.deleteObject(e)}))}async rotateSelected(e){if(0===this.selectedObjects.length)return;const i=this.selectedObjects[0];this.rotateObject(t.MathUtils.degToRad(e),i)}async placeGLB(e,i={}){var s;this.deselectObject();const n=new je,a=this.findTargetObject(),r=this.createVisualizationBox({x:1,y:1,z:1},null!==(s=i.position)&&void 0!==s?s:{x:0,y:0,z:0});return a.add(r),new Promise(((s,r)=>{n.load(e,(t=>{const n=i.name||`part__${Math.random().toString(36).substring(2,9)}`;t.scene.name="part__"+n,t.scene.userData.filepath=e,t.scene.userData.name=n;const o=this.parseNameMetadata(n);t.scene.userData=Object.assign(Object.assign({},t.scene.userData),{isPlacedObject:!0,groupId:o.groupId,tags:o.tags,instanceId:o.instanceId,placedAt:Date.now()}),i.snappingPoints&&i.snappingPoints.length>0?t.scene.userData.snappingPoints=i.snappingPoints:t.scene.userData.needsDefaultSnappingPoints=!0;const l=[];if(t.scene.traverse((e=>{"Mesh"===e.type&&l.push(e)})),t.scene.userData.meshes=l,a){let e;if(i.position){void 0===this.originalFloorY&&(this.originalFloorY=this[ec].boundingBox?this[ec].boundingBox.min.y:0);const t=this.originalFloorY,s=i.floorOffset||0;e={x:i.position.x,y:t+s,z:i.position.z}}else this.positionModelAtFloor(t.scene,i.floorOffset||0),e={x:t.scene.position.x,y:t.scene.position.y,z:t.scene.position.z};const n=e.y+.5;t.scene.position.set(e.x,n,e.z),a.add(t.scene),this.addedGLBs.add(t.scene),this.outlineEffect||this.setupOutlineSystem(),this.updateShadowsWithGLBs(),this[tc]();const r=i.mass||1;((e,t,i,s=1,n,a)=>{const r=Math.abs(t-i);if(r<=.001)return e.position.y=i,n(),void(a&&a());const o=1e3*Math.sqrt(2*r/10),l=Math.max(.7,Math.min(1.3,1/Math.sqrt(s))),A=Math.max(200,Math.min(1e3,o*l)),c=performance.now(),h=s=>{const o=s-c,l=Math.min(o/A,1),u=l*l,d=t>i?t-r*u:t+r*u;e.position.y=t>i?Math.max(d,i):Math.min(d,i),n(),l<1?requestAnimationFrame(h):(e.position.y=i,n(),a&&a())};requestAnimationFrame(h)})(t.scene,n,e.y,r,(()=>{this.updateShadowsWithGLBs(),this[tc]()}),(()=>{t.scene.userData.needsDefaultSnappingPoints&&(t.scene.userData.snappingPoints=mp(t.scene),delete t.scene.userData.needsDefaultSnappingPoints),this.updateShadowsWithGLBs(),this[tc]()})),s()}else r()}),(e=>{if(e.loaded===e.total){const e=a.children.find((e=>"VisualizationBox"===e.name));e&&e instanceof t.Mesh&&this.fadeOutVisualizationBox(e,300,(()=>{a.remove(e)}))}}),(e=>{console.error("Error loading GLB:",e),r(e)}))}))}deDraco(e){return new Promise((t=>{const i=new je,s=new Ge;s.setDecoderPath("https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/libs/draco/"),i.setDRACOLoader(s),i.parse(e,"",(i=>{if(i.scene){i.scene.traverse((e=>{e.userData.name&&(e.name=e.userData.name)}));(new Cd).parse(i.scene.children,(e=>{t(e)}),(function(e){console.error(e)}),{binary:!0})}else t(e)}),(e=>{console.error(e)}))}))}hideCustomSnappingPointSlots(){this.querySelectorAll('[slot="snapping-point"]').forEach((e=>{const t=e;t.dataset.originalDisplay=t.style.display||"",t.style.visibility="hidden",t.style.position="absolute",t.style.left="-9999px"}))}setupDragHandlers(){this.addEventListener("mousedown",this.onMouseDown.bind(this)),this.addEventListener("mousemove",this.onMouseMove.bind(this)),this.addEventListener("mouseup",this.onMouseUp.bind(this)),this.addEventListener("touchstart",this.onTouchStart.bind(this)),this.addEventListener("touchmove",this.onTouchMove.bind(this)),this.addEventListener("touchend",this.onTouchEnd.bind(this)),this.addEventListener("contextmenu",(e=>e.preventDefault()))}onMouseDown(e){if(0!==e.button)return;if(this.updateMousePosition(e),this.lastClickTime=performance.now(),this.lastClickPosition.copy(this.currentMousePosition),this.selectedObjects.length){if(this.selectedObjects.some((e=>this.isPointOnObject(this.currentMousePosition,e))))return e.stopImmediatePropagation(),e.preventDefault(),void this.startDragging(e)}this.getPartObjectAtPosition(this.currentMousePosition)&&(e.stopImmediatePropagation(),e.preventDefault())}onMouseMove(e){this.updateMousePosition(e),this.isDragging&&this.selectedObjects.length&&this.updateDragPosition()}onMouseUp(e){if(this.isDragging)this.stopDragging();else{const t=performance.now()-this.lastClickTime,i=this.currentMousePosition.distanceTo(this.lastClickPosition);if(t<300&&i<5){this.getPartObjectAtPosition(this.currentMousePosition)?this.handleSelection(e):this.deselectObject()}}}onTouchStart(e){if(1===e.touches.length){const t=e.touches[0];if(this.updateMousePositionFromTouch(t),this.lastClickTime=performance.now(),this.lastClickPosition.copy(this.currentMousePosition),this.selectedObjects.length){if(this.selectedObjects.some((e=>this.isPointOnObject(this.currentMousePosition,e))))return e.stopImmediatePropagation(),e.preventDefault(),void this.startDragging()}this.getPartObjectAtPosition(this.currentMousePosition)&&(e.stopImmediatePropagation(),e.preventDefault())}}onTouchMove(e){if(1===e.touches.length&&this.isDragging){const t=e.touches[0];this.updateMousePositionFromTouch(t),this.updateDragPosition(),e.preventDefault()}}onTouchEnd(e){if(this.isDragging)this.stopDragging();else if(1===e.changedTouches.length){const t=e.changedTouches[0];this.updateMousePositionFromTouch(t);const i=performance.now()-this.lastClickTime,s=this.currentMousePosition.distanceTo(this.lastClickPosition);i<300&&s<5&&this.handleSelection()}}updateMousePosition(e){const t=this.getBoundingClientRect();this.currentMousePosition.x=(e.clientX-t.left)/t.width*2-1,this.currentMousePosition.y=-(e.clientY-t.top)/t.height*2+1}updateMousePositionFromTouch(e){const t=this.getBoundingClientRect();this.currentMousePosition.x=(e.clientX-t.left)/t.width*2-1,this.currentMousePosition.y=-(e.clientY-t.top)/t.height*2+1}isPointOnObject(e,t){this.raycaster.setFromCamera(e,this[ec].camera);return this.raycaster.intersectObject(t,!0).length>0}getPartObjectAtPosition(e){this.raycaster.setFromCamera(e,this[ec].camera);const t=this.findTargetObject();if(!t)return null;const i=[];t.traverse((e=>{e.name&&e.name.startsWith("part__")&&i.push(e)}));const s=this.raycaster.intersectObjects(i,!0);if(s.length>0){let e=s[0].object;for(;e.parent&&!e.name.startsWith("part__");)e=e.parent;if(e.name&&e.name.startsWith("part__"))return e}return null}startDragging(e){if(!this.selectedObjects.length)return;this.isDragging=!0,this.dragStartMousePosition.copy(this.currentMousePosition),this.dragStartPosition.copy(this.selectedObjects[0].position),this.raycaster.setFromCamera(this.currentMousePosition,this[ec].camera),void 0!==this.originalFloorY&&(this.floorPlane.constant=-this.originalFloorY);const i=new t.Vector3;this.raycaster.ray.intersectPlane(this.floorPlane,i)?this.dragOffset.set(this.selectedObjects[0].position.x-i.x,0,this.selectedObjects[0].position.z-i.z):this.dragOffset.set(0,0,0),this[va]&&(this.originalSensitivities.orbit=this[va].orbitSensitivity,this.originalSensitivities.zoom=this[va].zoomSensitivity,this.originalSensitivities.pan=this[va].panSensitivity,this.originalSensitivities.input=this[va].inputSensitivity,this[va].orbitSensitivity=0,this[va].zoomSensitivity=0,this[va].panSensitivity=0,this[va].inputSensitivity=0),this.style.cursor="grabbing"}updateDragPosition(){if(!this.isDragging||0===this.selectedObjects.length)return;this.raycaster.setFromCamera(this.currentMousePosition,this[ec].camera);const e=this.selectedObjects[0],i=new t.Vector3;if(this.raycaster.ray.intersectPlane(this.floorPlane,i)){const t=i.x+this.dragOffset.x,s=i.z+this.dragOffset.z,n=e.userData.isSnappedGroup?e.position.y:this.originalFloorY||0;e.position.set(t,n,s),this.pendingSnapConnection=null,this.snappingEnabled&&this.checkAndApplySnapping(e,i),this[ec].updateShadow(),this[tc]()}}checkAndApplySnapping(e,t){const i=[];if(e.userData.isSnappedGroup?e.traverse((e=>{e.userData.isPlacedObject&&e.userData.snappingPoints&&i.push(e)})):e.userData.snappingPoints&&i.push(e),0===i.length)return;const s=this.findTargetObject();if(!s)return;let n=null;if(i.forEach((e=>{s.traverse((t=>{if(t.userData.isPlacedObject&&t!==e&&!this.areObjectsInSameGroup(e,t)&&t.userData.snappingPoints){const i=function(e,t){if(!e.userData.snappingPoints||!t.userData.snappingPoints)return[];const i=e.userData.snappingPoints,s=t.userData.snappingPoints,n=[];return i.forEach((i=>{i.isUsed||s.forEach((s=>{var a,r;if(s.isUsed)return;const o=fp(e,i),l=fp(t,s),A=o.distanceTo(l),c=null!==(a=i.attraction)&&void 0!==a?a:gp,h=null!==(r=s.attraction)&&void 0!==r?r:gp;A<=Math.max(c,h)&&n.push({draggedPoint:i,targetPoint:s,distance:A})}))})),n.sort(((e,t)=>e.distance-t.distance))}(e,t);if(i.length>0){const s=i[0];(!n||s.distance<n.distance)&&(n={draggedObject:e,targetObject:t,draggedPoint:s.draggedPoint,targetPoint:s.targetPoint,distance:s.distance})}}}))})),n){const t=fp(n.draggedObject,n.draggedPoint),i=fp(n.targetObject,n.targetPoint).sub(t);e.position.add(i),this.pendingSnapConnection={draggedObject:n.draggedObject,targetObject:n.targetObject,draggedPoint:n.draggedPoint,targetPoint:n.targetPoint}}}areObjectsInSameGroup(e,t){const i=bp(e),s=bp(t);return null!==i&&i===s}stopDragging(){this.isDragging&&(this.isDragging=!1,this.pendingSnapConnection&&(this.completeSnapConnection(this.pendingSnapConnection),this.pendingSnapConnection=null),this[va]&&(this[va].orbitSensitivity=this.originalSensitivities.orbit,this[va].zoomSensitivity=this.originalSensitivities.zoom,this[va].panSensitivity=this.originalSensitivities.pan,this[va].inputSensitivity=this.originalSensitivities.input),this.style.cursor="")}completeSnapConnection(e){const i=bp(e.draggedObject),s=bp(e.targetObject);if(i||e.draggedObject,s||e.targetObject,i&&s)this.mergeSnappedGroups(i,s,e);else if(i&&!s)this.addObjectToSnappedGroup(i,e.targetObject,e);else if(!i&&s)this.addObjectToSnappedGroup(s,e.draggedObject,e);else{const i=function(e,i,s,n){const a=new t.Group;a.name=`SnappedGroup_${Date.now()}`,a.userData.isSnappedGroup=!0,a.userData.snapConnections=[{object1:e,object2:i,snapPoint1:Object.assign({},s),snapPoint2:Object.assign({},n)}];const r=e.parent;return r&&(r.remove(e),r.remove(i),r.add(a)),a.add(e),a.add(i),a.userData=Object.assign(Object.assign({},e.userData),a.userData),a.userData.isPlacedObject=!0,delete a.userData.snappingPoints,e.userData.isInGroup=!0,i.userData.isInGroup=!0,a.userData.meshes=[],a.traverse((e=>{"Mesh"!==e.type||function(e){if("SnappingPointSphere"===e.name)return!0;let t=e.parent;for(;t;){if("SnappingPointSphere"===t.name)return!0;t=t.parent}return!1}(e)||a.userData.meshes.push(e)})),a}(e.draggedObject,e.targetObject,e.draggedPoint,e.targetPoint);this.selectedObjects=[i]}this.updateOutlineSelection();this.findTargetObject()&&(this.setSnappingPointSlotsVisible(!1),this.setSnappingPointSlotsVisible(!0)),this.selectedObjects.length>0&&this.selectedObjects[0].userData.isSnappedGroup&&this.setBreakLinkSlotsVisible(!0),this[tc]()}mergeSnappedGroups(e,i,s){[...i.children].forEach((s=>{const n=new t.Vector3,a=new t.Quaternion,r=new t.Vector3;s.getWorldPosition(n),s.getWorldQuaternion(a),s.getWorldScale(r),i.remove(s),e.add(s),e.worldToLocal(n),s.position.copy(n),s.quaternion.copy(a),s.scale.copy(r)})),e.userData.snapConnections||(e.userData.snapConnections=[]),e.userData.snapConnections.push({object1:s.draggedObject,object2:s.targetObject,snapPoint1:Object.assign({},s.draggedPoint),snapPoint2:Object.assign({},s.targetPoint)}),i.userData.snapConnections&&e.userData.snapConnections.push(...i.userData.snapConnections),s.draggedPoint.isUsed=!0,s.targetPoint.isUsed=!0,i.parent&&i.parent.remove(i),this.updateGroupMeshCache(e),this.selectedObjects=[e]}addObjectToSnappedGroup(e,i,s){const n=new t.Vector3,a=new t.Quaternion,r=new t.Vector3;i.getWorldPosition(n),i.getWorldQuaternion(a),i.getWorldScale(r),i.parent&&i.parent.remove(i),e.add(i),e.worldToLocal(n),i.position.copy(n),i.quaternion.copy(a),i.scale.copy(r),e.userData.snapConnections||(e.userData.snapConnections=[]),e.userData.snapConnections.push({object1:s.draggedObject,object2:s.targetObject,snapPoint1:Object.assign({},s.draggedPoint),snapPoint2:Object.assign({},s.targetPoint)}),s.draggedPoint.isUsed=!0,s.targetPoint.isUsed=!0,this.updateGroupMeshCache(e),this.selectedObjects=[e]}updateGroupMeshCache(e){e.userData.isSnappedGroup&&(e.userData.meshes=[],e.traverse((t=>{"Mesh"!==t.type||this.isSnappingPointMesh(t)||e.userData.meshes.push(t)})))}handleSelection(e){const t=this.getPartObjectAtPosition(this.currentMousePosition);if(t){const e=bp(t)||t;1===this.selectedObjects.length&&this.selectedObjects[0]===e?this.deselectObject():this.selectObject(e)}else this.deselectObject()}selectObject(e){this.deselectObject(),this.selectedObjects=[e],this.updateOutlineSelection();this.findTargetObject()&&this.setSnappingPointSlotsVisible(!0),this.selectedObjects.length>0&&this.selectedObjects[0].userData.isSnappedGroup&&this.setBreakLinkSlotsVisible(!0),this[va]&&(this[va].enablePan=!1),this[Hu](e),this[tc]()}deselectObject(){if(this.selectedObjects.length>0){this.selectedObjects=[],this.selectedGroups.clear(),this.updateOutlineSelection();this.findTargetObject()&&this.setSnappingPointSlotsVisible(!1),this.isAnimatingRotation&&(this.isAnimatingRotation=!1,this.rotationAnimation=null),this.setBreakLinkSlotsVisible(!1),this[Hu](null),this[tc]()}this[va]&&(this[va].enablePan=!0)}getObjectsByGroupId(e){const t=[],i=this.findTargetObject();return i?(i.traverse((i=>{i.userData.groupId===e&&i.userData.isPlacedObject&&t.push(i)})),t):t}getObjectsByTags(e){const t=[],i=this.findTargetObject();return i?(i.traverse((i=>{if(i.userData.isPlacedObject&&i.userData.tags){e.some((e=>i.userData.tags.includes(e)))&&t.push(i)}})),t):t}selectObjectsByGroupId(e){const t=this.getObjectsByGroupId(e);t.length>0&&this.selectObjects(t)}parseNameMetadata(e){const t=e.match(/^([^#]+)#([^_]+)_(.+)$/);if(t)return{groupId:t[1],tags:[t[2]],instanceId:t[3]};const i=e.match(/^(.+)_([^_]+)$/);return i?{groupId:i[1],tags:[],instanceId:i[2]}:{groupId:e,tags:[],instanceId:""}}connectedCallback(){super.connectedCallback(),this.addEventListener("load",this._handleLoad),this.addEventListener("progress",this._handleProgress),"undefined"!=typeof window&&(window.deDraco=this.deDraco),this.hideCustomSnappingPointSlots(),this.setupDragHandlers()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("load",this._handleLoad),this.removeEventListener("progress",this._handleProgress),this.removeEventListener("mousedown",this.onMouseDown.bind(this)),this.removeEventListener("mousemove",this.onMouseMove.bind(this)),this.removeEventListener("mouseup",this.onMouseUp.bind(this)),this.removeEventListener("touchstart",this.onTouchStart.bind(this)),this.removeEventListener("touchmove",this.onTouchMove.bind(this)),this.removeEventListener("touchend",this.onTouchEnd.bind(this)),this.deselectObject(),this.isAnimatingRotation&&(this.isAnimatingRotation=!1,this.rotationAnimation=null);this.findTargetObject()&&(this.clearSlots(this.snappingPointSlots),this.clearSlots(this.breakLinkSlots))}setSnappingEnabled(e){this.snappingEnabled=e}getSnappingEnabled(){return this.snappingEnabled}ungroupSelectedObject(){if(1!==this.selectedObjects.length)return!1;const e=this.selectedObjects[0];return!!e.userData.isSnappedGroup&&this.ungroupSnappedGroup(e)}ungroupSnappedGroup(e){if(!e.userData.snapConnections)return!1;const i=this.findTargetObject(),s=[...e.children],n=[];return s.forEach((s=>{const a=new t.Vector3,r=new t.Quaternion,o=new t.Vector3;s.getWorldPosition(a),s.getWorldQuaternion(r),s.getWorldScale(o),e.remove(s),i&&(i.add(s),i.worldToLocal(a),s.position.copy(a),s.quaternion.copy(r),s.scale.copy(o),s.userData.isPlacedObject=!0,delete s.userData.isInGroup,s.userData.snappingPoints||(s.userData.snappingPoints=mp(s)),n.push(s))})),e.parent&&e.parent.remove(e),n.length>0?(this.selectObject(n[0]),setTimeout((()=>{this.setSnappingPointSlotsVisible(!0),this.updateSnappingPointSlots()}),10)):this.deselectObject(),this[tc](),!0}createVisualizationBox(e,i){const s=new t.PlaneGeometry(e.x,e.z),n=new t.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.3,side:2}),a=new t.Mesh(s,n);return a.name="VisualizationBox",a.rotation.x=-Math.PI/2,a.position.set(i.x,0,i.z),this.startVisualizationBoxPulse(a),a}fadeOutVisualizationBox(e,i=500,s){if(!(e.material instanceof t.MeshBasicMaterial))return void(null==s||s());const n=e.material.opacity,a=performance.now(),r=()=>{const t=performance.now()-a,o=Math.min(t/i,1),l=Math.pow(o,3),A=n*(1-l);e.material.opacity=A,this[tc](),o<1?requestAnimationFrame(r):null==s||s()};requestAnimationFrame(r)}startVisualizationBoxPulse(e){if(!(e.material instanceof t.MeshBasicMaterial))return void console.warn("Visualization box material is not MeshBasicMaterial:",e.material);const i=performance.now(),s=e.material,n=()=>{if(!e.parent)return;const t=(performance.now()-i)%2e3/2e3,a=.5*Math.sin(t*Math.PI*2)+.5,r=.2+(.6-.2)*a;s.opacity=r,s.needsUpdate=!0;const o=.95+(1.05-.95)*a;e.scale.setScalar(o),this[tc](),requestAnimationFrame(n)};requestAnimationFrame(n)}updateAllSlots(){this.updateSnappingPointSlots(),this.updateBreakLinkSlots()}rotateObject(e,t){if(!t||this.isAnimatingRotation)return;const i=t.rotation.y;let s;s=i+e,console.log(`Rotating object ${t.name} from ${i} to ${s}`),t.userData.isSnappedGroup?this.rotateGroupAroundCenter(t,i,s,direction):this.startRotationAnimation(t,i,s)}rotateGroupAroundCenter(e,i,s,n){const a=(new t.Box3).setFromObject(e).getCenter(new t.Vector3),r=e.parent;r&&r.worldToLocal(a);const o=e.position.clone();this.isAnimatingRotation=!0,this.rotationAnimation={object:e,startRotation:i,targetRotation:s,startTime:performance.now(),duration:500,isGroup:!0,groupCenter:a,originalPosition:o}}startRotationAnimation(e,t,i){this.isAnimatingRotation=!0,this.rotationAnimation={object:e,startRotation:t,targetRotation:i,startTime:performance.now(),duration:500}}updateRotationAnimation(e){if(!this.isAnimatingRotation||!this.rotationAnimation)return;const{object:i,startRotation:s,targetRotation:n,startTime:a,duration:r}=this.rotationAnimation,o=e-a,l=Math.min(o/r,1),A=s+(n-s)*(1-Math.pow(1-l,3));if(this.rotationAnimation.isGroup&&this.rotationAnimation.groupCenter&&this.rotationAnimation.originalPosition){const{groupCenter:e,originalPosition:n}=this.rotationAnimation,a=A-s,r=n.clone().sub(e).clone();r.applyAxisAngle(new t.Vector3(0,1,0),a),i.position.copy(r.add(e)),i.rotation.y=A}else i.rotation.y=A;this.updateShadowsWithGLBs(),this[tc](),l>=1&&this.finishRotationAnimation()}finishRotationAnimation(){if(!this.rotationAnimation)return;const{object:e,targetRotation:t}=this.rotationAnimation;e.rotation.y=t,this.isAnimatingRotation=!1,this.rotationAnimation=null,this.updateShadowsWithGLBs(),this[tc]()}[ic](e,t){super[ic](e,t),this.isAnimatingRotation&&this.updateRotationAnimation(e),this.updateAllSlots()}clearSlots(e){e.forEach((e=>{e.parentElement&&e.parentElement.removeChild(e)})),e.clear()}}})((e=>{var t;class i extends e{constructor(){super(...arguments),this.lights=!1,this[t]=e=>{this[ec].traverse((function(t){const i=t;i.isLight&&(i.visible=e)})),this[tc]()}}toggleLights(e){const t=void 0!==e?e:!this.lights;return this.lights=t,t}updated(e){super.updated(e),e.has("lights")&&this[Vu](this.lights)}[(t=Vu,sc)](){super[sc](),this[Vu](this.lights)}}return qu([v({type:Boolean,attribute:"lights"})],i.prototype,"lights",void 0),i})((e=>{return class extends e{constructor(){super(...arguments),this._pointerDwn=[0,0],this._pointerUp=[0,0]}handleClick(e){const{_pointerDwn:t,_pointerUp:i}=this;if(Math.hypot(i[0]-t[0],i[1]-t[1])>4)return;const{clientX:s,clientY:n}=e,a=this[ec],r=a.getNDC(s,n),o=a.hitFromPoint(r);if(o){const{object:e}=o;if(e&&e.isObject3D&&e.visible){const t={},{material:i,name:s,geometry:n}=e;s&&(t.mesh=s),n&&(t.geometry=n.name),void 0===i||Array.isArray(i)||(t.material=i.name),this.dispatchEvent(new CustomEvent("click",{detail:t}))}}}async setCameraFromJSON(e){const t=this[va],{camera:i}=t;console.log("scene",this[ec]),console.log("camera",i),console.log("controls",t),Object.keys(e).forEach((t=>{const s=e[t];if(i.hasOwnProperty(t)&&i[t]!==s)switch(t){case"matrix":case"up":break;default:console.log("setting camera property",t,s)}}))}getCameraMeta(){const{camera:e}=this[ec];return e&&(null==e?void 0:e.toJSON())||null}[sc](){super[sc]();const{currentGLTF:e}=this[ec];this.addEventListener("pointerdown",(e=>{this._pointerDwn=[e.offsetX,e.offsetY]})),this.addEventListener("pointerup",(e=>{this._pointerUp=[e.offsetX,e.offsetY]})),this.addEventListener("click",this.handleClick)}}})((e=>{var i,s,n,a,r,o;class l extends e{constructor(){super(...arguments),this.waterTexture=null,this.waterDistortionScale=null,this.waterSize=null,this.sky=null,this.sunElevation=void 0,this.sunAzimuth=void 0,this[i]=null,this[s]=null,this[n]=null,this[a]=null,this[r]=null,this[o]=null}[(i=Du,s=Fu,n=ku,a=Lu,r=_u,o=Pu,Ru)](){this[Du]&&(this[Du].animate(),this[tc](),requestAnimationFrame((()=>{this[Ru]()})))}[Qu](){if(this[ec]&&!this[Du]){const{waterTexture:e}=this,i=new t.PlaneGeometry(1e4,1e4);this[Du]=new vu(i,{textureWidth:512,textureHeight:512,waterNormals:(new t.TextureLoader).load(e,(function(e){e.wrapS=e.wrapT=t.RepeatWrapping})),sunDirection:new t.Vector3,sunColor:13887743,waterColor:7695,distortionScale:this.waterDistortionScale||3.7,fog:void 0!==this[ec].fog}),this[Du].rotation.x=-Math.PI/2,this[ec].add(this[Du]),this[Ru]()}}[Tu](e=2,i=180){if(!(this[ku]&&this[Fu]&&this[Du]&&this[Lu]))return;const s=t.MathUtils.degToRad(90-e),n=t.MathUtils.degToRad(i);this[ku].setFromSphericalCoords(1,s,n),this[Fu].material.uniforms.sunPosition.value.copy(this[ku]),this[Du].material.uniforms.sunDirection.value.copy(this[ku]).normalize(),this[Pu]&&this[Pu].dispose(),this[_u].add(this[Fu]),this[Pu]=this[Lu].fromScene(this[_u]),this[ec].add(this[Fu]),this[ec].environment=this[Pu].texture}[Mu](){this[ku]=new t.Vector3,this[Fu]=new xu,this[Fu].scale.setScalar(1e4),this[ec].add(this[Fu]);const e=this[Fu].material.uniforms;e.turbidity.value=10,e.rayleigh.value=2,e.mieCoefficient.value=.005,e.mieDirectionalG.value=.8,this[Lu]=new t.PMREMGenerator(lo.singleton.threeRenderer),this[_u]=new t.Scene}updated(e){super.updated(e),e.has("waterTexture")&&null!=this.waterTexture&&this[Qu](),e.has("sky")&&null!=this.sky&&(this[Mu](),this[Tu](this.sunElevation,this.sunAzimuth)),(e.has("sunElevation")&&null!=this.sunElevation||e.has("sunAzimuth")&&null!=this.sunAzimuth)&&this[Tu](this.sunElevation,this.sunAzimuth),e.has("waterDistortionScale")&&this[Du]&&this.waterDistortionScale&&(this[Du].material.uniforms.distortionScale.value=this.waterDistortionScale),e.has("waterSize")&&this[Du]&&this.waterSize&&(this[Du].material.uniforms.size.value=this.waterSize)}}return Su([v({type:String,attribute:"water-texture"})],l.prototype,"waterTexture",void 0),Su([v({type:Number,attribute:"water-distortion-scale"})],l.prototype,"waterDistortionScale",void 0),Su([v({type:Number,attribute:"water-size"})],l.prototype,"waterSize",void 0),Su([v({type:Number,attribute:"sky"})],l.prototype,"sky",void 0),Su([v({type:Number,attribute:"sun-elevation"})],l.prototype,"sunElevation",void 0),Su([v({type:Number,attribute:"sun-azimuth"})],l.prototype,"sunAzimuth",void 0),l})((e=>{var i,s,n,a;class r extends e{constructor(){super(...arguments),this[i]=new t.Object3D,this[s]=new Map,this[n]=new Map,this[a]=Se((async()=>{await this[ec].updateFraming(),this[tc]()}),400)}_updateNodePosition(e,t){e&&(e.position.set(...t),this[ec].updateBoundingBox(),this[ec].updateShadow(),this[tc](),this[Bu]())}_updateNodeRotation(e,t,i="XYZ"){e&&(e.rotation.set(...t,i),this[ec].updateBoundingBox(),this[ec].updateShadow(),this[tc](),this[Bu]())}_updateNodeScale(e,t){e&&(e.scale.set(...t),this[ec].updateBoundingBox(),this[ec].updateShadow(),this[tc](),this[Bu]())}getSceneMeshes(){return[...this[Eu].keys()]}getSceneObjects(){return[...this[wu].keys()]}updateMeshPosition(e,t){const i=this[Eu].get(e);this._updateNodePosition(i,t)}updateMeshRotation(e,t,i){const s=this[Eu].get(e);this._updateNodeRotation(s,t,i)}updateMeshScale(e,t){const i=this[Eu].get(e);this._updateNodeScale(i,t)}updateObjectPosition(e,t){const i=this[wu].get(e);this._updateNodePosition(i,t)}updateObjectRotation(e,t,i){const s=this[wu].get(e);this._updateNodeRotation(s,t,i)}updateObjectScale(e,t){const i=this[wu].get(e);this._updateNodeScale(i,t)}updateScenePosition(e){const t=this[Iu];this._updateNodePosition(t,e)}updateSceneRotation(e){const t=this[Iu];this._updateNodeRotation(t,e)}updateSceneScale(e){const t=this[Iu];this._updateNodeScale(t,e)}getSceneRotation(){var e,t;const i=(null===(t=null===(e=this[Iu])||void 0===e?void 0:e.rotation)||void 0===t?void 0:t.toArray().map((e=>+(e||0))))||[0,0,0];return i.slice(0,3)}[(i=Iu,s=Eu,n=wu,a=Bu,sc)](){super[sc]();const{currentGLTF:e}=this[ec];if(null!=e){const e=this[ec];this[Eu].clear(),this[wu].clear(),e.traverse((e=>{e.parent||(this[Iu]=e),"Mesh"===e.type&&e.name.length&&this[Eu].set(e.name,e),"Object3D"===e.type&&e.name.length&&this[wu].set(e.name,e)}))}}}return r})((e=>{var i,s,n;class a extends e{constructor(){super(...arguments),this[i]=new Map,this[s]=e=>{e.forEach((e=>{e instanceof MutationRecord&&"childList"!==e.type||(e.addedNodes.forEach((e=>{this[Bc](e)})),e.removedNodes.forEach((e=>{this[vc](e)})),this[tc]())}))},this[n]=new MutationObserver(this[Ec])}connectedCallback(){super.connectedCallback();for(let e=0;e<this.children.length;++e)this[Bc](this.children[e]);const{ShadyDOM:e}=self;null==e?this[wc].observe(this,{childList:!0}):this[wc]=e.observeChildren(this,this[Ec])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:e}=self;null==e?this[wc].disconnect():e.unobserveChildren(this[wc])}[(i=Ic,s=Ec,n=wc,sc)](){super[sc]();const e=this[ec];e.forHotspots((t=>{e.updateSurfaceHotspot(t)}))}[ic](e,t){super[ic](e,t);const i=this[ec],{annotationRenderer:s}=i,n=i.getCamera();i.shouldRender()&&(i.animateSurfaceHotspots(),i.updateHotspotsVisibility(n.position),s.domElement.style.display="",s.render(i,n))}updateHotspot(e){const t=this[Ic].get(e.name);null!=t&&(t.updatePosition(e.position),t.updateNormal(e.normal),t.surface=e.surface,this[ec].updateSurfaceHotspot(t),this[tc]())}queryHotspot(e){const i=this[Ic].get(e);if(null==i)return null;const s=cc(i.position),n=cc(i.normal),a=i.facingCamera,r=this[ec],o=r.getCamera(),l=new t.Vector3;l.setFromMatrixPosition(i.matrixWorld),l.project(o);const A=r.width/2,c=r.height/2;l.x=l.x*A+A,l.y=-l.y*c+c;const h=cc(new t.Vector3(l.x,l.y,l.z));return Number.isFinite(h.x)&&Number.isFinite(h.y)?{position:s,normal:n,canvasPosition:h,facingCamera:a}:null}positionAndNormalFromPoint(e,t){const i=this[ec],s=i.getNDC(e,t),n=i.positionAndNormalFromPoint(s);if(null==n)return null;xc.copy(i.target.matrixWorld).invert();const a=cc(n.position.applyMatrix4(xc)),r=cc(n.normal.transformDirection(xc));let o=null;return null!=n.uv&&(o=hc(n.uv)),{position:a,normal:r,uv:o}}surfaceFromPoint(e,t){const i=this[ec],s=i.getNDC(e,t);return i.surfaceFromPoint(s)}[Bc](e){if(!(e instanceof HTMLElement&&0===e.slot.indexOf("hotspot")))return;let t=this[Ic].get(e.slot);null!=t?t.increment():(t=new sA({name:e.slot,position:e.dataset.position,normal:e.dataset.normal,surface:e.dataset.surface}),this[Ic].set(e.slot,t),this[ec].addHotspot(t)),this[ec].queueRender()}[vc](e){if(!(e instanceof HTMLElement))return;const t=this[Ic].get(e.slot);t&&(t.decrement()&&(this[ec].removeHotspot(t),this[Ic].delete(e.slot)),this[ec].queueRender())}}return a})((e=>{var i,s,n;class a extends e{constructor(){super(...arguments),this[i]=void 0,this[s]=null,this[n]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[Kl]}get availableVariants(){return this.model?this.model[Gl]():[]}get originalGltfJson(){return this[Vl]}[(i=Kl,s=ql,n=Vl,Wl)](){return()=>{this[tc]()}}[Jl](e){return e.colorSpace=t.SRGBColorSpace,e.wrapS=t.RepeatWrapping,e.wrapT=t.RepeatWrapping,new Po(this[Wl](),e)}async createTexture(e,t="image/png"){const{textureUtils:i}=this[ac],s=await i.loadImage(e,this.withCredentials);return s.userData.mimeType=t,this[Jl](s)}async createLottieTexture(e,t=1){const{textureUtils:i}=this[ac],s=await i.loadLottie(e,t,this.withCredentials);return this[Jl](s)}createVideoTexture(e){const i=document.createElement("video");i.crossOrigin=this.withCredentials?"use-credentials":"anonymous",i.src=e,i.muted=!0,i.playsInline=!0,i.loop=!0,i.play();const s=new t.VideoTexture(i);return this[Jl](s)}createCanvasTexture(){const e=document.createElement("canvas"),i=new t.CanvasTexture(e);return this[Jl](i)}async updated(e){if(super.updated(e),e.has("variantName")){const e=this[rc].beginActivity("variant-update");e(.1);const t=this[Kl],{variantName:i}=this;null!=t&&(await t[Fl](i),this[tc](),this.dispatchEvent(new CustomEvent("variant-applied"))),e(1)}if(e.has("orientation")||e.has("scale")){if(!this.loaded)return;const e=this[ec];e.applyTransform(),e.updateBoundingBox(),e.updateShadow(),this[ac].arRenderer.onUpdateScene(),this[tc]()}}[sc](){super[sc]();const{currentGLTF:e}=this[ec];if(null!=e){const{correlatedSceneGraph:t}=e;null!=t&&e!==this[ql]&&(this[Kl]=new Hl(t,this[Wl]()),this[Vl]=JSON.parse(JSON.stringify(t.gltf))),"variants"in e.userData&&this.requestUpdate("variantName")}this[ql]=e}async exportScene(e){const t=this[ec];return new Promise((async(i,s)=>{const n={binary:!0,onlyVisible:!0,maxTextureSize:1/0,includeCustomExtensions:!1,forceIndices:!1};Object.assign(n,e),n.animations=t.animations,n.truncateDrawRange=!0;const a=t.shadow;let r=!1;null!=a&&(r=a.visible,a.visible=!1),await this[Kl][kl]();(new Zi).register((e=>new Js(e))).parse(t.model,(e=>i(new Blob([n.binary?e:JSON.stringify(e)],{type:n.binary?"application/octet-stream":"application/json"}))),(()=>s("glTF export failed")),n),null!=a&&(a.visible=r)}))}materialFromPoint(e,t){const i=this[Kl];if(null==i)return null;const s=this[ec],n=s.getNDC(e,t),a=s.hitFromPoint(n);return null==a||null==a.face?null:i[Ll](a)}}return zl([v({type:String,attribute:"variant-name"})],a.prototype,"variantName",void 0),zl([v({type:String,attribute:"orientation"})],a.prototype,"orientation",void 0),zl([v({type:String,attribute:"scale"})],a.prototype,"scale",void 0),a})((e=>{var t,i,s;class n extends e{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=3e3,this.rotationPerSecond="auto",this[t]=performance.now(),this[i]=0,this[s]=e=>{this.autoRotate&&"user-interaction"===e.detail.source&&(this[fu]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[Cu]),this[fu]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[Cu]),this[fu]=performance.now()}updated(e){super.updated(e),e.has("autoRotate")&&(this[fu]=performance.now())}[(t=fu,i=bu,yu)](e){this[bu]=e[0]}[ic](e,t){if(super[ic](e,t),!this.autoRotate||!this[lc]()||this[ac].isPresenting)return;const i=Math.min(t,e-this[fu]-this.autoRotateDelay);i>0&&(this[ec].yaw=this.turntableRotation+this[bu]*i*.001)}get turntableRotation(){return this[ec].yaw}resetTurntableRotation(e=0){this[ec].yaw=e}}return s=Cu,pu([v({type:Boolean,attribute:"auto-rotate"})],n.prototype,"autoRotate",void 0),pu([v({type:Number,attribute:"auto-rotate-delay"})],n.prototype,"autoRotateDelay",void 0),pu([ta({intrinsics:mu,updateHandler:yu}),v({type:String,attribute:"rotation-per-second"})],n.prototype,"rotationPerSecond",void 0),n})((e=>{var i,s,n;class a extends e{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=0,this.shadowSoftness=1,this.exposure=1,this.toneMapping="auto",this.skyboxHeight="0",this[i]=null,this[s]=null,this[n]=null}updated(e){super.updated(e),e.has("shadowIntensity")&&(this[ec].setShadowIntensity(.5*this.shadowIntensity),this[tc]()),e.has("shadowSoftness")&&(this[ec].setShadowSoftness(this.shadowSoftness),this[tc]()),e.has("exposure")&&(this[ec].exposure=this.exposure,this[tc]()),e.has("toneMapping")&&(this[ec].toneMapping="aces"===this.toneMapping?t.ACESFilmicToneMapping:"agx"===this.toneMapping?t.AgXToneMapping:"reinhard"===this.toneMapping?t.ReinhardToneMapping:"cineon"===this.toneMapping?t.CineonToneMapping:"linear"===this.toneMapping?t.LinearToneMapping:"none"===this.toneMapping?t.NoToneMapping:t.NeutralToneMapping,this[tc]()),(e.has("environmentImage")||e.has("skyboxImage"))&&this[Ac]()&&this[Fe](),e.has("skyboxHeight")&&(this[ec].setGroundedSkybox(),this[tc]())}hasBakedShadow(){return this[ec].bakedShadows.size>0}async[(i=De,s=ke,n=Le,Fe)](){const{skyboxImage:e,environmentImage:t}=this;null!=this[Le]&&(this[Le](),this[Le]=null);const{textureUtils:i}=this[ac];if(null==i)return;const s=this[rc].beginActivity("environment-update");try{const{environmentMap:n,skybox:a}=await i.generateEnvironmentMapAndSkybox(Be(e),t,(e=>s(Me(e,0,1))),this.withCredentials);this[De]!==n&&(this[De]=n,this.dispatchEvent(new CustomEvent("environment-change"))),this[ke]=null!=a?a.name===n.name?n:a:null,this[ec].setEnvironmentAndSkybox(this[De],this[ke])}catch(e){if(e instanceof Error)throw this[ec].setEnvironmentAndSkybox(null,null),e}finally{s(1)}}}return Re([v({type:String,attribute:"environment-image"})],a.prototype,"environmentImage",void 0),Re([v({type:String,attribute:"skybox-image"})],a.prototype,"skyboxImage",void 0),Re([v({type:Number,attribute:"shadow-intensity"})],a.prototype,"shadowIntensity",void 0),Re([v({type:Number,attribute:"shadow-softness"})],a.prototype,"shadowSoftness",void 0),Re([v({type:Number})],a.prototype,"exposure",void 0),Re([v({type:String,attribute:"tone-mapping"})],a.prototype,"toneMapping",void 0),Re([v({type:String,attribute:"skybox-height"})],a.prototype,"skyboxHeight",void 0),a})((e=>{var i,s,n,a,r,o,l,A,c,h,u,d,p,g,m,f,b,y;class C extends e{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=la,this.cameraTarget="auto auto auto",this.fieldOfView="auto",this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=3e3,this.interactionPrompt=ha,this.interactionPromptStyle=da,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.touchAction=pa,this.disableZoom=!1,this.disablePan=!1,this.disableTap=!1,this.interpolationDecay=50,this.a11y=null,this[i]=this.shadowRoot.querySelector(".interaction-prompt"),this[s]=this.shadowRoot.querySelector("#prompt"),this[n]=[this.shadowRoot.querySelector("#finger0"),this.shadowRoot.querySelector("#finger1")],this[a]=this.shadowRoot.querySelector(".pan-target"),this[r]=0,this[o]=1/0,this[l]=!1,this[A]=!1,this[c]=ar.AUTOMATIC,this[h]=new rr(this[ec].camera,this[$A],this[ec]),this[u]=new t.Spherical,this[d]=!1,this[p]=!1,this[g]=!1,this[m]={},this[f]=()=>{const e=this[va].changeSource;this[ja]=e,e===ar.USER_INTERACTION&&(this[Ga]=!0,this[Ta]())},this[b]=()=>{const e=this[Ra]();this[tc]();const t=this[va].changeSource;this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:t,spatialRegion:e}}))},this[y]=e=>{this[XA].classList.toggle("pointer-tumbling","pointer-change-start"===e.type)}}get inputSensitivity(){return this[va].inputSensitivity}set inputSensitivity(e){this[va].inputSensitivity=e}getCameraOrbit(){const{theta:e,phi:t,radius:i}=this[Ha];return{theta:e,phi:t,radius:i,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return cc(this[ac].isPresenting?this[ac].arRenderer.target:this[ec].getDynamicTarget())}getFieldOfView(){return this[va].getFieldOfView()}getMinimumFieldOfView(){return this[va].options.minimumFieldOfView}getMaximumFieldOfView(){return this[va].options.maximumFieldOfView}getIdealAspect(){return this[ec].idealAspect}jumpCameraToGoal(){this[za]=!0,this.requestUpdate(za,!1)}resetInteractionPrompt(){this[Na]=0,this[Ua]=1/0,this[Ga]=!1,this[Oa]=this.interactionPrompt===ha&&this.cameraControls}zoom(e){const t=new WheelEvent("wheel",{deltaY:-30*e});this[$A].dispatchEvent(t)}connectedCallback(){super.connectedCallback(),this[va].addEventListener("user-interaction",this[La]),this[va].addEventListener("pointer-change-start",this[Pa]),this[va].addEventListener("pointer-change-end",this[Pa])}disconnectedCallback(){super.disconnectedCallback(),this[va].removeEventListener("user-interaction",this[La]),this[va].removeEventListener("pointer-change-start",this[Pa]),this[va].removeEventListener("pointer-change-end",this[Pa])}updated(e){super.updated(e);const t=this[va],i=this[ec];if(e.has("cameraControls")&&(this.cameraControls?(t.enableInteraction(),this.interactionPrompt===ha&&(this[Oa]=!0)):(t.disableInteraction(),this[Ta]()),this[$A].setAttribute("aria-label",this[zA])),e.has("disableZoom")&&(t.disableZoom=this.disableZoom),e.has("disablePan")&&(t.enablePan=!this.disablePan),e.has("disableTap")&&(t.enableTap=!this.disableTap),(e.has("interactionPrompt")||e.has("cameraControls")||e.has("src"))&&(this.interactionPrompt===ha&&this.cameraControls&&!this[Ga]?this[Oa]=!0:this[Ta]()),e.has("interactionPromptStyle")&&(this[Qa].style.opacity=this.interactionPromptStyle==ua?"1":"0"),e.has("touchAction")){const e=this.touchAction;t.applyOptions({touchAction:e}),t.updateTouchActionStyle()}e.has("orbitSensitivity")&&(t.orbitSensitivity=this.orbitSensitivity),e.has("zoomSensitivity")&&(t.zoomSensitivity=this.zoomSensitivity),e.has("panSensitivity")&&(t.panSensitivity=this.panSensitivity),e.has("interpolationDecay")&&(t.setDamperDecayTime(this.interpolationDecay),i.setTargetDamperDecayTime(this.interpolationDecay)),e.has("a11y")&&this[ka](),!0===this[za]&&Promise.resolve().then((()=>{t.jumpToGoal(),i.jumpToGoal(),this[_a](),this[za]=!1}))}async updateFraming(){const e=this[ec],t=e.adjustedFoV(e.framedFoVDeg);await e.updateFraming();const i=e.adjustedFoV(e.framedFoVDeg),s=this[va].getFieldOfView()/t;this[va].setFieldOfView(i*s),this[Va]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),this.requestUpdate("cameraOrbit"),await this.updateComplete}interact(e,t,i){const s=this[$A],n=this[Ma];if("1"===n[0].style.opacity)return void console.warn("interact() failed because an existing interaction is running.");const a=new Array;a.push({x:na(t.x),y:na(t.y)});const r=[{x:a[0].x(0),y:a[0].y(0)}];null!=i&&(a.push({x:na(i.x),y:na(i.y)}),r.push({x:a[1].x(0),y:a[1].y(0)}));let o=performance.now();const{width:l,height:A}=this[ec],c=this.getBoundingClientRect(),h=e=>{for(const[t,i]of r.entries()){const{style:a}=n[t];a.transform=`translateX(${l*i.x}px) translateY(${A*i.y}px)`,"pointerdown"===e?a.opacity="1":"pointerup"===e&&(a.opacity="0");const r={pointerId:t-5678,pointerType:"touch",target:s,clientX:l*i.x+c.x,clientY:A*i.y+c.y,altKey:!0};s.dispatchEvent(new PointerEvent(e,r))}},u=()=>{const t=this[ja];if(t!==ar.AUTOMATIC||!s.isConnected){for(const e of this[Ma])e.style.opacity="0";return h("pointercancel"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:t}})),void document.removeEventListener("visibilitychange",d)}const i=Math.min(1,(performance.now()-o)/e);for(const[e,t]of r.entries())t.x=a[e].x(i),t.y=a[e].y(i);h("pointermove"),i<1?requestAnimationFrame(u):(h("pointerup"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:ar.AUTOMATIC}})),document.removeEventListener("visibilitychange",d))},d=()=>{let e=0;"hidden"===document.visibilityState?e=performance.now()-o:o=performance.now()-e};document.addEventListener("visibilitychange",d),h("pointerdown"),this[ja]=ar.AUTOMATIC,requestAnimationFrame(u)}[(i=Sa,s=Qa,n=Ma,a=xa,r=Na,o=Ua,l=Ga,A=Oa,c=ja,h=va,u=Ha,d=za,p=qa,g=Va,m=Da,Wa)](e){const t=this[va],i=this[ec];i.framedFoVDeg=180*e[0]/Math.PI,t.changeSource=ar.NONE,t.setFieldOfView(i.adjustedFoV(i.framedFoVDeg)),this[La]()}[Ka](e){const t=this[va];if(this[Va]){const{theta:t,phi:i}=this.getCameraOrbit();e[0]=t,e[1]=i,this[Va]=!1}t.changeSource=ar.NONE,t.setOrbit(e[0],e[1],e[2]),this[La]()}[Ya](e){this[va].applyOptions({minimumAzimuthalAngle:e[0],minimumPolarAngle:e[1],minimumRadius:e[2]}),this.jumpCameraToGoal()}[Xa](e){this[va].applyOptions({maximumAzimuthalAngle:e[0],maximumPolarAngle:e[1],maximumRadius:e[2]}),this[Fa](e[2]),this.jumpCameraToGoal()}[$a](e){this[va].applyOptions({minimumFieldOfView:180*e[0]/Math.PI}),this.jumpCameraToGoal()}[Za](e){const t=this[ec].adjustedFoV(180*e[0]/Math.PI);this[va].applyOptions({maximumFieldOfView:t}),this.jumpCameraToGoal()}[Ja](e){const[t,i,s]=e;this[ac].arRenderer.isPresenting||this[ec].setTarget(t,i,s),this[va].changeSource=ar.NONE,this[ac].arRenderer.updateTarget(),this[La]()}[ic](e,t){if(super[ic](e,t),this[ac].isPresenting||!this[lc]())return;const i=this[va],s=this[ec],n=performance.now();if(this[Oa]&&this.loaded&&n>this[WA]+this.interactionPromptThreshold&&(this[Oa]=!1,this[Ua]=n,this[Sa].classList.add("visible")),isFinite(this[Ua])&&this.interactionPromptStyle===da){const e=(n-this[Ua])/5e3%1,t=ra(e),a=oa(e);if(this[Qa].style.opacity=`${a}`,t!==this[Na]){const e=t*s.width*.05,n=(t-this[Na])*Math.PI/16;this[Qa].style.transform=`translateX(${e}px)`,i.changeSource=ar.AUTOMATIC,i.adjustOrbit(n,0,0),this[Na]=t}}const a=i.update(e,t),r=s.updateTarget(t);(a||r)&&this[_a]()}[Ta](){this[Oa]=!1,this[Sa].classList.remove("visible"),this[Ua]=1/0}[Fa](e){const t=Math.max(this[ec].farRadius(),e),i=Math.abs(2*t);this[va].updateNearFar(0,i)}[Ra](){const{theta:e,phi:t}=this[va].getCameraSpherical(this[Ha]),i=(4+Math.floor((e%Ba+wa)/Ia))%4,s=Math.floor(t/Ea),n=`${ca[s]}${Aa[i]}`,a=n;return a in this[Da]?this[KA](this[Da][a]):this[KA](`View from stage ${n}`),n}get[zA](){let e=". Use mouse, touch or arrow keys to move.";return"interaction-prompt"in this[Da]&&(e=`. ${this[Da]["interaction-prompt"]}`),super[zA].replace(/\.$/,"")+(this.cameraControls?e:"")}async[nc](e){const t=this[va],i=this[ec],s=i.adjustedFoV(i.framedFoVDeg);super[nc](e);const n=i.adjustedFoV(i.framedFoVDeg)/s,a=t.getFieldOfView()*(isFinite(n)?n:1);t.updateAspect(this[ec].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),await this.updateComplete,this[va].setFieldOfView(a),this.jumpCameraToGoal()}[sc](){super[sc](),this[qa]?this[Va]=!0:this[qa]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}[(f=La,b=_a,y=Pa,ka)](){if("string"==typeof this.a11y)if(this.a11y.startsWith("{"))try{this[Da]=JSON.parse(this.a11y)}catch(e){console.warn("Error parsing a11y JSON:",e)}else this.a11y.length>0?console.warn("Error not supported format, should be a JSON string:",this.a11y):this[Da]={};else"object"==typeof this.a11y&&null!=this.a11y?this[Da]=Object.assign({},this.a11y):this[Da]={};this[$A].setAttribute("aria-label",this[zA])}}return aa([v({type:Boolean,attribute:"camera-controls"})],C.prototype,"cameraControls",void 0),aa([ta({intrinsics:fa,observeEffects:!0,updateHandler:Ka}),v({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],C.prototype,"cameraOrbit",void 0),aa([ta({intrinsics:Ca,observeEffects:!0,updateHandler:Ja}),v({type:String,attribute:"camera-target",hasChanged:()=>!0})],C.prototype,"cameraTarget",void 0),aa([ta({intrinsics:ga,observeEffects:!0,updateHandler:Wa}),v({type:String,attribute:"field-of-view",hasChanged:()=>!0})],C.prototype,"fieldOfView",void 0),aa([ta({intrinsics:ba,updateHandler:Ya}),v({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],C.prototype,"minCameraOrbit",void 0),aa([ta({intrinsics:ya,updateHandler:Xa}),v({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],C.prototype,"maxCameraOrbit",void 0),aa([ta({intrinsics:ma,updateHandler:$a}),v({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],C.prototype,"minFieldOfView",void 0),aa([ta({intrinsics:ga,updateHandler:Za}),v({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],C.prototype,"maxFieldOfView",void 0),aa([v({type:Number,attribute:"interaction-prompt-threshold"})],C.prototype,"interactionPromptThreshold",void 0),aa([v({type:String,attribute:"interaction-prompt"})],C.prototype,"interactionPrompt",void 0),aa([v({type:String,attribute:"interaction-prompt-style"})],C.prototype,"interactionPromptStyle",void 0),aa([v({type:Number,attribute:"orbit-sensitivity"})],C.prototype,"orbitSensitivity",void 0),aa([v({type:Number,attribute:"zoom-sensitivity"})],C.prototype,"zoomSensitivity",void 0),aa([v({type:Number,attribute:"pan-sensitivity"})],C.prototype,"panSensitivity",void 0),aa([v({type:String,attribute:"touch-action"})],C.prototype,"touchAction",void 0),aa([v({type:Boolean,attribute:"disable-zoom"})],C.prototype,"disableZoom",void 0),aa([v({type:Boolean,attribute:"disable-pan"})],C.prototype,"disablePan",void 0),aa([v({type:Boolean,attribute:"disable-tap"})],C.prototype,"disableTap",void 0),aa([v({type:Number,attribute:"interpolation-decay"})],C.prototype,"interpolationDecay",void 0),aa([v()],C.prototype,"a11y",void 0),C})((e=>{var t,i,s,n,a,r,o,l,A,c;class h extends e{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arUsdzMaxTextureSize="auto",this.arPlacement="floor",this.arModes="webxr scene-viewer quick-look",this.iosSrc=null,this.xrEnvironment=!1,this[t]=!1,this[i]=this.shadowRoot.querySelector(".ar-button"),this[s]=document.createElement("a"),this[n]=new Set,this[a]=Gh,this[r]=!1,this[o]=e=>{e.preventDefault(),this.activateAR()},this[l]=({status:e})=>{e!==lr&&this[ac].arRenderer.presentedScene!==this[ec]||(this.setAttribute("ar-status",e),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:e}})),e===lr?this.removeAttribute("ar-tracking"):e===Ar&&this.setAttribute("ar-tracking",ur))},this[A]=({status:e})=>{this.setAttribute("ar-tracking",e),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:e}}))},this[c]=e=>{"_apple_ar_quicklook_button_tapped"==e.data&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[qh]!==Gh}connectedCallback(){super.connectedCallback(),this[ac].arRenderer.addEventListener("status",this[Yh]),this.setAttribute("ar-status",lr),this[ac].arRenderer.addEventListener("tracking",this[Xh]),this[Kh].addEventListener("message",this[$h])}disconnectedCallback(){super.disconnectedCallback(),this[ac].arRenderer.removeEventListener("status",this[Yh]),this[ac].arRenderer.removeEventListener("tracking",this[Xh]),this[Kh].removeEventListener("message",this[$h])}update(e){super.update(e),e.has("arScale")&&(this[ec].canScale="fixed"!==this.arScale),e.has("arPlacement")&&(this[ec].updateShadow(),this[tc]()),e.has("arModes")&&(this[Vh]=Fh(this.arModes)),(e.has("ar")||e.has("arModes")||e.has("src")||e.has("iosSrc")||e.has("arUsdzMaxTextureSize"))&&this[Zh]()}async activateAR(){switch(this[qh]){case _h:await this[Hh]();break;case Oh:await this[Nh]();break;case Ph:this[jh]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities")}}async[(t=zh,i=Uh,s=Kh,n=Vh,a=qh,r=Wh,o=Jh,l=Yh,A=Xh,c=$h,Zh)](){var e;let t=Gh;if(this.ar){if(null!=this.src)for(const i of this[Vh]){if("webxr"===i&&me&&!Rh&&await this[ac].arRenderer.supportsPresentation()){t=Oh;break}if("scene-viewer"===i&&!Dh&&(Ie||navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues&&(null===(e=(await navigator.userAgentData.getHighEntropyValues(["formFactor"])).formFactor)||void 0===e?void 0:e.includes("XR")))){t=Ph;break}if("quick-look"===i&&we){t=_h;break}}t===Gh&&null!=this.iosSrc&&we&&(t=_h)}if(t!==Gh)this[Uh].classList.add("enabled"),this[Uh].addEventListener("click",this[Jh]);else if(this[Uh].classList.contains("enabled")){this[Uh].removeEventListener("click",this[Jh]),this[Uh].classList.remove("enabled");const e=hr;this.setAttribute("ar-status",e),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:e}}))}this[qh]=t}async[Nh](){console.log("Attempting to present in AR with WebXR..."),await this[eu]();try{this[Uh].removeEventListener("click",this[Jh]);const{arRenderer:e}=this[ac];e.placeOnWall="wall"===this.arPlacement,await e.present(this[ec],this.xrEnvironment)}catch(e){console.warn("Error while trying to present in AR with WebXR"),console.error(e),await this[ac].arRenderer.stopPresenting(),Rh=!0,console.warn("Falling back to next ar-mode"),await this[Zh](),this.activateAR()}finally{this[Zh]()}}async[eu](){this.loaded||(this[Wh]=!0,this[JA](),await((e,t,i=null)=>new Promise((s=>{e.addEventListener(t,(function n(a){i&&!i(a)||(s(a),e.removeEventListener(t,n))}))})))(this,"load"),this[Wh]=!1)}[Ac](){return super[Ac]()||this[Wh]}[jh](){const e=self.location.toString(),t=new URL(e),i=new URL(this.src,e);i.hash&&(i.hash="");const s=new URLSearchParams(i.search);if(t.hash=kh,s.set("mode","ar_preferred"),s.has("disable_occlusion")||s.set("disable_occlusion","true"),"fixed"===this.arScale&&s.set("resizable","false"),"wall"===this.arPlacement&&s.set("enable_vertical_placement","true"),s.has("sound")){const t=new URL(s.get("sound"),e);s.set("sound",t.toString())}if(s.has("link")){const t=new URL(s.get("link"),e);s.set("link",t.toString())}const n=`intent://arvr.google.com/scene-viewer/1.2?${s.toString()+"&file="+encodeURIComponent(i.toString())}#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(t.toString())};end;`;self.addEventListener("hashchange",(()=>{self.location.hash===kh&&(Dh=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[Zh]())}),{once:!0}),this[Kh].setAttribute("href",n),console.log("Attempting to present in AR with Scene Viewer..."),this[Kh].click()}async[Hh](){const e=!this.iosSrc;this[Uh].classList.remove("enabled");const t=e?await this.prepareUSDZ():this.iosSrc,i=new URL(t,self.location.toString());if(e){const e=self.location.toString(),t=new URL(e),s=new URL(this.src,t);s.hash&&(i.hash=s.hash)}"fixed"===this.arScale&&(i.hash&&(i.hash+="&"),i.hash+="allowsContentScaling=0");const s=this[Kh];s.setAttribute("rel","ar");const n=document.createElement("img");s.appendChild(n),s.setAttribute("href",i.toString()),e&&s.setAttribute("download","model.usdz"),s.style.display="none",s.isConnected||this.shadowRoot.appendChild(s),console.log("Attempting to present in AR with Quick Look..."),s.click(),s.removeChild(n),e&&URL.revokeObjectURL(t),this[Uh].classList.add("enabled")}async prepareUSDZ(){const e=this[rc].beginActivity("usdz-conversion");await this[eu]();const{model:t,shadow:i,target:s}=this[ec];if(null==t)return"";let n=!1;null!=i&&(n=i.visible,i.visible=!1),e(.2);const a=new yh;s.remove(t),t.position.copy(s.position),t.updateWorldMatrix(!1,!0);const r=await a.parseAsync(t,{maxTextureSize:isNaN(this.arUsdzMaxTextureSize)?1/0:Math.max(parseInt(this.arUsdzMaxTextureSize),16)});t.position.set(0,0,0),s.add(t);const o=new Blob([r],{type:"model/vnd.usdz+zip"}),l=URL.createObjectURL(o);return e(1),null!=i&&(i.visible=n),l}}return Th([v({type:Boolean,attribute:"ar"})],h.prototype,"ar",void 0),Th([v({type:String,attribute:"ar-scale"})],h.prototype,"arScale",void 0),Th([v({type:String,attribute:"ar-usdz-max-texture-size"})],h.prototype,"arUsdzMaxTextureSize",void 0),Th([v({type:String,attribute:"ar-placement"})],h.prototype,"arPlacement",void 0),Th([v({type:String,attribute:"ar-modes"})],h.prototype,"arModes",void 0),Th([v({type:String,attribute:"ios-src"})],h.prototype,"iosSrc",void 0),Th([v({type:Boolean,attribute:"xr-environment"})],h.prototype,"xrEnvironment",void 0),h})((e=>{var i,s,n,a,r,o,l,A;class c extends e{static set dracoDecoderLocation(e){Hi.setDRACODecoderLocation(e)}static get dracoDecoderLocation(){return Hi.getDRACODecoderLocation()}static set ktx2TranscoderLocation(e){Hi.setKTX2TranscoderLocation(e)}static get ktx2TranscoderLocation(){return Hi.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(e){Hi.setMeshoptDecoderLocation(e)}static get meshoptDecoderLocation(){return Hi.getMeshoptDecoderLocation()}static set lottieLoaderLocation(e){lo.singleton.textureUtils.lottieLoaderUrl=e}static get lottieLoaderLocation(){return lo.singleton.textureUtils.lottieLoaderUrl}static mapURLs(e){lo.singleton.loader[Ui].manager.setURLModifier(e)}dismissPoster(){this.loaded?this[Au]():(this[lu]=!0,this[JA]())}showPoster(){const e=this[ru];if(e.classList.contains("show"))return;e.classList.add("show"),this[$A].classList.remove("show");const t=this[ou];t.removeAttribute("tabindex"),t.removeAttribute("aria-hidden");const i=this.modelIsVisible;this[cu]=!1,this[HA](i)}getDimensions(){return cc(this[ec].size)}getBoundingBoxCenter(){return cc(this[ec].boundingBox.getCenter(new t.Vector3))}constructor(...e){super(...e),this.poster=null,this.reveal=iu,this.loading=su,this[i]=!1,this[s]=!1,this[n]=this.shadowRoot.querySelector(".slot.poster"),this[a]=this.shadowRoot.querySelector("#default-poster"),this[r]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[o]=this[ou].getAttribute("aria-label"),this[l]=Se((e=>{const t=this[au].parentNode;requestAnimationFrame((()=>{this[au].style.transform=`scaleX(${e})`,0===e&&(t.removeChild(this[au]),t.appendChild(this[au])),this[au].classList.toggle("hide",1===e)}))}),100),this[A]=e=>{const t=e.detail.totalProgress,i=e.detail.reason;1===t&&(this[hu].flush(),this.loaded&&(this[lu]||this.reveal===iu)&&this[Au]()),this[hu](t),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:t,reason:i}}))};const t=self.ModelViewerElement||{},c=t.dracoDecoderLocation||"https://www.gstatic.com/draco/versioned/decoders/1.5.6/";Hi.setDRACODecoderLocation(c);const h=t.ktx2TranscoderLocation||"https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";Hi.setKTX2TranscoderLocation(h),t.meshoptDecoderLocation&&Hi.setMeshoptDecoderLocation(t.meshoptDecoderLocation);const u=t.lottieLoaderLocation||"https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/LottieLoader.js";lo.singleton.textureUtils.lottieLoaderUrl=u}connectedCallback(){super.connectedCallback(),this.loaded||this.showPoster(),this[rc].addEventListener("progress",this[du])}disconnectedCallback(){super.disconnectedCallback(),this[rc].removeEventListener("progress",this[du])}async updated(e){super.updated(e),e.has("poster")&&null!=this.poster&&(this[ou].style.backgroundImage=`url(${this.poster})`),e.has("alt")&&this[ou].setAttribute("aria-label",this[qA]),(e.has("reveal")||e.has("loading"))&&this[JA]()}[(i=cu,s=lu,n=ru,a=ou,r=au,o=uu,l=hu,A=du,Ac)](){return!!this.src&&(this[lu]||this.loading===nu||this.reveal===iu&&this[jA])}[Au](){this[lu]=!1;const e=this[ru];if(!e.classList.contains("show"))return;e.classList.remove("show"),this[$A].classList.add("show");const t=this.modelIsVisible;this[cu]=!0,this[HA](t);const i=this.getRootNode();i&&i.activeElement===this&&this[$A].focus();const s=this[ou];s.setAttribute("aria-hidden","true"),s.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))}[lc](){return super[lc]()&&this[cu]}}return tu([v({type:String})],c.prototype,"poster",void 0),tu([v({type:String})],c.prototype,"reveal",void 0),tu([v({type:String})],c.prototype,"loading",void 0),c})((e=>{var i;class s extends e{constructor(...e){super(e),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[i]=!0,this[ec].subscribeMixerEvent("loop",(e=>{const t=e.action._loopCount,i=e.action._clip.name,s=e.action._clip.uuid,n=this[ec].markedAnimations.find((e=>e.name===i));if(n){this[ec].updateAnimationLoop(n.name,n.loopMode,n.repetitionCount);const e=this[ec].markedAnimations.filter((e=>e.name!==i));this[ec].markedAnimations=e}this.dispatchEvent(new CustomEvent("loop",{detail:{count:t,name:i,uuid:s}}))})),this[ec].subscribeMixerEvent("finished",(e=>{if(this[ec].appendedAnimations.includes(e.action._clip.name)){const t=this[ec].appendedAnimations.filter((t=>t!==e.action._clip.name));this[ec].appendedAnimations=t}else this[fc]=!0;this.dispatchEvent(new CustomEvent("finished"))}))}get availableAnimations(){return this.loaded?this[ec].animationNames:[]}get duration(){return this[ec].duration}get paused(){return this[fc]}get currentTime(){return this[ec].animationTime}get appendedAnimations(){return this[ec].appendedAnimations}set currentTime(e){this[ec].animationTime=e,this[tc]()}get timeScale(){return this[ec].animationTimeScale}set timeScale(e){this[ec].animationTimeScale=e}pause(){this[fc]||(this[fc]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(e){this.availableAnimations.length>0&&(this[fc]=!1,this[pc](e),this.dispatchEvent(new CustomEvent("play")))}appendAnimation(e,t){this.availableAnimations.length>0&&(this[fc]=!1,this[gc](e,t),this.dispatchEvent(new CustomEvent("append-animation")))}detachAnimation(e,t){this.availableAnimations.length>0&&(this[fc]=!1,this[mc](e,t),this.dispatchEvent(new CustomEvent("detach-animation")))}[(i=fc,sc)](){super[sc](),this[fc]=!0,null!=this.animationName&&this[pc](),this.autoplay&&this.play()}[ic](e,t){super[ic](e,t),this[fc]||!this[lc]()&&!this[ac].isPresenting||(this[ec].updateAnimation(t/1e3),this[tc]())}updated(e){super.updated(e),e.has("autoplay")&&this.autoplay&&this.play(),e.has("animationName")&&this[pc]()}[pc](e=bc){var i;const s=null!==(i=e.repetitions)&&void 0!==i?i:1/0,n=e.pingpong?t.LoopPingPong:1===s?t.LoopOnce:t.LoopRepeat;this[ec].playAnimation(this.animationName,this.animationCrossfadeDuration/1e3,n,s),this[fc]&&(this[ec].updateAnimation(0),this[tc]())}[gc](e="",i=yc){var s;const n=null!==(s=i.repetitions)&&void 0!==s?s:1/0,a=i.pingpong?t.LoopPingPong:1===n?t.LoopOnce:t.LoopRepeat,r=!!i.repetitions||"pingpong"in i;this[ec].appendAnimation(e||this.animationName,a,n,i.weight,i.timeScale,i.fade,i.warp,i.relativeWarp,i.time,r),this[fc]&&(this[ec].updateAnimation(0),this[tc]())}[mc](e="",t=Cc){this[ec].detachAnimation(e||this.animationName,t.fade),this[fc]&&(this[ec].updateAnimation(0),this[tc]())}}return dc([v({type:Boolean})],s.prototype,"autoplay",void 0),dc([v({type:String,attribute:"animation-name"})],s.prototype,"animationName",void 0),dc([v({type:Number,attribute:"animation-crossfade-duration"})],s.prototype,"animationCrossfadeDuration",void 0),s})(uc)))))))))))))))),Ep=Ip;customElements.define("model-viewer",Ep),Object.defineProperty(e,"CanvasTexture",{enumerable:!0,get:function(){return t.CanvasTexture}}),Object.defineProperty(e,"FileLoader",{enumerable:!0,get:function(){return t.FileLoader}}),Object.defineProperty(e,"Loader",{enumerable:!0,get:function(){return t.Loader}}),Object.defineProperty(e,"NearestFilter",{enumerable:!0,get:function(){return t.NearestFilter}}),e.ModelViewerElement=Ep}));
//# sourceMappingURL=model-viewer-module-umd.min.js.map
