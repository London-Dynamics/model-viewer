import{ACESFilmicToneMapping as e,AgXToneMapping as t,ReinhardToneMapping as i,CineonToneMapping as s,LinearToneMapping as n,NoToneMapping as a,NeutralToneMapping as r,Loader as o,FileLoader as A,SRGBColorSpace as l,LinearSRGBColorSpace as c,BufferGeometry as h,BufferAttribute as u,Color as d,ColorManagement as p,TrianglesDrawMode as g,TriangleFanDrawMode as m,TriangleStripDrawMode as f,LoaderUtils as b,MeshPhysicalMaterial as I,Vector2 as y,SpotLight as C,PointLight as E,DirectionalLight as w,Matrix4 as B,Vector3 as v,Quaternion as x,InstancedMesh as S,InstancedBufferAttribute as Q,Object3D as M,TextureLoader as T,ImageBitmapLoader as D,InterleavedBuffer as R,InterleavedBufferAttribute as k,LinearMipmapLinearFilter as F,NearestMipmapLinearFilter as L,LinearMipmapNearestFilter as _,NearestMipmapNearestFilter as P,LinearFilter as O,NearestFilter as U,RepeatWrapping as G,MirroredRepeatWrapping as N,ClampToEdgeWrapping as j,PointsMaterial as H,Material as z,LineBasicMaterial as q,MeshStandardMaterial as V,DoubleSide as K,MeshBasicMaterial as J,PropertyBinding as Y,SkinnedMesh as W,Mesh as X,LineSegments as $,Line as Z,LineLoop as ee,Points as te,Group as ie,PerspectiveCamera as se,MathUtils as ne,OrthographicCamera as ae,Skeleton as re,AnimationClip as oe,Bone as Ae,InterpolateDiscrete as le,InterpolateLinear as ce,Texture as he,VectorKeyframeTrack as ue,NumberKeyframeTrack as de,QuaternionKeyframeTrack as pe,FrontSide as ge,Interpolant as me,Box3 as fe,Sphere as be,CompressedCubeTexture as Ie,CompressedArrayTexture as ye,CompressedTexture as Ce,NoColorSpace as Ee,RGBA_ASTC_6x6_Format as we,RGBA_ASTC_4x4_Format as Be,RedFormat as ve,RGFormat as xe,RGBAFormat as Se,UnsignedByteType as Qe,HalfFloatType as Me,FloatType as Te,DataTexture as De,Data3DTexture as Re,RGBA_S3TC_DXT1_Format as ke,RGB_PVRTC_4BPPV1_Format as Fe,RGB_ETC2_Format as Le,RGB_ETC1_Format as _e,RGBA_S3TC_DXT5_Format as Pe,RGBA_PVRTC_4BPPV1_Format as Oe,RGBA_ETC2_EAC_Format as Ue,RGBA_BPTC_Format as Ge,RGB_BPTC_UNSIGNED_Format as Ne,EventDispatcher as je,REVISION as He,Source as ze,Scene as qe,LightProbe as Ve,WebGLCubeRenderTarget as Ke,Float32BufferAttribute as Je,PlaneGeometry as Ye,BoxGeometry as We,Spherical as Xe,Matrix3 as $e,Euler as Ze,WebGLRenderTarget as et,UVMapping as tt,WebGLRenderer as it,ShaderMaterial as st,IntType as nt,ShortType as at,ByteType as rt,UnsignedIntType as ot,LoadingManager as At,LinearMipMapLinearFilter as lt,NoBlending as ct,DataTextureLoader as ht,DataUtils as ut,BackSide as dt,EquirectangularReflectionMapping as pt,CubeCamera as gt,VideoTexture as mt,CanvasTexture as ft,SphereGeometry as bt,Triangle as It,MeshDepthMaterial as yt,Raycaster as Ct,AnimationMixer as Et,LoopPingPong as wt,LoopRepeat as Bt,LoopOnce as vt,Plane as xt,Vector4 as St,UniformsUtils as Qt,UniformsLib as Mt,PMREMGenerator as Tt,CircleGeometry as Dt,Uniform as Rt}from"three";export{CanvasTexture,FileLoader,Loader,NearestFilter}from"three";
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const kt=globalThis,Ft=kt.ShadowRoot&&(void 0===kt.ShadyCSS||kt.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Lt=Symbol(),_t=new WeakMap;let Pt=class{constructor(e,t,i){if(this._$cssResult$=!0,i!==Lt)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Ft&&void 0===e){const i=void 0!==t&&1===t.length;i&&(e=_t.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&_t.set(t,e))}return e}toString(){return this.cssText}};const Ot=Ft?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new Pt("string"==typeof e?e:e+"",void 0,Lt))(t)})(e):e,{is:Ut,defineProperty:Gt,getOwnPropertyDescriptor:Nt,getOwnPropertyNames:jt,getOwnPropertySymbols:Ht,getPrototypeOf:zt}=Object,qt=globalThis,Vt=qt.trustedTypes,Kt=Vt?Vt.emptyScript:"",Jt=qt.reactiveElementPolyfillSupport,Yt=(e,t)=>e,Wt={toAttribute(e,t){switch(t){case Boolean:e=e?Kt:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},Xt=(e,t)=>!Ut(e,t),$t={attribute:!0,type:String,converter:Wt,reflect:!1,useDefault:!1,hasChanged:Xt};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */Symbol.metadata??=Symbol("metadata"),qt.litPropertyMetadata??=new WeakMap;let Zt=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=$t){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const i=Symbol(),s=this.getPropertyDescriptor(e,i,t);void 0!==s&&Gt(this.prototype,e,s)}}static getPropertyDescriptor(e,t,i){const{get:s,set:n}=Nt(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:s,set(t){const a=s?.call(this);n?.call(this,t),this.requestUpdate(e,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??$t}static _$Ei(){if(this.hasOwnProperty(Yt("elementProperties")))return;const e=zt(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Yt("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Yt("properties"))){const e=this.properties,t=[...jt(e),...Ht(e)];for(const i of t)this.createProperty(i,e[i])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,i]of t)this.elementProperties.set(e,i)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const i=this._$Eu(e,t);void 0!==i&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(Ot(e))}else void 0!==e&&t.push(Ot(e));return t}static _$Eu(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(Ft)e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet));else for(const i of t){const t=document.createElement("style"),s=kt.litNonce;void 0!==s&&t.setAttribute("nonce",s),t.textContent=i.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$ET(e,t){const i=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,i);if(void 0!==s&&!0===i.reflect){const n=(void 0!==i.converter?.toAttribute?i.converter:Wt).toAttribute(t,i.type);this._$Em=e,null==n?this.removeAttribute(s):this.setAttribute(s,n),this._$Em=null}}_$AK(e,t){const i=this.constructor,s=i._$Eh.get(e);if(void 0!==s&&this._$Em!==s){const e=i.getPropertyOptions(s),n="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:Wt;this._$Em=s,this[s]=n.fromAttribute(t,e.type)??this._$Ej?.get(s)??null,this._$Em=null}}requestUpdate(e,t,i){if(void 0!==e){const s=this.constructor,n=this[e];if(i??=s.getPropertyOptions(e),!((i.hasChanged??Xt)(n,t)||i.useDefault&&i.reflect&&n===this._$Ej?.get(e)&&!this.hasAttribute(s._$Eu(e,i))))return;this.C(e,t,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:i,reflect:s,wrapped:n},a){i&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,a??t??this[e]),!0!==n||void 0!==a)||(this._$AL.has(e)||(this.hasUpdated||i||(t=void 0),this._$AL.set(e,t)),!0===s&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,i]of e){const{wrapped:e}=i,s=this[t];!0!==e||this._$AL.has(t)||void 0===s||this.C(t,void 0,i,s)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach((e=>e.hostUpdate?.())),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach((e=>e.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach((e=>this._$ET(e,this[e]))),this._$EM()}updated(e){}firstUpdated(e){}};Zt.elementStyles=[],Zt.shadowRootOptions={mode:"open"},Zt[Yt("elementProperties")]=new Map,Zt[Yt("finalized")]=new Map,Jt?.({ReactiveElement:Zt}),(qt.reactiveElementVersions??=[]).push("2.1.0");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const ei={attribute:!0,type:String,converter:Wt,reflect:!1,hasChanged:Xt},ti=(e=ei,t,i)=>{const{kind:s,metadata:n}=i;let a=globalThis.litPropertyMetadata.get(n);if(void 0===a&&globalThis.litPropertyMetadata.set(n,a=new Map),"setter"===s&&((e=Object.create(e)).wrapped=!0),a.set(i.name,e),"accessor"===s){const{name:s}=i;return{set(i){const n=t.get.call(this);t.set.call(this,i),this.requestUpdate(s,n,e)},init(t){return void 0!==t&&this.C(s,void 0,e,t),t}}}if("setter"===s){const{name:s}=i;return function(i){const n=this[s];t.call(this,i),this.requestUpdate(s,n,e)}}throw Error("Unsupported decorator location: "+s)};function ii(e){return(t,i)=>"object"==typeof i?ti(e,t,i):((e,t,i)=>{const s=t.hasOwnProperty(i);return t.constructor.createProperty(i,e),s?Object.getOwnPropertyDescriptor(t,i):void 0})(e,t,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const si=globalThis,ni=si.trustedTypes,ai=ni?ni.createPolicy("lit-html",{createHTML:e=>e}):void 0,ri="$lit$",oi=`lit$${Math.random().toFixed(9).slice(2)}$`,Ai="?"+oi,li=`<${Ai}>`,ci=document,hi=()=>ci.createComment(""),ui=e=>null===e||"object"!=typeof e&&"function"!=typeof e,di=Array.isArray,pi="[ \t\n\f\r]",gi=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,mi=/-->/g,fi=/>/g,bi=RegExp(`>|${pi}(?:([^\\s"'>=/]+)(${pi}*=${pi}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),Ii=/'/g,yi=/"/g,Ci=/^(?:script|style|textarea|title)$/i,Ei=(e=>(t,...i)=>({_$litType$:e,strings:t,values:i}))(1),wi=Symbol.for("lit-noChange"),Bi=Symbol.for("lit-nothing"),vi=new WeakMap,xi=ci.createTreeWalker(ci,129);function Si(e,t){if(!di(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==ai?ai.createHTML(t):t}const Qi=(e,t)=>{const i=e.length-1,s=[];let n,a=2===t?"<svg>":3===t?"<math>":"",r=gi;for(let t=0;t<i;t++){const i=e[t];let o,A,l=-1,c=0;for(;c<i.length&&(r.lastIndex=c,A=r.exec(i),null!==A);)c=r.lastIndex,r===gi?"!--"===A[1]?r=mi:void 0!==A[1]?r=fi:void 0!==A[2]?(Ci.test(A[2])&&(n=RegExp("</"+A[2],"g")),r=bi):void 0!==A[3]&&(r=bi):r===bi?">"===A[0]?(r=n??gi,l=-1):void 0===A[1]?l=-2:(l=r.lastIndex-A[2].length,o=A[1],r=void 0===A[3]?bi:'"'===A[3]?yi:Ii):r===yi||r===Ii?r=bi:r===mi||r===fi?r=gi:(r=bi,n=void 0);const h=r===bi&&e[t+1].startsWith("/>")?" ":"";a+=r===gi?i+li:l>=0?(s.push(o),i.slice(0,l)+ri+i.slice(l)+oi+h):i+oi+(-2===l?t:h)}return[Si(e,a+(e[i]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),s]};class Mi{constructor({strings:e,_$litType$:t},i){let s;this.parts=[];let n=0,a=0;const r=e.length-1,o=this.parts,[A,l]=Qi(e,t);if(this.el=Mi.createElement(A,i),xi.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(s=xi.nextNode())&&o.length<r;){if(1===s.nodeType){if(s.hasAttributes())for(const e of s.getAttributeNames())if(e.endsWith(ri)){const t=l[a++],i=s.getAttribute(e).split(oi),r=/([.?@])?(.*)/.exec(t);o.push({type:1,index:n,name:r[2],strings:i,ctor:"."===r[1]?Fi:"?"===r[1]?Li:"@"===r[1]?_i:ki}),s.removeAttribute(e)}else e.startsWith(oi)&&(o.push({type:6,index:n}),s.removeAttribute(e));if(Ci.test(s.tagName)){const e=s.textContent.split(oi),t=e.length-1;if(t>0){s.textContent=ni?ni.emptyScript:"";for(let i=0;i<t;i++)s.append(e[i],hi()),xi.nextNode(),o.push({type:2,index:++n});s.append(e[t],hi())}}}else if(8===s.nodeType)if(s.data===Ai)o.push({type:2,index:n});else{let e=-1;for(;-1!==(e=s.data.indexOf(oi,e+1));)o.push({type:7,index:n}),e+=oi.length-1}n++}}static createElement(e,t){const i=ci.createElement("template");return i.innerHTML=e,i}}function Ti(e,t,i=e,s){if(t===wi)return t;let n=void 0!==s?i._$Co?.[s]:i._$Cl;const a=ui(t)?void 0:t._$litDirective$;return n?.constructor!==a&&(n?._$AO?.(!1),void 0===a?n=void 0:(n=new a(e),n._$AT(e,i,s)),void 0!==s?(i._$Co??=[])[s]=n:i._$Cl=n),void 0!==n&&(t=Ti(e,n._$AS(e,t.values),n,s)),t}class Di{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,s=(e?.creationScope??ci).importNode(t,!0);xi.currentNode=s;let n=xi.nextNode(),a=0,r=0,o=i[0];for(;void 0!==o;){if(a===o.index){let t;2===o.type?t=new Ri(n,n.nextSibling,this,e):1===o.type?t=new o.ctor(n,o.name,o.strings,this,e):6===o.type&&(t=new Pi(n,this,e)),this._$AV.push(t),o=i[++r]}a!==o?.index&&(n=xi.nextNode(),a++)}return xi.currentNode=ci,s}p(e){let t=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}let Ri=class e{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,i,s){this.type=2,this._$AH=Bi,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ti(this,e,t),ui(e)?e===Bi||null==e||""===e?(this._$AH!==Bi&&this._$AR(),this._$AH=Bi):e!==this._$AH&&e!==wi&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>di(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Bi&&ui(this._$AH)?this._$AA.nextSibling.data=e:this.T(ci.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:i}=e,s="number"==typeof i?this._$AC(e):(void 0===i.el&&(i.el=Mi.createElement(Si(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===s)this._$AH.p(t);else{const e=new Di(s,this),i=e.u(this.options);e.p(t),this.T(i),this._$AH=e}}_$AC(e){let t=vi.get(e.strings);return void 0===t&&vi.set(e.strings,t=new Mi(e)),t}k(t){di(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let s,n=0;for(const a of t)n===i.length?i.push(s=new e(this.O(hi()),this.O(hi()),this,this.options)):s=i[n],s._$AI(a),n++;n<i.length&&(this._$AR(s&&s._$AB.nextSibling,n),i.length=n)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}};class ki{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,s,n){this.type=1,this._$AH=Bi,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=n,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Bi}_$AI(e,t=this,i,s){const n=this.strings;let a=!1;if(void 0===n)e=Ti(this,e,t,0),a=!ui(e)||e!==this._$AH&&e!==wi,a&&(this._$AH=e);else{const s=e;let r,o;for(e=n[0],r=0;r<n.length-1;r++)o=Ti(this,s[i+r],t,r),o===wi&&(o=this._$AH[r]),a||=!ui(o)||o!==this._$AH[r],o===Bi?e=Bi:e!==Bi&&(e+=(o??"")+n[r+1]),this._$AH[r]=o}a&&!s&&this.j(e)}j(e){e===Bi?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Fi extends ki{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Bi?void 0:e}}let Li=class extends ki{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Bi)}};class _i extends ki{constructor(e,t,i,s,n){super(e,t,i,s,n),this.type=5}_$AI(e,t=this){if((e=Ti(this,e,t,0)??Bi)===wi)return;const i=this._$AH,s=e===Bi&&i!==Bi||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,n=e!==Bi&&(i===Bi||s);s&&this.element.removeEventListener(this.name,this,i),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class Pi{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Ti(this,e)}}const Oi=si.litHtmlPolyfillSupport;Oi?.(Mi,Ri),(si.litHtmlVersions??=[]).push("3.3.0");const Ui=(e,t,i)=>{const s=i?.renderBefore??t;let n=s._$litPart$;if(void 0===n){const e=i?.renderBefore??null;s._$litPart$=n=new Ri(t.insertBefore(hi(),e),e,void 0,i??{})}return n._$AI(e),n
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */},Gi=globalThis;let Ni=class extends Zt{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Ui(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return wi}};Ni._$litElement$=!0,Ni.finalized=!0,Gi.litElementHydrateSupport?.({LitElement:Ni});const ji=Gi.litElementPolyfillSupport;ji?.({LitElement:Ni}),(Gi.litElementVersions??=[]).push("4.2.0");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Hi=null!=navigator.xr&&null!=self.XRSession&&null!=navigator.xr.isSessionSupported,zi=Hi&&null!=self.XRSession.prototype.requestHitTestSource,qi=null!=self.ResizeObserver,Vi=null!=self.IntersectionObserver,Ki=zi;(()=>{const e=navigator.userAgent||navigator.vendor||self.opera;let t=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)})();const Ji=/android/i.test(navigator.userAgent),Yi=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,Wi=/firefox/i.test(navigator.userAgent),Xi=/OculusBrowser/.test(navigator.userAgent),$i=Ji&&!Wi&&!Xi,Zi=Boolean(window.webkit&&window.webkit.messageHandlers),es=(()=>{if(Yi){if(Zi)return Boolean(/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent));{const e=document.createElement("a");return Boolean(e.relList&&e.relList.supports&&e.relList.supports("ar"))}}return!1})(),ts=e=>e&&"null"!==e?ss(e):null,is=()=>{if(Ki)return;const e=[];throw Hi||e.push("WebXR Device API"),zi||e.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${e.join(", ")}`)},ss=e=>new URL(e,window.location.toString()).toString(),ns=(e,t)=>{let i=null;const s=(...s)=>{null==i&&(e(...s),i=self.setTimeout((()=>i=null),t))};return s.flush=()=>{null!=i&&(self.clearTimeout(i),i=null)},s},as=(e,t)=>{let i=null;return(...s)=>{null!=i&&self.clearTimeout(i),i=self.setTimeout((()=>{i=null,e(...s)}),t)}},rs=(e,t,i)=>Math.max(t,Math.min(i,e)),os=(()=>{const e=new RegExp("[?&]model-viewer-debug-mode(&|$)");return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(e)})();
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var As=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const ls=Symbol("currentEnvironmentMap"),cs=Symbol("currentBackground"),hs=Symbol("updateEnvironment"),us=Symbol("cancelEnvironmentUpdate");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ds=Ei` <style>
       :host {
         display: block;
         position: relative;
         contain: strict;
         width: 300px;
         height: 150px;
       }

       .container {
         position: relative;
         overflow: hidden;
       }

       .userInput {
         width: 100%;
         height: 100%;
         display: none;
         position: relative;
         outline-offset: -1px;
         outline-width: 1px;
       }

       canvas {
         position: absolute;
         display: none;
         pointer-events: none;
         /* NOTE(cdata): Chrome 76 and below apparently have a bug
      * that causes our canvas not to display pixels unless it is
      * on its own render layer
      * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
      */
         transform: translateZ(0);
       }

       .show {
         display: block;
       }

       /* Adapted from HTML5 Boilerplate
    *
    * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
       .screen-reader-only {
         border: 0;
         left: 0;
         top: 0;
         clip: rect(0, 0, 0, 0);
         height: 1px;
         margin: -1px;
         overflow: hidden;
         padding: 0;
         position: absolute;
         white-space: nowrap;
         width: 1px;
         pointer-events: none;
       }

       .slot {
         position: absolute;
         pointer-events: none;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
       }

       .slot > * {
         pointer-events: initial;
       }

       .annotation-wrapper ::slotted(*) {
         opacity: var(--max-hotspot-opacity, 1);
         transition: opacity 0.3s;
       }

       .pointer-tumbling .annotation-wrapper ::slotted(*) {
         pointer-events: none;
       }

       .annotation-wrapper ::slotted(*) {
         pointer-events: initial;
       }

       .annotation-wrapper.hide ::slotted(*) {
         opacity: var(--min-hotspot-opacity, 0.25);
       }

       .slot.poster {
         display: none;
         background-color: inherit;
       }

       .slot.poster.show {
         display: inherit;
       }

       .slot.poster > * {
         pointer-events: initial;
       }

       .slot.poster:not(.show) > * {
         pointer-events: none;
       }

       #default-poster {
         width: 100%;
         height: 100%;
         /* The default poster is a <button> so we need to set display
      * to prevent it from being affected by text-align: */
         display: block;
         position: absolute;
         border: none;
         padding: 0;
         background-size: contain;
         background-repeat: no-repeat;
         background-position: center;
         background-color: #fff0;
       }

       #default-progress-bar {
         display: block;
         position: relative;
         width: 100%;
         height: 100%;
         pointer-events: none;
         overflow: hidden;
       }

       #default-progress-bar > .bar {
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: var(--progress-bar-height, 5px);
         background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
         transition: transform 0.09s;
         transform-origin: top left;
         transform: scaleX(0);
         overflow: hidden;
       }

       #default-progress-bar > .bar.hide {
         transition: opacity 0.3s 1s;
         opacity: 0;
       }

       .centered {
         align-items: center;
         justify-content: center;
       }

       .cover {
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         pointer-events: none;
       }

       .slot.interaction-prompt {
         display: var(--interaction-prompt-display, flex);
         overflow: hidden;
         opacity: 0;
         will-change: opacity;
         transition: opacity 0.3s;
       }

       .slot.interaction-prompt.visible {
         opacity: 1;
       }

       .animated-container {
         will-change: transform, opacity;
         opacity: 0;
         transition: opacity 0.3s;
       }

       .slot.interaction-prompt > * {
         pointer-events: none;
       }

       .slot.ar-button {
         -moz-user-select: none;
         -webkit-tap-highlight-color: transparent;
         user-select: none;

         display: var(--ar-button-display, block);
       }

       .slot.ar-button:not(.enabled) {
         display: none;
       }

       .fab {
         display: flex;
         align-items: center;
         justify-content: center;
         box-sizing: border-box;
         width: 40px;
         height: 40px;
         cursor: pointer;
         background-color: #fff;
         box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
         border-radius: 100px;
       }

       .fab > * {
         opacity: 0.87;
       }

       #default-ar-button {
         position: absolute;
         bottom: 16px;
         right: 16px;
         transform: scale(var(--ar-button-scale, 1));
         transform-origin: bottom right;
       }

       .slot.pan-target {
         display: block;
         position: absolute;
         width: 0;
         height: 0;
         left: 50%;
         top: 50%;
         transform: translate3d(-50%, -50%, 0);
         background-color: transparent;
         opacity: 0;
         transition: opacity 0.3s;
       }

       #default-pan-target {
         width: 6px;
         height: 6px;
         border-radius: 6px;
         border: 1px solid white;
         box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
       }

       .slot.default {
         pointer-events: none;
       }

       .slot.progress-bar {
         pointer-events: none;
       }

       .slot.exit-webxr-ar-button {
         pointer-events: none;
       }

       .slot.exit-webxr-ar-button:not(.enabled) {
         display: none;
       }

       .ld-measure .ruler {
         position: absolute;
         font-size: 0.8rem;
         background-color: #fefefe;
         padding: 0.1rem 0.5rem;
         border-radius: 1rem;
         white-space: nowrap;
       }

       /* Hide the ld-puzzler slot template content by default */
       .slot.ld-puzzler > slot {
         display: none;
       }

       /* LD Puzzler Styles */
       .ld-puzzler .ld-snapping-point {
         pointer-events: none;
       }

       .ld-puzzler .back-facing .ld-snapping-point {
          opacity: 0.4;
       }

       .ld-puzzler .ld-floating-control-strip {
         pointer-events: auto;
         position: absolute;
         z-index: 100;
       }

       .ld-puzzler .ld-rotation-control {

       }

       .ld-puzzler .ld-break-link {

        pointer-events: auto;

       }

       .ld-puzzler .default-icon {
         font-size: 16px;
         line-height: 1;
         font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
         sans-serif;
        }
  </style>
  <div class="container">
    <div class="userInput" tabindex="0" role="img" aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>
    </div>

    <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
    <div class="slot poster">
      <slot name="poster">
        <button
          type="button"
          id="default-poster"
          aria-hidden="true"
          aria-label="Loading 3D model"
        ></button>
      </slot>
    </div>

    <div class="slot ar-button">
      <slot name="ar-button">
        <a
          id="default-ar-button"
          part="default-ar-button"
          class="fab"
          tabindex="2"
          role="button"
          href="javascript:void(0);"
          aria-label="View in your space"
        >
          ${Ei`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`}
        </a>
      </slot>
    </div>

    <div class="slot pan-target">
      <slot name="pan-target">
        <div id="default-pan-target"></div>
      </slot>
    </div>

    <div class="slot interaction-prompt cover centered">
      <div id="prompt" class="animated-container">
        <slot name="interaction-prompt" aria-hidden="true">
          ${Ei`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}
        </slot>
      </div>
    </div>

    <div id="finger0" class="animated-container cover">
      <slot name="finger0" aria-hidden="true"> </slot>
    </div>
    <div id="finger1" class="animated-container cover">
      <slot name="finger1" aria-hidden="true"> </slot>
    </div>

    <div class="slot ld-measure">
      <slot name="ruler-width">
        <div class="ruler" id="default-ruler-width" aria-hidden="true"></div>
      </slot>
      <slot name="ruler-height">
        <div class="ruler" id="default-ruler-height" aria-hidden="true"></div>
      </slot>
      <slot name="ruler-depth">
        <div class="ruler" id="default-ruler-depth" aria-hidden="true"></div>
      </slot>
    </div>

    <div class="slot ld-puzzler">
      <slot name="snapping-point">
        <div
          class="ld-snapping-point"
          part="ld-snapping-point"
          aria-hidden="true"
        ></div>
      </slot>
      <slot name="floating-control-strip">
        <div
          class="ld-floating-control-strip"
          part="ld-floating-control-strip"
          aria-hidden="true"
        ></div>
      </slot>
      <slot name="rotation-left">
        <div
          class="ld-rotation-control"
          part="ld-rotation-control ld-rotation-left"
          aria-hidden="true"
        >
          <div class="default-icon" part="ld-rotation-icon">↺</div>
        </div>
      </slot>
      <slot name="rotation-right">
        <div
          class="ld-rotation-control"
          part="ld-rotation-control ld-rotation-right"
          aria-hidden="true"
        >
          <div class="default-icon" part="ld-rotation-icon">↻</div>
        </div>
      </slot>
      <slot name="break-link">
        <div class="ld-break-link" part="ld-break-link" aria-hidden="true">
          <div class="default-icon" part="ld-break-link-icon">✖</div>
        </div>
      </slot>
    </div>

    <div class="slot default">
      <slot></slot>

      <div class="slot progress-bar">
        <slot name="progress-bar">
          <div id="default-progress-bar" aria-hidden="true">
            <div class="bar" part="default-progress-bar"></div>
          </div>
        </slot>
      </div>

      <div class="slot exit-webxr-ar-button">
        <slot name="exit-webxr-ar-button">
          <a
            id="default-exit-webxr-ar-button"
            part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true"
          >
            ${Ei`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}
          </a>
        </slot>
      </div>
    </div>
  </div>
  <div class="screen-reader-only" role="region" aria-label="Live announcements">
    <span id="status" role="status"></span>
  </div>`;var ps=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var i,s=WebAssembly.validate(e)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",n=WebAssembly.instantiate(a(s),{}).then((function(e){(i=e.instance).exports.__wasm_call_ctors()}));function a(e){for(var i=new Uint8Array(e.length),s=0;s<e.length;++s){var n=e.charCodeAt(s);i[s]=n>96?n-97:n>64?n-39:n+4}var a=0;for(s=0;s<e.length;++s)i[a++]=i[s]<60?t[i[s]]:64*(i[s]-60)+i[++s];return i.buffer.slice(0,a)}function r(e,t,s,n,a,r){var o=i.exports.sbrk,A=s+3&-4,l=o(A*n),c=o(a.length),h=new Uint8Array(i.exports.memory.buffer);h.set(a,c);var u=e(l,s,n,c,a.length);if(0==u&&r&&r(l,A,n),t.set(h.subarray(l,l+s*n)),o(l-o(0)),0!=u)throw new Error("Malformed buffer data: "+u)}var o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},A={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},l=[],c=0;function h(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var i=e.data;t.pending-=i.count,t.requests[i.id][i.action](i.value),delete t.requests[i.id]},t}function u(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(s))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+r.toString()+d.toString(),i=new Blob([t],{type:"text/javascript"}),n=URL.createObjectURL(i),o=0;o<e;++o)l[o]=h(n);URL.revokeObjectURL(n)}function d(e){n.then((function(){var t=e.data;try{var s=new Uint8Array(t.count*t.size);r(i.exports[t.mode],s,t.count,t.size,t.source,i.exports[t.filter]),self.postMessage({id:t.id,count:t.count,action:"resolve",value:s},[s.buffer])}catch(e){self.postMessage({id:t.id,count:t.count,action:"reject",value:e})}}))}return{ready:n,supported:!0,useWorkers:function(e){u(e)},decodeVertexBuffer:function(e,t,s,n,a){r(i.exports.meshopt_decodeVertexBuffer,e,t,s,n,i.exports[o[a]])},decodeIndexBuffer:function(e,t,s,n){r(i.exports.meshopt_decodeIndexBuffer,e,t,s,n)},decodeIndexSequence:function(e,t,s,n){r(i.exports.meshopt_decodeIndexSequence,e,t,s,n)},decodeGltfBuffer:function(e,t,s,n,a,l){r(i.exports[A[a]],e,t,s,n,i.exports[o[l]])},decodeGltfBufferAsync:function(e,t,s,a,h){return l.length>0?function(e,t,i,s,n){for(var a=l[0],r=1;r<l.length;++r)l[r].pending<a.pending&&(a=l[r]);return new Promise((function(r,o){var A=new Uint8Array(i),l=c++;a.pending+=e,a.requests[l]={resolve:r,reject:o},a.object.postMessage({id:l,count:e,size:t,source:A,mode:s,filter:n},[A.buffer])}))}(e,t,s,A[a],o[h]):n.then((function(){var n=new Uint8Array(e*t);return r(i.exports[A[a]],n,e,t,s,i.exports[o[h]]),n}))}}}();const gs=new WeakMap;class ms extends o{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){const n=new A(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,(e=>{this.parse(e,t,s)}),i,s)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,l,i).catch(i)}decodeDracoFile(e,t,i,s,n=c,a=()=>{}){const r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:n};return this.decodeGeometry(e,r).then(t).catch(a)}decodeGeometry(e,t){const i=JSON.stringify(t);if(gs.has(e)){const t=gs.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const n=this.workerNextTaskID++,a=e.byteLength,r=this._getWorker(n,a).then((i=>(s=i,new Promise(((i,a)=>{s._callbacks[n]={resolve:i,reject:a},s.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return r.catch((()=>!0)).then((()=>{s&&n&&this._releaseTask(s,n)})),gs.set(e,{key:i,promise:r}),r}_createGeometry(e){const t=new h;e.index&&t.setIndex(new u(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],n=s.name,a=s.array,r=s.itemSize,o=new u(a,r);"color"===n&&(this._assignVertexColorSpace(o,s.vertexColorSpace),o.normalized=a instanceof Float32Array==!1),t.setAttribute(n,o)}return t}_assignVertexColorSpace(e,t){if(t!==l)return;const i=new d;for(let t=0,s=e.count;t<s;t++)i.fromBufferAttribute(e,t),p.toWorkingColorSpace(i,l),e.setXYZ(t,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new A(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise(((t,s)=>{i.load(e,t,void 0,s)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const i=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const s=fs.toString(),n=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const i=t.data;switch(i.type){case"decode":e._callbacks[i.id].resolve(i);break;case"error":e._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function fs(){let e,t;function i(e,t,i,s,n,a){const r=a.num_components(),o=i.num_points()*r,A=o*n.BYTES_PER_ELEMENT,l=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),c=e._malloc(A);t.GetAttributeDataArrayForAllPoints(i,a,l,A,c);const h=new n(e.HEAPF32.buffer,c,o).slice();return e._free(c),{name:s,array:h,itemSize:r}}onmessage=function(s){const n=s.data;switch(n.type){case"init":e=n.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const s=n.buffer,a=n.taskConfig;t.then((e=>{const t=e.draco,r=new t.Decoder;try{const e=function(e,t,s,n){const a=n.attributeIDs,r=n.attributeTypes;let o,A;const l=t.GetEncodedGeometryType(s);if(l===e.TRIANGULAR_MESH)o=new e.Mesh,A=t.DecodeArrayToMesh(s,s.byteLength,o);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,A=t.DecodeArrayToPointCloud(s,s.byteLength,o)}if(!A.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+A.error_msg());const c={index:null,attributes:[]};for(const s in a){const A=self[r[s]];let l,h;if(n.useUniqueIDs)h=a[s],l=t.GetAttributeByUniqueId(o,h);else{if(h=t.GetAttributeId(o,e[a[s]]),-1===h)continue;l=t.GetAttribute(o,h)}const u=i(e,t,o,s,A,l);"color"===s&&(u.vertexColorSpace=n.vertexColorSpace),c.attributes.push(u)}l===e.TRIANGULAR_MESH&&(c.index=function(e,t,i){const s=i.num_faces(),n=3*s,a=4*n,r=e._malloc(a);t.GetTrianglesUInt32Array(i,a,r);const o=new Uint32Array(e.HEAPF32.buffer,r,n).slice();return e._free(r),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),c}(t,r,new Int8Array(s),a),o=e.attributes.map((e=>e.array.buffer));e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:n.id,error:e.message})}finally{t.destroy(r)}}))}}}function bs(e,t){if(t===g)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===m||t===f){let i=e.getIndex();if(null===i){const t=[],s=e.getAttribute("position");if(void 0===s)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<s.count;e++)t.push(e);e.setIndex(t),i=e.getIndex()}const s=i.count-2,n=[];if(t===m)for(let e=1;e<=s;e++)n.push(i.getX(0)),n.push(i.getX(e)),n.push(i.getX(e+1));else for(let e=0;e<s;e++)e%2==0?(n.push(i.getX(e)),n.push(i.getX(e+1)),n.push(i.getX(e+2))):(n.push(i.getX(e+2)),n.push(i.getX(e+1)),n.push(i.getX(e)));n.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(n),a.clearGroups(),a}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class Is extends o{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new vs(e)})),this.register((function(e){return new xs(e)})),this.register((function(e){return new Ls(e)})),this.register((function(e){return new _s(e)})),this.register((function(e){return new Ps(e)})),this.register((function(e){return new Qs(e)})),this.register((function(e){return new Ms(e)})),this.register((function(e){return new Ts(e)})),this.register((function(e){return new Ds(e)})),this.register((function(e){return new Bs(e)})),this.register((function(e){return new Rs(e)})),this.register((function(e){return new Ss(e)})),this.register((function(e){return new Fs(e)})),this.register((function(e){return new ks(e)})),this.register((function(e){return new Es(e)})),this.register((function(e){return new Os(e)})),this.register((function(e){return new Us(e)}))}load(e,t,i,s){const n=this;let a;if(""!==this.resourcePath)a=this.resourcePath;else if(""!==this.path){const t=b.extractUrlBase(e);a=b.resolveURL(t,this.path)}else a=b.extractUrlBase(e);this.manager.itemStart(e);const r=function(t){s?s(t):console.error(t),n.manager.itemError(e),n.manager.itemEnd(e)},o=new A(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){try{n.parse(i,a,(function(i){t(i),n.manager.itemEnd(e)}),r)}catch(e){r(e)}}),i,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let n;const a={},r={},o=new TextDecoder;if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer){if(o.decode(new Uint8Array(e,0,4))===Gs){try{a[Cs.KHR_BINARY_GLTF]=new Hs(e)}catch(e){return void(s&&s(e))}n=JSON.parse(a[Cs.KHR_BINARY_GLTF].content)}else n=JSON.parse(o.decode(e))}else n=e;if(void 0===n.asset||n.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const A=new mn(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});A.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](A);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[t.name]=t,a[t.name]=!0}if(n.extensionsUsed)for(let e=0;e<n.extensionsUsed.length;++e){const t=n.extensionsUsed[e],i=n.extensionsRequired||[];switch(t){case Cs.KHR_MATERIALS_UNLIT:a[t]=new ws;break;case Cs.KHR_DRACO_MESH_COMPRESSION:a[t]=new zs(n,this.dracoLoader);break;case Cs.KHR_TEXTURE_TRANSFORM:a[t]=new qs;break;case Cs.KHR_MESH_QUANTIZATION:a[t]=new Vs;break;default:i.indexOf(t)>=0&&void 0===r[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}A.setExtensions(a),A.setPlugins(r),A.parse(i,s)}parseAsync(e,t){const i=this;return new Promise((function(s,n){i.parse(e,t,s,n)}))}}function ys(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Cs={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Es{constructor(e){this.parser=e,this.name=Cs.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const n=t.json,a=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let r;const o=new d(16777215);void 0!==a.color&&o.setRGB(a.color[0],a.color[1],a.color[2],c);const A=void 0!==a.range?a.range:0;switch(a.type){case"directional":r=new w(o),r.target.position.set(0,0,-1),r.add(r.target);break;case"point":r=new E(o),r.distance=A;break;case"spot":r=new C(o),r.distance=A,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,r.angle=a.spot.outerConeAngle,r.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return r.position.set(0,0,0),r.decay=2,cn(r,a),void 0!==a.intensity&&(r.intensity=a.intensity),r.name=t.createUniqueName(a.name||"light_"+e),s=Promise.resolve(r),t.cache.add(i,s),s}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],n=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then((function(e){return i._getNodeRef(t.cache,n,e)}))}}let ws=class{constructor(){this.name=Cs.KHR_MATERIALS_UNLIT}getMaterialType(){return J}extendParams(e,t,i){const s=[];e.color=new d(1,1,1),e.opacity=1;const n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],c),e.opacity=t[3]}void 0!==n.baseColorTexture&&s.push(i.assignTexture(e,"map",n.baseColorTexture,l))}return Promise.all(s)}},Bs=class{constructor(e){this.parser=e,this.name=Cs.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}},vs=class{constructor(e){this.parser=e,this.name=Cs.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&n.push(i.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&n.push(i.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(n.push(i.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new y(e,e)}return Promise.all(n)}},xs=class{constructor(e){this.parser=e,this.name=Cs.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=void 0!==s.dispersion?s.dispersion:0,Promise.resolve()}},Ss=class{constructor(e){this.parser=e,this.name=Cs.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&n.push(i.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&n.push(i.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(n)}},Qs=class{constructor(e){this.parser=e,this.name=Cs.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[];t.sheenColor=new d(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=s.extensions[this.name];if(void 0!==a.sheenColorFactor){const e=a.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],c)}return void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&n.push(i.assignTexture(t,"sheenColorMap",a.sheenColorTexture,l)),void 0!==a.sheenRoughnessTexture&&n.push(i.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(n)}},Ms=class{constructor(e){this.parser=e,this.name=Cs.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)}},Ts=class{constructor(e){this.parser=e,this.name=Cs.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&n.push(i.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const r=a.attenuationColor||[1,1,1];return t.attenuationColor=(new d).setRGB(r[0],r[1],r[2],c),Promise.all(n)}},Ds=class{constructor(e){this.parser=e,this.name=Cs.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}},Rs=class{constructor(e){this.parser=e,this.name=Cs.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&n.push(i.assignTexture(t,"specularIntensityMap",a.specularTexture));const r=a.specularColorFactor||[1,1,1];return t.specularColor=(new d).setRGB(r[0],r[1],r[2],c),void 0!==a.specularColorTexture&&n.push(i.assignTexture(t,"specularColorMap",a.specularColorTexture,l)),Promise.all(n)}},ks=class{constructor(e){this.parser=e,this.name=Cs.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return t.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&n.push(i.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(n)}},Fs=class{constructor(e){this.parser=e,this.name=Cs.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&n.push(i.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(n)}};class Ls{constructor(e){this.parser=e,this.name=Cs.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const n=s.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,a)}}class _s{constructor(e){this.parser=e,this.name=Cs.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,n=s.textures[e];if(!n.extensions||!n.extensions[t])return null;const a=n.extensions[t],r=s.images[a.source];let o=i.textureLoader;if(r.uri){const e=i.options.manager.getHandler(r.uri);null!==e&&(o=e)}return this.detectSupport().then((function(n){if(n)return i.loadTextureImage(e,a.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Ps{constructor(e){this.parser=e,this.name=Cs.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,n=s.textures[e];if(!n.extensions||!n.extensions[t])return null;const a=n.extensions[t],r=s.images[a.source];let o=i.textureLoader;if(r.uri){const e=i.options.manager.getHandler(r.uri);null!==e&&(o=e)}return this.detectSupport().then((function(n){if(n)return i.loadTextureImage(e,a.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Os{constructor(e){this.name=Cs.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const e=i.extensions[this.name],s=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then((function(t){const i=e.byteOffset||0,s=e.byteLength||0,a=e.count,r=e.byteStride,o=new Uint8Array(t,i,s);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(a,r,o,e.mode,e.filter).then((function(e){return e.buffer})):n.ready.then((function(){const t=new ArrayBuffer(a*r);return n.decodeGltfBuffer(new Uint8Array(t),a,r,o,e.mode,e.filter),t}))}))}return null}}let Us=class{constructor(e){this.name=Cs.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const s=t.meshes[i.mesh];for(const e of s.primitives)if(e.mode!==Ws.TRIANGLES&&e.mode!==Ws.TRIANGLE_STRIP&&e.mode!==Ws.TRIANGLE_FAN&&void 0!==e.mode)return null;const n=i.extensions[this.name].attributes,a=[],r={};for(const e in n)a.push(this.parser.getDependency("accessor",n[e]).then((t=>(r[e]=t,r[e]))));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then((e=>{const t=e.pop(),i=t.isGroup?t.children:[t],s=e[0].count,n=[];for(const e of i){const t=new B,i=new v,a=new x,o=new v(1,1,1),A=new S(e.geometry,e.material,s);for(let e=0;e<s;e++)r.TRANSLATION&&i.fromBufferAttribute(r.TRANSLATION,e),r.ROTATION&&a.fromBufferAttribute(r.ROTATION,e),r.SCALE&&o.fromBufferAttribute(r.SCALE,e),A.setMatrixAt(e,t.compose(i,a,o));for(const t in r)if("_COLOR_0"===t){const e=r[t];A.instanceColor=new Q(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,r[t]);M.prototype.copy.call(A,e),this.parser.assignFinalMaterial(A),n.push(A)}return t.isGroup?(t.clear(),t.add(...n),t):n[0]})))}};const Gs="glTF",Ns=1313821514,js=5130562;class Hs{constructor(e){this.name=Cs.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Gs)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,n=new DataView(e,12);let a=0;for(;a<s;){const t=n.getUint32(a,!0);a+=4;const s=n.getUint32(a,!0);if(a+=4,s===Ns){const s=new Uint8Array(e,12+a,t);this.content=i.decode(s)}else if(s===js){const i=12+a;this.body=e.slice(i,i+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class zs{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Cs.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,r={},o={},A={};for(const e in a){const t=tn[e]||e.toLowerCase();r[t]=a[e]}for(const t in e.attributes){const s=tn[t]||t.toLowerCase();if(void 0!==a[t]){const n=i.accessors[e.attributes[t]],a=Xs[n.componentType];A[s]=a.name,o[s]=!0===n.normalized}}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t,i){s.decodeDracoFile(e,(function(e){for(const t in e.attributes){const i=e.attributes[t],s=o[t];void 0!==s&&(i.normalized=s)}t(e)}),r,A,c,i)}))}))}}class qs{constructor(){this.name=Cs.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Vs{constructor(){this.name=Cs.KHR_MESH_QUANTIZATION}}class Ks extends me{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=e*s*3+s;for(let e=0;e!==s;e++)t[e]=i[n+e];return t}interpolate_(e,t,i,s){const n=this.resultBuffer,a=this.sampleValues,r=this.valueSize,o=2*r,A=3*r,l=s-t,c=(i-t)/l,h=c*c,u=h*c,d=e*A,p=d-A,g=-2*u+3*h,m=u-h,f=1-g,b=m-h+c;for(let e=0;e!==r;e++){const t=a[p+e+r],i=a[p+e+o]*l,s=a[d+e+r],A=a[d+e]*l;n[e]=f*t+b*i+g*s+m*A}return n}}const Js=new x;class Ys extends Ks{interpolate_(e,t,i,s){const n=super.interpolate_(e,t,i,s);return Js.fromArray(n).normalize().toArray(n),n}}const Ws={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Xs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},$s={9728:U,9729:O,9984:P,9985:_,9986:L,9987:F},Zs={33071:j,33648:N,10497:G},en={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},sn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},nn={CUBICSPLINE:void 0,LINEAR:ce,STEP:le},an="OPAQUE",rn="MASK",on="BLEND";function An(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new V({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ge})),e.DefaultMaterial}function ln(e,t,i){for(const s in i.extensions)void 0===e[s]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=i.extensions[s])}function cn(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function hn(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,s=t.weights.length;i<s;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,s=i.length;t<s;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function un(e){let t;const i=e.extensions&&e.extensions[Cs.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+dn(i.attributes):e.indices+":"+dn(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,s=e.targets.length;i<s;i++)t+=":"+dn(e.targets[i]);return t}function dn(e){let t="";const i=Object.keys(e).sort();for(let s=0,n=i.length;s<n;s++)t+=i[s]+":"+e[i[s]]+";";return t}function pn(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const gn=new B;class mn{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ys,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,n=!1,a=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;i=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);s=i&&t?parseInt(t[1],10):-1,n=e.indexOf("Firefox")>-1,a=n?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||i&&s<17||n&&a<98?this.textureLoader=new T(this.options.manager):this.textureLoader=new D(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new A(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(t){const a={scene:t[0][s.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:s.asset,parser:i,userData:{}};return ln(n,a,s),cn(a,s),Promise.all(i._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){for(const e of a.scenes)e.updateMatrixWorld();e(a)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const s=t[i].joints;for(let t=0,i=s.length;t<i;t++)e[s[t]].isBone=!0}for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0!==s.mesh&&(this._addNodeRef(this.meshCache,s.mesh),void 0!==s.skin&&(i[s.mesh].isSkinnedMesh=!0)),void 0!==s.camera&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),n=(e,t)=>{const i=this.associations.get(e);null!=i&&this.associations.set(t,i);for(const[i,s]of e.children.entries())n(s,t.children[i])};return n(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const n=e(t[s]);n&&i.push(n)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":s=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":s=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)})),!s)throw new Error("Unknown type: "+e)}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(s.map((function(t,s){return i.getDependency(e,s)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Cs.KHR_BINARY_GLTF].body);const s=this.options;return new Promise((function(e,n){i.load(b.resolveURL(t.uri,s.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const i=t.byteLength||0,s=t.byteOffset||0;return e.slice(s,s+i)}))}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse){const e=en[s.type],t=Xs[s.componentType],i=!0===s.normalized,n=new t(s.count*e);return Promise.resolve(new u(n,e,i))}const n=[];return void 0!==s.bufferView?n.push(this.getDependency("bufferView",s.bufferView)):n.push(null),void 0!==s.sparse&&(n.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(n).then((function(e){const n=e[0],a=en[s.type],r=Xs[s.componentType],o=r.BYTES_PER_ELEMENT,A=o*a,l=s.byteOffset||0,c=void 0!==s.bufferView?i.bufferViews[s.bufferView].byteStride:void 0,h=!0===s.normalized;let d,p;if(c&&c!==A){const e=Math.floor(l/c),i="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+e+":"+s.count;let A=t.cache.get(i);A||(d=new r(n,e*c,s.count*c/o),A=new R(d,c/o),t.cache.add(i,A)),p=new k(A,a,l%c/o,h)}else d=null===n?new r(s.count*a):new r(n,l,s.count*a),p=new u(d,a,h);if(void 0!==s.sparse){const t=en.SCALAR,i=Xs[s.sparse.indices.componentType],o=s.sparse.indices.byteOffset||0,A=s.sparse.values.byteOffset||0,l=new i(e[1],o,s.sparse.count*t),c=new r(e[2],A,s.sparse.count*a);null!==n&&(p=new u(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,t=l.length;e<t;e++){const t=l[e];if(p.setX(t,c[e*a]),a>=2&&p.setY(t,c[e*a+1]),a>=3&&p.setZ(t,c[e*a+2]),a>=4&&p.setW(t,c[e*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=h}return p}))}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,n=t.images[s];let a=this.textureLoader;if(n.uri){const e=i.manager.getHandler(n.uri);null!==e&&(a=e)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,i){const s=this,n=this.json,a=n.textures[e],r=n.images[t],o=(r.uri||r.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];const A=this.loadImageSource(t,i).then((function(t){t.flipY=!1,t.name=a.name||r.name||"",""===t.name&&"string"==typeof r.uri&&!1===r.uri.startsWith("data:image/")&&(t.name=r.uri);const i=(n.samplers||{})[a.sampler]||{};return t.magFilter=$s[i.magFilter]||O,t.minFilter=$s[i.minFilter]||F,t.wrapS=Zs[i.wrapS]||G,t.wrapT=Zs[i.wrapT]||G,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==U&&t.minFilter!==O,s.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[o]=A,A}loadImageSource(e,t){const i=this,s=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const a=s.images[e],r=self.URL||self.webkitURL;let o=a.uri||"",A=!1;if(void 0!==a.bufferView)o=i.getDependency("bufferView",a.bufferView).then((function(e){A=!0;const t=new Blob([e],{type:a.mimeType});return o=r.createObjectURL(t),o}));else if(void 0===a.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then((function(e){return new Promise((function(i,s){let a=i;!0===t.isImageBitmapLoader&&(a=function(e){const t=new he(e);t.needsUpdate=!0,i(t)}),t.load(b.resolveURL(e,n.path),a,void 0,s)}))})).then((function(e){var t;return!0===A&&r.revokeObjectURL(o),cn(e,a),e.userData.mimeType=a.mimeType||((t=a.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,i,s){const n=this;return this.getDependency("texture",i.index).then((function(a){if(!a)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((a=a.clone()).channel=i.texCoord),n.extensions[Cs.KHR_TEXTURE_TRANSFORM]){const e=void 0!==i.extensions?i.extensions[Cs.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(a);a=n.extensions[Cs.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return void 0!==s&&(a.colorSpace=s),e[t]=a,a}))}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=void 0===t.attributes.tangent,n=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new H,z.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,t.sizeAttenuation=!1,this.cache.add(e,t)),i=t}else if(e.isLine){const e="LineBasicMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new q,z.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,this.cache.add(e,t)),i=t}if(s||n||a){let e="ClonedMaterial:"+i.uuid+":";s&&(e+="derivative-tangents:"),n&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=i.clone(),n&&(t.vertexColors=!0),a&&(t.flatShading=!0),s&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}e.material=i}getMaterialType(){return V}loadMaterial(e){const t=this,i=this.json,s=this.extensions,n=i.materials[e];let a;const r={},o=[];if((n.extensions||{})[Cs.KHR_MATERIALS_UNLIT]){const e=s[Cs.KHR_MATERIALS_UNLIT];a=e.getMaterialType(),o.push(e.extendParams(r,n,t))}else{const i=n.pbrMetallicRoughness||{};if(r.color=new d(1,1,1),r.opacity=1,Array.isArray(i.baseColorFactor)){const e=i.baseColorFactor;r.color.setRGB(e[0],e[1],e[2],c),r.opacity=e[3]}void 0!==i.baseColorTexture&&o.push(t.assignTexture(r,"map",i.baseColorTexture,l)),r.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,r.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(o.push(t.assignTexture(r,"metalnessMap",i.metallicRoughnessTexture)),o.push(t.assignTexture(r,"roughnessMap",i.metallicRoughnessTexture))),a=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),o.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,r)}))))}!0===n.doubleSided&&(r.side=K);const A=n.alphaMode||an;if(A===on?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,A===rn&&(r.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&a!==J&&(o.push(t.assignTexture(r,"normalMap",n.normalTexture)),r.normalScale=new y(1,1),void 0!==n.normalTexture.scale)){const e=n.normalTexture.scale;r.normalScale.set(e,e)}if(void 0!==n.occlusionTexture&&a!==J&&(o.push(t.assignTexture(r,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(r.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&a!==J){const e=n.emissiveFactor;r.emissive=(new d).setRGB(e[0],e[1],e[2],c)}return void 0!==n.emissiveTexture&&a!==J&&o.push(t.assignTexture(r,"emissiveMap",n.emissiveTexture,l)),Promise.all(o).then((function(){const i=new a(r);return n.name&&(i.name=n.name),cn(i,n),t.associations.set(i,{materials:e}),n.extensions&&ln(s,i,n),i}))}createUniqueName(e){const t=Y.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function n(e){return i[Cs.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(i){return fn(i,e,t)}))}const a=[];for(let i=0,r=e.length;i<r;i++){const r=e[i],o=un(r),A=s[o];if(A)a.push(A.promise);else{let e;e=r.extensions&&r.extensions[Cs.KHR_DRACO_MESH_COMPRESSION]?n(r):fn(new h,r,t),s[o]={primitive:r,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){const t=this,i=this.json,s=this.extensions,n=i.meshes[e],a=n.primitives,r=[];for(let e=0,t=a.length;e<t;e++){const t=void 0===a[e].material?An(this.cache):this.getDependency("material",a[e].material);r.push(t)}return r.push(t.loadGeometries(a)),Promise.all(r).then((function(i){const r=i.slice(0,i.length-1),o=i[i.length-1],A=[];for(let i=0,l=o.length;i<l;i++){const l=o[i],c=a[i];let h;const u=r[i];if(c.mode===Ws.TRIANGLES||c.mode===Ws.TRIANGLE_STRIP||c.mode===Ws.TRIANGLE_FAN||void 0===c.mode)h=!0===n.isSkinnedMesh?new W(l,u):new X(l,u),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),c.mode===Ws.TRIANGLE_STRIP?h.geometry=bs(h.geometry,f):c.mode===Ws.TRIANGLE_FAN&&(h.geometry=bs(h.geometry,m));else if(c.mode===Ws.LINES)h=new $(l,u);else if(c.mode===Ws.LINE_STRIP)h=new Z(l,u);else if(c.mode===Ws.LINE_LOOP)h=new ee(l,u);else{if(c.mode!==Ws.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);h=new te(l,u)}Object.keys(h.geometry.morphAttributes).length>0&&hn(h,n),h.name=t.createUniqueName(n.name||"mesh_"+e),cn(h,n),c.extensions&&ln(s,h,c),t.assignFinalMaterial(h),A.push(h)}for(let i=0,s=A.length;i<s;i++)t.associations.set(A[i],{meshes:e,primitives:i});if(1===A.length)return n.extensions&&ln(s,A[0],n),A[0];const l=new ie;n.extensions&&ln(s,l,n),t.associations.set(l,{meshes:e});for(let e=0,t=A.length;e<t;e++)l.add(A[e]);return l}))}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(s)return"perspective"===i.type?t=new se(ne.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===i.type&&(t=new ae(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),cn(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let e=0,s=t.joints.length;e<s;e++)i.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then((function(e){const i=e.pop(),s=e,n=[],a=[];for(let e=0,r=s.length;e<r;e++){const r=s[e];if(r){n.push(r);const t=new B;null!==i&&t.fromArray(i.array,16*e),a.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new re(n,a)}))}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],n=s.name?s.name:"animation_"+e,a=[],r=[],o=[],A=[],l=[];for(let e=0,t=s.channels.length;e<t;e++){const t=s.channels[e],i=s.samplers[t.sampler],n=t.target,c=n.node,h=void 0!==s.parameters?s.parameters[i.input]:i.input,u=void 0!==s.parameters?s.parameters[i.output]:i.output;void 0!==n.node&&(a.push(this.getDependency("node",c)),r.push(this.getDependency("accessor",h)),o.push(this.getDependency("accessor",u)),A.push(i),l.push(n))}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(o),Promise.all(A),Promise.all(l)]).then((function(e){const t=e[0],s=e[1],a=e[2],r=e[3],o=e[4],A=[];for(let e=0,n=t.length;e<n;e++){const n=t[e],l=s[e],c=a[e],h=r[e],u=o[e];if(void 0===n)continue;n.updateMatrix&&n.updateMatrix();const d=i._createAnimationTracks(n,l,c,h,u);if(d)for(let e=0;e<d.length;e++)A.push(d[e])}return new oe(n,void 0,A)}))}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return void 0===s.mesh?null:i.getDependency("mesh",s.mesh).then((function(e){const t=i._getNodeRef(i.meshCache,s.mesh,e);return void 0!==s.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,i=s.weights.length;t<i;t++)e.morphTargetInfluences[t]=s.weights[t]})),t}))}loadNode(e){const t=this,i=this.json.nodes[e],s=t._loadNodeShallow(e),n=[],a=i.children||[];for(let e=0,i=a.length;e<i;e++)n.push(t.getDependency("node",a[e]));const r=void 0===i.skin?Promise.resolve(null):t.getDependency("skin",i.skin);return Promise.all([s,Promise.all(n),r]).then((function(e){const t=e[0],i=e[1],s=e[2];null!==s&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(s,gn)}));for(let e=0,s=i.length;e<s;e++)t.add(i[e]);return t}))}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const n=t.nodes[e],a=n.name?s.createUniqueName(n.name):"",r=[],o=s._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return o&&r.push(o),void 0!==n.camera&&r.push(s.getDependency("camera",n.camera).then((function(e){return s._getNodeRef(s.cameraCache,n.camera,e)}))),s._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){r.push(e)})),this.nodeCache[e]=Promise.all(r).then((function(t){let r;if(r=!0===n.isBone?new Ae:t.length>1?new ie:1===t.length?t[0]:new M,r!==t[0])for(let e=0,i=t.length;e<i;e++)r.add(t[e]);if(n.name&&(r.userData.name=n.name,r.name=a),cn(r,n),n.extensions&&ln(i,r,n),void 0!==n.matrix){const e=new B;e.fromArray(n.matrix),r.applyMatrix4(e)}else void 0!==n.translation&&r.position.fromArray(n.translation),void 0!==n.rotation&&r.quaternion.fromArray(n.rotation),void 0!==n.scale&&r.scale.fromArray(n.scale);return s.associations.has(r)||s.associations.set(r,{}),s.associations.get(r).nodes=e,r})),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,n=new ie;i.name&&(n.name=s.createUniqueName(i.name)),cn(n,i),i.extensions&&ln(t,n,i);const a=i.nodes||[],r=[];for(let e=0,t=a.length;e<t;e++)r.push(s.getDependency("node",a[e]));return Promise.all(r).then((function(e){for(let t=0,i=e.length;t<i;t++)n.add(e[t]);return s.associations=(e=>{const t=new Map;for(const[e,i]of s.associations)(e instanceof z||e instanceof he)&&t.set(e,i);return e.traverse((e=>{const i=s.associations.get(e);null!=i&&t.set(e,i)})),t})(n),n}))}_createAnimationTracks(e,t,i,s,n){const a=[],r=e.name?e.name:e.uuid,o=[];let A;switch(sn[n.path]===sn.weights?e.traverse((function(e){e.morphTargetInfluences&&o.push(e.name?e.name:e.uuid)})):o.push(r),sn[n.path]){case sn.weights:A=de;break;case sn.rotation:A=pe;break;case sn.position:case sn.scale:A=ue;break;default:if(1===i.itemSize)A=de;else A=ue}const l=void 0!==s.interpolation?nn[s.interpolation]:ce,c=this._getArrayFromAccessor(i);for(let e=0,i=o.length;e<i;e++){const i=new A(o[e]+"."+sn[n.path],t.array,c,l);"CUBICSPLINE"===s.interpolation&&this._createCubicSplineTrackInterpolant(i),a.push(i)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=pn(t.constructor),i=new Float32Array(t.length);for(let s=0,n=t.length;s<n;s++)i[s]=t[s]*e;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof pe?Ys:Ks)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function fn(e,t,i){const s=t.attributes,n=[];function a(t,s){return i.getDependency("accessor",t).then((function(t){e.setAttribute(s,t)}))}for(const t in s){const i=tn[t]||t.toLowerCase();i in e.attributes||n.push(a(s[t],i))}if(void 0!==t.indices&&!e.index){const s=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));n.push(s)}return p.workingColorSpace!==c&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${p.workingColorSpace}" not supported.`),cn(e,t),function(e,t,i){const s=t.attributes,n=new fe;if(void 0===s.POSITION)return;{const e=i.json.accessors[s.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(n.set(new v(t[0],t[1],t[2]),new v(a[0],a[1],a[2])),e.normalized){const t=pn(Xs[e.componentType]);n.min.multiplyScalar(t),n.max.multiplyScalar(t)}}const a=t.targets;if(void 0!==a){const e=new v,t=new v;for(let s=0,n=a.length;s<n;s++){const n=a[s];if(void 0!==n.POSITION){const s=i.json.accessors[n.POSITION],a=s.min,r=s.max;if(void 0!==a&&void 0!==r){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(r[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(r[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(r[2]))),s.normalized){const e=pn(Xs[s.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(e)}e.boundingBox=n;const r=new be;n.getCenter(r.center),r.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=r}(e,t,i),Promise.all(n).then((function(){return void 0!==t.targets?function(e,t,i){let s=!1,n=!1,a=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(void 0!==i.POSITION&&(s=!0),void 0!==i.NORMAL&&(n=!0),void 0!==i.COLOR_0&&(a=!0),s&&n&&a)break}if(!s&&!n&&!a)return Promise.resolve(e);const r=[],o=[],A=[];for(let l=0,c=t.length;l<c;l++){const c=t[l];if(s){const t=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;r.push(t)}if(n){const t=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal;o.push(t)}if(a){const t=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):e.attributes.color;A.push(t)}}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(A)]).then((function(t){const i=t[0],r=t[1],o=t[2];return s&&(e.morphAttributes.position=i),n&&(e.morphAttributes.normal=r),a&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,i):e}))}class bn{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:t,msg:i,transfer:s}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(i,s)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((i=>{const s=this._getIdleWorker();-1!==s?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const In=9,yn=15,Cn=16,En=22,wn=37,Bn=43,vn=76,xn=83,Sn=97,Qn=100,Mn=103,Tn=109,Dn=165,Rn=166,kn=1000066e3;class Fn{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Ln{constructor(e,t,i,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}const _n=[171,75,84,88,32,50,48,187,13,10,26,10];function Pn(e){return(new TextDecoder).decode(e)}let On,Un,Gn;const Nn={env:{emscripten_notify_memory_growth:function(e){Gn=new Uint8Array(Un.exports.memory.buffer)}}};class jn{init(){return On||(On="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Hn).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,Nn))).then(this._init):WebAssembly.instantiate(Buffer.from(Hn,"base64"),Nn).then(this._init),On)}_init(e){Un=e.instance,Nn.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Un)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,s=Un.exports.malloc(i);Gn.set(e,s),t=t||Number(Un.exports.ZSTD_findDecompressedSize(s,i));const n=Un.exports.malloc(t),a=Un.exports.ZSTD_decompress(n,t,s,i),r=Gn.slice(n,n+a);return Un.exports.free(s),Un.exports.free(n),r}}const Hn="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",zn=new WeakMap;let qn,Vn=0;class Kn extends o{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new bn,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new A(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new A(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then((([e,t])=>{const i=Kn.BasisWorker.toString(),s=["/* constants */","let _EngineFormat = "+JSON.stringify(Kn.EngineFormat),"let _EngineType = "+JSON.stringify(Kn.EngineType),"let _TranscoderFormat = "+JSON.stringify(Kn.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Kn.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),Vn>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Vn++}return this.transcoderPending}load(e,t,i,s){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const n=new A(this.manager);n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials),n.load(e,(e=>{this.parse(e,t,s)}),i,s)}parse(e,t,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(zn.has(e)){return zn.get(e).promise.then(t).catch(i)}this._createTexture(e).then((e=>t?t(e):null)).catch(i)}_createTextureFrom(e,t){const{type:i,error:s,data:{faces:n,width:a,height:r,format:o,type:A,dfdFlags:l}}=e;if("error"===i)return Promise.reject(s);let c;if(6===t.faceCount)c=new Ie(n,o,A);else{const e=n[0].mipmaps;c=t.layerCount>1?new ye(e,a,r,t.layerCount,o,A):new Ce(e,a,r,o,A)}return c.minFilter=1===n[0].mipmaps.length?O:F,c.magFilter=O,c.generateMipmaps=!1,c.needsUpdate=!0,c.colorSpace=Xn(t),c.premultiplyAlpha=!!(1&l),c}async _createTexture(e,t={}){const i=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,_n.length);if(t[0]!==_n[0]||t[1]!==_n[1]||t[2]!==_n[2]||t[3]!==_n[3]||t[4]!==_n[4]||t[5]!==_n[5]||t[6]!==_n[6]||t[7]!==_n[7]||t[8]!==_n[8]||t[9]!==_n[9]||t[10]!==_n[10]||t[11]!==_n[11])throw new Error("Missing KTX 2.0 identifier.");const i=new Fn,s=17*Uint32Array.BYTES_PER_ELEMENT,n=new Ln(e,_n.length,s,!0);i.vkFormat=n._nextUint32(),i.typeSize=n._nextUint32(),i.pixelWidth=n._nextUint32(),i.pixelHeight=n._nextUint32(),i.pixelDepth=n._nextUint32(),i.layerCount=n._nextUint32(),i.faceCount=n._nextUint32();const a=n._nextUint32();i.supercompressionScheme=n._nextUint32();const r=n._nextUint32(),o=n._nextUint32(),A=n._nextUint32(),l=n._nextUint32(),c=n._nextUint64(),h=n._nextUint64(),u=new Ln(e,_n.length+s,3*a*8,!0);for(let t=0;t<a;t++)i.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const d=new Ln(e,r,o,!0),p={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},g=(p.descriptorBlockSize/4-6)/4;for(let e=0;e<g;e++){const t={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=d._nextInt32(),t.sampleUpper=d._nextInt32()):(t.sampleLower=d._nextUint32(),t.sampleUpper=d._nextUint32()),p.samples[e]=t}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(p);const m=new Ln(e,A,l,!0);for(;m._offset<l;){const e=m._nextUint32(),t=m._scan(e),s=Pn(t);if(i.keyValue[s]=m._nextUint8Array(e-t.byteLength-1),s.match(/^ktx/i)){const e=Pn(i.keyValue[s]);i.keyValue[s]=e.substring(0,e.lastIndexOf("\0"))}m._skip(e%4?4-e%4:0)}if(h<=0)return i;const f=new Ln(e,c,h,!0),b=f._nextUint16(),I=f._nextUint16(),y=f._nextUint32(),C=f._nextUint32(),E=f._nextUint32(),w=f._nextUint32(),B=[];for(let e=0;e<a;e++)B.push({imageFlags:f._nextUint32(),rgbSliceByteOffset:f._nextUint32(),rgbSliceByteLength:f._nextUint32(),alphaSliceByteOffset:f._nextUint32(),alphaSliceByteLength:f._nextUint32()});const v=c+f._offset,x=v+y,S=x+C,Q=S+E,M=new Uint8Array(e.buffer,e.byteOffset+v,y),T=new Uint8Array(e.buffer,e.byteOffset+x,C),D=new Uint8Array(e.buffer,e.byteOffset+S,E),R=new Uint8Array(e.buffer,e.byteOffset+Q,w);return i.globalData={endpointCount:b,selectorCount:I,imageDescs:B,endpointsData:M,selectorsData:T,tablesData:D,extendedData:R},i}(new Uint8Array(e)),s=i.vkFormat===kn&&167===i.dataFormatDescriptor[0].colorModel;if(!(0===i.vkFormat||s&&!this.workerConfig.astcHDRSupported))return async function(e){const{vkFormat:t}=e;if(void 0===Yn[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let i;2===e.supercompressionScheme&&(qn||(qn=new Promise((async e=>{const t=new jn;await t.init(),e(t)}))),i=await qn);const s=[];for(let n=0;n<e.levels.length;n++){const a=Math.max(1,e.pixelWidth>>n),r=Math.max(1,e.pixelHeight>>n),o=e.pixelDepth?Math.max(1,e.pixelDepth>>n):0,A=e.levels[n];let l,c;if(0===e.supercompressionScheme)l=A.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");l=i.decode(A.levelData,A.uncompressedByteLength)}c=Wn[t]===Te?new Float32Array(l.buffer,l.byteOffset,l.byteLength/Float32Array.BYTES_PER_ELEMENT):Wn[t]===Me?new Uint16Array(l.buffer,l.byteOffset,l.byteLength/Uint16Array.BYTES_PER_ELEMENT):l,s.push({data:c,width:a,height:r,depth:o})}let n;if(Jn.has(Yn[t]))n=0===e.pixelDepth?new De(s[0].data,e.pixelWidth,e.pixelHeight):new Re(s[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");n=new Ce(s,e.pixelWidth,e.pixelHeight),n.minFilter=1===s.length?O:F,n.magFilter=O}return n.mipmaps=s,n.type=Wn[t],n.format=Yn[t],n.colorSpace=Xn(e),n.needsUpdate=!0,Promise.resolve(n)}(i);const n=t,a=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:n},[e]))).then((e=>this._createTextureFrom(e.data,i)));return zn.set(e,{promise:a}),a}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Vn--,this}}Kn.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},Kn.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},Kn.EngineFormat={RGBAFormat:Se,RGBA_ASTC_4x4_Format:Be,RGB_BPTC_UNSIGNED_Format:Ne,RGBA_BPTC_Format:Ge,RGBA_ETC2_EAC_Format:Ue,RGBA_PVRTC_4BPPV1_Format:Oe,RGBA_S3TC_DXT5_Format:Pe,RGB_ETC1_Format:_e,RGB_ETC2_Format:Le,RGB_PVRTC_4BPPV1_Format:Fe,RGBA_S3TC_DXT1_Format:ke},Kn.EngineType={UnsignedByteType:Qe,HalfFloatType:Me,FloatType:Te},Kn.BasisWorker=function(){let e,t,i;const s=_EngineFormat,n=_EngineType,a=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",(function(s){const a=s.data;switch(a.type){case"init":e=a.config,o=a.transcoderBinary,t=new Promise((e=>{i={wasmBinary:o,onRuntimeInitialized:e},BASIS(i)})).then((()=>{i.initializeBasis(),void 0===i.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{faces:t,buffers:s,width:o,height:h,hasAlpha:u,format:d,type:p,dfdFlags:g}=function(t){const s=new i.KTX2File(new Uint8Array(t));function a(){s.close(),s.delete()}if(!s.isValid())throw a(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");let o;if(s.isUASTC())o=r.UASTC;else if(s.isETC1S())o=r.ETC1S;else{if(!s.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");o=r.UASTC_HDR}const h=s.getWidth(),u=s.getHeight(),d=s.getLayers()||1,p=s.getLevels(),g=s.getFaces(),m=s.getHasAlpha(),f=s.getDFDFlags(),{transcoderFormat:b,engineFormat:I,engineType:y}=function(t,i,s,n){const a=A[t];for(let r=0;r<a.length;r++){const o=a[r];if(o.if&&!e[o.if])continue;if(!o.basisFormat.includes(t))continue;if(n&&o.transcoderFormat.length<2)continue;if(o.needsPowerOfTwo&&(!l(i)||!l(s)))continue;return{transcoderFormat:o.transcoderFormat[n?1:0],engineFormat:o.engineFormat[n?1:0],engineType:o.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(o,h,u,m);if(!h||!u||!p)throw a(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!s.startTranscoding())throw a(),new Error("THREE.KTX2Loader: .startTranscoding failed");const C=[],E=[];for(let e=0;e<g;e++){const t=[];for(let i=0;i<p;i++){const r=[];let o,A;for(let t=0;t<d;t++){const l=s.getImageLevelInfo(i,t,e);0!==e||0!==i||0!==t||l.origWidth%4==0&&l.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),p>1?(o=l.origWidth,A=l.origHeight):(o=l.width,A=l.height);let c=new Uint8Array(s.getImageTranscodedSizeInBytes(i,t,0,b));const h=s.transcodeImage(c,i,t,e,b,0,-1,-1);if(y===n.HalfFloatType&&(c=new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!h)throw a(),new Error("THREE.KTX2Loader: .transcodeImage failed.");r.push(c)}const l=c(r);t.push({data:l,width:o,height:A}),E.push(l.buffer)}C.push({mipmaps:t,width:h,height:u,format:I,type:y})}return a(),{faces:C,buffers:E,width:h,height:u,hasAlpha:m,dfdFlags:f,format:I,type:y}}(a.buffer);self.postMessage({type:"transcode",id:a.id,data:{faces:t,width:o,height:h,hasAlpha:u,format:d,type:p,dfdFlags:g}},s)}catch(e){console.error(e),self.postMessage({type:"error",id:a.id,error:e.message})}}))}var o}));const o=[{if:"astcSupported",basisFormat:[r.UASTC],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],engineType:[n.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],engineType:[n.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.BC1,a.BC3],engineFormat:[s.RGBA_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],engineType:[n.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],engineType:[n.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.ETC1],engineFormat:[s.RGB_ETC1_Format],engineType:[n.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],engineType:[n.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[r.UASTC_HDR],transcoderFormat:[a.BC6H],engineFormat:[s.RGB_BPTC_UNSIGNED_Format],engineType:[n.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.RGBA32,a.RGBA32],engineFormat:[s.RGBAFormat,s.RGBAFormat],engineType:[n.UnsignedByteType,n.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[r.UASTC_HDR],transcoderFormat:[a.RGBA_HALF],engineFormat:[s.RGBAFormat],engineType:[n.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],A={[r.ETC1S]:o.filter((e=>e.basisFormat.includes(r.ETC1S))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[r.UASTC]:o.filter((e=>e.basisFormat.includes(r.UASTC))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[r.UASTC_HDR]:o.filter((e=>e.basisFormat.includes(r.UASTC_HDR))).sort(((e,t)=>e.priorityHDR-t.priorityHDR))};function l(e){return e<=2||!(e&e-1)&&0!==e}function c(e){if(1===e.length)return e[0];let t=0;for(let i=0;i<e.length;i++){t+=e[i].byteLength}const i=new Uint8Array(t);let s=0;for(let t=0;t<e.length;t++){const n=e[t];i.set(n,s),s+=n.byteLength}return i}};const Jn=new Set([Se,xe,ve]),Yn={[Tn]:Se,[Sn]:Se,[wn]:Se,[Bn]:Se,[Mn]:xe,[xn]:xe,[Cn]:xe,[En]:xe,[Qn]:ve,[vn]:ve,[yn]:ve,[In]:ve,[kn]:Be,[Rn]:we,[Dn]:we},Wn={[Tn]:Te,[Sn]:Me,[wn]:Qe,[Bn]:Qe,[Mn]:Te,[xn]:Me,[Cn]:Qe,[En]:Qe,[Qn]:Te,[vn]:Me,[yn]:Qe,[In]:Qe,[kn]:Me,[Rn]:Qe,[Dn]:Qe};function Xn(e){const t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?l:c:10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(0===t.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),Ee)}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $n,Zn;const ea=Symbol("retainerCount"),ta=Symbol("recentlyUsed"),ia=Symbol("evict"),sa=Symbol("evictionThreshold"),na=Symbol("cache");class aa{constructor(e,t=5){this[$n]=new Map,this[Zn]=[],this[na]=e,this[sa]=t}set evictionThreshold(e){this[sa]=e,this[ia]()}get evictionThreshold(){return this[sa]}get cache(){return this[na]}retainerCount(e){return this[ea].get(e)||0}reset(){this[ea].clear(),this[ta]=[]}retain(e){this[ea].has(e)||this[ea].set(e,0),this[ea].set(e,this[ea].get(e)+1);const t=this[ta].indexOf(e);-1!==t&&this[ta].splice(t,1),this[ta].unshift(e),this[ia]()}release(e){this[ea].has(e)&&this[ea].set(e,Math.max(this[ea].get(e)-1,0)),this[ia]()}[($n=ea,Zn=ta,ia)](){if(!(this[ta].length<this[sa]))for(let e=this[ta].length-1;e>=this[sa];--e){const t=this[ta][e];0===this[ea].get(t)&&(this[na].delete(t),this[ta].splice(e,1))}}}
/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ra=e=>{const t=new Map;for(const i of e.mappings)for(const e of i.variants)t.set(e,{material:null,gltfMaterialIndex:i.material});return t};class oa{constructor(e){this.parser=e,this.name="KHR_materials_variants"}afterRoot(e){const t=this.parser,i=t.json;if(void 0===i.extensions||void 0===i.extensions[this.name])return null;const s=(e=>{const t=[],i=new Set;for(const s of e){let e=s,n=0;for(;i.has(e);)e=s+"."+ ++n;i.add(e),t.push(e)}return t})((i.extensions[this.name].variants||[]).map((e=>e.name)));for(const s of e.scenes)s.traverse((e=>{const s=e;if(!s.material)return;const n=t.associations.get(s);if(null==n||null==n.meshes||null==n.primitives)return;const a=i.meshes[n.meshes].primitives[n.primitives].extensions;a&&a[this.name]&&(s.userData.variantMaterials=ra(a[this.name]))}));return e.userData.variants=s,Promise.resolve()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Aa,la;he.DEFAULT_ANISOTROPY=4;const ca=new Map,ha=new Map;let ua;const da=new ms;let pa;const ga=new Kn;let ma,fa;const ba=Symbol("loader"),Ia=Symbol("evictionPolicy"),ya=Symbol("GLTFInstance");class Ca extends je{static setDRACODecoderLocation(e){ua=e,da.setDecoderPath(e)}static getDRACODecoderLocation(){return ua}static setKTX2TranscoderLocation(e){pa=e,ga.setTranscoderPath(e)}static getKTX2TranscoderLocation(){return pa}static setMeshoptDecoderLocation(e){var t;ma!==e&&(ma=e,fa=(t=e,new Promise(((e,i)=>{const s=document.createElement("script");document.body.appendChild(s),s.onload=e,s.onerror=i,s.async=!0,s.src=t}))).then((()=>ps.ready)).then((()=>ps)))}static getMeshoptDecoderLocation(){return ma}static initializeKTX2Loader(e){ga.detectSupport(e)}static get cache(){return ca}static clearCache(){ca.forEach(((e,t)=>{this.delete(t)})),this[Ia].reset()}static has(e){return ca.has(e)}static async delete(e){if(!this.has(e))return;const t=ca.get(e);ha.delete(e),ca.delete(e);(await t).dispose()}static hasFinishedLoading(e){return!!ha.get(e)}constructor(e){super(),this[la]=(new Is).register((e=>new oa(e))),this[ya]=e,this[ba].setDRACOLoader(da),this[ba].setKTX2Loader(ga)}get[(Aa=Ia,la=ba,Ia)](){return this.constructor[Ia]}async preload(e,t,i=()=>{}){if(this[ba].setWithCredentials(t.withCredentials),this.dispatchEvent({type:"preload",element:t,src:e}),!ca.has(e)){null!=fa&&this[ba].setMeshoptDecoder(await fa);const t=((e,t,i=()=>{})=>{const s=e=>{const t=e.loaded/e.total;i(Math.max(0,Math.min(1,isFinite(t)?t:1)))};return new Promise(((i,n)=>{t.load(e,i,s,n)}))})(e,this[ba],(e=>{i(.8*e)})),s=this[ya],n=t.then((e=>s.prepare(e))).then((e=>(i(.9),new s(e)))).catch((e=>(console.error(e),new s)));ca.set(e,n)}await ca.get(e),ha.set(e,!0),i&&i(1)}async load(e,t,i=()=>{}){await this.preload(e,t,i);const s=await ca.get(e),n=await s.clone();return this[Ia].retain(e),n.dispose=()=>{this[Ia].release(e)},n}}Ca[Aa]=new aa(Ca);class Ea extends M{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new y(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&null!==e.element.parentNode&&e.element.remove()}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const wa=new v,Ba=new B,va=new B,xa=new v,Sa=new v;class Qa{constructor(e={}){const t=this;let i,s,n,a;const r={objects:new WeakMap},o=void 0!==e.element?e.element:document.createElement("div");function A(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,i=e.children.length;t<i;t++)A(e.children[t])}function l(e,i,s){if(!1!==e.visible){if(e.isCSS2DObject){wa.setFromMatrixPosition(e.matrixWorld),wa.applyMatrix4(va);const A=wa.z>=-1&&wa.z<=1&&!0===e.layers.test(s.layers),l=e.element;l.style.display=!0===A?"":"none",!0===A&&(e.onBeforeRender(t,i,s),l.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(wa.x*n+n)+"px,"+(-wa.y*a+a)+"px)",l.parentNode!==o&&o.appendChild(l),e.onAfterRender(t,i,s));const h={distanceToCameraSquared:c(s,e)};r.objects.set(e,h)}for(let t=0,n=e.children.length;t<n;t++)l(e.children[t],i,s)}else A(e)}function c(e,t){return xa.setFromMatrixPosition(e.matrixWorld),Sa.setFromMatrixPosition(t.matrixWorld),xa.distanceToSquared(Sa)}o.style.overflow="hidden",this.domElement=o,this.getSize=function(){return{width:i,height:s}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),Ba.copy(t.matrixWorldInverse),va.multiplyMatrices(t.projectionMatrix,Ba),l(e,e,t),function(e){const t=function(e){const t=[];return e.traverseVisible((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return r.objects.get(e).distanceToCameraSquared-r.objects.get(t).distanceToCameraSquared})),i=t.length;for(let e=0,s=t.length;e<s;e++)t[e].element.style.zIndex=i-e}(e)},this.setSize=function(e,t){i=e,s=t,n=i/2,a=s/2,o.style.width=e+"px",o.style.height=t+"px"}}}function Ma(e,t,i){let s=i;const n=new v;return e.updateWorldMatrix(!0,!0),e.traverseVisible((e=>{const{geometry:i}=e;if(void 0!==i){const{position:a}=i.attributes;if(void 0!==a)for(let i=0,r=a.count;i<r;i++)e.isMesh?e.getVertexPosition(i,n):n.fromBufferAttribute(a,i),e.isSkinnedMesh||n.applyMatrix4(e.matrixWorld),s=t(s,n)}})),s}const Ta={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Da{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register((function(e){return new hr(e)})),this.register((function(e){return new ur(e)})),this.register((function(e){return new mr(e)})),this.register((function(e){return new fr(e)})),this.register((function(e){return new br(e)})),this.register((function(e){return new Ir(e)})),this.register((function(e){return new dr(e)})),this.register((function(e){return new pr(e)})),this.register((function(e){return new gr(e)})),this.register((function(e){return new yr(e)})),this.register((function(e){return new Cr(e)})),this.register((function(e){return new Er(e)})),this.register((function(e){return new wr(e)})),this.register((function(e){return new Br(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}setTextureUtils(e){return this.textureUtils=e,this}parse(e,t,i,s){const n=new cr,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](n));n.setPlugins(a),n.setTextureUtils(this.textureUtils),n.writeAsync(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise((function(s,n){i.parse(e,s,n,t)}))}}const Ra=0,ka=1,Fa=2,La=3,_a=4,Pa=5120,Oa=5121,Ua=5122,Ga=5123,Na=5124,ja=5125,Ha=5126,za=34962,qa=34963,Va=9728,Ka=9729,Ja=9984,Ya=9985,Wa=9986,Xa=9987,$a=33071,Za=33648,er=10497,tr="KHR_mesh_quantization",ir={};ir[U]=Va,ir[P]=Ja,ir[L]=Wa,ir[O]=Ka,ir[_]=Ya,ir[F]=Xa,ir[j]=$a,ir[G]=er,ir[N]=Za;const sr={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},nr=new d;function ar(e,t){return e.length===t.length&&e.every((function(e,i){return e===t[i]}))}function rr(e){return 4*Math.ceil(e/4)}function or(e,t=0){const i=rr(e.byteLength);if(i!==e.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<i;n++)s[n]=t;return s.buffer}return e}function Ar(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function lr(e,t){if(void 0!==e.toBlob)return new Promise((i=>e.toBlob(i,t)));let i;return"image/jpeg"===t?i=.92:"image/webp"===t&&(i=.8),e.convertToBlob({type:t,quality:i})}let cr=class{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+He}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(e){this.plugins=e}setTextureUtils(e){this.textureUtils=e}async writeAsync(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(e),await Promise.all(this.pending);const s=this,n=s.buffers,a=s.json;i=s.options;const r=s.extensionsUsed,o=s.extensionsRequired,A=new Blob(n,{type:"application/octet-stream"}),l=Object.keys(r),c=Object.keys(o);if(l.length>0&&(a.extensionsUsed=l),c.length>0&&(a.extensionsRequired=c),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=A.size),!0===i.binary){const e=new FileReader;e.readAsArrayBuffer(A),e.onloadend=function(){const i=or(e.result),s=new DataView(new ArrayBuffer(8));s.setUint32(0,i.byteLength,!0),s.setUint32(4,5130562,!0);const n=or((r=JSON.stringify(a),(new TextEncoder).encode(r).buffer),32);var r;const o=new DataView(new ArrayBuffer(8));o.setUint32(0,n.byteLength,!0),o.setUint32(4,1313821514,!0);const A=new ArrayBuffer(12),l=new DataView(A);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);const c=12+o.byteLength+n.byteLength+s.byteLength+i.byteLength;l.setUint32(8,c,!0);const h=new Blob([A,o,n,s,i],{type:"application/octet-stream"}),u=new FileReader;u.readAsArrayBuffer(h),u.onloadend=function(){t(u.result)}}}else if(a.buffers&&a.buffers.length>0){const e=new FileReader;e.readAsDataURL(A),e.onloadend=function(){const i=e.result;a.buffers[0].uri=i,t(a)}}else t(a)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const i=this.options,s=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&n.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],s[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new v;for(let i=0,s=e.count;i<s;i++)if(Math.abs(t.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),s=new v;for(let e=0,t=i.count;e<t;e++)s.fromBufferAttribute(i,e),0===s.x&&0===s.y&&0===s.z?s.setX(1):s.normalize(),i.setXYZ(e,s.x,s.y,s.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const s={};0===t.offset.x&&0===t.offset.y||(s.offset=t.offset.toArray(),i=!0),0!==t.rotation&&(s.rotation=t.rotation,i=!0),1===t.repeat.x&&1===t.repeat.y||(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(e,t){if(e===t)return e;function i(e){return e.colorSpace===l?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}e instanceof Ce&&(e=await this.decompressTextureAsync(e)),t instanceof Ce&&(t=await this.decompressTextureAsync(t));const s=e?e.image:null,n=t?t.image:null,a=Math.max(s?s.width:0,n?n.width:0),r=Math.max(s?s.height:0,n?n.height:0),o=Ar();o.width=a,o.height=r;const A=o.getContext("2d",{willReadFrequently:!0});A.fillStyle="#00ffff",A.fillRect(0,0,a,r);const c=A.getImageData(0,0,a,r);if(s){A.drawImage(s,0,0,a,r);const t=i(e),n=A.getImageData(0,0,a,r).data;for(let e=2;e<n.length;e+=4)c.data[e]=256*t(n[e]/256)}if(n){A.drawImage(n,0,0,a,r);const e=i(t),s=A.getImageData(0,0,a,r).data;for(let t=1;t<s.length;t+=4)c.data[t]=256*e(s[t]/256)}A.putImageData(c,0,0);const h=(e||t).clone();return h.source=new ze(o),h.colorSpace=Ee,h.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),h}async decompressTextureAsync(e,t=1/0){if(null===this.textureUtils)throw new Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(e,t)}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,s,n){const a=this.json;let r;switch(a.bufferViews||(a.bufferViews=[]),t){case Pa:case Oa:r=1;break;case Ua:case Ga:r=2;break;default:r=4}let o=e.itemSize*r;n===za&&(o=4*Math.ceil(o/4));const A=rr(s*o),l=new DataView(new ArrayBuffer(A));let c=0;for(let n=i;n<i+s;n++){for(let i=0;i<e.itemSize;i++){let s;e.itemSize>4?s=e.array[n*e.itemSize+i]:(0===i?s=e.getX(n):1===i?s=e.getY(n):2===i?s=e.getZ(n):3===i&&(s=e.getW(n)),!0===e.normalized&&(s=ne.normalize(s,e.array))),t===Ha?l.setFloat32(c,s,!0):t===Na?l.setInt32(c,s,!0):t===ja?l.setUint32(c,s,!0):t===Ua?l.setInt16(c,s,!0):t===Ga?l.setUint16(c,s,!0):t===Pa?l.setInt8(c,s):t===Oa&&l.setUint8(c,s),c+=r}c%o!==0&&(c+=o-c%o)}const h={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:A};void 0!==n&&(h.target=n),n===za&&(h.byteStride=o),this.byteOffset+=A,a.bufferViews.push(h);return{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise((function(s){const n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){const e=or(n.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,s(i.bufferViews.push(a)-1)}}))}processAccessor(e,t,i,s){const n=this.json;let a;if(e.array.constructor===Float32Array)a=Ha;else if(e.array.constructor===Int32Array)a=Na;else if(e.array.constructor===Uint32Array)a=ja;else if(e.array.constructor===Int16Array)a=Ua;else if(e.array.constructor===Uint16Array)a=Ga;else if(e.array.constructor===Int8Array)a=Pa;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);a=Oa}if(void 0===i&&(i=0),void 0!==s&&s!==1/0||(s=e.count),0===s)return null;const r=function(e,t,i){const s={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=t;n<t+i;n++)for(let t=0;t<e.itemSize;t++){let i;e.itemSize>4?i=e.array[n*e.itemSize+t]:(0===t?i=e.getX(n):1===t?i=e.getY(n):2===t?i=e.getZ(n):3===t&&(i=e.getW(n)),!0===e.normalized&&(i=ne.normalize(i,e.array))),s.min[t]=Math.min(s.min[t],i),s.max[t]=Math.max(s.max[t],i)}return s}(e,i,s);let o;void 0!==t&&(o=e===t.index?qa:za);const A=this.processBufferView(e,a,i,s,o),l={bufferView:A.id,byteOffset:A.byteOffset,componentType:a,count:s,max:r.max,min:r.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(l.normalized=!0),n.accessors||(n.accessors=[]),n.accessors.push(l)-1}processImage(e,t,i,s="image/png"){if(null!==e){const n=this,a=n.cache,r=n.json,o=n.options,A=n.pending;a.images.has(e)||a.images.set(e,{});const l=a.images.get(e),c=s+":flipY/"+i.toString();if(void 0!==l[c])return l[c];r.images||(r.images=[]);const h={mimeType:s},u=Ar();u.width=Math.min(e.width,o.maxTextureSize),u.height=Math.min(e.height,o.maxTextureSize);const d=u.getContext("2d",{willReadFrequently:!0});if(!0===i&&(d.translate(0,u.height),d.scale(1,-1)),void 0!==e.data){t!==Se&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>o.maxTextureSize||e.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const i=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<i.length;t+=4)i[t+0]=e.data[t+0],i[t+1]=e.data[t+1],i[t+2]=e.data[t+2],i[t+3]=e.data[t+3];d.putImageData(new ImageData(i,e.width,e.height),0,0)}else{if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");d.drawImage(e,0,0,u.width,u.height)}!0===o.binary?A.push(lr(u,s).then((e=>n.processBufferViewImage(e))).then((e=>{h.bufferView=e}))):void 0!==u.toDataURL?h.uri=u.toDataURL(s):A.push(lr(u,s).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{h.uri=e})));const p=r.images.push(h)-1;return l[c]=p,p}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:ir[e.magFilter],minFilter:ir[e.minFilter],wrapS:ir[e.wrapS],wrapT:ir[e.wrapT]};return t.samplers.push(i)-1}async processTextureAsync(e){const t=this.options,i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);s.textures||(s.textures=[]),e instanceof Ce&&(e=await this.decompressTextureAsync(e,t.maxTextureSize));let n=e.userData.mimeType;"image/webp"===n&&(n="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,n)};e.name&&(a.name=e.name),await this._invokeAllAsync((async function(t){t.writeTexture&&await t.writeTexture(e,a)}));const r=s.textures.push(a)-1;return i.textures.set(e,r),r}async processMaterialAsync(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const n=e.color.toArray().concat([e.opacity]);if(ar(n,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=0,s.pbrMetallicRoughness.roughnessFactor=1),e.metalnessMap||e.roughnessMap){const t=await this.buildMetalRoughTextureAsync(e.metalnessMap,e.roughnessMap),i={index:await this.processTextureAsync(t),texCoord:t.channel};this.applyTextureTransform(i,t),s.pbrMetallicRoughness.metallicRoughnessTexture=i}if(e.map){const t={index:await this.processTextureAsync(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),s.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(s.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:await this.processTextureAsync(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),s.emissiveTexture=t}}if(e.normalMap){const t={index:await this.processTextureAsync(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),s.normalTexture=t}if(e.aoMap){const t={index:await this.processTextureAsync(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),s.occlusionTexture=t}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),e.side===K&&(s.doubleSided=!0),""!==e.name&&(s.name=e.name),this.serializeUserData(e,s),await this._invokeAllAsync((async function(t){t.writeMaterialAsync&&await t.writeMaterialAsync(e,s)}));const a=i.materials.push(s)-1;return t.materials.set(e,a),a}async processMeshAsync(e){const t=this.cache,i=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)s.push(e.material[t].uuid);else s.push(e.material.uuid);const n=s.join(":");if(t.meshes.has(n))return t.meshes.get(n);const a=e.geometry;let r;r=e.isLineSegments?ka:e.isLineLoop?Fa:e.isLine?La:e.isPoints?Ra:e.material.wireframe?ka:_a;const o={},A={},l=[],c=[],h={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=a.getAttribute("normal");void 0===d||this.isNormalizedNormalAttribute(d)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let p=null;for(let e in a.attributes){if("morph"===e.slice(0,5))continue;const i=a.attributes[e];e=h[e]||e.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),t.attributes.has(this.getUID(i))){A[e]=t.attributes.get(this.getUID(i));continue}p=null;const s=i.array;"JOINTS_0"!==e||s instanceof Uint16Array||s instanceof Uint8Array?(s instanceof Uint32Array||s instanceof Int32Array)&&!e.startsWith("_")&&(console.warn(`GLTFExporter: Attribute "${e}" converted to type FLOAT.`),p=Da.Utils.toFloat32BufferAttribute(i)):(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new u(new Uint16Array(s),i.itemSize,i.normalized));const n=this.processAccessor(p||i,a);null!==n&&(e.startsWith("_")||this.detectMeshQuantization(e,i),A[e]=n,t.attributes.set(this.getUID(i),n))}if(void 0!==d&&a.setAttribute("normal",d),0===Object.keys(A).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const i=[],s=[],n={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let r=0;r<e.morphTargetInfluences.length;++r){const o={};let A=!1;for(const e in a.morphAttributes){if("position"!==e&&"normal"!==e){A||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),A=!0);continue}const i=a.morphAttributes[e][r],s=e.toUpperCase(),n=a.attributes[e];if(t.attributes.has(this.getUID(i,!0))){o[s]=t.attributes.get(this.getUID(i,!0));continue}const l=i.clone();if(!a.morphTargetsRelative)for(let e=0,t=i.count;e<t;e++)for(let t=0;t<i.itemSize;t++)0===t&&l.setX(e,i.getX(e)-n.getX(e)),1===t&&l.setY(e,i.getY(e)-n.getY(e)),2===t&&l.setZ(e,i.getZ(e)-n.getZ(e)),3===t&&l.setW(e,i.getW(e)-n.getW(e));o[s]=this.processAccessor(l,a),t.attributes.set(this.getUID(n,!0),o[s])}c.push(o),i.push(e.morphTargetInfluences[r]),void 0!==e.morphTargetDictionary&&s.push(n[r])}o.weights=i,s.length>0&&(o.extras={},o.extras.targetNames=s)}const g=Array.isArray(e.material);if(g&&0===a.groups.length)return null;let m=!1;if(g&&null===a.index){const e=[];for(let t=0,i=a.attributes.position.count;t<i;t++)e[t]=t;a.setIndex(e),m=!0}const f=g?e.material:[e.material],b=g?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,i=b.length;e<i;e++){const i={mode:r,attributes:A};if(this.serializeUserData(a,i),c.length>0&&(i.targets=c),null!==a.index){let s=this.getUID(a.index);void 0===b[e].start&&void 0===b[e].count||(s+=":"+b[e].start+":"+b[e].count),t.attributes.has(s)?i.indices=t.attributes.get(s):(i.indices=this.processAccessor(a.index,a,b[e].start,b[e].count),t.attributes.set(s,i.indices)),null===i.indices&&delete i.indices}const s=await this.processMaterialAsync(f[b[e].materialIndex]);null!==s&&(i.material=s),l.push(i)}!0===m&&a.setIndex(null),o.primitives=l,i.meshes||(i.meshes=[]),await this._invokeAllAsync((function(t){t.writeMesh&&t.writeMesh(e,o)}));const I=i.meshes.push(o)-1;return t.meshes.set(n,I),I}detectMeshQuantization(e,t){if(this.extensionsUsed[tr])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const s=e.split("_",1)[0];Ta[s]&&Ta[s].includes(i)&&(this.extensionsUsed[tr]=!0,this.extensionsRequired[tr]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:ne.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]);const n=(e=Da.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],r=[];for(let e=0;e<n.length;++e){const i=n[e],o=Y.parseTrackName(i.name);let A=Y.findNode(t,o.nodeName);const l=sr[o.propertyName];if("bones"===o.objectName&&(A=!0===A.isSkinnedMesh?A.skeleton.getBoneByName(o.objectIndex):void 0),!A||!l){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',i.name);continue}const c=1;let h,d=i.values.length/i.times.length;l===sr.morphTargetInfluences&&(d/=A.morphTargetInfluences.length),!0===i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=i.getInterpolation()===le?"STEP":"LINEAR",r.push({input:this.processAccessor(new u(i.times,c)),output:this.processAccessor(new u(i.values,d)),interpolation:h}),a.push({sampler:r.length-1,target:{node:s.get(A),path:l}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:r,channels:a}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,s=t.nodes[i.get(e)],n=e.skeleton;if(void 0===n)return null;const a=e.skeleton.bones[0];if(void 0===a)return null;const r=[],o=new Float32Array(16*n.bones.length),A=new B;for(let t=0;t<n.bones.length;++t)r.push(i.get(n.bones[t])),A.copy(n.boneInverses[t]),A.multiply(e.bindMatrix).toArray(o,16*t);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new u(o,16)),joints:r,skeleton:i.get(a)});return s.skin=t.skins.length-1}async processNodeAsync(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const n={};if(i.trs){const t=e.quaternion.toArray(),i=e.position.toArray(),s=e.scale.toArray();ar(t,[0,0,0,1])||(n.rotation=t),ar(i,[0,0,0])||(n.translation=i),ar(s,[1,1,1])||(n.scale=s)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===ar(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){const t=await this.processMeshAsync(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let s=0,n=e.children.length;s<n;s++){const n=e.children[s];if(n.visible||!1===i.onlyVisible){const e=await this.processNodeAsync(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}await this._invokeAllAsync((function(t){t.writeNode&&t.writeNode(e,n)}));const a=t.nodes.push(n)-1;return s.set(e,a),a}async processSceneAsync(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};""!==e.name&&(s.name=e.name),t.scenes.push(s);const n=[];for(let t=0,s=e.children.length;t<s;t++){const s=e.children[t];if(s.visible||!1===i.onlyVisible){const e=await this.processNodeAsync(s);null!==e&&n.push(e)}}n.length>0&&(s.nodes=n),this.serializeUserData(e,s)}async processObjectsAsync(e){const t=new qe;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);await this.processSceneAsync(t)}async processInputAsync(e){const t=this.options;e=e instanceof Array?e:[e],await this._invokeAllAsync((function(t){t.beforeParse&&t.beforeParse(e)}));const i=[];for(let t=0;t<e.length;t++)e[t]instanceof qe?await this.processSceneAsync(e[t]):i.push(e[t]);i.length>0&&await this.processObjectsAsync(i);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);await this._invokeAllAsync((function(t){t.afterParse&&t.afterParse(e)}))}async _invokeAllAsync(e){for(let t=0,i=this.plugins.length;t<i;t++)await e(this.plugins[t])}},hr=class{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const i=this.writer,s=i.json,n=i.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},n[this.name]=!0);const r=s.extensions[this.name].lights;r.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:r.length-1}}},ur=class{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}async writeMaterialAsync(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}},dr=class{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:await i.processTextureAsync(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:await i.processTextureAsync(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:await i.processTextureAsync(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};1!==e.clearcoatNormalScale.x&&(t.scale=e.clearcoatNormalScale.x),i.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}};class pr{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.dispersion)return;const i=this.writer.extensionsUsed,s={};s.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}let gr=class{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:await i.processTextureAsync(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:await i.processTextureAsync(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},mr=class{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){const t={index:await i.processTextureAsync(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},fr=class{constructor(e){this.writer=e,this.name="KHR_materials_volume"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){const t={index:await i.processTextureAsync(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}e.attenuationDistance!==1/0&&(n.attenuationDistance=e.attenuationDistance),n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},br=class{constructor(e){this.writer=e,this.name="KHR_materials_ior"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const i=this.writer.extensionsUsed,s={};s.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}},Ir=class{constructor(e){this.writer=e,this.name="KHR_materials_specular"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(nr)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.specularIntensityMap){const t={index:await i.processTextureAsync(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(t,e.specularIntensityMap),n.specularTexture=t}if(e.specularColorMap){const t={index:await i.processTextureAsync(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(t,e.specularColorMap),n.specularColorTexture=t}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},yr=class{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.sheenRoughnessMap){const t={index:await i.processTextureAsync(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:await i.processTextureAsync(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},Cr=class{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.anisotropyMap){const t={index:await i.processTextureAsync(e.anisotropyMap)};i.applyTextureTransform(t,e.anisotropyMap),n.anisotropyTexture=t}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},Er=class{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const i=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}},wr=class{constructor(e){this.writer=e,this.name="EXT_materials_bump"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.bumpMap){const t={index:await i.processTextureAsync(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(t,e.bumpMap),n.bumpTexture=t}n.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}},Br=class{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const i=this.writer,s=e,n=new Float32Array(3*s.count),a=new Float32Array(4*s.count),r=new Float32Array(3*s.count),o=new B,A=new v,l=new x,c=new v;for(let e=0;e<s.count;e++)s.getMatrixAt(e,o),o.decompose(A,l,c),A.toArray(n,3*e),l.toArray(a,4*e),c.toArray(r,3*e);const h={TRANSLATION:i.processAccessor(new u(n,3)),ROTATION:i.processAccessor(new u(a,4)),SCALE:i.processAccessor(new u(r,3))};s.instanceColor&&(h._COLOR_0=i.processAccessor(s.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:h},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}};Da.Utils={insertKeyframe:function(e,t){const i=.001,s=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+s),r=e.createInterpolant(new e.ValueBufferType(s));let o;if(0===e.times.length){n[0]=t;for(let e=0;e<s;e++)a[e]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<i)return 0;n[0]=t,n.set(e.times,1),a.set(r.evaluate(t),0),a.set(e.values,s),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<i)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),a.set(e.values,0),a.set(r.evaluate(t),e.values.length),o=n.length-1}else for(let A=0;A<e.times.length;A++){if(Math.abs(e.times[A]-t)<i)return A;if(e.times[A]<t&&e.times[A+1]>t){n.set(e.times.slice(0,A+1),0),n[A+1]=t,n.set(e.times.slice(A+1),A+2),a.set(e.values.slice(0,(A+1)*s),0),a.set(r.evaluate(t),(A+1)*s),a.set(e.values.slice((A+1)*s),(A+2)*s),o=A+1;break}}return e.times=n,e.values=a,o},mergeMorphTargetTracks:function(e,t){const i=[],s={},n=e.tracks;for(let e=0;e<n.length;++e){let a=n[e];const r=Y.parseTrackName(a.name),o=Y.findNode(t,r.nodeName);if("morphTargetInfluences"!==r.propertyName||void 0===r.propertyIndex){i.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(ce)}const A=o.morphTargetInfluences.length,l=o.morphTargetDictionary[r.propertyIndex];if(void 0===l)throw new Error("THREE.GLTFExporter: Morph target name not found: "+r.propertyIndex);let c;if(void 0===s[o.uuid]){c=a.clone();const e=new c.ValueBufferType(A*c.times.length);for(let t=0;t<c.times.length;t++)e[t*A+l]=c.values[t];c.name=(r.nodeName||"")+".morphTargetInfluences",c.values=e,s[o.uuid]=c,i.push(c);continue}const h=a.createInterpolant(new a.ValueBufferType(1));c=s[o.uuid];for(let e=0;e<c.times.length;e++)c.values[e*A+l]=h.evaluate(c.times[e]);for(let e=0;e<a.times.length;e++){const t=this.insertKeyframe(c,a.times[e]);c.values[t*A+l]=a.values[e]}}return e.tracks=i,e},toFloat32BufferAttribute:function(e){const t=new u(new Float32Array(e.count*e.itemSize),e.itemSize,!1);if(!e.normalized&&!e.isInterleavedBufferAttribute)return t.array.set(e.array),t;for(let i=0,s=e.count;i<s;i++)for(let s=0;s<e.itemSize;s++)t.setComponent(i,s,e.getComponent(i,s));return t}};
/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const vr=e=>void 0!==e.material&&e.userData&&e.userData.variantMaterials&&!!Array.from(e.userData.variantMaterials.values()).filter((e=>xr(e.material))),xr=e=>e&&e.isMaterial&&!Array.isArray(e);class Sr{constructor(e){this.writer=e,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(e){const t=new Set,i=e=>{if(!vr(e))return;const i=e.userData.variantMaterials,s=e.userData.variantData;for(const[e,n]of s){const s=i.get(n.index);s&&xr(s.material)&&t.add(e)}};if(Array.isArray(e))for(const t of e)t.traverse(i);else e.traverse(i);t.forEach((e=>this.variantNames.push(e)))}async writeMesh(e,t){if(!vr(e))return;const i=e.userData,s=i.variantMaterials,n=i.variantData,a=new Map,r=new Map,o=Array.from(n.values()).sort(((e,t)=>e.index-t.index));for(const[e,t]of o.entries())r.set(t.index,e);for(const e of n.values()){const t=s.get(e.index);if(!t||!xr(t.material))continue;const i=await this.writer.processMaterialAsync(t.material);a.has(i)||a.set(i,{material:i,variants:[]}),a.get(i).variants.push(r.get(e.index))}const A=Array.from(a.values()).map((e=>e.variants.sort(((e,t)=>e-t))&&e)).sort(((e,t)=>e.material-t.material));if(0===A.length)return;const l=xr(i.originalMaterial)?await this.writer.processMaterialAsync(i.originalMaterial):-1;for(const e of t.primitives)l>=0&&(e.material=l),e.extensions=e.extensions||{},e.extensions[this.name]={mappings:A}}afterParse(){if(0===this.variantNames.length)return;const e=this.writer.json;e.extensions=e.extensions||{};const t=this.variantNames.map((e=>({name:e})));e.extensions[this.name]={variants:t},this.writer.extensionsUsed[this.name]=!0}}class Qr{constructor(e,t,i,s,n){this.xrLight=e,this.renderer=t,this.lightProbe=i,this.xrWebGLBinding=null,this.estimationStartCallback=n,this.frameCallback=this.onXRFrame.bind(this);const a=t.xr.getSession();if(s&&"XRWebGLBinding"in window){const i=new Ke(16);e.environment=i.texture;const s=t.getContext();switch(a.preferredReflectionFormat){case"srgba8":s.getExtension("EXT_sRGB");break;case"rgba16f":s.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(a,s),this.lightProbe.addEventListener("reflectionchange",(()=>{this.updateReflection()}))}a.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const i=t.getLightEstimate(this.lightProbe);if(i){this.xrLight.lightProbe.sh.fromArray(i.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const e=Math.max(1,Math.max(i.primaryLightIntensity.x,Math.max(i.primaryLightIntensity.y,i.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(i.primaryLightIntensity.x/e,i.primaryLightIntensity.y/e,i.primaryLightIntensity.z/e),this.xrLight.directionalLight.intensity=e,this.xrLight.directionalLight.position.copy(i.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class Mr extends ie{constructor(e,t=!0){super(),this.lightProbe=new Ve,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new w,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let i=null,s=!1;e.xr.addEventListener("sessionstart",(()=>{const n=e.xr.getSession();"requestLightProbe"in n&&n.requestLightProbe({reflectionFormat:n.preferredReflectionFormat}).then((n=>{i=new Qr(this,e,n,t,(()=>{s=!0,this.dispatchEvent({type:"estimationstart"})}))}))})),e.xr.addEventListener("sessionend",(()=>{i&&(i.dispose(),i=null),s&&this.dispatchEvent({type:"estimationend"})})),this.dispose=()=>{i&&(i.dispose(),i=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e=50){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,t,i,s){const n=2e-4*this.naturalFrequency;if(null==e||0===s)return t;if(e===t&&0===this.velocity)return t;if(i<0)return e;const a=e-t,r=this.velocity+this.naturalFrequency*a,o=a+i*r,A=Math.exp(-this.naturalFrequency*i),l=(r-this.naturalFrequency*o)*A,c=-this.naturalFrequency*(l+r*A);return Math.abs(l)<n*Math.abs(s)&&c*a>=0?(this.velocity=0,t):(this.velocity=l,t+o*A)}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dr=.2,Rr=Math.PI/24,kr=new y,Fr=(e,t,i)=>{let s=t>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let n=0;n<=12;++n)e.push(t+.17*Math.cos(s),i+.17*Math.sin(s),0,t+Dr*Math.cos(s),i+Dr*Math.sin(s),0),s+=Rr};class Lr extends X{constructor(e,t){const i=new h,s=[],n=[],{size:a,boundingBox:r}=e,o=a.x/2,A=("back"===t?a.y:a.z)/2;Fr(n,o,A),Fr(n,-o,A),Fr(n,-o,-A),Fr(n,o,-A);const l=n.length/3;for(let e=0;e<l-2;e+=2)s.push(e,e+1,e+3,e,e+3,e+2);const c=l-2;s.push(c,c+1,1,c,1,0),i.setAttribute("position",new Je(n,3)),i.setIndex(s),super(i),this.side=t;const u=this.material;switch(u.side=K,u.transparent=!0,u.opacity=0,this.goalOpacity=0,this.opacityDamper=new Tr,this.hitPlane=new X(new Ye(2*(o+Dr),2*(A+Dr))),this.hitPlane.visible=!1,this.hitPlane.material.side=K,this.add(this.hitPlane),this.hitBox=new X(new We(a.x+.4,a.y+Dr,a.z+.4)),this.hitBox.visible=!1,this.hitBox.material.side=K,this.add(this.hitBox),r.getCenter(this.position),t){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=r.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=r.min.z,this.position.z=this.shadowHeight}e.target.add(this),this.hitBox.position.y=(a.y+Dr)/2+r.min.y,e.target.add(this.hitBox),this.offsetHeight=0}getHit(e,t,i){kr.set(t,-i),this.hitPlane.visible=!0;const s=e.positionAndNormalFromPoint(kr,this.hitPlane);return this.hitPlane.visible=!1,null==s?null:s.position}getExpandedHit(e,t,i){this.hitPlane.scale.set(1e3,1e3,1e3),this.hitPlane.updateMatrixWorld();const s=this.getHit(e,t,i);return this.hitPlane.scale.set(1,1,1),s}controllerIntersection(e,t){this.hitBox.visible=!0;const i=e.hitFromController(t,this.hitBox);return this.hitBox.visible=!1,i}set offsetHeight(e){e-=.001,"back"===this.side?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return"back"===this.side?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.goalOpacity=e?.75:0}updateOpacity(e){const t=this.material;t.opacity=this.opacityDamper.update(t.opacity,this.goalOpacity,e,1),this.visible=t.opacity>0}dispose(){const{geometry:e,material:t}=this.hitPlane;e.dispose(),t.dispose(),this.hitBox.geometry.dispose(),this.hitBox.material.dispose(),this.geometry.dispose(),this.material.dispose(),this.hitBox.removeFromParent(),this.removeFromParent()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _r=(e,t)=>({type:"number",number:e,unit:t}),Pr=(()=>{const e={};return t=>{const i=t;if(i in e)return e[i];const s=[];let n=0;for(;t;){if(++n>1e3){t="";break}const e=Or(t),i=e.nodes[0];if(null==i||0===i.terms.length)break;s.push(i),t=e.remainingInput}return e[i]=s}})(),Or=(()=>{const e=/^(\-\-|[a-z\u0240-\uffff])/i,t=/^([\*\+\/]|[\-]\s)/i,i=/^[\),]/;return s=>{const n=[];for(;s.length&&(s=s.trim(),!i.test(s));)if("("===s[0]){const{nodes:e,remainingInput:t}=jr(s);s=t,n.push({type:"function",name:{type:"ident",value:"calc"},arguments:e})}else if(e.test(s)){const e=Ur(s),t=e.nodes[0];if("("===(s=e.remainingInput)[0]){const{nodes:e,remainingInput:i}=jr(s);n.push({type:"function",name:t,arguments:e}),s=i}else n.push(t)}else if(t.test(s))n.push({type:"operator",value:s[0]}),s=s.slice(1);else{const{nodes:e,remainingInput:t}="#"===s[0]?Nr(s):Gr(s);if(0===e.length)break;n.push(e[0]),s=t}return{nodes:[{type:"expression",terms:n}],remainingInput:s}}})(),Ur=(()=>{const e=/[^a-z0-9_\-\u0240-\uffff]/i;return t=>{const i=t.match(e);return{nodes:[{type:"ident",value:null==i?t:t.substr(0,i.index)}],remainingInput:null==i?"":t.substr(i.index)}}})(),Gr=(()=>{const e=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,t=/^[a-z%]+/i,i=/^(m|mm|cm|rad|deg|[%])$/;return s=>{const n=s.match(e),a=null==n?"0":n[0],r=(s=null==a?s:s.slice(a.length)).match(t);let o=null!=r&&""!==r[0]?r[0]:null;const A=null==r?s:s.slice(o.length);return null==o||i.test(o)||(o=null),{nodes:[{type:"number",number:parseFloat(a)||0,unit:o}],remainingInput:A}}})(),Nr=(()=>{const e=/^[a-f0-9]*/i;return t=>{const i=(t=t.slice(1).trim()).match(e);return{nodes:null==i?[]:[{type:"hex",value:i[0]}],remainingInput:null==i?t:t.slice(i[0].length)}}})(),jr=e=>{const t=[];for(e=e.slice(1).trim();e.length;){const i=Or(e);if(t.push(i.nodes[0]),","===(e=i.remainingInput.trim())[0])e=e.slice(1).trim();else if(")"===e[0]){e=e.slice(1);break}}return{nodes:t,remainingInput:e}},Hr=Symbol("visitedTypes");class zr{constructor(e){this[Hr]=e}walk(e,t){const i=e.slice();for(;i.length;){const e=i.shift();switch(this[Hr].indexOf(e.type)>-1&&t(e),e.type){case"expression":i.unshift(...e.terms);break;case"function":i.unshift(e.name,...e.arguments)}}}}const qr=Object.freeze({type:"number",number:0,unit:null}),Vr=(e,t=0)=>{let{number:i,unit:s}=e;if(isFinite(i)){if("rad"===e.unit||null==e.unit)return e}else i=t,s="rad";return{type:"number",number:("deg"===s&&null!=i?i:0)*Math.PI/180,unit:"rad"}},Kr=(e,t=0)=>{let i,{number:s,unit:n}=e;if(isFinite(s)){if("m"===e.unit)return e}else s=t,n="m";switch(n){default:i=1;break;case"cm":i=.01;break;case"mm":i=.001}return{type:"number",number:i*s,unit:"m"}},Jr=(()=>{const e=e=>e,t={rad:e,deg:Vr,m:e,mm:Kr,cm:Kr};return(e,i=qr)=>{isFinite(e.number)||(e.number=i.number,e.unit=i.unit);const{unit:s}=e;if(null==s)return e;const n=t[s];return null==n?i:n(e)}})();
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Yr,Wr,Xr;const $r=Symbol("evaluate"),Zr=Symbol("lastValue");class eo{constructor(){this[Yr]=null}static evaluatableFor(e,t=qr){if(e instanceof eo)return e;if("number"===e.type)return"%"===e.unit?new so(e,t):e;switch(e.name.value){case"calc":return new Ao(e,t);case"env":return new ao(e)}return qr}static evaluate(e){return e instanceof eo?e.evaluate():e}static isConstant(e){return!(e instanceof eo)||e.isConstant}static applyIntrinsics(e,t){const{basis:i,keywords:s}=t,{auto:n}=s;return i.map(((t,i)=>{const a=null==n[i]?t:n[i];let r=e[i]?e[i]:a;if("ident"===r.type){const e=r.value;e in s&&(r=s[e][i])}return null!=r&&"ident"!==r.type||(r=a),"%"===r.unit?_r(r.number/100*t.number,t.unit):(r=Jr(r,t),r.unit!==t.unit?t:r)}))}get isConstant(){return!1}evaluate(){return this.isConstant&&null!=this[Zr]||(this[Zr]=this[$r]()),this[Zr]}}Yr=Zr;const to=Symbol("percentage"),io=Symbol("basis");class so extends eo{constructor(e,t){super(),this[to]=e,this[io]=t}get isConstant(){return!0}[$r](){return _r(this[to].number/100*this[io].number,this[io].unit)}}const no=Symbol("identNode");class ao extends eo{constructor(e){super(),this[Wr]=null;const t=e.arguments.length?e.arguments[0].terms[0]:null;null!=t&&"ident"===t.type&&(this[no]=t)}get isConstant(){return!1}[(Wr=no,$r)](){if(null!=this[no]&&"window-scroll-y"===this[no].value){return{type:"number",number:window.pageYOffset/(Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight)||0,unit:null}}return qr}}const ro=/[\*\/]/,oo=Symbol("evaluator");class Ao extends eo{constructor(e,t=qr){if(super(),this[Xr]=null,1!==e.arguments.length)return;const i=e.arguments[0].terms.slice(),s=[];for(;i.length;){const e=i.shift();if(s.length>0){const i=s[s.length-1];if("operator"===i.type&&ro.test(i.value)){const i=s.pop(),n=s.pop();if(null==n)return;s.push(new uo(i,eo.evaluatableFor(n,t),eo.evaluatableFor(e,t)));continue}}s.push("operator"===e.type?e:eo.evaluatableFor(e,t))}for(;s.length>2;){const[e,i,n]=s.splice(0,3);if("operator"!==i.type)return;s.unshift(new uo(i,eo.evaluatableFor(e,t),eo.evaluatableFor(n,t)))}1===s.length&&(this[oo]=s[0])}get isConstant(){return null==this[oo]||eo.isConstant(this[oo])}[(Xr=oo,$r)](){return null!=this[oo]?eo.evaluate(this[oo]):qr}}const lo=Symbol("operator"),co=Symbol("left"),ho=Symbol("right");class uo extends eo{constructor(e,t,i){super(),this[lo]=e,this[co]=t,this[ho]=i}get isConstant(){return eo.isConstant(this[co])&&eo.isConstant(this[ho])}[$r](){const e=Jr(eo.evaluate(this[co])),t=Jr(eo.evaluate(this[ho])),{number:i,unit:s}=e,{number:n,unit:a}=t;if(null!=a&&null!=s&&a!=s)return qr;const r=s||a;let o;switch(this[lo].value){case"+":o=i+n;break;case"-":o=i-n;break;case"/":o=i/n;break;case"*":o=i*n;break;default:return qr}return{type:"number",number:o,unit:r}}}const po=Symbol("evaluatables"),go=Symbol("intrinsics");class mo extends eo{constructor(e,t){super(),this[go]=t;const i=e[0],s=null!=i?i.terms:[];this[po]=t.basis.map(((e,t)=>{const i=s[t];return null==i?{type:"ident",value:"auto"}:"ident"===i.type?i:eo.evaluatableFor(i,e)}))}get isConstant(){for(const e of this[po])if(!eo.isConstant(e))return!1;return!0}[$r](){const e=this[po].map((e=>eo.evaluate(e)));return eo.applyIntrinsics(e,this[go]).map((e=>e.number))}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fo,bo,Io,yo;const Co=Symbol("instances"),Eo=Symbol("activateListener"),wo=Symbol("deactivateListener"),Bo=Symbol("notifyInstances"),vo=Symbol("notify"),xo=Symbol("callback");class So{static[Bo](){for(const e of So[Co])e[vo]()}static[(fo=Co,Eo)](){window.addEventListener("scroll",this[Bo],{passive:!0})}static[wo](){window.removeEventListener("scroll",this[Bo])}constructor(e){this[xo]=e}observe(){0===So[Co].size&&So[Eo](),So[Co].add(this)}disconnect(){So[Co].delete(this),0===So[Co].size&&So[wo]()}[vo](){this[xo]()}}So[fo]=new Set;const Qo=Symbol("computeStyleCallback"),Mo=Symbol("astWalker"),To=Symbol("dependencies"),Do=Symbol("onScroll");class Ro{constructor(e){this[bo]={},this[Io]=new zr(["function"]),this[yo]=()=>{this[Qo]({relatedState:"window-scroll"})},this[Qo]=e}observeEffectsFor(e){const t={},i=this[To];this[Mo].walk(e,(e=>{const{name:s}=e,n=e.arguments[0].terms[0];if("env"===s.value&&null!=n&&"ident"===n.type&&"window-scroll-y"===n.value)if(null==t["window-scroll"]){const e="window-scroll"in i?i["window-scroll"]:new So(this[Do]);e.observe(),delete i["window-scroll"],t["window-scroll"]=e}}));for(const e in i){i[e].disconnect()}this[To]=t}dispose(){for(const e in this[To]){this[To][e].disconnect()}}}bo=To,Io=Mo,yo=Do;
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ko=e=>{const t=e.observeEffects||!1,i=e.intrinsics instanceof Function?e.intrinsics:()=>e.intrinsics;return(s,n)=>{const a=s.updated,r=s.connectedCallback,o=s.disconnectedCallback,A=Symbol(`${n}StyleEffector`),l=Symbol(`${n}StyleEvaluator`),c=Symbol(`${n}UpdateEvaluator`),h=Symbol(`${n}EvaluateAndSync`);Object.defineProperties(s,{[A]:{value:null,writable:!0},[l]:{value:null,writable:!0},[c]:{value:function(){const e=Pr(this[n]);this[l]=new mo(e,i(this)),null==this[A]&&t&&(this[A]=new Ro((()=>this[h]()))),null!=this[A]&&this[A].observeEffectsFor(e)}},[h]:{value:function(){if(null==this[l])return;const t=this[l].evaluate();this[e.updateHandler](t)}},updated:{value:function(e){e.has(n)&&(this[c](),this[h]()),a.call(this,e)}},connectedCallback:{value:function(){r.call(this),this.requestUpdate(n,this[n])}},disconnectedCallback:{value:function(){o.call(this),null!=this[A]&&(this[A].dispose(),this[A]=null)}}})}},Fo=e=>e<.5?2*e*e:(4-2*e)*e-1,Lo=(e,t,i=Fo)=>s=>e+(t-e)*i(s),_o=e=>{const t=[],i=[];let s=e.initialValue;for(let n=0;n<e.keyframes.length;++n){const a=e.keyframes[n],{value:r,frames:o}=a,A=a.ease||Fo,l=Lo(s,r,A);t.push(l),i.push(o),s=r}return((e,t)=>{const i=t.map((s=0,e=>s+=e));var s;return t=>{t=rs(t,0,1),t*=i[i.length-1];const s=i.findIndex((e=>e>=t)),n=s<1?0:i[s-1],a=i[s];return e[s]((t-n)/(a-n))}})(t,i)};
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Po=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const Oo=_o({initialValue:0,keyframes:[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]}),Uo=_o({initialValue:0,keyframes:[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]}),Go="0deg 75deg 105%",No=["front","right","back","left"],jo=["upper-","","lower-"],Ho="auto",zo="basic",qo="wiggle",Vo="none",Ko=()=>({basis:[Vr(_r(30,"deg"))],keywords:{auto:[null]}}),Jo=()=>({basis:[Vr(_r(12,"deg"))],keywords:{auto:[null]}}),Yo=(()=>{const e=Pr(Go)[0].terms,t=Jr(e[0]),i=Jr(e[1]);return e=>{const s=e[Du].idealCameraDistance();return{basis:[t,i,_r(s,"m")],keywords:{auto:[null,null,_r(105,"%")]}}}})(),Wo=e=>{const t=2.2*e[Du].boundingSphere.radius;return{basis:[_r(-1/0,"rad"),_r(0,"rad"),_r(t,"m")],keywords:{auto:[null,null,null]}}},Xo=e=>{const t=Yo(e),i=new mo([],t).evaluate()[2];return{basis:[_r(1/0,"rad"),_r(Math.PI,"rad"),_r(i,"m")],keywords:{auto:[null,null,null]}}},$o=e=>{const t=e[Du].boundingBox.getCenter(new v);return{basis:[_r(t.x,"m"),_r(t.y,"m"),_r(t.z,"m")],keywords:{auto:[null,null,null]}}},Zo=Math.PI/2,eA=Math.PI/3,tA=Zo/2,iA=2*Math.PI,sA=Symbol("controls"),nA=Symbol("panElement"),aA=Symbol("promptElement"),rA=Symbol("promptAnimatedContainer"),oA=Symbol("fingerAnimatedContainers"),AA=Symbol("deferInteractionPrompt"),lA=Symbol("updateAria"),cA=Symbol("a11y"),hA=Symbol("updateA11y"),uA=Symbol("updateCameraForRadius"),dA=Symbol("cancelPrompts"),pA=Symbol("onChange"),gA=Symbol("onPointerChange"),mA=Symbol("waitingToPromptUser"),fA=Symbol("userHasInteracted"),bA=Symbol("promptElementVisibleTime"),IA=Symbol("lastPromptOffset"),yA=Symbol("cancellationSource"),CA=Symbol("lastSpherical"),EA=Symbol("jumpCamera"),wA=Symbol("initialized"),BA=Symbol("maintainThetaPhi"),vA=Symbol("syncCameraOrbit"),xA=Symbol("syncFieldOfView"),SA=Symbol("syncCameraTarget"),QA=Symbol("syncMinCameraOrbit"),MA=Symbol("syncMaxCameraOrbit"),TA=Symbol("syncMinFieldOfView"),DA=Symbol("syncMaxFieldOfView"),RA=new y,kA=new v,FA=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:0,maximumPolarAngle:Math.PI,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,touchAction:"none"}),LA=Math.PI/8,_A=.04,PA={USER_INTERACTION:"user-interaction",NONE:"none",AUTOMATIC:"automatic"};class OA extends je{constructor(e,t,i){super(),this.camera=e,this.element=t,this.scene=i,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.inputSensitivity=1,this.changeSource=PA.NONE,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserPointing=!1,this.enablePan=!0,this.enableTap=!0,this.panProjection=new $e,this.panPerPixel=0,this.spherical=new Xe,this.goalSpherical=new Xe,this.thetaDamper=new Tr,this.phiDamper=new Tr,this.radiusDamper=new Tr,this.logFov=Math.log(FA.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new Tr,this.touchMode=null,this.pointers=[],this.startTime=0,this.startPointerPosition={clientX:0,clientY:0},this.lastSeparation=0,this.touchDecided=!1,this.onContext=e=>{if(this.enablePan)e.preventDefault();else for(const e of this.pointers)this.onPointerUp(new PointerEvent("pointercancel",Object.assign(Object.assign({},this.startPointerPosition),{pointerId:e.id})))},this.touchModeZoom=(e,t)=>{if(!this._disableZoom){const e=this.twoTouchDistance(this.pointers[0],this.pointers[1]),t=_A*this.zoomSensitivity*(this.lastSeparation-e)*50/this.scene.height;this.lastSeparation=e,this.userAdjustOrbit(0,0,t)}this.panPerPixel>0&&this.movePan(e,t)},this.disableScroll=e=>{e.preventDefault()},this.touchModeRotate=(e,t)=>{const{touchAction:i}=this._options;if(!this.touchDecided&&"none"!==i){this.touchDecided=!0;const s=Math.abs(e),n=Math.abs(t);if(this.changeSource===PA.USER_INTERACTION&&("pan-y"===i&&n>s||"pan-x"===i&&s>n))return void(this.touchMode=null);this.element.addEventListener("touchmove",this.disableScroll,{passive:!1})}this.handleSinglePointerMove(e,t)},this.onPointerDown=e=>{if(this.pointers.length>2)return;const{element:t}=this;0===this.pointers.length&&(t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.touchMode=null,this.touchDecided=!1,this.startPointerPosition.clientX=e.clientX,this.startPointerPosition.clientY=e.clientY,this.startTime=performance.now());try{t.setPointerCapture(e.pointerId)}catch(e){}this.pointers.push({clientX:e.clientX,clientY:e.clientY,id:e.pointerId}),this.isUserPointing=!1,"touch"===e.pointerType?(this.changeSource=e.altKey?PA.AUTOMATIC:PA.USER_INTERACTION,this.onTouchChange(e)):(this.changeSource=PA.USER_INTERACTION,this.onMouseDown(e)),this.changeSource===PA.USER_INTERACTION&&this.dispatchEvent({type:"user-interaction"})},this.onPointerMove=e=>{const t=this.pointers.find((t=>t.id===e.pointerId));if(null==t)return;if("mouse"===e.pointerType&&0===e.buttons)return void this.onPointerUp(e);const i=this.pointers.length,s=(e.clientX-t.clientX)/i,n=(e.clientY-t.clientY)/i;0===s&&0===n||(t.clientX=e.clientX,t.clientY=e.clientY,"touch"===e.pointerType?(this.changeSource=e.altKey?PA.AUTOMATIC:PA.USER_INTERACTION,null!==this.touchMode&&this.touchMode(s,n)):(this.changeSource=PA.USER_INTERACTION,this.panPerPixel>0?this.movePan(s,n):this.handleSinglePointerMove(s,n)))},this.onPointerUp=e=>{const{element:t}=this,i=this.pointers.findIndex((t=>t.id===e.pointerId));-1!==i&&this.pointers.splice(i,1),this.panPerPixel>0&&!e.altKey&&this.resetRadius(),0===this.pointers.length?(t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("touchmove",this.disableScroll),this.enablePan&&this.enableTap&&this.recenter(e)):null!==this.touchMode&&this.onTouchChange(e),this.scene.element[nA].style.opacity=0,t.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end"})},this.onWheel=e=>{this.changeSource=PA.USER_INTERACTION;const t=e.deltaY*(1==e.deltaMode?18:1)*_A*this.zoomSensitivity/30;this.userAdjustOrbit(0,0,t),e.preventDefault(),this.dispatchEvent({type:"user-interaction"})},this.onKeyDown=e=>{const{changeSource:t}=this;this.changeSource=PA.USER_INTERACTION;(e.shiftKey&&this.enablePan?this.panKeyCodeHandler(e):this.orbitZoomKeyCodeHandler(e))?(e.preventDefault(),this.dispatchEvent({type:"user-interaction"})):this.changeSource=t},this._options=Object.assign({},FA),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(!1===this._interactionEnabled){const{element:e}=this;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointercancel",this.onPointerUp),this._disableZoom||e.addEventListener("wheel",this.onWheel),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("touchmove",(()=>{}),{passive:!1}),e.addEventListener("contextmenu",this.onContext),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(!0===this._interactionEnabled){const{element:e}=this;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointercancel",this.onPointerUp),e.removeEventListener("wheel",this.onWheel),e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("contextmenu",this.onContext),e.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(e){this._disableZoom!=e&&(this._disableZoom=e,!0===e?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(e=new Xe){return e.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(e){Object.assign(this._options,e),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(e,t){this.camera.far=0===t?2:t,this.camera.near=.1,this.camera.updateProjectionMatrix()}updateAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setOrbit(e=this.goalSpherical.theta,t=this.goalSpherical.phi,i=this.goalSpherical.radius){const{minimumAzimuthalAngle:s,maximumAzimuthalAngle:n,minimumPolarAngle:a,maximumPolarAngle:r,minimumRadius:o,maximumRadius:A}=this._options,{theta:l,phi:c,radius:h}=this.goalSpherical,u=rs(e,s,n);isFinite(s)||isFinite(n)||(this.spherical.theta=this.wrapAngle(this.spherical.theta-u)+u);const d=rs(t,a,r),p=rs(i,o,A);return(u!==l||d!==c||p!==h)&&(!!(isFinite(u)&&isFinite(d)&&isFinite(p))&&(this.goalSpherical.theta=u,this.goalSpherical.phi=d,this.goalSpherical.radius=p,this.goalSpherical.makeSafe(),!0))}setRadius(e){this.goalSpherical.radius=e,this.setOrbit()}setFieldOfView(e){const{minimumFieldOfView:t,maximumFieldOfView:i}=this._options;e=rs(e,t,i),this.goalLogFov=Math.log(e)}setDamperDecayTime(e){this.thetaDamper.setDecayTime(e),this.phiDamper.setDecayTime(e),this.radiusDamper.setDecayTime(e),this.fovDamper.setDecayTime(e)}adjustOrbit(e,t,i){const{theta:s,phi:n,radius:a}=this.goalSpherical,{minimumRadius:r,maximumRadius:o,minimumFieldOfView:A,maximumFieldOfView:l}=this._options,c=this.spherical.theta-s,h=Math.PI-.001,u=s-rs(e,-h-c,h-c),d=n-t,p=0===i?0:((i>0?o:r)-a)/(Math.log(i>0?l:A)-this.goalLogFov),g=a+i*(isFinite(p)?p:2*(o-r));if(this.setOrbit(u,d,g),0!==i){const e=this.goalLogFov+i;this.setFieldOfView(Math.exp(e))}}jumpToGoal(){this.update(0,1e4)}update(e,t){if(this.isStationary())return!1;const{maximumPolarAngle:i,maximumRadius:s}=this._options,n=this.spherical.theta-this.goalSpherical.theta;return Math.abs(n)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=2*Math.sign(n)*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,t,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,t,i),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,t,s),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,t,1),this.moveCamera(),!0}updateTouchActionStyle(){const{style:e}=this.element;if(this._interactionEnabled){const{touchAction:t}=this._options;this._disableZoom&&"none"!==t?e.touchAction="manipulation":e.touchAction=t}else e.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new Ze(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix())}userAdjustOrbit(e,t,i){this.adjustOrbit(e*this.orbitSensitivity*this.inputSensitivity,t*this.orbitSensitivity*this.inputSensitivity,i*this.inputSensitivity)}wrapAngle(e){const t=(e+Math.PI)/(2*Math.PI);return 2*(t-Math.floor(t))*Math.PI-Math.PI}pixelLengthToSphericalAngle(e){return 2*Math.PI*e/this.scene.height}twoTouchDistance(e,t){const{clientX:i,clientY:s}=e,{clientX:n,clientY:a}=t,r=n-i,o=a-s;return Math.sqrt(r*r+o*o)}handleSinglePointerMove(e,t){const i=this.pixelLengthToSphericalAngle(e),s=this.pixelLengthToSphericalAngle(t);!1===this.isUserPointing&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start"})),this.userAdjustOrbit(i,s,0)}initializePan(){const{theta:e,phi:t}=this.spherical,i=e-this.scene.yaw;this.panPerPixel=.018*this.panSensitivity/this.scene.height,this.panProjection.set(-Math.cos(i),-Math.cos(t)*Math.sin(i),0,0,Math.sin(t),0,Math.sin(i),-Math.cos(t)*Math.cos(i),0)}movePan(e,t){const{scene:i}=this,s=kA.set(e,t,0).multiplyScalar(this.inputSensitivity),n=this.spherical.radius*Math.exp(this.logFov)*this.panPerPixel;s.multiplyScalar(n);const a=i.getTarget();a.add(s.applyMatrix3(this.panProjection)),i.boundingSphere.clampPoint(a,a),i.setTarget(a.x,a.y,a.z)}recenter(e){if(performance.now()>this.startTime+300||Math.abs(e.clientX-this.startPointerPosition.clientX)>2||Math.abs(e.clientY-this.startPointerPosition.clientY)>2)return;const{scene:t}=this,i=t.positionAndNormalFromPoint(t.getNDC(e.clientX,e.clientY));if(null==i){const{cameraTarget:e}=t.element;t.element.cameraTarget="",t.element.cameraTarget=e,this.userAdjustOrbit(0,0,1)}else t.target.worldToLocal(i.position),t.setTarget(i.position.x,i.position.y,i.position.z)}resetRadius(){const{scene:e}=this,t=e.positionAndNormalFromPoint(RA.set(0,0));if(null==t)return;e.target.worldToLocal(t.position);const i=e.getTarget(),{theta:s,phi:n}=this.spherical,a=s-e.yaw,r=kA.set(Math.sin(n)*Math.sin(a),Math.cos(n),Math.sin(n)*Math.cos(a)),o=r.dot(t.position.sub(i));i.add(r.multiplyScalar(o)),e.setTarget(i.x,i.y,i.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-o)}onTouchChange(e){if(1===this.pointers.length)this.touchMode=this.touchModeRotate;else{if(this._disableZoom)return this.touchMode=null,void this.element.removeEventListener("touchmove",this.disableScroll);this.touchMode=this.touchDecided&&null===this.touchMode?null:this.touchModeZoom,this.touchDecided=!0,this.element.addEventListener("touchmove",this.disableScroll,{passive:!1}),this.lastSeparation=this.twoTouchDistance(this.pointers[0],this.pointers[1]),this.enablePan&&null!=this.touchMode&&(this.initializePan(),e.altKey||(this.scene.element[nA].style.opacity=1))}}onMouseDown(e){this.panPerPixel=0,this.enablePan&&(2===e.button||e.ctrlKey||e.metaKey||e.shiftKey)&&(this.initializePan(),this.scene.element[nA].style.opacity=1),this.element.style.cursor="grabbing"}orbitZoomKeyCodeHandler(e){let t=!0;switch(e.key){case"PageUp":this.userAdjustOrbit(0,0,_A*this.zoomSensitivity);break;case"PageDown":this.userAdjustOrbit(0,0,-.04*this.zoomSensitivity);break;case"ArrowUp":this.userAdjustOrbit(0,-LA,0);break;case"ArrowDown":this.userAdjustOrbit(0,LA,0);break;case"ArrowLeft":this.userAdjustOrbit(-LA,0,0);break;case"ArrowRight":this.userAdjustOrbit(LA,0,0);break;default:t=!1}return t}panKeyCodeHandler(e){this.initializePan();let t=!0;switch(e.key){case"ArrowUp":this.movePan(0,-10);break;case"ArrowDown":this.movePan(0,10);break;case"ArrowLeft":this.movePan(-10,0);break;case"ArrowRight":this.movePan(10,0);break;default:t=!1}return t}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UA=150,GA="not-presenting",NA="session-started",jA="object-placed",HA="failed",zA="tracking",qA="not-tracking",VA=new v,KA=new x,JA=new B,YA=new v,WA=new se(45,1,.1,100),XA=(new h).setFromPoints([new v(0,0,0),new v(0,0,-1)]),$A=new We;class ZA extends je{constructor(e){super(),this.renderer=e,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.xrMode=null,this.controller1=null,this.controller2=null,this.selectedController=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new v,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new v,this.relativeOrientation=new x,this.scaleLine=new Z(XA),this.firstRatio=0,this.lastAngle=0,this.goalPosition=new v,this.goalYaw=0,this.goalScale=1,this.xDamper=new Tr,this.yDamper=new Tr,this.zDamper=new Tr,this.yawDamper=new Tr,this.pitchDamper=new Tr,this.rollDamper=new Tr,this.scaleDamper=new Tr,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onControllerSelectStart=e=>{const t=this.presentedScene,i=e.target;if(null!=this.placementBox.controllerIntersection(t,i))null!=this.selectedController&&(this.selectedController.userData.line.visible=!1,t.canScale&&(this.isTwoFingering=!0,this.firstRatio=this.controllerSeparation()/t.pivot.scale.x,this.scaleLine.visible=!0)),i.attach(t.pivot),this.selectedController=i,t.setShadowIntensity(.01);else{const e=i===this.controller1?this.controller2:this.controller1;this.relativeOrientation.copy(i.quaternion).invert().multiply(t.pivot.getWorldQuaternion(KA)),e.userData.turning=!1,i.userData.turning=!0,i.userData.line.visible=!1}},this.onControllerSelectEnd=e=>{const t=e.target;if(t.userData.turning=!1,t.userData.line.visible=!0,this.isTwoFingering=!1,this.scaleLine.visible=!1,null!=this.selectedController&&this.selectedController!=t)return;const i=this.presentedScene;i.attach(i.pivot),this.selectedController=null,this.goalYaw=Math.atan2(i.pivot.matrix.elements[8],i.pivot.matrix.elements[10]),this.goalPosition.x=i.pivot.position.x,this.goalPosition.z=i.pivot.position.z},this.onUpdateScene=()=>{null!=this.placementBox&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new Lr(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=e=>{const t=this.transientHitTestSource;if(null==t)return;const i=this.frame.getHitTestResultsForTransientInput(t),s=this.presentedScene,n=this.placementBox;if(1===i.length){this.inputSource=e.inputSource;const{axes:t}=this.inputSource.gamepad,i=n.getHit(this.presentedScene,t[0],t[1]);n.show=!0,null!=i?(this.isTranslating=!0,this.lastDragPosition.copy(i)):!1===this.placeOnWall&&(this.isRotating=!0,this.lastAngle=1.5*t[0])}else if(2===i.length){n.show=!0,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(i);this.firstRatio=e/s.pivot.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=e.threeRenderer,this.threeRenderer.xr.enabled=!0}async resolveARSession(){is();const e=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:[],optionalFeatures:["hit-test","dom-overlay","light-estimation"],domOverlay:this.overlay?{root:this.overlay}:void 0});return this.threeRenderer.xr.setReferenceSpaceType("local"),await this.threeRenderer.xr.setSession(e),this.threeRenderer.xr.cameraAutoUpdate=!1,e}get presentedScene(){return this._presentedScene}async supportsPresentation(){try{return is(),await navigator.xr.isSessionSupported("immersive-ar")}catch(e){return console.warn("Request to present in WebXR denied:"),console.warn(e),console.warn("Falling back to next ar-mode"),!1}}async present(e,t=!1){this.isPresenting&&console.warn("Cannot present while a model is already presenting");let i=new Promise(((e,t)=>{requestAnimationFrame((()=>e()))}));e.setHotspotsVisibility(!1),e.queueRender(),await i,this._presentedScene=e,this.overlay=e.element.shadowRoot.querySelector("div.default"),!0===t&&(this.xrLight=new Mr(this.threeRenderer),this.xrLight.addEventListener("estimationstart",(()=>{if(!this.isPresenting||null==this.xrLight)return;const e=this.presentedScene;e.add(this.xrLight),e.environment=this.xrLight.environment})));const s=await this.resolveARSession();s.addEventListener("end",(()=>{this.postSessionCleanup()}),{once:!0});const n=e.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");n.classList.add("enabled"),n.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=n;const a=await s.requestReferenceSpace("viewer");this.xrMode=s.interactionMode,this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=e.yaw,this.goalYaw=e.yaw,this.goalScale=1,e.setBackground(null),this.oldShadowIntensity=e.shadowIntensity,e.setShadowIntensity(.01),this.oldTarget.copy(e.getTarget()),e.element.addEventListener("load",this.onUpdateScene);const r=20*Math.PI/180,o=!0===this.placeOnWall?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(r),z:-Math.cos(r)});s.requestHitTestSource({space:a,offsetRay:o}).then((e=>{this.initialHitSource=e})),"screen-space"!==this.xrMode&&(this.setupControllers(),this.xDamper.setDecayTime(UA),this.yDamper.setDecayTime(UA),this.zDamper.setDecayTime(UA),this.yawDamper.setDecayTime(UA),this.pitchDamper.setDecayTime(UA),this.rollDamper.setDecayTime(UA)),this.currentSession=s,this.placementBox=new Lr(e,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:NA})}setupControllers(){this.controller1=this.threeRenderer.xr.getController(0),this.controller1.addEventListener("selectstart",this.onControllerSelectStart),this.controller1.addEventListener("selectend",this.onControllerSelectEnd),this.controller2=this.threeRenderer.xr.getController(1),this.controller2.addEventListener("selectstart",this.onControllerSelectStart),this.controller2.addEventListener("selectend",this.onControllerSelectEnd);const e=this.presentedScene;if(e.add(this.controller1),e.add(this.controller2),!this.controller1.userData.line){const t=new Z(XA);t.name="line",t.scale.z=5,this.controller1.userData.turning=!1,this.controller1.userData.line=t,this.controller1.add(t),this.controller2.userData.turning=!1;const i=t.clone();this.controller2.userData.line=i,this.controller2.add(i),this.scaleLine.name="scale line",this.scaleLine.visible=!1,this.controller1.add(this.scaleLine);const{size:s}=e,n=.1/Math.max(s.x,s.y,s.z),a=new X($A);a.name="box",a.scale.copy(s).multiplyScalar(n),a.visible=!1,this.controller1.userData.box=a,e.add(a);const r=a.clone();this.controller2.userData.box=r,e.add(r)}}hover(e){if("screen-space"===this.xrMode||this.selectedController==e)return!1;const t=this.presentedScene,i=this.placementBox.controllerIntersection(t,e);return e.userData.box.visible=(null==i||e.userData.turning)&&!this.isTwoFingering,e.userData.line.scale.z=null==i?5:i.distance,null!=i}controllerSeparation(){return this.controller1.position.distanceTo(this.controller2.position)}async stopPresenting(){if(!this.isPresenting)return;const e=new Promise((e=>{this.resolveCleanup=e}));try{await this.currentSession.end(),await e}catch(e){console.warn("Error while trying to end WebXR AR session"),console.warn(e),this.postSessionCleanup()}}get isPresenting(){return null!=this.presentedScene}get target(){return this.oldTarget}updateTarget(){const e=this.presentedScene;if(null!=e){const t=e.getTarget();this.oldTarget.copy(t),this.placeOnWall?t.z=e.boundingBox.min.z:t.y=e.boundingBox.min.y,e.setTarget(t.x,t.y,t.z)}}postSessionCleanup(){const e=this.currentSession;null!=e&&(e.removeEventListener("selectstart",this.onSelectStart),e.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const t=this.presentedScene;if(this._presentedScene=null,null!=t){const{element:e}=t;null!=this.xrLight&&(t.remove(this.xrLight),this.xrLight.dispose(),this.xrLight=null),t.add(t.pivot),t.pivot.quaternion.set(0,0,0,1),t.pivot.position.set(0,0,0),t.pivot.scale.set(1,1,1),t.setShadowOffset(0);const i=this.turntableRotation;null!=i&&(t.yaw=i);const s=this.oldShadowIntensity;null!=s&&t.setShadowIntensity(s),t.setEnvironmentAndSkybox(e[ls],e[cs]);const n=this.oldTarget;t.setTarget(n.x,n.y,n.z),t.xrCamera=null,t.element.removeEventListener("load",this.onUpdateScene),t.orientHotspots(0);const{width:a,height:r}=e.getBoundingClientRect();t.setSize(a,r),requestAnimationFrame((()=>{t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:PA.NONE}}))}))}this.renderer.height=0;const i=this.exitWebXRButtonContainer;null!=i&&(i.classList.remove("enabled"),i.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const s=this.transientHitTestSource;null!=s&&(s.cancel(),this.transientHitTestSource=null);const n=this.initialHitSource;null!=n&&(n.cancel(),this.initialHitSource=null),null!=this.placementBox&&(this.placementBox.dispose(),this.placementBox=null),"screen-space"!==this.xrMode&&(null!=this.controller1&&(this.controller1.userData.turning=!1,this.controller1.userData.box.visible=!1,this.controller1.userData.line.visible=!0,this.controller1.removeEventListener("selectstart",this.onControllerSelectStart),this.controller1.removeEventListener("selectend",this.onControllerSelectEnd),this.controller1.removeFromParent(),this.controller1=null),null!=this.controller2&&(this.controller2.userData.turning=!1,this.controller2.userData.box.visible=!1,this.controller2.userData.line.visible=!0,this.controller2.removeEventListener("selectstart",this.onControllerSelectStart),this.controller2.removeEventListener("selectend",this.onControllerSelectEnd),this.controller2.removeFromParent(),this.controller2=null),this.selectedController=null,this.scaleLine.visible=!1),this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.inputSource=null,this.overlay=null,null!=this.resolveCleanup&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:GA})}updateView(e){const t=this.presentedScene,i=this.threeRenderer.xr;i.updateCamera(WA),t.xrCamera=i.getCamera();const{elements:s}=t.getCamera().matrixWorld;if(t.orientHotspots(Math.atan2(s[1],s[5])),this.initialized||(this.placeInitially(),this.initialized=!0),e.requestViewportScale&&e.recommendedViewportScale){const t=e.recommendedViewportScale;e.requestViewportScale(Math.max(t,.25))}const n=i.getBaseLayer();if(null!=n){const t=n instanceof XRWebGLLayer?n.getViewport(e):i.getBinding().getViewSubImage(n,e).viewport;this.threeRenderer.setViewport(t.x,t.y,t.width,t.height)}}placeInitially(){const e=this.presentedScene,{pivot:t,element:i}=e,{position:s}=t,n=e.getCamera(),{width:a,height:r}=this.overlay.getBoundingClientRect();e.setSize(a,r),n.projectionMatrixInverse.copy(n.projectionMatrix).invert();const{theta:o}=i.getCameraOrbit(),A=n.getWorldDirection(VA);e.yaw=Math.atan2(-A.x,-A.z)-o,this.goalYaw=e.yaw;const l=Math.max(1,2*e.boundingSphere.radius);s.copy(n.position).add(A.multiplyScalar(l)),this.updateTarget();const c=e.getTarget();if(s.add(c).sub(this.oldTarget),this.goalPosition.copy(s),e.setHotspotsVisibility(!0),"screen-space"===this.xrMode){const{session:e}=this.frame;e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd),e.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then((e=>{this.transientHitTestSource=e}))}}getTouchLocation(){const{axes:e}=this.inputSource.gamepad;let t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return null!=t&&(VA.copy(t).sub(this.presentedScene.getCamera().position),VA.length()>10)?null:t}getHitPoint(e){const t=this.threeRenderer.xr.getReferenceSpace(),i=e.getPose(t);if(null==i)return null;const s=JA.fromArray(i.transform.matrix);return!0===this.placeOnWall&&(this.goalYaw=Math.atan2(s.elements[4],s.elements[6])),s.elements[5]>.75!==this.placeOnWall?YA.setFromMatrixPosition(s):null}moveToFloor(e){const t=this.initialHitSource;if(null==t)return;const i=e.getHitTestResults(t);if(0==i.length)return;const s=i[0],n=this.getHitPoint(s);null!=n&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(n):this.goalPosition.y=n.y),t.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:jA}))}fingerPolar(e){const t=e[0].inputSource.gamepad.axes,i=e[1].inputSource.gamepad.axes,s=i[0]-t[0],n=i[1]-t[1],a=Math.atan2(n,s);let r=this.lastAngle-a;return r>Math.PI?r-=2*Math.PI:r<-Math.PI&&(r+=2*Math.PI),this.lastAngle=a,{separation:Math.sqrt(s*s+n*n),deltaYaw:r}}setScale(e){const t=e/this.firstRatio;this.goalScale=Math.abs(t-1)<.2?1:t}processInput(e){const t=this.transientHitTestSource;if(null==t)return;if(!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const i=e.getHitTestResultsForTransientInput(t),s=this.presentedScene,n=s.pivot.scale.x;if(this.isTwoFingering)if(i.length<2)this.isTwoFingering=!1;else{const{separation:e,deltaYaw:t}=this.fingerPolar(i);!1===this.placeOnWall&&(this.goalYaw+=t),s.canScale&&this.setScale(e)}else if(2!==i.length)if(this.isRotating){const e=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=e-this.lastAngle,this.lastAngle=e}else this.isTranslating&&i.forEach((e=>{if(e.inputSource!==this.inputSource)return;let t=null;if(e.results.length>0&&(t=this.getHitPoint(e.results[0])),null==t&&(t=this.getTouchLocation()),null!=t){if(this.goalPosition.sub(this.lastDragPosition),!1===this.placeOnWall){const e=t.y-this.lastDragPosition.y;if(e<0){this.placementBox.offsetHeight=e/n,this.presentedScene.setShadowOffset(e);const i=VA.copy(s.getCamera().position),a=-e/(i.y-t.y);i.multiplyScalar(a),t.multiplyScalar(1-a).add(i)}}this.goalPosition.add(t),this.lastDragPosition.copy(t)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(i);this.firstRatio=e/n}}moveScene(e){const t=this.presentedScene,{pivot:i}=t,s=this.placementBox;if(s.updateOpacity(e),this.controller1&&(this.controller1.userData.turning&&(i.quaternion.copy(this.controller1.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller2&&i.quaternion.premultiply(KA.copy(this.controller2.quaternion).invert())),this.controller1.userData.box.position.copy(this.controller1.position),i.getWorldQuaternion(this.controller1.userData.box.quaternion)),this.controller2&&(this.controller2.userData.turning&&(i.quaternion.copy(this.controller2.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller1&&i.quaternion.premultiply(KA.copy(this.controller1.quaternion).invert())),this.controller2.userData.box.position.copy(this.controller2.position),i.getWorldQuaternion(this.controller2.userData.box.quaternion)),this.controller1&&this.controller2&&this.isTwoFingering){const e=this.controllerSeparation();this.setScale(e),this.scaleLine.scale.z=-e,this.scaleLine.lookAt(this.controller2.position)}const n=t.pivot.scale.x;if(this.goalScale!==n){const i=this.scaleDamper.update(n,this.goalScale,e,1);t.pivot.scale.set(i,i,i)}if(i.parent!==t)return;const{position:a}=i,r=t.boundingSphere.radius,o=this.goalPosition;let A=PA.NONE;if(!o.equals(a)){A=PA.USER_INTERACTION;let{x:i,y:n,z:l}=a;if(i=this.xDamper.update(i,o.x,e,r),n=this.yDamper.update(n,o.y,e,r),l=this.zDamper.update(l,o.z,e,r),a.set(i,n,l),"screen-space"===this.xrMode&&!this.isTranslating){const e=o.y-n;this.placementComplete&&!1===this.placeOnWall?(s.offsetHeight=e/t.pivot.scale.x,t.setShadowOffset(e)):0===e&&(this.placementComplete=!0,s.show=!1,t.setShadowIntensity(.8))}"screen-space"!==this.xrMode&&o.equals(a)&&t.setShadowIntensity(.8)}t.updateTarget(e),KA.setFromAxisAngle(VA.set(0,1,0),this.goalYaw);const l=t.pivot.quaternion.angleTo(KA),c=l-this.yawDamper.update(l,0,e,Math.PI);t.pivot.quaternion.rotateTowards(KA,c),t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:A}}))}onWebXRFrame(e,t){if("screen-space"!==this.xrMode){const e=this.hover(this.controller1),t=this.hover(this.controller2);this.placementBox.show=(e||t)&&!this.isTwoFingering}this.frame=t,++this.frames;const i=this.threeRenderer.xr.getReferenceSpace(),s=t.getViewerPose(i);null==s&&!0===this.tracking&&this.frames>30&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:qA}));const n=this.presentedScene;if(null==s||null==n||!n.element.loaded)return void this.threeRenderer.clear();!1===this.tracking&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:zA}));let a=!0;for(const i of s.views){if(this.updateView(i),a){this.moveToFloor(t),this.processInput(t);const i=e-this.lastTick;this.moveScene(i),this.renderer.preRender(n,e,i),this.lastTick=e,n.renderShadow(this.threeRenderer)}this.threeRenderer.render(n,n.getCamera()),a=!1}}}function el(e){const t=new Map,i=new Map,s=e.clone();return tl(e,s,(function(e,s){t.set(s,e),i.set(e,s)})),s.traverse((function(e){if(!e.isSkinnedMesh)return;const s=e,n=t.get(e),a=n.skeleton.bones;s.skeleton=n.skeleton.clone(),s.bindMatrix.copy(n.bindMatrix),s.skeleton.bones=a.map((function(e){return i.get(e)})),s.bind(s.skeleton,s.bindMatrix)})),s}function tl(e,t,i){i(e,t);for(let s=0;s<e.children.length;s++)tl(e.children[s],t.children[s],i)}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const il=Symbol("prepared"),sl=Symbol("prepare"),nl=Symbol("preparedGLTF"),al=Symbol("clone");class rl{static prepare(e){if(null==e.scene)throw new Error("Model does not have a scene");if(e[il])return e;const t=this[sl](e);return t[il]=!0,t}static[sl](e){const{scene:t}=e,i=[t];return Object.assign(Object.assign({},e),{scene:t,scenes:i})}get parser(){return this[nl].parser}get animations(){return this[nl].animations}get scene(){return this[nl].scene}get scenes(){return this[nl].scenes}get cameras(){return this[nl].cameras}get asset(){return this[nl].asset}get userData(){return this[nl].userData}constructor(e){this[nl]=e}clone(){return new(0,this.constructor)(this[al]())}dispose(){this.scenes.forEach((e=>{e.traverse((e=>{const t=e;if(!t.material)return;(Array.isArray(t.material)?t.material:[t.material]).forEach((e=>{for(const t in e){const i=e[t];if(i instanceof he){const e=i.source.data;null!=e.close&&e.close(),i.dispose()}}e.dispose()})),t.geometry.dispose()}))}))}[al](){const e=this[nl],t=el(this.scene);ol(t,this.scene);const i=[t],s=e.userData?Object.assign({},e.userData):{};return Object.assign(Object.assign({},e),{scene:t,scenes:i,userData:s})}}const ol=(e,t)=>{Al(e,t,((e,t)=>{void 0!==t.userData.variantMaterials&&(e.userData.variantMaterials=new Map(t.userData.variantMaterials)),void 0!==t.userData.variantData&&(e.userData.variantData=t.userData.variantData),void 0!==t.userData.originalMaterial&&(e.userData.originalMaterial=t.userData.originalMaterial)}))},Al=(e,t,i)=>{i(e,t);for(let s=0;s<e.children.length;s++)Al(e.children[s],t.children[s],i)},ll=Symbol("threeGLTF"),cl=Symbol("gltf"),hl=Symbol("gltfElementMap"),ul=Symbol("threeObjectMap"),dl=Symbol("parallelTraverseThreeScene"),pl=Symbol("correlateOriginalThreeGLTF"),gl=Symbol("correlateCloneThreeGLTF");class ml{static from(e,t){return null!=t?this[gl](e,t):this[pl](e)}static[pl](e){const t=e.parser.json,i=e.parser.associations,s=new Map,n={name:"Default"},a={index:-1};for(const e of i.keys())e instanceof z&&null==i.get(e)&&(a.index<0&&(null==t.materials&&(t.materials=[]),a.index=t.materials.length,t.materials.push(n)),e.name=n.name,i.set(e,{materials:a.index}));for(const[e,n]of i){n&&(e.userData=e.userData||{},e.userData.associations=n);for(const i in n)if(null!=i&&"primitives"!==i){const a=i,r=(t[a]||[])[n[a]];if(null==r)continue;let o=s.get(r);null==o&&(o=new Set,s.set(r,o)),o.add(e)}}return new ml(e,t,i,s)}static[gl](e,t){const i=t.threeGLTF,s=t.gltf,n=JSON.parse(JSON.stringify(s)),a=new Map,r=new Map;for(let s=0;s<i.scenes.length;s++)this[dl](i.scenes[s],e.scenes[s],((e,i)=>{const s=t.threeObjectMap.get(e);if(null!=s)for(const e in s)if(null!=e&&"primitives"!==e){const t=e,o=s[t],A=n[t][o],l=a.get(i)||{};l[t]=o,a.set(i,l);const c=r.get(A)||new Set;c.add(i),r.set(A,c)}}));return new ml(e,n,a,r)}static[dl](e,t,i){const s=(e,t)=>{if(i(e,t),e.isObject3D){const n=e,a=t;if(n.material)if(Array.isArray(n.material))for(let e=0;e<n.material.length;++e)i(n.material[e],a.material[e]);else i(n.material,a.material);for(let i=0;i<e.children.length;++i)s(e.children[i],t.children[i])}};s(e,t)}get threeGLTF(){return this[ll]}get gltf(){return this[cl]}get gltfElementMap(){return this[hl]}get threeObjectMap(){return this[ul]}constructor(e,t,i,s){this[ll]=e,this[cl]=t,this[hl]=s,this[ul]=i}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fl=Symbol("correlatedSceneGraph");class bl extends rl{static[sl](e){const t=super[sl](e);null==t[fl]&&(t[fl]=ml.from(t));const{scene:i}=t,s=new be(void 0,1/0);return i.traverse((e=>{e.renderOrder=1e3,e.frustumCulled=!1,e.name||(e.name=e.uuid);const i=e;if(i.material){const{geometry:e}=i;i.castShadow=!0,i.isSkinnedMesh&&(e.boundingSphere=s,e.boundingBox=null);const n=i.material;if(!0===n.isMeshBasicMaterial&&(n.toneMapped=!1),n.shadowSide=ge,n.aoMap){const{gltf:i,threeObjectMap:s}=t[fl],a=s.get(n);if(null!=i.materials&&null!=a&&null!=a.materials){const t=i.materials[a.materials];t.occlusionTexture&&0===t.occlusionTexture.texCoord&&null!=e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv)}}}})),t}get correlatedSceneGraph(){return this[nl][fl]}[al](){const e=super[al](),t=new Map;return e.scene.traverse((e=>{const i=e;if(i.material){const e=i.material;if(null!=e){if(t.has(e.uuid))return void(i.material=t.get(e.uuid));i.material=e.clone(),t.set(e.uuid,i.material)}}const s=e;void 0!==s.target&&s.add(s.target)})),e[fl]=ml.from(e,this.correlatedSceneGraph),e}}const Il=(e,t,i)=>{let s;switch(e){case Qe:s=new Uint8ClampedArray(t*i*4);break;case Me:s=new Uint16Array(t*i*4);break;case ot:s=new Uint32Array(t*i*4);break;case rt:s=new Int8Array(t*i*4);break;case at:s=new Int16Array(t*i*4);break;case nt:s=new Int32Array(t*i*4);break;case Te:s=new Float32Array(t*i*4);break;default:throw new Error("Unsupported data type")}return s};let yl;class Cl{constructor(e){var t,i,s,n,a,r,o,A,l,c,h,u,d,p,g,m;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const f={format:Se,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:void 0!==(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)?null===(i=e.renderTargetOptions)||void 0===i?void 0:i.anisotropy:1,generateMipmaps:void 0!==(null===(s=e.renderTargetOptions)||void 0===s?void 0:s.generateMipmaps)&&(null===(n=e.renderTargetOptions)||void 0===n?void 0:n.generateMipmaps),magFilter:void 0!==(null===(a=e.renderTargetOptions)||void 0===a?void 0:a.magFilter)?null===(r=e.renderTargetOptions)||void 0===r?void 0:r.magFilter:O,minFilter:void 0!==(null===(o=e.renderTargetOptions)||void 0===o?void 0:o.minFilter)?null===(A=e.renderTargetOptions)||void 0===A?void 0:A.minFilter:O,samples:void 0!==(null===(l=e.renderTargetOptions)||void 0===l?void 0:l.samples)?null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples:void 0,wrapS:void 0!==(null===(h=e.renderTargetOptions)||void 0===h?void 0:h.wrapS)?null===(u=e.renderTargetOptions)||void 0===u?void 0:u.wrapS:j,wrapT:void 0!==(null===(d=e.renderTargetOptions)||void 0===d?void 0:d.wrapT)?null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapT:j};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=Cl.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new qe,this._camera=new ae,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,i,s)=>{if(void 0!==yl)return yl;const n=new et(1,1,s);t.setRenderTarget(n);const a=new X(new Ye,new J({color:16777215}));t.render(a,i),t.setRenderTarget(null);const r=Il(e,n.width,n.height);return t.readRenderTargetPixels(n,0,0,n.width,n.height,r),n.dispose(),a.geometry.dispose(),a.material.dispose(),yl=0!==r[0],yl})(this._type,this._renderer,this._camera,f)){let e;if(this._type===Me)e=this._renderer.extensions.has("EXT_color_buffer_float")?Te:void 0;void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Te}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new X(new Ye,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new et(this.width,this.height,f),this._renderTarget.texture.mapping=void 0!==(null===(g=e.renderTargetOptions)||void 0===g?void 0:g.mapping)?null===(m=e.renderTargetOptions)||void 0===m?void 0:m.mapping:tt}static instantiateRenderer(){const e=new it;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Il(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new De(this.toArray(),this.width,this.height,Se,this._type,(null==e?void 0:e.mapping)||tt,(null==e?void 0:e.wrapS)||j,(null==e?void 0:e.wrapT)||j,(null==e?void 0:e.magFilter)||O,(null==e?void 0:e.minFilter)||O,(null==e?void 0:e.anisotropy)||1,c);return t.generateMipmaps=void 0!==(null==e?void 0:e.generateMipmaps)&&(null==e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof st&&Object.values(this.material.uniforms).forEach((e=>{e.value instanceof he&&e.value.dispose()})),Object.values(this.material).forEach((e=>{e instanceof he&&e.dispose()})),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class El extends st{constructor({gamma:e,offsetHdr:t,offsetSdr:i,gainMapMin:s,gainMapMax:n,maxDisplayBoost:a,hdrCapacityMin:r,hdrCapacityMax:o,sdr:A,gainMap:l}){super({name:"GainMapDecoderMaterial",vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n// min half float value\n#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )\n// max half float value\n#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )\n\nuniform sampler2D sdr;\nuniform sampler2D gainMap;\nuniform vec3 gamma;\nuniform vec3 offsetHdr;\nuniform vec3 offsetSdr;\nuniform vec3 gainMapMin;\nuniform vec3 gainMapMax;\nuniform float weightFactor;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 rgb = texture2D( sdr, vUv ).rgb;\n  vec3 recovery = texture2D( gainMap, vUv ).rgb;\n  vec3 logRecovery = pow( recovery, gamma );\n  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;\n  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;\n  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));\n  gl_FragColor = vec4( clampedHdrColor , 1.0 );\n}\n",uniforms:{sdr:{value:A},gainMap:{value:l},gamma:{value:new v(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:(new v).fromArray(t)},offsetSdr:{value:(new v).fromArray(i)},gainMapMin:{value:(new v).fromArray(s)},gainMapMax:{value:(new v).fromArray(n)},weightFactor:{value:(Math.log2(a)-r)/(o-r)}},blending:ct,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=r,this._hdrCapacityMax=o,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class wl extends Error{}class Bl extends Error{}const vl=(e,t,i)=>{const s=new RegExp(`${t}="([^"]*)"`,"i").exec(e);if(s)return s[1];const n=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(n){const e=n[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map((e=>e.replace(/<\/?rdf:li>/g,""))):n[1].trim()}if(void 0!==i)return i;throw new Error(`Can't find ${t} in gainmap metadata`)};class xl{constructor(e){this.options={debug:!(!e||void 0===e.debug)&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise(((t,i)=>{const s=this.options.debug,n=new DataView(e.buffer);if(65496!==n.getUint16(0))return void i(new Error("Not a valid jpeg"));const a=n.byteLength;let r,o=2,A=0;for(;o<a;){if(++A>250)return void i(new Error(`Found no marker after ${A} loops 😵`));if(255!==n.getUint8(o))return void i(new Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${n.getUint8(o).toString(16)}`));if(r=n.getUint8(o+1),s&&console.log(`Marker: ${r.toString(16)}`),226===r){s&&console.log("Found APP2 marker (0xffe2)");const e=o+4;if(1297106432===n.getUint32(e)){const s=e+4;let a;if(18761===n.getUint16(s))a=!1;else{if(19789!==n.getUint16(s))return void i(new Error("No valid endianness marker found in TIFF header"));a=!0}if(42!==n.getUint16(s+2,!a))return void i(new Error("Not valid TIFF data! (no 0x002A marker)"));const r=n.getUint32(s+4,!a);if(r<8)return void i(new Error("Not valid TIFF data! (First offset less than 8)"));const o=s+r,A=n.getUint16(o,!a),l=o+2;let c=0;for(let e=l;e<l+12*A;e+=12)45057===n.getUint16(e,!a)&&(c=n.getUint32(e+8,!a));const h=o+2+12*A+4,u=[];for(let e=h;e<h+16*c;e+=16){const t={MPType:n.getUint32(e,!a),size:n.getUint32(e+4,!a),dataOffset:n.getUint32(e+8,!a),dependantImages:n.getUint32(e+12,!a),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=s+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,u.push(t)}if(this.options.extractNonFII&&u.length){const e=new Blob([n]),i=[];for(const t of u){if(t.isFII&&!this.options.extractFII)continue;const s=e.slice(t.start,t.end+1,"image/jpeg");i.push(s)}t(i)}}}o+=2+n.getUint16(o+2)}}))}}const Sl=async e=>{const t=(e=>{let t;t="undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):e.toString();let i=t.indexOf("<x:xmpmeta");for(;-1!==i;){const e=t.indexOf("x:xmpmeta>",i),s=t.slice(i,e+10);try{const e=vl(s,"hdrgm:GainMapMin","0"),t=vl(s,"hdrgm:GainMapMax"),i=vl(s,"hdrgm:Gamma","1"),n=vl(s,"hdrgm:OffsetSDR","0.015625"),a=vl(s,"hdrgm:OffsetHDR","0.015625"),r=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(s),o=r?r[1]:"0",A=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(s);if(!A)throw new Error("Incomplete gainmap metadata");const l=A[1];return{gainMapMin:Array.isArray(e)?e.map((e=>parseFloat(e))):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map((e=>parseFloat(e))):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(i)?i.map((e=>parseFloat(e))):[parseFloat(i),parseFloat(i),parseFloat(i)],offsetSdr:Array.isArray(n)?n.map((e=>parseFloat(e))):[parseFloat(n),parseFloat(n),parseFloat(n)],offsetHdr:Array.isArray(a)?a.map((e=>parseFloat(e))):[parseFloat(a),parseFloat(a),parseFloat(a)],hdrCapacityMin:parseFloat(o),hdrCapacityMax:parseFloat(l)}}catch(e){}i=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new Bl("Gain map XMP metadata not found");const i=new xl({extractFII:!0,extractNonFII:!0}),s=await i.extract(e);if(2!==s.length)throw new wl("Gain map recovery image not found");return{sdr:new Uint8Array(await s[0].arrayBuffer()),gainMap:new Uint8Array(await s[1].arrayBuffer()),metadata:t}},Ql=e=>new Promise(((t,i)=>{const s=document.createElement("img");s.onload=()=>{t(s)},s.onerror=e=>{i(e)},s.src=URL.createObjectURL(e)}));class Ml extends o{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new At}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new El({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new he,sdr:new he});return new Cl({width:16,height:16,type:Me,colorSpace:c,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,i,s){const n=s?new Blob([s],{type:"image/jpeg"}):void 0,a=new Blob([i],{type:"image/jpeg"});let r,o,A=!1;if("undefined"==typeof createImageBitmap){const e=await Promise.all([n?Ql(n):Promise.resolve(void 0),Ql(a)]);o=e[0],r=e[1],A=!0}else{const e=await Promise.all([n?createImageBitmap(n,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(a,{imageOrientation:"flipY"})]);o=e[0],r=e[1]}const h=new he(o||new ImageData(2,2),tt,j,j,O,lt,Se,Qe,1,c);h.flipY=A,h.needsUpdate=!0;const u=new he(r,tt,j,j,O,lt,Se,Qe,1,l);u.flipY=A,u.needsUpdate=!0,e.width=r.width,e.height=r.height,e.material.gainMap=h,e.material.sdr=u,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class Tl extends Ml{load(e,t,i,s){const n=this.prepareQuadRenderer(),a=new A(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,(async i=>{if("string"==typeof i)throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const a=new Uint8Array(i);let r,o,A;try{const e=await Sl(a);r=e.sdr,o=e.gainMap,A=e.metadata}catch(t){if(!(t instanceof Bl||t instanceof wl))throw t;console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),A={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},r=a}try{await this.render(n,A,r,o)}catch(t){return this.manager.itemError(e),"function"==typeof s&&s(t),void n.disposeOnDemandRenderer()}"function"==typeof t&&t(n),this.manager.itemEnd(e),n.disposeOnDemandRenderer()}),i,(t=>{this.manager.itemError(e),"function"==typeof s&&s(t)})),n}}class Dl extends ht{constructor(e){super(e),this.type=Me}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},i=function(e,t,i){t=t||1024;let s=e.pos,n=-1,a=0,r="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));for(;0>(n=o.indexOf("\n"))&&a<t&&s<e.byteLength;)r+=o,a+=o.length,s+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));return-1<n&&(e.pos+=a+n+1,r+o.slice(0,n))},s=function(e,t,i,s){const n=e[t+3],a=Math.pow(2,n-128)/255;i[s+0]=e[t+0]*a,i[s+1]=e[t+1]*a,i[s+2]=e[t+2]*a,i[s+3]=1},n=function(e,t,i,s){const n=e[t+3],a=Math.pow(2,n-128)/255;i[s+0]=ut.toHalfFloat(Math.min(e[t+0]*a,65504)),i[s+1]=ut.toHalfFloat(Math.min(e[t+1]*a,65504)),i[s+2]=ut.toHalfFloat(Math.min(e[t+2]*a,65504)),i[s+3]=ut.toHalfFloat(1)},a=new Uint8Array(e);a.pos=0;const r=function(e){const s=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,r=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let A,l;for((e.pos>=e.byteLength||!(A=i(e)))&&t(1,"no header found"),(l=A.match(/^#\?(\S+)/))||t(3,"bad initial token"),o.valid|=1,o.programtype=l[1],o.string+=A+"\n";A=i(e),!1!==A;)if(o.string+=A+"\n","#"!==A.charAt(0)){if((l=A.match(s))&&(o.gamma=parseFloat(l[1])),(l=A.match(n))&&(o.exposure=parseFloat(l[1])),(l=A.match(a))&&(o.valid|=2,o.format=l[1]),(l=A.match(r))&&(o.valid|=4,o.height=parseInt(l[1],10),o.width=parseInt(l[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=A+"\n";return 2&o.valid||t(3,"missing format specifier"),4&o.valid||t(3,"missing image size specifier"),o}(a),o=r.width,A=r.height,l=function(e,i,s){const n=i;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);n!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const a=new Uint8Array(4*i*s);a.length||t(4,"unable to allocate buffer space");let r=0,o=0;const A=4*n,l=new Uint8Array(4),c=new Uint8Array(A);let h=s;for(;h>0&&o<e.byteLength;){o+4>e.byteLength&&t(1),l[0]=e[o++],l[1]=e[o++],l[2]=e[o++],l[3]=e[o++],2==l[0]&&2==l[1]&&(l[2]<<8|l[3])==n||t(3,"bad rgbe scanline format");let i,s=0;for(;s<A&&o<e.byteLength;){i=e[o++];const n=i>128;if(n&&(i-=128),(0===i||s+i>A)&&t(3,"bad scanline data"),n){const t=e[o++];for(let e=0;e<i;e++)c[s++]=t}else c.set(e.subarray(o,o+i),s),s+=i,o+=i}const u=n;for(let e=0;e<u;e++){let t=0;a[r]=c[e+t],t+=n,a[r+1]=c[e+t],t+=n,a[r+2]=c[e+t],t+=n,a[r+3]=c[e+t],r+=4}h--}return a}(a.subarray(a.pos),o,A);let c,h,u;switch(this.type){case Te:u=l.length/4;const e=new Float32Array(4*u);for(let t=0;t<u;t++)s(l,4*t,e,4*t);c=e,h=Te;break;case Me:u=l.length/4;const t=new Uint16Array(4*u);for(let e=0;e<u;e++)n(l,4*e,t,4*e);c=t,h=Me;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:o,height:A,data:c,header:r.string,gamma:r.gamma,exposure:r.exposure,type:h}}setDataType(e){return this.type=e,this}load(e,t,i,s){return super.load(e,(function(e,i){switch(e.type){case Te:case Me:e.colorSpace=c,e.minFilter=O,e.magFilter=O,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,i)}),i,s)}}
/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rl={topLight:{intensity:500,position:[.418,16.199,.3]},room:{position:[-.757,13.219,.717],scale:[31.713,28.305,28.591]},boxes:[{position:[-10.906,2.009,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,.857,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:50,position:[-16.116,14.37,8.208],scale:[.1,2.428,2.739]},{intensity:50,position:[-16.109,18.021,-8.207],scale:[.1,2.425,2.751]},{intensity:17,position:[14.904,12.198,-1.832],scale:[.15,4.265,6.331]},{intensity:43,position:[-.462,8.89,14.52],scale:[4.38,5.441,.088]},{intensity:20,position:[3.235,11.486,-12.541],scale:[2.5,2,.1]},{intensity:100,position:[0,20,0],scale:[1,.1,1]}]},kl={topLight:{intensity:400,position:[.5,14,.5]},room:{position:[0,13.2,0],scale:[31.5,28.5,31.5]},boxes:[{position:[-10.906,-1,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,-.16,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:80,position:[-14,10,8],scale:[.1,2.5,2.5]},{intensity:80,position:[-14,14,-4],scale:[.1,2.5,2.5]},{intensity:23,position:[14,12,0],scale:[.1,5,5]},{intensity:16,position:[0,9,14],scale:[5,5,.1]},{intensity:80,position:[7,8,-14],scale:[2.5,2.5,.1]},{intensity:80,position:[-7,16,-14],scale:[2.5,2.5,.1]},{intensity:1,position:[0,20,0],scale:[.1,.1,.1]}]};class Fl extends qe{constructor(e){super(),this.position.y=-3.5;const t=new We;t.deleteAttribute("uv");const i=new V({metalness:0,side:dt}),s=new V({metalness:0}),n="legacy"==e?Rl:kl,a=new E(16777215,n.topLight.intensity,28,2);a.position.set(...n.topLight.position),this.add(a);const r=new X(t,i);r.position.set(...n.room.position),r.scale.set(...n.room.scale),this.add(r);for(const e of n.boxes){const i=new X(t,s);i.position.set(...e.position),i.rotation.set(0,e.rotation,0),i.scale.set(...e.scale),this.add(i)}for(const e of n.lights){const i=new X(t,this.createAreaLightMaterial(e.intensity));i.position.set(...e.position),i.scale.set(...e.scale),this.add(i)}}createAreaLightMaterial(e){const t=new J;return t.color.setScalar(e),t}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ll=20,_l=/\.hdr(\.js)?$/;class Pl{constructor(e){this.threeRenderer=e,this.lottieLoaderUrl="",this._ldrLoader=null,this._imageLoader=null,this._hdrLoader=null,this._lottieLoader=null,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}ldrLoader(e){return null==this._ldrLoader&&(this._ldrLoader=new T),this._ldrLoader.setWithCredentials(e),this._ldrLoader}imageLoader(e){return null==this._imageLoader&&(this._imageLoader=new Tl(this.threeRenderer)),this._imageLoader.setWithCredentials(e),this._imageLoader}hdrLoader(e){return null==this._hdrLoader&&(this._hdrLoader=new Dl,this._hdrLoader.setDataType(Me)),this._hdrLoader.setWithCredentials(e),this._hdrLoader}async getLottieLoader(e){if(null==this._lottieLoader){const{LottieLoader:e}=await import(this.lottieLoaderUrl);this._lottieLoader=new e}return this._lottieLoader.setWithCredentials(e),this._lottieLoader}async loadImage(e,t){const i=await new Promise(((i,s)=>this.ldrLoader(t).load(e,i,(()=>{}),s)));return i.name=e,i.flipY=!1,i}async loadLottie(e,t,i){const s=await this.getLottieLoader(i);s.setQuality(t);const n=await new Promise(((t,i)=>s.load(e,t,(()=>{}),i)));return n.name=e,n}async loadEquirect(e,t=!1,i=()=>{}){try{const s=_l.test(e),n=s?this.hdrLoader(t):this.imageLoader(t),a=await new Promise(((t,s)=>n.load(e,(e=>{const{renderTarget:i}=e;if(null!=i){const{texture:s}=i;e.dispose(!1),t(s)}else t(e)}),(e=>{i(e.loaded/e.total*.9)}),s)));return i(1),a.name=e,a.mapping=pt,s||(a.colorSpace=l),a}finally{i&&i(1)}}async generateEnvironmentMapAndSkybox(e=null,t=null,i=()=>{},s=!1){const n="legacy"!==t;"legacy"!==t&&"neutral"!==t||(t=null),t=ts(t);let a,r=Promise.resolve(null);e&&(r=this.loadEquirectFromUrl(e,s,i)),a=t?this.loadEquirectFromUrl(t,s,i):e?this.loadEquirectFromUrl(e,s,i):n?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();const[o,A]=await Promise.all([a,r]);if(null==o)throw new Error("Failed to load environment map.");return{environmentMap:o,skybox:A}}async loadEquirectFromUrl(e,t,i){if(!this.skyboxCache.has(e)){const s=this.loadEquirect(e,t,i);this.skyboxCache.set(e,s)}return this.skyboxCache.get(e)}async GenerateEnvironmentMap(e,t){await((e=0)=>new Promise((t=>setTimeout(t,e))))();const i=this.threeRenderer,s=new Ke(256,{generateMipmaps:!1,type:Me,format:Se,colorSpace:c,depthBuffer:!0}),n=new gt(.1,100,s),r=n.renderTarget.texture;r.name=t;const o=i.outputColorSpace,A=i.toneMapping;return i.toneMapping=a,i.outputColorSpace=c,n.update(i,e),this.blurCubemap(s,.04),i.toneMapping=A,i.outputColorSpace=o,r}async loadGeneratedEnvironmentMap(){return null==this.generatedEnvironmentMap&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new Fl("legacy"),"legacy")),this.generatedEnvironmentMap}async loadGeneratedEnvironmentMapAlt(){return null==this.generatedEnvironmentMapAlt&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new Fl("neutral"),"neutral")),this.generatedEnvironmentMapAlt}blurCubemap(e,t){if(null==this.blurMaterial){this.blurMaterial=this.getBlurShader(Ll);const e=new We,t=new X(e,this.blurMaterial);this.blurScene=new qe,this.blurScene.add(t)}const i=e.clone();this.halfblur(e,i,t,"latitudinal"),this.halfblur(i,e,t,"longitudinal")}halfblur(e,t,i,s){const n=e.width,a=isFinite(i)?Math.PI/(2*n):2*Math.PI/39,r=i/a,o=isFinite(i)?1+Math.floor(3*r):Ll;o>Ll&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${o} samples when the maximum is set to 20`);const A=[];let l=0;for(let e=0;e<Ll;++e){const t=e/r,i=Math.exp(-t*t/2);A.push(i),0==e?l+=i:e<o&&(l+=2*i)}for(let e=0;e<A.length;e++)A[e]=A[e]/l;const c=this.blurMaterial.uniforms;c.envMap.value=e.texture,c.samples.value=o,c.weights.value=A,c.latitudinal.value="latitudinal"===s,c.dTheta.value=a;new gt(.1,100,t).update(this.threeRenderer,this.blurScene)}getBlurShader(e){const t=new Float32Array(e),i=new v(0,1,0);return new st({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:i}},vertexShader:"\n      \n      varying vec3 vOutputDirection;\n  \n      void main() {\n  \n        vOutputDirection = vec3( position );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  \n      }\n    ",fragmentShader:"\n        varying vec3 vOutputDirection;\n  \n        uniform samplerCube envMap;\n        uniform int samples;\n        uniform float weights[ n ];\n        uniform bool latitudinal;\n        uniform float dTheta;\n        uniform vec3 poleAxis;\n  \n        vec3 getSample( float theta, vec3 axis ) {\n  \n          float cosTheta = cos( theta );\n          // Rodrigues' axis-angle rotation\n          vec3 sampleDirection = vOutputDirection * cosTheta\n            + cross( axis, vOutputDirection ) * sin( theta )\n            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n  \n          return vec3( textureCube( envMap, sampleDirection ) );\n  \n        }\n  \n        void main() {\n  \n          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n  \n          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n  \n            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n  \n          }\n  \n          axis = normalize( axis );\n  \n          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n  \n          for ( int i = 1; i < n; i++ ) {\n  \n            if ( i >= samples ) {\n  \n              break;\n  \n            }\n  \n            float theta = dTheta * float( i );\n            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n  \n          }\n        }\n      ",blending:ct,depthTest:!1,depthWrite:!1,side:dt})}async dispose(){for(const[,e]of this.skyboxCache){(await e).dispose()}null!=this.generatedEnvironmentMap&&((await this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),null!=this.generatedEnvironmentMapAlt&&((await this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),null!=this.blurMaterial&&this.blurMaterial.dispose()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ol=[1,.79,.62,.5,.4,.31,.25],Ul="high-performance";class Gl extends je{static get singleton(){return this._singleton||(this._singleton=new Gl({powerPreference:(self.ModelViewerElement||{}).powerPreference||Ul,debug:os()})),this._singleton}static resetSingleton(){const e=this._singleton.dispose();for(const t of e)t.disconnectedCallback();this._singleton=new Gl({powerPreference:(self.ModelViewerElement||{}).powerPreference||Ul,debug:os()});for(const t of e)t.connectedCallback()}get canRender(){return null!=this.threeRenderer}get scaleFactor(){return Ol[this.scaleStep]}set minScale(e){let t=1;for(;t<Ol.length&&!(Ol[t]<e);)++t;this.lastStep=t-1}constructor(e){super(),this.loader=new Ca(bl),this.width=0,this.height=0,this.dpr=1,this.scenes=new Set,this.multipleScenesVisible=!1,this.lastTick=performance.now(),this.renderedLastFrame=!1,this.scaleStep=0,this.lastStep=3,this.avgFrameDuration=50,this.onWebGLContextLost=e=>{this.dispatchEvent({type:"contextlost",sourceEvent:e})},this.onWebGLContextRestored=()=>{var e;null===(e=this.textureUtils)||void 0===e||e.dispose(),this.textureUtils=new Pl(this.threeRenderer);for(const e of this.scenes)e.element[hs]()},this.dpr=window.devicePixelRatio,this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas",this.canvas3D.classList.add("show");try{this.threeRenderer=new it({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:e.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.setPixelRatio(1),this.threeRenderer.debug={checkShaderErrors:!!e.debug,onShaderError:null},this.threeRenderer.toneMapping=r}catch(e){console.warn(e)}this.arRenderer=new ZA(this),this.textureUtils=this.canRender?new Pl(this.threeRenderer):null,Ca.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize()}registerScene(e){this.scenes.add(e),e.forceRescale();const t=new y;this.threeRenderer.getSize(t),e.canvas.width=t.x,e.canvas.height=t.y,this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop(((e,t)=>this.render(e,t)))}unregisterScene(e){this.scenes.delete(e),this.canvas3D.parentElement===e.canvas.parentElement&&e.canvas.parentElement.removeChild(this.canvas3D),this.canRender&&0===this.scenes.size&&this.threeRenderer.setAnimationLoop(null)}displayCanvas(e){return e.element.modelIsVisible&&!this.multipleScenesVisible?this.canvas3D:e.element[Tu]}countVisibleScenes(){const{canvas3D:e}=this;let t=0,i=null;for(const s of this.scenes){const{element:n}=s;n.modelIsVisible&&null==s.externalRenderer&&++t,e.parentElement===s.canvas.parentElement&&(i=s)}const s=t>1;if(null!=i){const t=s&&!this.multipleScenesVisible,n=!i.element.modelIsVisible;if(t||n){const{width:t,height:s}=this.sceneSize(i);this.copyPixels(i,t,s),e.parentElement.removeChild(e)}}this.multipleScenesVisible=s}updateRendererSize(){var e;const t=window.devicePixelRatio;if(t!==this.dpr)for(const e of this.scenes){const{element:t}=e;t[fu](t.getBoundingClientRect())}let i=0,s=0;for(const e of this.scenes)i=Math.max(i,e.width),s=Math.max(s,e.height);if(i!==this.width||s!==this.height||t!==this.dpr){this.width=i,this.height=s,this.dpr=t,i=Math.ceil(i*t),s=Math.ceil(s*t),this.canRender&&this.threeRenderer.setSize(i,s,!1);for(const t of this.scenes){const{canvas:n}=t;n.width=i,n.height=s,t.forceRescale(),null===(e=t.effectRenderer)||void 0===e||e.setSize(i,s)}}}updateRendererScale(e){const t=this.scaleStep;this.avgFrameDuration+=rs(.2*(e-this.avgFrameDuration),-5,5),this.avgFrameDuration>60?++this.scaleStep:this.avgFrameDuration<40&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),t!==this.scaleStep&&(this.avgFrameDuration=50)}shouldRender(e){if(e.shouldRender())e.scaleStep!=this.scaleStep&&(e.scaleStep=this.scaleStep,this.rescaleCanvas(e));else{if(0==e.scaleStep)return!1;e.scaleStep=0,this.rescaleCanvas(e)}return!0}rescaleCanvas(e){const t=Ol[e.scaleStep],i=Math.ceil(this.width/t),s=Math.ceil(this.height/t),{style:n}=e.canvas;n.width=`${i}px`,n.height=`${s}px`,this.canvas3D.style.width=`${i}px`,this.canvas3D.style.height=`${s}px`;const a=this.dpr*t,r=t<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";e.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:a,minimumDpr:this.dpr*Ol[this.lastStep],pixelWidth:Math.ceil(e.width*a),pixelHeight:Math.ceil(e.height*a),reason:r}}))}sceneSize(e){const{dpr:t}=this,i=Ol[e.scaleStep];return{width:Math.min(Math.ceil(e.width*i*t),this.canvas3D.width),height:Math.min(Math.ceil(e.height*i*t),this.canvas3D.height)}}copyPixels(e,t,i){const s=e.context;null!=s?(s.clearRect(0,0,t,i),s.drawImage(this.canvas3D,0,0,t,i,0,0,t,i),e.canvas.classList.add("show")):console.log("could not acquire 2d context")}orderedScenes(){const e=[];for(const t of[!1,!0])for(const i of this.scenes)i.element.modelIsVisible===t&&e.push(i);return e}get isPresenting(){return this.arRenderer.isPresenting}preRender(e,t,i){const{element:s,exposure:n,toneMapping:a}=e;s[ku](t,i);const o="number"==typeof n&&!Number.isNaN(n),A=s.environmentImage,l=s.skyboxImage,c=a===r&&("neutral"===A||"legacy"===A||!A&&!l);this.threeRenderer.toneMappingExposure=(o?n:1)*(c?1.3:1)}render(e,t){if(null!=t)return void this.arRenderer.onWebXRFrame(e,t);const i=e-this.lastTick;if(this.lastTick=e,!this.canRender||this.isPresenting)return;this.countVisibleScenes(),this.updateRendererSize(),this.renderedLastFrame&&(this.updateRendererScale(i),this.renderedLastFrame=!1);const{canvas3D:s}=this;for(const t of this.orderedScenes()){const{element:n}=t;if(!n.loaded||!n.modelIsVisible&&t.renderCount>0)continue;if(this.preRender(t,e,i),!this.shouldRender(t))continue;if(null!=t.externalRenderer){const e=t.getCamera();e.updateMatrix();const{matrix:i,projectionMatrix:s}=e,n=i.elements.slice(),a=t.getTarget();n[12]+=a.x,n[13]+=a.y,n[14]+=a.z,t.externalRenderer.render({viewMatrix:n,projectionMatrix:s.elements});continue}if(!n.modelIsVisible&&!this.multipleScenesVisible)for(const e of this.scenes)e.element.modelIsVisible&&e.queueRender();const{width:a,height:r}=this.sceneSize(t);t.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.ceil(this.height*this.dpr)-r,a,r),null!=t.effectRenderer?t.effectRenderer.render(i):(this.threeRenderer.autoClear=!0,this.threeRenderer.toneMapping=t.toneMapping,this.threeRenderer.render(t,t.camera)),this.multipleScenesVisible||!t.element.modelIsVisible&&0===t.renderCount?this.copyPixels(t,a,r):s.parentElement!==t.canvas.parentElement&&(t.canvas.parentElement.appendChild(s),t.canvas.classList.remove("show")),t.hasRendered(),++t.renderCount,this.renderedLastFrame=!0}}dispose(){null!=this.textureUtils&&this.textureUtils.dispose(),null!=this.threeRenderer&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const e=[];for(const t of this.scenes)e.push(t.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),e}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nl=Symbol("correlatedObjects"),jl=Symbol("onUpdate");class Hl{constructor(e,t){this[jl]=e,this[Nl]=t}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zl=new J,ql=new Ye(2,2);let Vl=0;const Kl=Symbol("threeTexture"),Jl=Symbol("threeTextures");let Yl=class extends Hl{get[Kl](){var e;return null===(e=this[Nl])||void 0===e?void 0:e.values().next().value}get[Jl](){return this[Nl]}constructor(e,t){super(e,new Set(t?[t]:[])),this[Kl].image.src||(this[Kl].image.src=t.name?t.name:"adhoc_image"+Vl++),this[Kl].image.name||(this[Kl].image.name=t&&t.image&&t.image.src?t.image.src.split("/").pop():"adhoc_image")}get name(){return this[Kl].image.name||""}get uri(){return this[Kl].image.src}get bufferView(){return this[Kl].image.bufferView}get element(){const e=this[Kl];if(e&&(e.isCanvasTexture||e.isVideoTexture))return e.image}get animation(){const e=this[Kl];if(e&&e.isCanvasTexture&&e.animation)return e.animation}get type(){return null!=this.uri?"external":"embedded"}set name(e){for(const t of this[Jl])t.image.name=e}update(){const e=this[Kl];e&&e.isCanvasTexture&&!e.animation&&(this[Kl].needsUpdate=!0,this[jl]())}async createThumbnail(e,t){const i=new qe;zl.map=this[Kl];const s=new X(ql,zl);i.add(s);const n=new ae(-1,1,1,-1,0,1),{threeRenderer:a}=Gl.singleton,r=new et(e,t);a.setRenderTarget(r),a.render(i,n),a.setRenderTarget(null);const o=new Uint8Array(e*t*4);a.readRenderTargetPixels(r,0,0,e,t,o),ou.width=e,ou.height=t;const A=ou.getContext("2d"),l=A.createImageData(e,t);return l.data.set(o),A.putImageData(l,0,0),new Promise((async(e,t)=>{ou.toBlob((i=>{if(!i)return t("Failed to capture thumbnail.");e(URL.createObjectURL(i))}),"image/png")}))}};var Wl,Xl;!function(e){e[e.Nearest=9728]="Nearest",e[e.Linear=9729]="Linear",e[e.NearestMipmapNearest=9984]="NearestMipmapNearest",e[e.LinearMipmapNearest=9985]="LinearMipmapNearest",e[e.NearestMipmapLinear=9986]="NearestMipmapLinear",e[e.LinearMipmapLinear=9987]="LinearMipmapLinear"}(Wl||(Wl={})),function(e){e[e.ClampToEdge=33071]="ClampToEdge",e[e.MirroredRepeat=33648]="MirroredRepeat",e[e.Repeat=10497]="Repeat"}(Xl||(Xl={}));
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const $l=new Map([[Xl.Repeat,G],[Xl.ClampToEdge,j],[Xl.MirroredRepeat,N]]),Zl=new Map([[G,Xl.Repeat],[j,Xl.ClampToEdge],[N,Xl.MirroredRepeat]]),ec=new Map([[Wl.Nearest,U],[Wl.Linear,O],[Wl.NearestMipmapNearest,P],[Wl.LinearMipmapNearest,_],[Wl.NearestMipmapLinear,L],[Wl.LinearMipmapLinear,F]]),tc=new Map([[U,Wl.Nearest],[O,Wl.Linear],[P,Wl.NearestMipmapNearest],[_,Wl.LinearMipmapNearest],[L,Wl.NearestMipmapLinear],[F,Wl.LinearMipmapLinear]]),ic=new Map([[Wl.Nearest,U],[Wl.Linear,O]]),sc=new Map([[U,Wl.Nearest],[O,Wl.Linear]]),nc=e=>tc.has(e),ac=e=>sc.has(e),rc=e=>Zl.has(e),oc=Symbol("threeTexture"),Ac=Symbol("threeTextures"),lc=Symbol("setProperty");class cc extends Hl{get[oc](){var e;return null===(e=this[Nl])||void 0===e?void 0:e.values().next().value}get[Ac](){return this[Nl]}constructor(e,t){super(e,new Set(t?[t]:[]))}get name(){return this[oc].name||""}get minFilter(){return tc.get(this[oc].minFilter)}get magFilter(){return sc.get(this[oc].magFilter)}get wrapS(){return Zl.get(this[oc].wrapS)}get wrapT(){return Zl.get(this[oc].wrapT)}get rotation(){return this[oc].rotation}get scale(){return ju(this[oc].repeat)}get offset(){return ju(this[oc].offset)}setMinFilter(e){this[lc]("minFilter",ec.get(e))}setMagFilter(e){this[lc]("magFilter",ic.get(e))}setWrapS(e){this[lc]("wrapS",$l.get(e))}setWrapT(e){this[lc]("wrapT",$l.get(e))}setRotation(e){null==e&&(e=0),this[lc]("rotation",e)}setScale(e){null==e&&(e={u:1,v:1}),this[lc]("repeat",new y(e.u,e.v))}setOffset(e){null==e&&(e={u:0,v:0}),this[lc]("offset",new y(e.u,e.v))}[lc](e,t){if(((e,t)=>{switch(e){case"minFilter":return nc(t);case"magFilter":return ac(t);case"wrapS":case"wrapT":return rc(t);case"rotation":case"repeat":case"offset":return!0;default:throw new Error(`Cannot configure property "${e}" on Sampler`)}})(e,t))for(const i of this[Ac])i[e]=t,i.needsUpdate=!0;this[jl]()}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hc=Symbol("image"),uc=Symbol("sampler"),dc=Symbol("threeTexture");class pc extends Hl{get[dc](){var e;return null===(e=this[Nl])||void 0===e?void 0:e.values().next().value}constructor(e,t){super(e,new Set(t?[t]:[])),this[uc]=new cc(e,t),this[hc]=new Yl(e,t)}get name(){return this[dc].name||""}set name(e){for(const t of this[Nl])t.name=e}get sampler(){return this[uc]}get source(){return this[hc]}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gc,mc,fc;const bc=Symbol("texture"),Ic=Symbol("transform"),yc=Symbol("materials"),Cc=Symbol("usage"),Ec=Symbol("onUpdate"),wc=Symbol("activeVideo");var Bc;!function(e){e[e.Base=0]="Base",e[e.MetallicRoughness=1]="MetallicRoughness",e[e.Normal=2]="Normal",e[e.Occlusion=3]="Occlusion",e[e.Emissive=4]="Emissive",e[e.Clearcoat=5]="Clearcoat",e[e.ClearcoatRoughness=6]="ClearcoatRoughness",e[e.ClearcoatNormal=7]="ClearcoatNormal",e[e.SheenColor=8]="SheenColor",e[e.SheenRoughness=9]="SheenRoughness",e[e.Transmission=10]="Transmission",e[e.Thickness=11]="Thickness",e[e.Specular=12]="Specular",e[e.SpecularColor=13]="SpecularColor",e[e.Iridescence=14]="Iridescence",e[e.IridescenceThickness=15]="IridescenceThickness",e[e.Anisotropy=16]="Anisotropy"}(Bc||(Bc={}));class vc{constructor(e,t,i,s){this[gc]=null,this[mc]={rotation:0,scale:new y(1,1),offset:new y(0,0)},this[fc]=!1,i&&(this[Ic].rotation=i.rotation,this[Ic].scale.copy(i.repeat),this[Ic].offset.copy(i.offset),this[bc]=new pc(e,i)),this[Ec]=e,this[yc]=s,this[Cc]=t}get texture(){return this[bc]}setTexture(e){var t,i;const s=null!=e?e.source[Kl]:null,n=null===(t=this[bc])||void 0===t?void 0:t.source[Kl];if(null!=n&&n.isVideoTexture?this[wc]=!1:(null===(i=this[bc])||void 0===i?void 0:i.source.animation)&&this[bc].source.animation.removeEventListener("enterFrame",this[Ec]),this[bc]=e,null!=s&&s.isVideoTexture){const e=s.image;if(this[wc]=!0,null!=e.requestVideoFrameCallback){const t=()=>{this[wc]&&(this[Ec](),e.requestVideoFrameCallback(t))};e.requestVideoFrameCallback(t)}else{const e=()=>{this[wc]&&(this[Ec](),requestAnimationFrame(e))};requestAnimationFrame(e)}}else null!=(null==e?void 0:e.source.animation)&&e.source.animation.addEventListener("enterFrame",this[Ec]);let a=l;if(this[yc])for(const e of this[yc]){switch(this[Cc]){case Bc.Base:e.map=s;break;case Bc.MetallicRoughness:a=c,e.metalnessMap=s,e.roughnessMap=s;break;case Bc.Normal:a=c,e.normalMap=s;break;case Bc.Occlusion:a=c,e.aoMap=s;break;case Bc.Emissive:e.emissiveMap=s;break;case Bc.Clearcoat:e.clearcoatMap=s;break;case Bc.ClearcoatRoughness:e.clearcoatRoughnessMap=s;break;case Bc.ClearcoatNormal:e.clearcoatNormalMap=s;break;case Bc.SheenColor:e.sheenColorMap=s;break;case Bc.SheenRoughness:e.sheenRoughnessMap=s;break;case Bc.Transmission:e.transmissionMap=s;break;case Bc.Thickness:e.thicknessMap=s;break;case Bc.Specular:e.specularIntensityMap=s;break;case Bc.SpecularColor:e.specularColorMap=s;break;case Bc.Iridescence:e.iridescenceMap=s;break;case Bc.IridescenceThickness:e.iridescenceThicknessMap=s;break;case Bc.Anisotropy:e.anisotropyMap=s}e.needsUpdate=!0}s&&(s.colorSpace=a,s.rotation=this[Ic].rotation,s.repeat=this[Ic].scale,s.offset=this[Ic].offset),this[Ec]()}}gc=bc,mc=Ic,fc=wc;
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const xc=Symbol("threeMaterial"),Sc=Symbol("threeMaterials"),Qc=Symbol("baseColorTexture"),Mc=Symbol("metallicRoughnessTexture");class Tc extends Hl{get[Sc](){return this[Nl]}get[xc](){var e;return null===(e=this[Nl])||void 0===e?void 0:e.values().next().value}constructor(e,t){super(e,t);const{map:i,metalnessMap:s}=t.values().next().value;this[Qc]=new vc(e,Bc.Base,i,t),this[Mc]=new vc(e,Bc.MetallicRoughness,s,t)}get baseColorFactor(){const e=[0,0,0,this[xc].opacity];return this[xc].color.toArray(e),e}get metallicFactor(){return this[xc].metalness}get roughnessFactor(){return this[xc].roughness}get baseColorTexture(){return this[Qc]}get metallicRoughnessTexture(){return this[Mc]}setBaseColorFactor(e){const t=new d;e instanceof Array?t.fromArray(e):t.set(e);for(const i of this[Sc])i.color.set(t),e instanceof Array&&e.length>3?i.opacity=e[3]:(e=[0,0,0,i.opacity],t.toArray(e));this[jl]()}setMetallicFactor(e){for(const t of this[Sc])t.metalness=e;this[jl]()}setRoughnessFactor(e){for(const t of this[Sc])t.roughness=e;this[jl]()}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dc,Rc;const kc=Symbol("pbrMetallicRoughness"),Fc=Symbol("normalTexture"),Lc=Symbol("occlusionTexture"),_c=Symbol("emissiveTexture"),Pc=Symbol("backingThreeMaterial"),Oc=Symbol("applyAlphaCutoff"),Uc=Symbol("getAlphaMode"),Gc=Symbol("lazyLoadGLTFInfo"),Nc=Symbol("initialize"),jc=Symbol("getLoadedMaterial"),Hc=Symbol("ensureMaterialIsLoaded"),zc=Symbol("gltfIndex"),qc=Symbol("setActive"),Vc=Symbol("variantIndices"),Kc=Symbol("isActive"),Jc=Symbol("modelVariants"),Yc=Symbol("name"),Wc=Symbol("pbrTextures");class Xc extends Hl{get[(Dc=Vc,Rc=Wc,Pc)](){return this[Nl].values().next().value}constructor(e,t,i,s,n,a,r=void 0){super(e,n),this[Dc]=new Set,this[Rc]=new Map,this[zc]=t,this[Kc]=i,this[Jc]=s,this[Yc]=a,null==r?this[Nc]():this[Gc]=r}[Nc](){const e=this[jl],t=this[Nl];this[kc]=new Tc(e,t);const{normalMap:i,aoMap:s,emissiveMap:n}=t.values().next().value;this[Fc]=new vc(e,Bc.Normal,i,t),this[Lc]=new vc(e,Bc.Occlusion,s,t),this[_c]=new vc(e,Bc.Emissive,n,t);const a=i=>{this[Wc].set(i,new vc(e,i,null,t))};a(Bc.Clearcoat),a(Bc.ClearcoatRoughness),a(Bc.ClearcoatNormal),a(Bc.SheenColor),a(Bc.SheenRoughness),a(Bc.Transmission),a(Bc.Thickness),a(Bc.Specular),a(Bc.SpecularColor),a(Bc.Iridescence),a(Bc.IridescenceThickness),a(Bc.Anisotropy)}async[jc](){if(null!=this[Gc]){const e=await this[Gc].doLazyLoad();return this[Nc](),this[Gc]=void 0,this.ensureLoaded=async()=>{},e}return null}colorFromRgb(e){const t=new d;return e instanceof Array?t.fromArray(e):t.set(e),t}[Hc](){if(null!=this[Gc])throw new Error(`Material "${this.name}" has not been loaded, call 'await\n    myMaterial.ensureLoaded()' before using an unloaded material.`)}async ensureLoaded(){await this[jc]()}get isLoaded(){return null==this[Gc]}get isActive(){return this[Kc]}[qc](e){this[Kc]=e}get name(){return this[Yc]||""}set name(e){if(this[Yc]=e,null!=this[Nl])for(const t of this[Nl])t.name=e}get pbrMetallicRoughness(){return this[Hc](),this[kc]}get normalTexture(){return this[Hc](),this[Fc]}get occlusionTexture(){return this[Hc](),this[Lc]}get emissiveTexture(){return this[Hc](),this[_c]}get emissiveFactor(){return this[Hc](),this[Pc].emissive.toArray()}get index(){return this[zc]}hasVariant(e){const t=this[Jc].get(e);return null!=t&&this[Vc].has(t.index)}setEmissiveFactor(e){this[Hc]();const t=this.colorFromRgb(e);for(const e of this[Nl])e.emissive.set(t);this[jl]()}[Uc](){return this[Pc].transparent?"BLEND":this[Pc].alphaTest>0?"MASK":"OPAQUE"}[Oc](){this[Hc]();for(const e of this[Nl])"MASK"===this[Uc]()?null==e.alphaTest&&(e.alphaTest=.5):e.alphaTest=void 0,e.needsUpdate=!0}setAlphaCutoff(e){this[Hc]();for(const t of this[Nl])t.alphaTest=e,t.needsUpdate=!0;this[Oc](),this[jl]()}getAlphaCutoff(){return this[Hc](),this[Pc].alphaTest}setDoubleSided(e){this[Hc]();for(const t of this[Nl])t.side=e?K:ge,t.needsUpdate=!0;this[jl]()}getDoubleSided(){return this[Hc](),this[Pc].side==K}setAlphaMode(e){this[Hc]();const t=(e,t)=>{e.transparent=t,e.depthWrite=!t};for(const i of this[Nl])t(i,"BLEND"===e),i.alphaTest="MASK"===e?.5:void 0,i.needsUpdate=!0;this[jl]()}getAlphaMode(){return this[Hc](),this[Uc]()}get emissiveStrength(){return this[Hc](),this[Pc].emissiveIntensity}setEmissiveStrength(e){this[Hc]();for(const t of this[Nl])t.emissiveIntensity=e;this[jl]()}get clearcoatFactor(){return this[Hc](),this[Pc].clearcoat}get clearcoatRoughnessFactor(){return this[Hc](),this[Pc].clearcoatRoughness}get clearcoatTexture(){return this[Hc](),this[Wc].get(Bc.Clearcoat)}get clearcoatRoughnessTexture(){return this[Hc](),this[Wc].get(Bc.ClearcoatRoughness)}get clearcoatNormalTexture(){return this[Hc](),this[Wc].get(Bc.ClearcoatNormal)}get clearcoatNormalScale(){return this[Hc](),this[Pc].clearcoatNormalScale.x}setClearcoatFactor(e){this[Hc]();for(const t of this[Nl])t.clearcoat=e;this[jl]()}setClearcoatRoughnessFactor(e){this[Hc]();for(const t of this[Nl])t.clearcoatRoughness=e;this[jl]()}setClearcoatNormalScale(e){this[Hc]();for(const t of this[Nl])t.clearcoatNormalScale=new y(e,e);this[jl]()}get ior(){return this[Hc](),this[Pc].ior}setIor(e){this[Hc]();for(const t of this[Nl])t.ior=e;this[jl]()}get sheenColorFactor(){return this[Hc](),this[Pc].sheenColor.toArray()}get sheenColorTexture(){return this[Hc](),this[Wc].get(Bc.SheenColor)}get sheenRoughnessFactor(){return this[Hc](),this[Pc].sheenRoughness}get sheenRoughnessTexture(){return this[Hc](),this[Wc].get(Bc.SheenRoughness)}setSheenColorFactor(e){this[Hc]();const t=this.colorFromRgb(e);for(const e of this[Nl])e.sheenColor.set(t),e.sheen=1;this[jl]()}setSheenRoughnessFactor(e){this[Hc]();for(const t of this[Nl])t.sheenRoughness=e,t.sheen=1;this[jl]()}get transmissionFactor(){return this[Hc](),this[Pc].transmission}get transmissionTexture(){return this[Hc](),this[Wc].get(Bc.Transmission)}setTransmissionFactor(e){this[Hc]();for(const t of this[Nl])t.transmission=e;this[jl]()}get thicknessFactor(){return this[Hc](),this[Pc].thickness}get thicknessTexture(){return this[Hc](),this[Wc].get(Bc.Thickness)}get attenuationDistance(){return this[Hc](),this[Pc].attenuationDistance}get attenuationColor(){return this[Hc](),this[Pc].attenuationColor.toArray()}setThicknessFactor(e){this[Hc]();for(const t of this[Nl])t.thickness=e;this[jl]()}setAttenuationDistance(e){this[Hc]();for(const t of this[Nl])t.attenuationDistance=e;this[jl]()}setAttenuationColor(e){this[Hc]();const t=this.colorFromRgb(e);for(const e of this[Nl])e.attenuationColor.set(t);this[jl]()}get specularFactor(){return this[Hc](),this[Pc].specularIntensity}get specularTexture(){return this[Hc](),this[Wc].get(Bc.Specular)}get specularColorFactor(){return this[Hc](),this[Pc].specularColor.toArray()}get specularColorTexture(){return this[Hc](),this[Wc].get(Bc.SheenColor)}setSpecularFactor(e){this[Hc]();for(const t of this[Nl])t.specularIntensity=e;this[jl]()}setSpecularColorFactor(e){this[Hc]();const t=this.colorFromRgb(e);for(const e of this[Nl])e.specularColor.set(t);this[jl]()}get iridescenceFactor(){return this[Hc](),this[Pc].iridescence}get iridescenceTexture(){return this[Hc](),this[Wc].get(Bc.Iridescence)}get iridescenceIor(){return this[Hc](),this[Pc].iridescenceIOR}get iridescenceThicknessMinimum(){return this[Hc](),this[Pc].iridescenceThicknessRange[0]}get iridescenceThicknessMaximum(){return this[Hc](),this[Pc].iridescenceThicknessRange[1]}get iridescenceThicknessTexture(){return this[Hc](),this[Wc].get(Bc.IridescenceThickness)}setIridescenceFactor(e){this[Hc]();for(const t of this[Nl])t.iridescence=e;this[jl]()}setIridescenceIor(e){this[Hc]();for(const t of this[Nl])t.iridescenceIOR=e;this[jl]()}setIridescenceThicknessMinimum(e){this[Hc]();for(const t of this[Nl])t.iridescenceThicknessRange[0]=e;this[jl]()}setIridescenceThicknessMaximum(e){this[Hc]();for(const t of this[Nl])t.iridescenceThicknessRange[1]=e;this[jl]()}get anisotropyStrength(){return this[Hc](),this[Pc].anisotropy}get anisotropyRotation(){return this[Hc](),this[Pc].anisotropyRotation}get anisotropyTexture(){return this[Hc](),this[Wc].get(Bc.Anisotropy)}setAnisotropyStrength(e){this[Hc]();for(const t of this[Nl])t.anisotropy=e;this[jl]()}setAnisotropyRotation(e){this[Hc]();for(const t of this[Nl])t.anisotropyRotation=e;this[jl]()}}let $c=class{constructor(e){this.name="",this.children=new Array,this.name=e}};class Zc extends $c{constructor(e,t,i,s){super(e.name),this.materials=new Map,this.variantToMaterialMap=new Map,this.initialMaterialIdx=0,this.activeMaterialIdx=0,this.mesh=e;const{gltf:n,threeGLTF:a,threeObjectMap:r}=s;this.parser=a.parser,this.modelVariants=i,this.mesh.userData.variantData=i;const o=r.get(e.material);null!=o.materials?this.initialMaterialIdx=this.activeMaterialIdx=o.materials:console.error(`Primitive (${e.name}) missing initial material reference.`);const A=e.userData.associations||{};if(null==A.meshes)return void console.error("Mesh is missing primitive index association");const l=((n.meshes||[])[A.meshes].primitives||[])[A.primitives];if(null!=l){if(null!=l.material)this.materials.set(l.material,t[l.material]);else{const e=t.findIndex((e=>"Default"===e.name));e>=0?this.materials.set(e,t[e]):console.warn("gltfPrimitive has no material!")}if(l.extensions&&l.extensions.KHR_materials_variants){const e=l.extensions.KHR_materials_variants,s=a.parser.json.extensions.KHR_materials_variants.variants;for(const n of e.mappings){const e=t[n.material];this.materials.set(n.material,e);for(const t of n.variants){const{name:n}=s[t];this.variantToMaterialMap.set(t,e),e[Vc].add(t),i.has(n)||i.set(n,{name:n,index:t})}}}}else console.error("Mesh primitive definition is missing.")}async setActiveMaterial(e){const t=this.materials.get(e);if(e!==this.activeMaterialIdx){const i=t[Nl],s=await t[jc]();this.mesh.material=null!=s?s:i.values().next().value,this.parser.assignFinalMaterial(this.mesh),i.add(this.mesh.material),this.activeMaterialIdx=e}return this.mesh.material}getActiveMaterial(){return this.materials.get(this.activeMaterialIdx)}getMaterial(e){return this.materials.get(e)}async enableVariant(e){if(null==e)return this.setActiveMaterial(this.initialMaterialIdx);if(null!=this.variantToMaterialMap&&this.modelVariants.has(e)){const t=this.modelVariants.get(e);return this.enableVariantHelper(t.index)}return null}async enableVariantHelper(e){if(null!=this.variantToMaterialMap&&null!=e){const t=this.variantToMaterialMap.get(e);if(null!=t)return this.setActiveMaterial(t.index)}return null}async instantiateVariants(){if(null!=this.variantToMaterialMap)for(const e of this.variantToMaterialMap.keys()){const t=this.mesh.userData.variantMaterials.get(e);if(null!=t.material)continue;const i=await this.enableVariantHelper(e);null!=i&&(t.material=i)}}get variantInfo(){return this.variantToMaterialMap}addVariant(e,t){if(!this.ensureVariantIsUnused(t))return!1;this.modelVariants.has(t)||this.modelVariants.set(t,{name:t,index:this.modelVariants.size});const i=this.modelVariants.get(t).index;return e[Vc].add(i),this.variantToMaterialMap.set(i,e),this.materials.set(e.index,e),this.updateVariantUserData(i,e),!0}deleteVariant(e){if(this.variantInfo.has(e)){this.variantInfo.delete(e);const t=this.mesh.userData.variantMaterials;null!=t&&t.delete(e)}}updateVariantUserData(e,t){t[Vc].add(e),this.mesh.userData.variantData=this.modelVariants,this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map;this.mesh.userData.variantMaterials.set(e,{material:t[Nl].values().next().value,gltfMaterialIndex:t.index})}ensureVariantIsUnused(e){const t=this.modelVariants.get(e);return null==t||!this.variantInfo.has(t.index)||(console.warn(`Primitive cannot add variant '${e}' for this material, it already exists.`),!1)}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eh,th,ih,sh,nh,ah;const rh=Symbol("materials"),oh=Symbol("hierarchy"),Ah=Symbol("roots"),lh=Symbol("primitives"),ch=Symbol("prepareVariantsForExport"),hh=Symbol("switchVariant"),uh=Symbol("materialFromPoint"),dh=Symbol("nodeFromPoint"),ph=Symbol("nodeFromIndex"),gh=Symbol("variantData"),mh=Symbol("availableVariants"),fh=Symbol("modelOnUpdate"),bh=Symbol("cloneMaterial");class Ih{constructor(e,t,i,s){this.gltf=e,this.gltfElementMap=t,this.mapKey=i,this.doLazyLoad=s}}class yh{constructor(e,t=()=>{}){this[eh]=new Array,this[th]=new Array,this[ih]=new Array,this[sh]=new Array,this[nh]=()=>{},this[ah]=new Map,this[fh]=t;const{gltf:i,threeGLTF:s,gltfElementMap:n}=e;for(const[e,a]of i.materials.entries()){const r=n.get(a);if(null!=r)this[rh].push(new Xc(t,e,!0,this[gh],r,a.name));else{const r=(i.materials||[])[e],o=new Set;n.set(r,o);const A=async()=>{const t=await s.parser.getDependency("material",e);return o.add(t),t};this[rh].push(new Xc(t,e,!1,this[gh],o,a.name,new Ih(i,n,r,A)))}}const a=new Map,r=new Array;for(const e of s.scene.children)r.push(e);for(;r.length>0;){const t=r.pop();let i=null;t instanceof X?(i=new Zc(t,this.materials,this[gh],e),this[lh].push(i)):i=new $c(t.name);const s=a.get(t);null!=s?s.children.push(i):this[Ah].push(i),this[oh].push(i);for(const e of t.children)r.push(e),a.set(t,i)}}get materials(){return this[rh]}[(eh=rh,th=oh,ih=Ah,sh=lh,nh=fh,ah=gh,mh)](){const e=Array.from(this[gh].values());return e.sort(((e,t)=>e.index-t.index)),e.map((e=>e.name))}getMaterialByName(e){const t=this[rh].filter((t=>t.name===e));return t.length>0?t[0]:null}[ph](e,t){const i=this[oh].find((i=>{if(i instanceof Zc){const{meshes:s,primitives:n}=i.mesh.userData.associations;if(s==e&&n==t)return!0}return!1}));return null==i?null:i}[dh](e){return this[oh].find((t=>{if(t instanceof Zc){if(t.mesh===e.object)return!0}return!1}))}[uh](e){return this[dh](e).getActiveMaterial()}async[hh](e){for(const t of this[lh])await t.enableVariant(e);for(const e of this.materials)e[qc](!1);for(const e of this[lh])this.materials[e.getActiveMaterial().index][qc](!0)}async[ch](){const e=new Array;for(const t of this[lh])e.push(t.instantiateVariants());await Promise.all(e)}[bh](e,t){const i=this.materials[e];i.isLoaded||console.error("Cloning an unloaded material,\n           call 'material.ensureLoaded() before cloning the material.");const s=i[Nl],n=new Set;for(const[e,i]of s.entries()){const a=i.clone();a.name=t+(s.size>1?"_inst"+e:""),n.add(a)}const a=new Xc(this[fh],this[rh].length,!1,this[gh],n,t);return this[rh].push(a),a}createMaterialInstanceForVariant(e,t,i,s=!0){let n=null;for(const s of this[lh]){const a=this[gh].get(i);null!=a&&s.variantInfo.has(a.index)||null!=s.getMaterial(e)&&(this.hasVariant(i)||this.createVariant(i),null==n&&(n=this[bh](e,t)),s.addVariant(n,i))}if(s&&null!=n){n[qc](!0),this.materials[e][qc](!1);for(const e of this[lh])e.enableVariant(i)}return n}createVariant(e){this[gh].has(e)?console.warn(`Variant '${e}'' already exists`):this[gh].set(e,{name:e,index:this[gh].size})}hasVariant(e){return this[gh].has(e)}setMaterialToVariant(e,t){if(null!=this[mh]().find((e=>e===t)))if(e<0||e>=this.materials.length)console.error("setMaterialToVariant(): materialIndex is out of bounds.");else for(const i of this[lh]){const s=i.getMaterial(e);null!=s&&i.addVariant(s,t)}else console.warn(`Can't add material to '${t}', the variant does not exist.'`)}updateVariantName(e,t){const i=this[gh].get(e);null!=i&&(i.name=t,this[gh].set(t,i),this[gh].delete(e))}deleteVariant(e){const t=this[gh].get(e);if(null!=t){for(const i of this.materials)i.hasVariant(e)&&i[Vc].delete(t.index);for(const e of this[lh])e.deleteVariant(t.index);this[gh].delete(e)}}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ch=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const Eh=Symbol("currentGLTF"),wh=Symbol("originalGltfJson"),Bh=Symbol("model"),vh=Symbol("getOnUpdateMethod"),xh=Symbol("buildTexture");
/* @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Sh extends X{constructor(){super(void 0,new J({depthWrite:!1})),this.height=0,this.radius=0,this.resolution=0,this.userData.noHit=!0}get map(){return this.material.map}set map(e){this.material.map=e}isUsable(){return this.height>0&&this.radius>0&&null!=this.geometry&&null!=this.map}updateGeometry(e=this.height,t=this.radius,i=128){e==this.height&&t==this.radius&&i==this.resolution||(this.height=e,this.radius=t,this.resolution=i,e>0&&t>0&&(this.geometry.dispose(),this.geometry=function(e,t,i){const s=new bt(t,2*i,i);s.scale(1,1,-1);const n=s.getAttribute("position"),a=new v;for(let t=0;t<n.count;++t)if(a.fromBufferAttribute(n,t),a.y<0){const i=3*-e/2,s=a.y<i?-e/a.y:1-a.y*a.y/(3*i*i);a.multiplyScalar(s),a.toArray(n.array,3*t)}return n.needsUpdate=!0,s}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,i)))}}const Qh=new v,Mh=new v,Th=new v,Dh=new $e,Rh=new It,kh=new x;class Fh extends Ea{constructor(e){super(document.createElement("div")),this.normal=new v(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=e.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(e.position),this.updateNormal(e.normal),this.surface=e.surface}get facingCamera(){return!this.element.classList.contains("hide")}show(){this.facingCamera&&this.initialized||this.updateVisibility(!0)}hide(){!this.facingCamera&&this.initialized||this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,0===this.referenceCount}updatePosition(e){if(null==e)return;const t=Pr(e)[0].terms;for(let e=0;e<3;++e)this.position.setComponent(e,Jr(t[e]).number);this.updateMatrixWorld()}updateNormal(e){if(null==e)return;const t=Pr(e)[0].terms;for(let e=0;e<3;++e)this.normal.setComponent(e,t[e].number)}updateSurface(){const{mesh:e,tri:t,bary:i}=this;if(null==e||null==t||null==i)return;e.getVertexPosition(t.x,Qh),e.getVertexPosition(t.y,Mh),e.getVertexPosition(t.z,Th),Qh.toArray(Dh.elements,0),Mh.toArray(Dh.elements,3),Th.toArray(Dh.elements,6),this.position.copy(i).applyMatrix3(Dh);const s=this.parent;s.worldToLocal(e.localToWorld(this.position)),Rh.set(Qh,Mh,Th),Rh.getNormal(this.normal).transformDirection(e.matrixWorld);const n=s.parent;kh.setFromAxisAngle(Qh.set(0,1,0),-n.rotation.y),this.normal.applyQuaternion(kh)}orient(e){this.pivot.style.transform=`rotate(${e}rad)`}updateVisibility(e){this.element.classList.toggle("hide",!e),this.slot.assignedNodes().forEach((t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;const i=t,s=i.dataset.visibilityAttribute;if(null!=s){const t=`data-${s}`;i.toggleAttribute(t,e)}i.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:e}}))})),this.initialized=!0}}const Lh={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},_h={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"};function Ph(e,t,i){return(1-i)*e+i*t}
/* @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh extends M{constructor(e,t,i){super(),this.camera=new ae,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new yt,this.horizontalBlurMaterial=new st(Lh),this.verticalBlurMaterial=new st(_h),this.intensity=0,this.softness=1,this.boundingBox=new fe,this.size=new v,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:s}=this;s.rotation.x=Math.PI/2,s.left=-.5,s.right=.5,s.bottom=-.5,s.top=.5,this.add(s);const n=new Ye,a=new J({opacity:1,transparent:!0,side:dt});this.floor=new X(n,a),this.floor.userData.noHit=!0,s.add(this.floor),this.blurPlane=new X(n),this.blurPlane.visible=!1,s.add(this.blurPlane),e.target.add(this),this.depthMaterial.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.depthMaterial.side=K,this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(e,t,i)}setScene(e,t,i){const{boundingBox:s,size:n,rotation:a,position:r}=this;if(this.isAnimated=e.animationNames.length>0,this.boundingBox.copy(e.boundingBox),this.size.copy(e.size),this.maxDimension=Math.max(n.x,n.y,n.z)*(this.isAnimated?2:1),this.boundingBox.getCenter(r),"back"===i){const{min:e,max:t}=s;[e.y,e.z]=[e.z,e.y],[t.y,t.z]=[t.z,t.y],[n.y,n.z]=[n.z,n.y],a.x=Math.PI/2,a.y=Math.PI}else a.x=0,a.y=0;if(this.isAnimated){const e=s.min.y,t=s.max.y;n.y=this.maxDimension,s.expandByVector(n.subScalar(this.maxDimension).multiplyScalar(-.5)),s.min.y=e,s.max.y=t,n.set(this.maxDimension,t-e,this.maxDimension)}"bottom"===i?r.y=s.min.y:r.z=s.min.y,this.setSoftness(t)}setSoftness(e){this.softness=e;const{size:t,camera:i}=this,s=this.isAnimated?2:1,n=s*Math.pow(2,9-3*e);this.setMapSize(n);const a=t.y/2,r=t.y*s;i.near=0,i.far=Ph(r,a,e),this.depthMaterial.opacity=1/e,i.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(e){const{size:t}=this;this.isAnimated&&(e*=2);const i=Math.floor(t.x>t.z?e:e*t.x/t.z),s=Math.floor(t.x>t.z?e*t.z/t.x:e),n=10+i,a=10+s;if(null==this.renderTarget||this.renderTarget.width===n&&this.renderTarget.height===a||(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),null==this.renderTarget){const e={format:Se};this.renderTarget=new et(n,a,e),this.renderTargetBlur=new et(n,a,e),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(t.x*(1+10/i),t.z*(1+10/s),1),this.needsUpdate=!0}setIntensity(e){this.intensity=e,e>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=e*Ph(.3,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(e){this.floor.position.z=-e+this.gap()}gap(){return.001*this.maxDimension}render(e,t){t.overrideMaterial=this.depthMaterial;const i=e.getClearAlpha();e.setClearAlpha(0),this.floor.visible=!1;const s=e.xr.enabled;e.xr.enabled=!1;const n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.render(t,this.camera),t.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(e),e.xr.enabled=s,e.setRenderTarget(n),e.setClearAlpha(i)}blurShadow(e){const{camera:t,horizontalBlurMaterial:i,verticalBlurMaterial:s,renderTarget:n,renderTargetBlur:a,blurPlane:r}=this;r.visible=!0,r.material=i,i.uniforms.h.value=1/this.renderTarget.width,i.uniforms.tDiffuse.value=this.renderTarget.texture,e.setRenderTarget(a),e.render(r,t),r.material=s,s.uniforms.v.value=1/this.renderTarget.height,s.uniforms.tDiffuse.value=this.renderTargetBlur.texture,e.setRenderTarget(n),e.render(r,t),r.visible=!1}dispose(){null!=this.renderTarget&&this.renderTarget.dispose(),null!=this.renderTargetBlur&&this.renderTargetBlur.dispose(),this.depthMaterial.dispose(),this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose(),this.floor.material.dispose(),this.floor.geometry.dispose(),this.blurPlane.geometry.dispose(),this.removeFromParent()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uh=new v,Gh=new v,Nh=new v,jh=new Ct,Hh=new v,zh=new y;class qh extends qe{constructor({canvas:e,element:t,width:i,height:s}){super(),this.annotationRenderer=new Qa,this.effectRenderer=null,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.scaleStep=0,this.renderCount=0,this.externalRenderer=null,this.appendedAnimations=[],this.markedAnimations=[],this.camera=new se(45,1,.1,100),this.xrCamera=null,this.url=null,this.pivot=new M,this.target=new M,this.animationNames=[],this.boundingBox=new fe,this.boundingSphere=new be,this.size=new v,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=new Set,this.exposure=1,this.toneMapping=r,this.canScale=!0,this.isDirty=!1,this.goalTarget=new v,this.targetDamperX=new Tr,this.targetDamperY=new Tr,this.targetDamperZ=new Tr,this._currentGLTF=null,this._model=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.groundedSkybox=new Sh,this.name="ModelScene",this.element=t,this.canvas=e,this.camera=new se(45,1,.1,100),this.camera.name="MainCamera",this.add(this.pivot),this.pivot.name="Pivot",this.pivot.add(this.target),this.setSize(i,s),this.target.name="Target",this.mixer=new Et(this.target);const{domElement:n}=this.annotationRenderer,{style:a}=n;a.display="none",a.pointerEvents="none",a.position="absolute",a.top="0",this.element.shadowRoot.querySelector(".default").appendChild(n),this.schemaElement.setAttribute("type","application/ld+json")}get context(){return this.canvas.getContext("2d")}getCamera(){return null!=this.xrCamera?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}forceRescale(){this.scaleStep=-1,this.queueRender()}async setObject(e){this.reset(),this._model=e,this.target.add(e),await this.setupScene()}async setSource(e,t=()=>{}){if(!e||e===this.url)return void t(1);if(this.reset(),this.url=e,null!=this.externalRenderer){const e=await this.externalRenderer.load(t);return this.boundingSphere.radius=e.framedRadius,void(this.idealAspect=e.fieldOfViewAspect)}let i;null!=this.cancelPendingSourceChange&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);try{i=await new Promise((async(i,s)=>{this.cancelPendingSourceChange=()=>s();try{i(await this.element[_u].loader.load(e,this.element,t))}catch(e){s(e)}}))}catch(e){if(null==e)return;throw e}this.cancelPendingSourceChange=null,this.reset(),this.url=e,this._currentGLTF=i,null!=i&&(i.scene.userData.filepath=e,i.scene.userData.filename=e.split("/").pop()||"",this._model=i.scene,this.target.add(i.scene));const{animations:s}=i,n=new Map,a=[];for(const e of s)n.set(e.name,e),a.push(e.name);this.animations=s,this.animationsByName=n,this.animationNames=a,await this.setupScene()}async setupScene(){this.applyTransform(),this.updateBoundingBox(),await this.updateFraming(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity),this.setGroundedSkybox()}reset(){this.url=null,this.renderCount=0,this.queueRender(),null!=this.shadow&&this.shadow.setIntensity(0),this.bakedShadows.clear();const{_model:e}=this;null!=e&&(e.removeFromParent(),this._model=null);const t=this._currentGLTF;null!=t&&(t.dispose(),this._currentGLTF=null),null!=this.currentAnimationAction&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}dispose(){this.reset(),null!=this.shadow&&(this.shadow.dispose(),this.shadow=null),this.element[Eh]=null,this.element[wh]=null,this.element[Bh]=null}get currentGLTF(){return this._currentGLTF}setSize(e,t){if(this.width!==e||this.height!==t){if(this.width=Math.max(e,1),this.height=Math.max(t,1),this.annotationRenderer.setSize(e,t),this.aspect=this.width/this.height,null!=this.externalRenderer){const i=window.devicePixelRatio;this.externalRenderer.resize(e*i,t*i)}this.queueRender()}}markBakedShadow(e){e.userData.noHit=!0,this.bakedShadows.add(e)}unmarkBakedShadow(e){e.userData.noHit=!1,e.visible=!0,this.bakedShadows.delete(e),this.boundingBox.expandByObject(e)}findBakedShadows(e){const t=new fe;e.traverse((e=>{const i=e;if(!i.material)return;if(!i.material.transparent)return;t.setFromObject(i);const s=t.getSize(Hh),n=Math.min(s.x,s.y,s.z);Math.max(s.x,s.y,s.z)<100*n||this.markBakedShadow(i)}))}checkBakedShadows(){const{min:e,max:t}=this.boundingBox,i=new fe;this.boundingBox.getSize(this.size);for(const s of this.bakedShadows)i.setFromObject(s),i.min.y<e.y+this.size.y/100&&i.min.x<=e.x&&i.max.x>=t.x&&i.min.z<=e.z&&i.max.z>=t.z||i.min.z<e.z+this.size.z/100&&i.min.x<=e.x&&i.max.x>=t.x&&i.min.y<=e.y&&i.max.y>=t.y||this.unmarkBakedShadow(s)}applyTransform(){const{model:e}=this;if(null==e)return;const t=Pr(this.element.orientation)[0].terms,i=Jr(t[0]).number,s=Jr(t[1]).number,n=Jr(t[2]).number;e.quaternion.setFromEuler(new Ze(s,n,i,"YXZ"));const a=Pr(this.element.scale)[0].terms;e.scale.set(a[0].number,a[1].number,a[2].number)}updateBoundingBox(){const{model:e}=this;if(null==e)return;this.target.remove(e),this.findBakedShadows(e);const t=(e,t)=>e.expandByPoint(t);this.setBakedShadowVisibility(!1),this.boundingBox=Ma(e,t,new fe),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows.forEach((e=>this.unmarkBakedShadow(e))),this.boundingBox=Ma(e,t,new fe)),this.checkBakedShadows(),this.setBakedShadowVisibility(),this.boundingBox.getSize(this.size),this.target.add(e)}async updateFraming(){const{model:e}=this;if(null==e)return;this.target.remove(e),this.setBakedShadowVisibility(!1);const{center:t}=this.boundingSphere;this.element.requestUpdate("cameraTarget"),await this.element.updateComplete,t.copy(this.getTarget());this.boundingSphere.radius=Math.sqrt(Ma(e,((e,i)=>Math.max(e,t.distanceToSquared(i))),0));this.idealAspect=Ma(e,((e,i)=>{i.sub(t);const s=Math.sqrt(i.x*i.x+i.z*i.z);return Math.max(e,s/(this.idealCameraDistance()-Math.abs(i.y)))}),0)/Math.tan(this.framedFoVDeg/2*Math.PI/180),this.setBakedShadowVisibility(),this.target.add(e)}setBakedShadowVisibility(e=this.shadowIntensity<=0){for(const t of this.bakedShadows)t.visible=e}idealCameraDistance(){const e=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(e)}adjustedFoV(e){const t=Math.tan(e/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(t)*180/Math.PI}getNDC(e,t){if(null!=this.xrCamera)zh.set(e/window.screen.width,t/window.screen.height);else{const i=this.element.getBoundingClientRect();zh.set((e-i.x)/this.width,(t-i.y)/this.height)}return zh.multiplyScalar(2).subScalar(1),zh.y*=-1,zh}getSize(){return{width:this.width,height:this.height}}setEnvironmentAndSkybox(e,t){this.element[_u].arRenderer.presentedScene!==this&&(this.environment=e,this.setBackground(t),this.queueRender())}setBackground(e){this.groundedSkybox.map=e,this.groundedSkybox.isUsable()?(this.target.add(this.groundedSkybox),this.background=null):(this.target.remove(this.groundedSkybox),this.background=e)}farRadius(){return this.boundingSphere.radius*(null!=this.groundedSkybox.parent?10:1)+1e3}setGroundedSkybox(){const e=Pr(this.element.skyboxHeight)[0].terms[0],t=Jr(e).number,i=10*this.boundingSphere.radius;this.groundedSkybox.updateGeometry(t,i),this.groundedSkybox.position.y=t-(this.shadow?2*this.shadow.gap():0),this.setBackground(this.groundedSkybox.map)}setTarget(e,t,i){this.goalTarget.set(-e,-t,-i)}setTargetDamperDecayTime(e){this.targetDamperX.setDecayTime(e),this.targetDamperY.setDecayTime(e),this.targetDamperZ.setDecayTime(e)}getTarget(){return this.goalTarget.clone().multiplyScalar(-1)}getDynamicTarget(){return this.target.position.clone().multiplyScalar(-1)}jumpToGoal(){this.updateTarget(1e4)}updateTarget(e){const t=this.goalTarget,i=this.target.position;if(t.equals(i))return!1;{const s=this.boundingSphere.radius/10;let{x:n,y:a,z:r}=i;return n=this.targetDamperX.update(n,t.x,e,s),a=this.targetDamperY.update(a,t.y,e,s),r=this.targetDamperZ.update(r,t.z,e,s),this.groundedSkybox.position.x=-n,this.groundedSkybox.position.z=-r,this.target.position.set(n,a,r),this.target.updateMatrixWorld(),this.queueRender(),!0}}pointTowards(e,t){const{x:i,z:s}=this.position;this.yaw=Math.atan2(e-i,t-s)}get model(){return this._model}set yaw(e){this.pivot.rotation.y=e,this.groundedSkybox.rotation.y=-e,this.queueRender()}get yaw(){return this.pivot.rotation.y}set animationTime(e){this.mixer.setTime(e),this.queueShadowRender()}get animationTime(){if(null!=this.currentAnimationAction){const e=Math.max(this.currentAnimationAction._loopCount,0);return this.currentAnimationAction.loop!==wt||1&~e?this.currentAnimationAction.time:this.duration-this.currentAnimationAction.time}return 0}set animationTimeScale(e){this.mixer.timeScale=e}get animationTimeScale(){return this.mixer.timeScale}get duration(){return null!=this.currentAnimationAction&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return null!=this.currentAnimationAction}playAnimation(e=null,t=0,i=Bt,s=1/0){if(null==this._currentGLTF)return;const{animations:n}=this;if(null==n||0===n.length)return;let a=null;if(null!=e&&(a=this.animationsByName.get(e),null==a)){const t=parseInt(e);!isNaN(t)&&t>=0&&t<n.length&&(a=n[t])}null==a&&(a=n[0]);try{const{currentAnimationAction:e}=this,n=this.mixer.clipAction(a,this);n.timeScale!=this.element.timeScale&&(n.timeScale=this.element.timeScale),this.currentAnimationAction=n,this.element.paused?this.mixer.stopAllAction():(n.paused=!1,null!=e&&n!==e?n.crossFadeFrom(e,t,!1):this.animationTimeScale>0&&this.animationTime==this.duration&&(this.animationTime=0)),n.setLoop(i,s),n.enabled=!0,n.clampWhenFinished=!0,n.play()}catch(e){console.error(e)}}appendAnimation(e="",t=Bt,i=1/0,s=1,n=1,a=!1,r=!1,o=!0,A=null,l=!1){if(null==this._currentGLTF||e===this.element.animationName)return;const{animations:c}=this;if(null==c||0===c.length)return;let h=null;if(e&&(h=this.animationsByName.get(e)),null!=h){"string"==typeof i?isNaN(i)?(i=1/0,console.warn("Invalid repetitionCount value, repetitionCount is set to Infinity")):i=Math.max(parseInt(i),1):"number"==typeof i&&i<1&&(i=1),1===i&&t!==vt&&(t=vt),"string"==typeof s&&(isNaN(s)?(s=1,console.warn("Invalid weight value, weight is set to 1")):s=parseFloat(s)),"string"==typeof n&&(isNaN(n)?(n=1,console.warn("Invalid timeScale value, timeScale is set to 1")):n=parseFloat(n)),"string"==typeof a&&("true"===a.toLowerCase().trim()?a=!0:"false"===a.toLowerCase().trim()?a=!1:isNaN(a)?(a=!1,console.warn("Invalid fade value, fade is set to false")):a=parseFloat(a)),"string"==typeof r&&("true"===r.toLowerCase().trim()?r=!0:"false"===r.toLowerCase().trim()?r=!1:isNaN(r)?(r=!1,console.warn("Invalid warp value, warp is set to false")):r=parseFloat(r)),"string"==typeof A&&(isNaN(A)||(A=parseFloat(A)));try{const c=this.mixer.existingAction(h)||this.mixer.clipAction(h,this),u=c.timeScale;l&&this.appendedAnimations.includes(e)&&(this.markedAnimations.map((e=>e.name)).includes(e)||this.markedAnimations.push({name:e,loopMode:t,repetitionCount:i})),"number"==typeof A&&(c.time=Math.min(Math.max(A,0),h.duration)),"boolean"==typeof a&&a?c.fadeIn(1.25):"number"==typeof a?c.fadeIn(Math.max(a,0)):s>=0&&(c.weight=Math.min(Math.max(s,0),1)),"boolean"==typeof r&&r?c.warp(o?u:0,n,1.25):"number"==typeof r?c.warp(o?u:0,n,Math.max(r,0)):c.timeScale=n,c.isRunning()||(c.time==h.duration&&c.stop(),c.setLoop(t,i),c.paused=!1,c.enabled=!0,c.clampWhenFinished=!0,c.play()),this.appendedAnimations.includes(e)||this.element[Du].appendedAnimations.push(e)}catch(e){console.error(e)}}}detachAnimation(e="",t=!0){if(null==this._currentGLTF||e===this.element.animationName)return;const{animations:i}=this;if(null==i||0===i.length)return;let s=null;if(e&&(s=this.animationsByName.get(e)),null!=s){"string"==typeof t&&("true"===t.toLowerCase().trim()?t=!0:"false"===t.toLowerCase().trim()?t=!1:isNaN(t)?(t=!0,console.warn("Invalid fade value, fade is set to true")):t=parseFloat(t));try{const i=this.mixer.existingAction(s)||this.mixer.clipAction(s,this);"boolean"==typeof t&&t?i.fadeOut(1.5):"number"==typeof t?i.fadeOut(Math.max(t,0)):i.stop();const n=this.element[Du].appendedAnimations.filter((t=>t!==e));this.element[Du].appendedAnimations=n}catch(e){console.error(e)}}}updateAnimationLoop(e="",t=Bt,i=1/0){if(null==this._currentGLTF||e===this.element.animationName)return;const{animations:s}=this;if(null==s||0===s.length)return;let n=null;if(e&&(n=this.animationsByName.get(e)),null!=n)try{const e=this.mixer.existingAction(n)||this.mixer.clipAction(n,this);e.stop(),e.setLoop(t,i),e.play()}catch(e){console.error(e)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(e){this.mixer.update(e),this.queueShadowRender()}subscribeMixerEvent(e,t){this.mixer.addEventListener(e,t)}updateShadow(){const e=this.shadow;if(null!=e){const t="wall"===this.element.arPlacement?"back":"bottom";e.setScene(this,this.shadowSoftness,t),e.needsUpdate=!0}}renderShadow(e){const t=this.shadow;null!=t&&1==t.needsUpdate&&(t.render(e,this),t.needsUpdate=!1)}queueShadowRender(){null!=this.shadow&&(this.shadow.needsUpdate=!0)}setShadowIntensity(e){if(this.shadowIntensity=e,null!=this._currentGLTF&&(this.setBakedShadowVisibility(),!(e<=0&&null==this.shadow))){if(null==this.shadow){const e="wall"===this.element.arPlacement?"back":"bottom";this.shadow=new Oh(this,this.shadowSoftness,e)}this.shadow.setIntensity(e)}}setShadowSoftness(e){this.shadowSoftness=e;const t=this.shadow;null!=t&&t.setSoftness(e)}setShadowOffset(e){const t=this.shadow;null!=t&&t.setOffset(e)}getHit(e=this){return jh.intersectObject(e,!0).find((e=>e.object.visible&&!e.object.userData.noHit))}hitFromController(e,t=this){return jh.setFromXRController(e),this.getHit(t)}hitFromPoint(e,t=this){return jh.setFromCamera(e,this.getCamera()),this.getHit(t)}positionAndNormalFromPoint(e,t=this){var i;const s=this.hitFromPoint(e,t);if(null==s)return null;return{position:s.point,normal:null!=s.face?s.face.normal.clone().applyNormalMatrix((new $e).getNormalMatrix(s.object.matrixWorld)):jh.ray.direction.clone().multiplyScalar(-1),uv:null!==(i=s.uv)&&void 0!==i?i:null}}surfaceFromPoint(e,t=this){const i=this.element.model;if(null==i)return null;const s=this.hitFromPoint(e,t);if(null==s||null==s.face)return null;const n=i[dh](s),{meshes:a,primitives:r}=n.mesh.userData.associations,o=new v,A=new v,l=new v,{a:c,b:h,c:u}=s.face,d=s.object;d.getVertexPosition(c,o),d.getVertexPosition(h,A),d.getVertexPosition(u,l);const p=new It(o,A,l),g=new v;return p.getBarycoord(d.worldToLocal(s.point),g),`${a} ${r} ${c} ${h} ${u} ${g.x.toFixed(3)} ${g.y.toFixed(3)} ${g.z.toFixed(3)}`}addHotspot(e){this.target.add(e),this.annotationRenderer.domElement.appendChild(e.element),this.updateSurfaceHotspot(e)}removeHotspot(e){this.target.remove(e)}forHotspots(e){const{children:t}=this.target;for(let i=0,s=t.length;i<s;i++){const s=t[i];s instanceof Fh&&e(s)}}updateSurfaceHotspot(e){if(null==e.surface||null==this.element.model)return;const t=Pr(e.surface)[0].terms;if(8!=t.length)return void console.warn(e.surface+" does not have exactly 8 numbers.");const i=this.element.model[ph](t[0].number,t[1].number);if(null==i)return void console.warn(e.surface+" does not match a node/primitive in this glTF! Skipping this hotspot.");const s=i.mesh.geometry.attributes.position.count,n=new v(t[2].number,t[3].number,t[4].number);if(n.x>=s||n.y>=s||n.z>=s)return void console.warn(e.surface+" vertex indices out of range in this glTF! Skipping this hotspot.");const a=new v(t[5].number,t[6].number,t[7].number);e.mesh=i.mesh,e.tri=n,e.bary=a,e.updateSurface()}animateSurfaceHotspots(){this.element.paused||this.forHotspots((e=>{e.updateSurface()}))}updateHotspotsVisibility(e){this.forHotspots((t=>{Uh.copy(e),Gh.setFromMatrixPosition(t.matrixWorld),Uh.sub(Gh),Nh.copy(t.normal).transformDirection(this.target.matrixWorld),Uh.dot(Nh)<0?t.hide():t.show()}))}orientHotspots(e){this.forHotspots((t=>{t.orient(e)}))}setHotspotsVisibility(e){this.forHotspots((t=>{t.visible=e}))}updateSchema(e){var t;const{schemaElement:i,element:s}=this,{alt:n,poster:a,iosSrc:r}=s;if(null!=e){const s=[{"@type":"MediaObject",contentUrl:e,encodingFormat:"gltf"===(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())?"model/gltf+json":"model/gltf-binary"}];r&&s.push({"@type":"MediaObject",contentUrl:r,encodingFormat:"model/vnd.usdz+zip"});const o={"@context":"http://schema.org/","@type":"3DModel",image:null!=a?a:void 0,name:null!=n?n:void 0,encoding:s};i.textContent=JSON.stringify(o),document.head.appendChild(i)}else null!=i.parentElement&&i.parentElement.removeChild(i)}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vh extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(e){const t={progress:0,completed:!1};return this.ongoingActivities.add(t),1===this.ongoingActivityCount&&this.announceTotalProgress(t,0,e),i=>{let s;return s=Math.max(rs(i,0,1),t.progress),s!==t.progress&&this.announceTotalProgress(t,s,e),t.progress}}announceTotalProgress(e,t,i){let s=0,n=0;1==t&&(e.completed=!0);for(const e of this.ongoingActivities){const{progress:t}=e;s+=1-t,e.completed&&n++}const a=e.progress;e.progress=t,this.totalProgress+=(t-a)*(1-this.totalProgress)/s;const r=n===this.ongoingActivityCount?1:this.totalProgress;this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:r,reason:i}})),n===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kh,Jh,Yh,Wh,Xh,$h,Zh,eu,tu,iu,su,nu,au,ru=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const ou=document.createElement("canvas"),Au=Symbol("fallbackResizeHandler"),lu=Symbol("defaultAriaLabel"),cu=Symbol("resizeObserver"),hu=Symbol("clearModelTimeout"),uu=Symbol("onContextLost"),du=Symbol("loaded"),pu=Symbol("status"),gu=Symbol("onFocus"),mu=Symbol("onBlur"),fu=Symbol("updateSize"),bu=Symbol("intersectionObserver"),Iu=Symbol("isElementInViewport"),yu=Symbol("announceModelVisibility"),Cu=Symbol("ariaLabel"),Eu=Symbol("altDefaulted"),wu=Symbol("statusElement"),Bu=Symbol("updateStatus"),vu=Symbol("loadedTime"),xu=Symbol("updateSource"),Su=Symbol("markLoaded"),Qu=Symbol("container"),Mu=Symbol("input"),Tu=Symbol("canvas"),Du=Symbol("scene"),Ru=Symbol("needsRender"),ku=Symbol("tick"),Fu=Symbol("onModelLoad"),Lu=Symbol("onResize"),_u=Symbol("renderer"),Pu=Symbol("progressTracker"),Ou=Symbol("getLoaded"),Uu=Symbol("getModelIsVisible"),Gu=Symbol("shouldAttemptPreload"),Nu=e=>({x:e.x,y:e.y,z:e.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),ju=e=>({u:e.x,v:e.y,toString(){return`${this.u} ${this.v}`}});class Hu extends Zt{static get is(){return"model-viewer"}static set modelCacheSize(e){Ca[Ia].evictionThreshold=e}static get modelCacheSize(){return Ca[Ia].evictionThreshold}static set minimumRenderScale(e){e>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),e<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),Gl.singleton.minScale=e}static get minimumRenderScale(){return Gl.singleton.minScale}get loaded(){return this[Ou]()}get[(Kh=Iu,Jh=du,Yh=vu,Wh=pu,Xh=hu,$h=Au,Zh=yu,eu=cu,tu=bu,iu=Pu,_u)](){return Gl.singleton}get modelIsVisible(){return this[Uu]()}constructor(){super(),this.alt=null,this.src=null,this.withCredentials=!1,this.generateSchema=!1,this[Kh]=!1,this[Jh]=!1,this[Yh]=0,this[Wh]="",this[Xh]=null,this[$h]=as((()=>{const e=this.getBoundingClientRect();this[fu](e)}),50),this[Zh]=as((e=>{const t=this.modelIsVisible;t!==e&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:t}}))}),0),this[eu]=null,this[tu]=null,this[iu]=new Vh,this[su]=()=>{this[wu].textContent=this[pu]},this[nu]=()=>{this[wu].textContent=""},this[au]=e=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:e.sourceEvent}}))},this.attachShadow({mode:"open"});const e=this.shadowRoot;let t,i;if((e=>{Ui(ds,e)})(e),this[Qu]=e.querySelector(".container"),this[Mu]=e.querySelector(".userInput"),this[Tu]=e.querySelector("canvas"),this[wu]=e.querySelector("#status"),this[lu]=this[Mu].getAttribute("aria-label"),this.isConnected){const e=this.getBoundingClientRect();t=e.width,i=e.height}else t=300,i=150;this[Du]=new qh({canvas:this[Tu],element:this,width:t,height:i}),Promise.resolve().then((()=>{this[fu](this.getBoundingClientRect())})),qi&&(this[cu]=new ResizeObserver((e=>{if(!this[_u].isPresenting)for(let t of e)t.target===this&&this[fu](t.contentRect)}))),Vi?this[bu]=new IntersectionObserver((e=>{for(let t of e)if(t.target===this){const e=this.modelIsVisible;this[Iu]=t.isIntersecting,this[yu](e),this[Iu]&&!this.loaded&&this[xu]()}}),{root:null,rootMargin:"0px",threshold:1e-5}):this[Iu]=!0}connectedCallback(){super.connectedCallback&&super.connectedCallback(),qi?this[cu].observe(this):self.addEventListener("resize",this[Au]),Vi&&this[bu].observe(this),this.addEventListener("focus",this[gu]),this.addEventListener("blur",this[mu]);const e=this[_u];e.addEventListener("contextlost",this[uu]),e.registerScene(this[Du]),null!=this[hu]&&(self.clearTimeout(this[hu]),this[hu]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),qi?this[cu].unobserve(this):self.removeEventListener("resize",this[Au]),Vi&&this[bu].unobserve(this),this.removeEventListener("focus",this[gu]),this.removeEventListener("blur",this[mu]);const e=this[_u];e.removeEventListener("contextlost",this[uu]),e.unregisterScene(this[Du]),this[hu]=self.setTimeout((()=>{this[Du].dispose(),this[hu]=null}),10)}updated(e){super.updated(e),e.has("src")&&(null==this.src?(this[du]=!1,this[vu]=0,this[Du].reset()):this.src!==this[Du].url&&(this[du]=!1,this[vu]=0,this[xu]())),e.has("alt")&&this[Mu].setAttribute("aria-label",this[Cu]),e.has("generateSchema")&&(this.generateSchema?this[Du].updateSchema(this.src):this[Du].updateSchema(null))}toDataURL(e,t){return this[_u].displayCanvas(this[Du]).toDataURL(e,t)}async toBlob(e){const t=e?e.mimeType:void 0,i=e?e.qualityArgument:void 0,s=e?e.idealAspect:void 0,{width:n,height:a,idealAspect:r,aspect:o}=this[Du],{dpr:A,scaleFactor:l}=this[_u];let c=n*l*A,h=a*l*A,u=0,d=0;if(!0===s)if(r>o){const e=h;h=Math.round(c/r),d=(e-h)/2}else{const e=c;c=Math.round(h*r),u=(e-c)/2}ou.width=c,ou.height=h;try{return new Promise((async(e,s)=>{ou.getContext("2d").drawImage(this[_u].displayCanvas(this[Du]),u,d,c,h,0,0,c,h),ou.toBlob((t=>{if(!t)return s(new Error("Unable to retrieve canvas blob"));e(t)}),t,i)}))}finally{this[fu]({width:n,height:a})}}registerEffectComposer(e){e.setRenderer(this[_u].threeRenderer),e.setMainCamera(this[Du].getCamera()),e.setMainScene(this[Du]),this[Du].effectRenderer=e}unregisterEffectComposer(){this[Du].effectRenderer=null}registerRenderer(e){this[Du].externalRenderer=e}unregisterRenderer(){this[Du].externalRenderer=null}get[Cu](){return this[Eu]}get[Eu](){return null==this.alt||"null"===this.alt?this[lu]:this.alt}[Ou](){return this[du]}[Uu](){return this.loaded&&this[Iu]}[Gu](){return!!this.src&&this[Iu]}[fu]({width:e,height:t}){0!==e&&0!==t&&(this[Qu].style.width=`${e}px`,this[Qu].style.height=`${t}px`,this[Lu]({width:e,height:t}))}[ku](e,t){var i;null===(i=this[Du].effectRenderer)||void 0===i||i.beforeRender(e,t)}[Su](){this[du]||(this[du]=!0,this[vu]=performance.now())}[Ru](){this[Du].queueRender()}[Fu](){}[Bu](e){this[pu]=e;const t=this.getRootNode();null!=t&&t.activeElement===this&&this[wu].textContent!=e&&(this[wu].textContent=e)}[(su=gu,nu=mu,Lu)](e){this[Du].setSize(e.width,e.height)}async[(au=uu,xu)](){const e=this[Du];if(this.loaded||!this[Gu]()||this.src===e.url)return;this.generateSchema&&e.updateSchema(this.src),this[Bu]("Loading"),e.stopAnimation();const t=this[Pu].beginActivity("model-load"),i=this.src;try{const s=e.setSource(i,(e=>t(.95*rs(e,0,1)))),n=this[hs]();await Promise.all([s,n]),this[Su](),this[Fu](),this.updateComplete.then((()=>{this.dispatchEvent(new CustomEvent("before-render"))})),await new Promise((e=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>{this.dispatchEvent(new CustomEvent("load",{detail:{url:i}})),e()}))}))}))}catch(e){this.dispatchEvent(new CustomEvent("error",{detail:{type:"loadfailure",sourceError:e}}))}finally{t(1)}}}ru([ii({type:String})],Hu.prototype,"alt",void 0),ru([ii({type:String})],Hu.prototype,"src",void 0),ru([ii({type:Boolean,attribute:"with-credentials"})],Hu.prototype,"withCredentials",void 0),ru([ii({type:Boolean,attribute:"generate-schema"})],Hu.prototype,"generateSchema",void 0);
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var zu=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const qu=Symbol("changeAnimation"),Vu=Symbol("appendAnimation"),Ku=Symbol("detachAnimation"),Ju=Symbol("paused"),Yu={repetitions:1/0,pingpong:!1},Wu={pingpong:!1,repetitions:null,weight:1,timeScale:1,fade:!1,warp:!1,relativeWarp:!0,time:null},Xu={fade:!0},$u=Symbol("hotspotMap"),Zu=Symbol("mutationCallback"),ed=Symbol("observer"),td=Symbol("addHotspot"),id=Symbol("removeHotspot"),sd=new B;
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/
var nd=Uint8Array,ad=Uint16Array,rd=Int32Array,od=new nd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ad=new nd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ld=new nd([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cd=function(e,t){for(var i=new ad(31),s=0;s<31;++s)i[s]=t+=1<<e[s-1];var n=new rd(i[30]);for(s=1;s<30;++s)for(var a=i[s];a<i[s+1];++a)n[a]=a-i[s]<<5|s;return{b:i,r:n}},hd=cd(od,2),ud=hd.b,dd=hd.r;ud[28]=258,dd[258]=28;for(var pd=cd(Ad,0).r,gd=new ad(32768),md=0;md<32768;++md){var fd=(43690&md)>>1|(21845&md)<<1;fd=(61680&(fd=(52428&fd)>>2|(13107&fd)<<2))>>4|(3855&fd)<<4,gd[md]=((65280&fd)>>8|(255&fd)<<8)>>1}var bd=function(e,t,i){for(var s=e.length,n=0,a=new ad(t);n<s;++n)e[n]&&++a[e[n]-1];var r,o=new ad(t);for(n=1;n<t;++n)o[n]=o[n-1]+a[n-1]<<1;if(i){r=new ad(1<<t);var A=15-t;for(n=0;n<s;++n)if(e[n])for(var l=n<<4|e[n],c=t-e[n],h=o[e[n]-1]++<<c,u=h|(1<<c)-1;h<=u;++h)r[gd[h]>>A]=l}else for(r=new ad(s),n=0;n<s;++n)e[n]&&(r[n]=gd[o[e[n]-1]++]>>15-e[n]);return r},Id=new nd(288);for(md=0;md<144;++md)Id[md]=8;for(md=144;md<256;++md)Id[md]=9;for(md=256;md<280;++md)Id[md]=7;for(md=280;md<288;++md)Id[md]=8;var yd=new nd(32);for(md=0;md<32;++md)yd[md]=5;var Cd=bd(Id,9,0),Ed=bd(yd,5,0),wd=function(e){return(e+7)/8|0},Bd=function(e,t,i){return(null==i||i>e.length)&&(i=e.length),new nd(e.subarray(t,i))},vd=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],xd=function(e,t,i){var s=new Error(t||vd[e]);if(s.code=e,Error.captureStackTrace&&Error.captureStackTrace(s,xd),!i)throw s;return s},Sd=function(e,t,i){i<<=7&t;var s=t/8|0;e[s]|=i,e[s+1]|=i>>8},Qd=function(e,t,i){i<<=7&t;var s=t/8|0;e[s]|=i,e[s+1]|=i>>8,e[s+2]|=i>>16},Md=function(e,t){for(var i=[],s=0;s<e.length;++s)e[s]&&i.push({s:s,f:e[s]});var n=i.length,a=i.slice();if(!n)return{t:_d,l:0};if(1==n){var r=new nd(i[0].s+1);return r[i[0].s]=1,{t:r,l:1}}i.sort((function(e,t){return e.f-t.f})),i.push({s:-1,f:25001});var o=i[0],A=i[1],l=0,c=1,h=2;for(i[0]={s:-1,f:o.f+A.f,l:o,r:A};c!=n-1;)o=i[i[l].f<i[h].f?l++:h++],A=i[l!=c&&i[l].f<i[h].f?l++:h++],i[c++]={s:-1,f:o.f+A.f,l:o,r:A};var u=a[0].s;for(s=1;s<n;++s)a[s].s>u&&(u=a[s].s);var d=new ad(u+1),p=Td(i[c-1],d,0);if(p>t){s=0;var g=0,m=p-t,f=1<<m;for(a.sort((function(e,t){return d[t.s]-d[e.s]||e.f-t.f}));s<n;++s){var b=a[s].s;if(!(d[b]>t))break;g+=f-(1<<p-d[b]),d[b]=t}for(g>>=m;g>0;){var I=a[s].s;d[I]<t?g-=1<<t-d[I]++-1:++s}for(;s>=0&&g;--s){var y=a[s].s;d[y]==t&&(--d[y],++g)}p=t}return{t:new nd(d),l:p}},Td=function(e,t,i){return-1==e.s?Math.max(Td(e.l,t,i+1),Td(e.r,t,i+1)):t[e.s]=i},Dd=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new ad(++t),s=0,n=e[0],a=1,r=function(e){i[s++]=e},o=1;o<=t;++o)if(e[o]==n&&o!=t)++a;else{if(!n&&a>2){for(;a>138;a-=138)r(32754);a>2&&(r(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(r(n),--a;a>6;a-=6)r(8304);a>2&&(r(a-3<<5|8208),a=0)}for(;a--;)r(n);a=1,n=e[o]}return{c:i.subarray(0,s),n:t}},Rd=function(e,t){for(var i=0,s=0;s<t.length;++s)i+=e[s]*t[s];return i},kd=function(e,t,i){var s=i.length,n=wd(t+2);e[n]=255&s,e[n+1]=s>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var a=0;a<s;++a)e[n+a+4]=i[a];return 8*(n+4+s)},Fd=function(e,t,i,s,n,a,r,o,A,l,c){Sd(t,c++,i),++n[256];for(var h=Md(n,15),u=h.t,d=h.l,p=Md(a,15),g=p.t,m=p.l,f=Dd(u),b=f.c,I=f.n,y=Dd(g),C=y.c,E=y.n,w=new ad(19),B=0;B<b.length;++B)++w[31&b[B]];for(B=0;B<C.length;++B)++w[31&C[B]];for(var v=Md(w,7),x=v.t,S=v.l,Q=19;Q>4&&!x[ld[Q-1]];--Q);var M,T,D,R,k=l+5<<3,F=Rd(n,Id)+Rd(a,yd)+r,L=Rd(n,u)+Rd(a,g)+r+14+3*Q+Rd(w,x)+2*w[16]+3*w[17]+7*w[18];if(A>=0&&k<=F&&k<=L)return kd(t,c,e.subarray(A,A+l));if(Sd(t,c,1+(L<F)),c+=2,L<F){M=bd(u,d,0),T=u,D=bd(g,m,0),R=g;var _=bd(x,S,0);Sd(t,c,I-257),Sd(t,c+5,E-1),Sd(t,c+10,Q-4),c+=14;for(B=0;B<Q;++B)Sd(t,c+3*B,x[ld[B]]);c+=3*Q;for(var P=[b,C],O=0;O<2;++O){var U=P[O];for(B=0;B<U.length;++B){var G=31&U[B];Sd(t,c,_[G]),c+=x[G],G>15&&(Sd(t,c,U[B]>>5&127),c+=U[B]>>12)}}}else M=Cd,T=Id,D=Ed,R=yd;for(B=0;B<o;++B){var N=s[B];if(N>255){Qd(t,c,M[(G=N>>18&31)+257]),c+=T[G+257],G>7&&(Sd(t,c,N>>23&31),c+=od[G]);var j=31&N;Qd(t,c,D[j]),c+=R[j],j>3&&(Qd(t,c,N>>5&8191),c+=Ad[j])}else Qd(t,c,M[N]),c+=T[N]}return Qd(t,c,M[256]),c+T[256]},Ld=new rd([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),_d=new nd(0),Pd=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var i=t,s=9;--s;)i=(1&i&&-306674912)^i>>>1;e[t]=i}return e}(),Od=function(){var e=-1;return{p:function(t){for(var i=e,s=0;s<t.length;++s)i=Pd[255&i^t[s]]^i>>>8;e=i},d:function(){return~e}}},Ud=function(e,t,i,s,n){if(!n&&(n={l:1},t.dictionary)){var a=t.dictionary.subarray(-32768),r=new nd(a.length+e.length);r.set(a),r.set(e,a.length),e=r,n.w=a.length}return function(e,t,i,s,n,a){var r=a.z||e.length,o=new nd(s+r+5*(1+Math.ceil(r/7e3))+n),A=o.subarray(s,o.length-n),l=a.l,c=7&(a.r||0);if(t){c&&(A[0]=a.r>>3);for(var h=Ld[t-1],u=h>>13,d=8191&h,p=(1<<i)-1,g=a.p||new ad(32768),m=a.h||new ad(p+1),f=Math.ceil(i/3),b=2*f,I=function(t){return(e[t]^e[t+1]<<f^e[t+2]<<b)&p},y=new rd(25e3),C=new ad(288),E=new ad(32),w=0,B=0,v=a.i||0,x=0,S=a.w||0,Q=0;v+2<r;++v){var M=I(v),T=32767&v,D=m[M];if(g[T]=D,m[M]=T,S<=v){var R=r-v;if((w>7e3||x>24576)&&(R>423||!l)){c=Fd(e,A,0,y,C,E,B,x,Q,v-Q,c),x=w=B=0,Q=v;for(var k=0;k<286;++k)C[k]=0;for(k=0;k<30;++k)E[k]=0}var F=2,L=0,_=d,P=T-D&32767;if(R>2&&M==I(v-P))for(var O=Math.min(u,R)-1,U=Math.min(32767,v),G=Math.min(258,R);P<=U&&--_&&T!=D;){if(e[v+F]==e[v+F-P]){for(var N=0;N<G&&e[v+N]==e[v+N-P];++N);if(N>F){if(F=N,L=P,N>O)break;var j=Math.min(P,N-2),H=0;for(k=0;k<j;++k){var z=v-P+k&32767,q=z-g[z]&32767;q>H&&(H=q,D=z)}}}P+=(T=D)-(D=g[T])&32767}if(L){y[x++]=268435456|dd[F]<<18|pd[L];var V=31&dd[F],K=31&pd[L];B+=od[V]+Ad[K],++C[257+V],++E[K],S=v+F,++w}else y[x++]=e[v],++C[e[v]]}}for(v=Math.max(v,S);v<r;++v)y[x++]=e[v],++C[e[v]];c=Fd(e,A,l,y,C,E,B,x,Q,v-Q,c),l||(a.r=7&c|A[c/8|0]<<3,c-=7,a.h=m,a.p=g,a.i=v,a.w=S)}else{for(v=a.w||0;v<r+l;v+=65535){var J=v+65535;J>=r&&(A[c/8|0]=l,J=r),c=kd(A,c+1,e.subarray(v,J))}a.i=r}return Bd(o,0,s+wd(c)+n)}(e,null==t.level?6:t.level,null==t.mem?n.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,i,s,n)},Gd=function(e,t){var i={};for(var s in e)i[s]=e[s];for(var s in t)i[s]=t[s];return i},Nd=function(e,t,i){for(;i;++t)e[t]=i,i>>>=8};function jd(e,t){return Ud(e,t||{},0,0)}var Hd=function(e,t,i,s){for(var n in e){var a=e[n],r=t+n,o=s;Array.isArray(a)&&(o=Gd(s,a[1]),a=a[0]),a instanceof nd?i[r]=[a,o]:(i[r+="/"]=[new nd(0),o],Hd(a,r,i,s))}},zd="undefined"!=typeof TextEncoder&&new TextEncoder,qd="undefined"!=typeof TextDecoder&&new TextDecoder;try{qd.decode(_d,{stream:!0})}catch(ri){}function Vd(e,t){if(zd)return zd.encode(e);for(var i=e.length,s=new nd(e.length+(e.length>>1)),n=0,a=function(e){s[n++]=e},r=0;r<i;++r){if(n+5>s.length){var o=new nd(n+8+(i-r<<1));o.set(s),s=o}var A=e.charCodeAt(r);A<128||t?a(A):A<2048?(a(192|A>>6),a(128|63&A)):A>55295&&A<57344?(a(240|(A=65536+(1047552&A)|1023&e.charCodeAt(++r))>>18),a(128|A>>12&63),a(128|A>>6&63),a(128|63&A)):(a(224|A>>12),a(128|A>>6&63),a(128|63&A))}return Bd(s,0,n)}var Kd=function(e){var t=0;if(e)for(var i in e){var s=e[i].length;s>65535&&xd(9),t+=s+4}return t},Jd=function(e,t,i,s,n,a,r,o){var A=s.length,l=i.extra,c=o&&o.length,h=Kd(l);Nd(e,t,null!=r?33639248:67324752),t+=4,null!=r&&(e[t++]=20,e[t++]=i.os),e[t]=20,t+=2,e[t++]=i.flag<<1|(a<0&&8),e[t++]=n&&8,e[t++]=255&i.compression,e[t++]=i.compression>>8;var u=new Date(null==i.mtime?Date.now():i.mtime),d=u.getFullYear()-1980;if((d<0||d>119)&&xd(10),Nd(e,t,d<<25|u.getMonth()+1<<21|u.getDate()<<16|u.getHours()<<11|u.getMinutes()<<5|u.getSeconds()>>1),t+=4,-1!=a&&(Nd(e,t,i.crc),Nd(e,t+4,a<0?-a-2:a),Nd(e,t+8,i.size)),Nd(e,t+12,A),Nd(e,t+14,h),t+=16,null!=r&&(Nd(e,t,c),Nd(e,t+6,i.attrs),Nd(e,t+10,r),t+=14),e.set(s,t),t+=A,h)for(var p in l){var g=l[p],m=g.length;Nd(e,t,+p),Nd(e,t+2,m),e.set(g,t+4),t+=4+m}return c&&(e.set(o,t),t+=c),t};function Yd(e,t){t||(t={});var i={},s=[];Hd(e,"",i,t);var n=0,a=0;for(var r in i){var o=i[r],A=o[0],l=o[1],c=0==l.level?0:8,h=(w=Vd(r)).length,u=l.comment,d=u&&Vd(u),p=d&&d.length,g=Kd(l.extra);h>65535&&xd(11);var m=c?jd(A,l):A,f=m.length,b=Od();b.p(A),s.push(Gd(l,{size:A.length,crc:b.d(),c:m,f:w,m:d,u:h!=r.length||d&&u.length!=p,o:n,compression:c})),n+=30+h+g+f,a+=76+2*(h+g)+(p||0)+f}for(var I=new nd(a+22),y=n,C=a-n,E=0;E<s.length;++E){var w=s[E];Jd(I,w.o,w,w.f,w.u,w.c.length);var B=30+w.f.length+Kd(w.extra);I.set(w.c,w.o+B),Jd(I,n,w,w.f,w.u,w.c.length,w.o,w.m),n+=16+B+(w.m?w.m.length:0)}return function(e,t,i,s,n){Nd(e,t,101010256),Nd(e,t+8,i),Nd(e,t+10,i),Nd(e,t+12,s),Nd(e,t+16,n)}(I,n,s.length,C,y),I}class Wd{constructor(){this.textureUtils=null}setTextureUtils(e){this.textureUtils=e}parse(e,t,i,s){this.parseAsync(e,s).then(t).catch(i)}async parseAsync(e,t={}){t=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},includeAnchoringProperties:!0,quickLookCompatible:!1,maxTextureSize:1024},t);const i={},s="model.usda";i[s]=null;let n=Zd();n+=function(e){const t=!0===e.includeAnchoringProperties?`\n\t\ttoken preliminary:anchoring:type = "${e.ar.anchoring.type}"\n\t\ttoken preliminary:planeAnchoring:alignment = "${e.ar.planeAnchoring.alignment}"\n\t`:"";return`def Xform "Root"\n{\n\tdef Scope "Scenes" (\n\t\tkind = "sceneLibrary"\n\t)\n\t{\n\t\tdef Xform "Scene" (\n\t\t\tcustomData = {\n\t\t\t\tbool preliminary_collidesWithEnvironment = 0\n\t\t\t\tstring sceneName = "Scene"\n\t\t\t}\n\t\t\tsceneName = "Scene"\n\t\t)\n\t\t{${t}\n`}(t);const a={},r={};e.traverseVisible((e=>{if(e.isMesh){const t=e.geometry,s=e.material;if(s.isMeshStandardMaterial){const r="geometries/Geometry_"+t.id+".usda";if(!(r in i)){const e=function(e){const t=function(e){const t="Geometry",i=e.attributes,s=i.position.count;return`\n\tdef Mesh "${t}"\n\t{\n\t\tint[] faceVertexCounts = [${function(e){const t=null!==e.index?e.index.count:e.attributes.position.count;return Array(t/3).fill(3).join(", ")}(e)}]\n\t\tint[] faceVertexIndices = [${function(e){const t=e.index,i=[];if(null!==t)for(let e=0;e<t.count;e++)i.push(t.getX(e));else{const t=e.attributes.position.count;for(let e=0;e<t;e++)i.push(e)}return i.join(", ")}(e)}]\n\t\tnormal3f[] normals = [${ip(i.normal,s)}] (\n\t\t\tinterpolation = "vertex"\n\t\t)\n\t\tpoint3f[] points = [${ip(i.position,s)}]\n${function(e){let t="";for(let i=0;i<4;i++){const s=i>0?i:"",n=e["uv"+s];void 0!==n&&(t+=`\n\t\ttexCoord2f[] primvars:st${s} = [${sp(n)}] (\n\t\t\tinterpolation = "vertex"\n\t\t)`)}const i=e.color;if(void 0!==i){t+=`\n\tcolor3f[] primvars:displayColor = [${ip(i,i.count)}] (\n\t\tinterpolation = "vertex"\n\t\t)`}return t}(i)}\n\t\tuniform token subdivisionScheme = "none"\n\t}\n`}(e);return`\ndef "Geometry"\n{\n${t}\n}\n`}(t);i[r]=function(e){let t=Zd();return t+=e,Vd(t)}(e)}s.uuid in a||(a[s.uuid]=s),n+=function(e,t,i){const s="Object_"+e.id,n=ep(e.matrixWorld);e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e);return`def Xform "${s}" (\n\tprepend references = @./geometries/Geometry_${t.id}.usda@</Geometry>\n\tprepend apiSchemas = ["MaterialBindingAPI"]\n)\n{\n\tmatrix4d xformOp:transform = ${n}\n\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\trel material:binding = </Materials/Material_${i.id}>\n}\n\n`}(e,t,s)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",e)}else e.isCamera&&(n+=function(e){const t=e.name?e.name:"Camera_"+e.id,i=ep(e.matrixWorld);e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e);return e.isOrthographicCamera?`def Camera "${t}"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ${i}\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\t\t\tfloat2 clippingRange = (${e.near.toPrecision($d)}, ${e.far.toPrecision($d)})\n\t\t\tfloat horizontalAperture = ${(10*(Math.abs(e.left)+Math.abs(e.right))).toPrecision($d)}\n\t\t\tfloat verticalAperture = ${(10*(Math.abs(e.top)+Math.abs(e.bottom))).toPrecision($d)}\n\t\t\ttoken projection = "orthographic"\n\t\t}\n\t\n\t`:`def Camera "${t}"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ${i}\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\t\t\tfloat2 clippingRange = (${e.near.toPrecision($d)}, ${e.far.toPrecision($d)})\n\t\t\tfloat focalLength = ${e.getFocalLength().toPrecision($d)}\n\t\t\tfloat focusDistance = ${e.focus.toPrecision($d)}\n\t\t\tfloat horizontalAperture = ${e.getFilmWidth().toPrecision($d)}\n\t\t\ttoken projection = "perspective"\n\t\t\tfloat verticalAperture = ${e.getFilmHeight().toPrecision($d)}\n\t\t}\n\t\n\t`}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))})),n+="\n\t\t}\n\t}\n}\n\n",n+=function(e,t,i=!1){const s=[];for(const n in e){const a=e[n];s.push(np(a,t,i))}return`def "Materials"\n{\n${s.join("")}\n}\n\n`}(a,r,t.quickLookCompatible),i[s]=Vd(n),n=null;for(const e in r){let s=r[e];if(!0===s.isCompressedTexture){if(null===this.textureUtils)throw new Error("THREE.USDZExporter: setTextureUtils() must be called to process compressed textures.");s=await this.textureUtils.decompress(s)}const n=Xd(s.image,s.flipY,t.maxTextureSize),a=await new Promise((e=>n.toBlob(e,"image/png",1)));i[`textures/Texture_${e}.png`]=new Uint8Array(await a.arrayBuffer())}let o=0;for(const e in i){const t=i[e];o+=34+e.length;const s=63&o;if(4!==s){const n=new Uint8Array(64-s);i[e]=[t,{extra:{12345:n}}]}o=t.length}return Yd(i,{level:0})}}function Xd(e,t,i){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const s=i/Math.max(e.width,e.height),n=document.createElement("canvas");n.width=e.width*Math.min(1,s),n.height=e.height*Math.min(1,s);const a=n.getContext("2d");return!0===t&&(a.translate(0,n.height),a.scale(1,-1)),a.drawImage(e,0,0,n.width,n.height),n}throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const $d=7;function Zd(){return'#usda 1.0\n(\n\tcustomLayerData = {\n\t\tstring creator = "Three.js USDZExporter"\n\t}\n\tdefaultPrim = "Root"\n\tmetersPerUnit = 1\n\tupAxis = "Y"\n)\n\n'}function ep(e){const t=e.elements;return`( ${tp(t,0)}, ${tp(t,4)}, ${tp(t,8)}, ${tp(t,12)} )`}function tp(e,t){return`(${e[t+0]}, ${e[t+1]}, ${e[t+2]}, ${e[t+3]})`}function ip(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");const i=[];for(let t=0;t<e.count;t++){const s=e.getX(t),n=e.getY(t),a=e.getZ(t);i.push(`(${s.toPrecision($d)}, ${n.toPrecision($d)}, ${a.toPrecision($d)})`)}return i.join(", ")}function sp(e){const t=[];for(let i=0;i<e.count;i++){const s=e.getX(i),n=e.getY(i);t.push(`(${s.toPrecision($d)}, ${1-n.toPrecision($d)})`)}return t.join(", ")}function np(e,t,i=!1){const s="\t\t\t",n=[],a=[];function r(s,n,a){const r=s.source.id+"_"+s.flipY;t[r]=s;const o=s.channel>0?"st"+s.channel:"st",A={1e3:"repeat",1001:"clamp",1002:"mirror"},l=s.repeat.clone(),c=s.offset.clone(),h=s.rotation,u=Math.sin(h),d=Math.cos(h);return c.y=1-c.y-l.y,i?(c.x=c.x/l.x,c.y=c.y/l.y,c.x+=u/l.x,c.y+=d-1):(c.x+=u*l.x,c.y+=(1-d)*l.y),`\n\t\tdef Shader "PrimvarReader_${n}"\n\t\t{\n\t\t\tuniform token info:id = "UsdPrimvarReader_float2"\n\t\t\tfloat2 inputs:fallback = (0.0, 0.0)\n\t\t\ttoken inputs:varname = "${o}"\n\t\t\tfloat2 outputs:result\n\t\t}\n\n\t\tdef Shader "Transform2d_${n}"\n\t\t{\n\t\t\tuniform token info:id = "UsdTransform2d"\n\t\t\ttoken inputs:in.connect = </Materials/Material_${e.id}/PrimvarReader_${n}.outputs:result>\n\t\t\tfloat inputs:rotation = ${(h*(180/Math.PI)).toFixed($d)}\n\t\t\tfloat2 inputs:scale = ${rp(l)}\n\t\t\tfloat2 inputs:translation = ${rp(c)}\n\t\t\tfloat2 outputs:result\n\t\t}\n\n\t\tdef Shader "Texture_${s.id}_${n}"\n\t\t{\n\t\t\tuniform token info:id = "UsdUVTexture"\n\t\t\tasset inputs:file = @textures/Texture_${r}.png@\n\t\t\tfloat2 inputs:st.connect = </Materials/Material_${e.id}/Transform2d_${n}.outputs:result>\n\t\t\t${void 0!==a?"float4 inputs:scale = "+function(e){return`(${e.r}, ${e.g}, ${e.b}, 1.0)`}(a):""}\n\t\t\ttoken inputs:sourceColorSpace = "${s.colorSpace===Ee?"raw":"sRGB"}"\n\t\t\ttoken inputs:wrapS = "${A[s.wrapS]}"\n\t\t\ttoken inputs:wrapT = "${A[s.wrapT]}"\n\t\t\tfloat outputs:r\n\t\t\tfloat outputs:g\n\t\t\tfloat outputs:b\n\t\t\tfloat3 outputs:rgb\n\t\t\t${e.transparent||e.alphaTest>0?"float outputs:a":""}\n\t\t}`}return e.side===K&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",e),null!==e.map?(n.push(`${s}color3f inputs:diffuseColor.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:rgb>`),e.transparent?n.push(`${s}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:a>`):e.alphaTest>0&&(n.push(`${s}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:a>`),n.push(`${s}float inputs:opacityThreshold = ${e.alphaTest}`)),a.push(r(e.map,"diffuse",e.color))):n.push(`${s}color3f inputs:diffuseColor = ${ap(e.color)}`),null!==e.emissiveMap?(n.push(`${s}color3f inputs:emissiveColor.connect = </Materials/Material_${e.id}/Texture_${e.emissiveMap.id}_emissive.outputs:rgb>`),a.push(r(e.emissiveMap,"emissive",new d(e.emissive.r*e.emissiveIntensity,e.emissive.g*e.emissiveIntensity,e.emissive.b*e.emissiveIntensity)))):e.emissive.getHex()>0&&n.push(`${s}color3f inputs:emissiveColor = ${ap(e.emissive)}`),null!==e.normalMap&&(n.push(`${s}normal3f inputs:normal.connect = </Materials/Material_${e.id}/Texture_${e.normalMap.id}_normal.outputs:rgb>`),a.push(r(e.normalMap,"normal"))),null!==e.aoMap&&(n.push(`${s}float inputs:occlusion.connect = </Materials/Material_${e.id}/Texture_${e.aoMap.id}_occlusion.outputs:r>`),a.push(r(e.aoMap,"occlusion",new d(e.aoMapIntensity,e.aoMapIntensity,e.aoMapIntensity)))),null!==e.roughnessMap?(n.push(`${s}float inputs:roughness.connect = </Materials/Material_${e.id}/Texture_${e.roughnessMap.id}_roughness.outputs:g>`),a.push(r(e.roughnessMap,"roughness",new d(e.roughness,e.roughness,e.roughness)))):n.push(`${s}float inputs:roughness = ${e.roughness}`),null!==e.metalnessMap?(n.push(`${s}float inputs:metallic.connect = </Materials/Material_${e.id}/Texture_${e.metalnessMap.id}_metallic.outputs:b>`),a.push(r(e.metalnessMap,"metallic",new d(e.metalness,e.metalness,e.metalness)))):n.push(`${s}float inputs:metallic = ${e.metalness}`),null!==e.alphaMap?(n.push(`${s}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.alphaMap.id}_opacity.outputs:r>`),n.push(`${s}float inputs:opacityThreshold = 0.0001`),a.push(r(e.alphaMap,"opacity"))):n.push(`${s}float inputs:opacity = ${e.opacity}`),e.isMeshPhysicalMaterial&&(null!==e.clearcoatMap?(n.push(`${s}float inputs:clearcoat.connect = </Materials/Material_${e.id}/Texture_${e.clearcoatMap.id}_clearcoat.outputs:r>`),a.push(r(e.clearcoatMap,"clearcoat",new d(e.clearcoat,e.clearcoat,e.clearcoat)))):n.push(`${s}float inputs:clearcoat = ${e.clearcoat}`),null!==e.clearcoatRoughnessMap?(n.push(`${s}float inputs:clearcoatRoughness.connect = </Materials/Material_${e.id}/Texture_${e.clearcoatRoughnessMap.id}_clearcoatRoughness.outputs:g>`),a.push(r(e.clearcoatRoughnessMap,"clearcoatRoughness",new d(e.clearcoatRoughness,e.clearcoatRoughness,e.clearcoatRoughness)))):n.push(`${s}float inputs:clearcoatRoughness = ${e.clearcoatRoughness}`),n.push(`${s}float inputs:ior = ${e.ior}`)),`\n\tdef Material "Material_${e.id}"\n\t{\n\t\tdef Shader "PreviewSurface"\n\t\t{\n\t\t\tuniform token info:id = "UsdPreviewSurface"\n${n.join("\n")}\n\t\t\tint inputs:useSpecularWorkflow = 0\n\t\t\ttoken outputs:surface\n\t\t}\n\n\t\ttoken outputs:surface.connect = </Materials/Material_${e.id}/PreviewSurface.outputs:surface>\n\n${a.join("\n")}\n\n\t}\n`}function ap(e){return`(${e.r}, ${e.g}, ${e.b})`}function rp(e){return`(${e.x}, ${e.y})`}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var op=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};let Ap=!1,lp=!1;const cp="#model-viewer-no-ar-fallback",hp=(up=["quick-look","scene-viewer","webxr","none"],e=>{try{const t=Pr(e),i=(t.length?t[0].terms:[]).filter((e=>e&&"ident"===e.type)).map((e=>e.value)).filter((e=>up.indexOf(e)>-1));return new Set(i)}catch(e){}return new Set});var up;const dp="quick-look",pp="scene-viewer",gp="webxr",mp="none",fp=Symbol("arButtonContainer"),bp=Symbol("enterARWithWebXR"),Ip=Symbol("openSceneViewer"),yp=Symbol("openIOSARQuickLook"),Cp=Symbol("canActivateAR"),Ep=Symbol("arMode"),wp=Symbol("arModes"),Bp=Symbol("arAnchor"),vp=Symbol("preload"),xp=Symbol("onARButtonContainerClick"),Sp=Symbol("onARStatus"),Qp=Symbol("onARTracking"),Mp=Symbol("onARTap"),Tp=Symbol("selectARMode"),Dp=Symbol("triggerLoad");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Rp=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const kp="auto",Fp="auto",Lp="eager",_p=Symbol("defaultProgressBarElement"),Pp=Symbol("posterContainerElement"),Op=Symbol("defaultPosterElement"),Up=Symbol("shouldDismissPoster"),Gp=Symbol("hidePoster"),Np=Symbol("modelIsRevealed"),jp=Symbol("updateProgressBar"),Hp=Symbol("ariaLabelCallToAction"),zp=Symbol("onProgress");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var qp=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const Vp=Math.PI/32,Kp={basis:[Vr(_r(Vp,"rad"))],keywords:{auto:[null]}},Jp=Symbol("autoRotateStartTime"),Yp=Symbol("radiansPerSecond"),Wp=Symbol("syncRotationRate"),Xp=Symbol("onCameraChange"),$p=Symbol("meshRoot"),Zp=Symbol("meshes"),eg=Symbol("objects"),tg=Symbol("updateFramingThrottled");class ig extends X{constructor(e,t={}){super(e),this.isWater=!0;const i=this,s=void 0!==t.textureWidth?t.textureWidth:512,n=void 0!==t.textureHeight?t.textureHeight:512,a=void 0!==t.clipBias?t.clipBias:0,r=void 0!==t.alpha?t.alpha:1,o=void 0!==t.time?t.time:0,A=void 0!==t.waterNormals?t.waterNormals:null,l=void 0!==t.sunDirection?t.sunDirection:new v(.70707,.70707,0),c=new d(void 0!==t.sunColor?t.sunColor:16777215),h=new d(void 0!==t.waterColor?t.waterColor:8355711),u=void 0!==t.eye?t.eye:new v(0,0,0),p=void 0!==t.distortionScale?t.distortionScale:20,g=void 0!==t.side?t.side:ge,m=void 0!==t.fog&&t.fog,f=new xt,b=new v,I=new v,y=new v,C=new B,E=new v(0,0,-1),w=new St,x=new v,S=new v,Q=new St,M=new B,T=new se,D=new et(s,n),R={name:"MirrorShader",uniforms:Qt.merge([Mt.fog,Mt.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new B},sunColor:{value:new d(8355711)},sunDirection:{value:new v(.70707,.70707,0)},eye:{value:new v},waterColor:{value:new d(5592405)}}]),vertexShader:"\n\t\t\t\tuniform mat4 textureMatrix;\n\t\t\t\tuniform float time;\n\n\t\t\t\tvarying vec4 mirrorCoord;\n\t\t\t\tvarying vec4 worldPosition;\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tmirrorCoord = modelMatrix * vec4( position, 1.0 );\n\t\t\t\t\tworldPosition = mirrorCoord.xyzw;\n\t\t\t\t\tmirrorCoord = textureMatrix * mirrorCoord;\n\t\t\t\t\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t\t#include <beginnormal_vertex>\n\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t#include <fog_vertex>\n\t\t\t\t#include <shadowmap_vertex>\n\t\t\t}",fragmentShader:"\n\t\t\t\tuniform sampler2D mirrorSampler;\n\t\t\t\tuniform float alpha;\n\t\t\t\tuniform float time;\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float distortionScale;\n\t\t\t\tuniform sampler2D normalSampler;\n\t\t\t\tuniform vec3 sunColor;\n\t\t\t\tuniform vec3 sunDirection;\n\t\t\t\tuniform vec3 eye;\n\t\t\t\tuniform vec3 waterColor;\n\n\t\t\t\tvarying vec4 mirrorCoord;\n\t\t\t\tvarying vec4 worldPosition;\n\n\t\t\t\tvec4 getNoise( vec2 uv ) {\n\t\t\t\t\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n\t\t\t\t\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );\n\t\t\t\t\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n\t\t\t\t\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n\t\t\t\t\tvec4 noise = texture2D( normalSampler, uv0 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv1 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv2 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv3 );\n\t\t\t\t\treturn noise * 0.5 - 1.0;\n\t\t\t\t}\n\n\t\t\t\tvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n\t\t\t\t\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n\t\t\t\t\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );\n\t\t\t\t\tspecularColor += pow( direction, shiny ) * sunColor * spec;\n\t\t\t\t\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n\t\t\t\t}\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <packing>\n\t\t\t\t#include <bsdfs>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <lights_pars_begin>\n\t\t\t\t#include <shadowmap_pars_fragment>\n\t\t\t\t#include <shadowmask_pars_fragment>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\t\t\t\t\tvec4 noise = getNoise( worldPosition.xz * size );\n\t\t\t\t\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\n\n\t\t\t\t\tvec3 diffuseLight = vec3(0.0);\n\t\t\t\t\tvec3 specularLight = vec3(0.0);\n\n\t\t\t\t\tvec3 worldToEye = eye-worldPosition.xyz;\n\t\t\t\t\tvec3 eyeDirection = normalize( worldToEye );\n\t\t\t\t\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\n\t\t\t\t\tfloat distance = length(worldToEye);\n\n\t\t\t\t\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;\n\t\t\t\t\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );\n\n\t\t\t\t\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );\n\t\t\t\t\tfloat rf0 = 0.3;\n\t\t\t\t\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );\n\t\t\t\t\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;\n\t\t\t\t\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);\n\t\t\t\t\tvec3 outgoingLight = albedo;\n\t\t\t\t\tgl_FragColor = vec4( outgoingLight, alpha );\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <colorspace_fragment>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t}"},k=new st({name:R.name,uniforms:Qt.clone(R.uniforms),vertexShader:R.vertexShader,fragmentShader:R.fragmentShader,lights:!0,side:g,fog:m});k.uniforms.mirrorSampler.value=D.texture,k.uniforms.textureMatrix.value=M,k.uniforms.alpha.value=r,k.uniforms.time.value=o,k.uniforms.normalSampler.value=A,k.uniforms.sunColor.value=c,k.uniforms.waterColor.value=h,k.uniforms.sunDirection.value=l,k.uniforms.distortionScale.value=p,k.uniforms.eye.value=u,i.material=k,i.onBeforeRender=function(e,t,s){if(I.setFromMatrixPosition(i.matrixWorld),y.setFromMatrixPosition(s.matrixWorld),C.extractRotation(i.matrixWorld),b.set(0,0,1),b.applyMatrix4(C),x.subVectors(I,y),x.dot(b)>0)return;x.reflect(b).negate(),x.add(I),C.extractRotation(s.matrixWorld),E.set(0,0,-1),E.applyMatrix4(C),E.add(y),S.subVectors(I,E),S.reflect(b).negate(),S.add(I),T.position.copy(x),T.up.set(0,1,0),T.up.applyMatrix4(C),T.up.reflect(b),T.lookAt(S),T.far=s.far,T.updateMatrixWorld(),T.projectionMatrix.copy(s.projectionMatrix),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(T.projectionMatrix),M.multiply(T.matrixWorldInverse),f.setFromNormalAndCoplanarPoint(b,I),f.applyMatrix4(T.matrixWorldInverse),w.set(f.normal.x,f.normal.y,f.normal.z,f.constant);const n=T.projectionMatrix;Q.x=(Math.sign(w.x)+n.elements[8])/n.elements[0],Q.y=(Math.sign(w.y)+n.elements[9])/n.elements[5],Q.z=-1,Q.w=(1+n.elements[10])/n.elements[14],w.multiplyScalar(2/w.dot(Q)),n.elements[2]=w.x,n.elements[6]=w.y,n.elements[10]=w.z+1-a,n.elements[14]=w.w,u.setFromMatrixPosition(s.matrixWorld);const r=e.getRenderTarget(),o=e.xr.enabled,A=e.shadowMap.autoUpdate;i.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(D),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,T),i.visible=!0,e.xr.enabled=o,e.shadowMap.autoUpdate=A,e.setRenderTarget(r);const l=s.viewport;void 0!==l&&e.state.viewport(l)}}animate(){this.material.uniforms.time.value+=.1/60}}class sg extends X{constructor(){const e=sg.SkyShader,t=new st({name:e.name,uniforms:Qt.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:dt,depthWrite:!1});super(new We(1,1,1),t),this.isSky=!0}}sg.SkyShader={name:"SkyShader",uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new v},up:{value:new v(0,1,0)}},vertexShader:"\n\t\tuniform vec3 sunPosition;\n\t\tuniform float rayleigh;\n\t\tuniform float turbidity;\n\t\tuniform float mieCoefficient;\n\t\tuniform vec3 up;\n\n\t\tvarying vec3 vWorldPosition;\n\t\tvarying vec3 vSunDirection;\n\t\tvarying float vSunfade;\n\t\tvarying vec3 vBetaR;\n\t\tvarying vec3 vBetaM;\n\t\tvarying float vSunE;\n\n\t\t// constants for atmospheric scattering\n\t\tconst float e = 2.71828182845904523536028747135266249775724709369995957;\n\t\tconst float pi = 3.141592653589793238462643383279502884197169;\n\n\t\t// wavelength of used primaries, according to preetham\n\t\tconst vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n\t\t// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n\t\t// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n\t\tconst vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n\t\t// mie stuff\n\t\t// K coefficient for the primaries\n\t\tconst float v = 4.0;\n\t\tconst vec3 K = vec3( 0.686, 0.678, 0.666 );\n\t\t// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n\t\tconst vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n\t\t// earth shadow hack\n\t\t// cutoffAngle = pi / 1.95;\n\t\tconst float cutoffAngle = 1.6110731556870734;\n\t\tconst float steepness = 1.5;\n\t\tconst float EE = 1000.0;\n\n\t\tfloat sunIntensity( float zenithAngleCos ) {\n\t\t\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n\t\t\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n\t\t}\n\n\t\tvec3 totalMie( float T ) {\n\t\t\tfloat c = ( 0.2 * T ) * 10E-18;\n\t\t\treturn 0.434 * c * MieConst;\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\tvWorldPosition = worldPosition.xyz;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n\t\t\tvSunDirection = normalize( sunPosition );\n\n\t\t\tvSunE = sunIntensity( dot( vSunDirection, up ) );\n\n\t\t\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n\t\t\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n\t\t\t// extinction (absorbtion + out scattering)\n\t\t\t// rayleigh coefficients\n\t\t\tvBetaR = totalRayleigh * rayleighCoefficient;\n\n\t\t\t// mie coefficients\n\t\t\tvBetaM = totalMie( turbidity ) * mieCoefficient;\n\n\t\t}",fragmentShader:"\n\t\tvarying vec3 vWorldPosition;\n\t\tvarying vec3 vSunDirection;\n\t\tvarying float vSunfade;\n\t\tvarying vec3 vBetaR;\n\t\tvarying vec3 vBetaM;\n\t\tvarying float vSunE;\n\n\t\tuniform float mieDirectionalG;\n\t\tuniform vec3 up;\n\n\t\t// constants for atmospheric scattering\n\t\tconst float pi = 3.141592653589793238462643383279502884197169;\n\n\t\tconst float n = 1.0003; // refractive index of air\n\t\tconst float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\n\n\t\t// optical length at zenith for molecules\n\t\tconst float rayleighZenithLength = 8.4E3;\n\t\tconst float mieZenithLength = 1.25E3;\n\t\t// 66 arc seconds -> degrees, and the cosine of that\n\t\tconst float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n\t\t// 3.0 / ( 16.0 * pi )\n\t\tconst float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n\t\t// 1.0 / ( 4.0 * pi )\n\t\tconst float ONE_OVER_FOURPI = 0.07957747154594767;\n\n\t\tfloat rayleighPhase( float cosTheta ) {\n\t\t\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n\t\t}\n\n\t\tfloat hgPhase( float cosTheta, float g ) {\n\t\t\tfloat g2 = pow( g, 2.0 );\n\t\t\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n\t\t\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec3 direction = normalize( vWorldPosition - cameraPosition );\n\n\t\t\t// optical length\n\t\t\t// cutoff angle at 90 to avoid singularity in next formula.\n\t\t\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );\n\t\t\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n\t\t\tfloat sR = rayleighZenithLength * inverse;\n\t\t\tfloat sM = mieZenithLength * inverse;\n\n\t\t\t// combined extinction factor\n\t\t\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n\t\t\t// in scattering\n\t\t\tfloat cosTheta = dot( direction, vSunDirection );\n\n\t\t\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n\t\t\tvec3 betaRTheta = vBetaR * rPhase;\n\n\t\t\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );\n\t\t\tvec3 betaMTheta = vBetaM * mPhase;\n\n\t\t\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n\t\t\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n\t\t\t// nightsky\n\t\t\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n\t\t\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n\t\t\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n\t\t\tvec3 L0 = vec3( 0.1 ) * Fex;\n\n\t\t\t// composition + solar disc\n\t\t\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n\t\t\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n\t\t\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n\t\t\tvec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n\t\t\tgl_FragColor = vec4( retColor, 1.0 );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <colorspace_fragment>\n\n\t\t}"};var ng=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const ag=Symbol("justAddWater"),rg=Symbol("addSky"),og=Symbol("updateSun"),Ag=Symbol("animateEnvironment"),lg=Symbol("water"),cg=Symbol("sun"),hg=Symbol("sky"),ug=Symbol("pmremGenerator"),dg=Symbol("sceneEnv"),pg=Symbol("renderTarget");
/* @license
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var gg=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const mg=Symbol("modularControlsContainer"),fg=Symbol("selectedObject"),bg=Symbol("updateModularControls"),Ig=Symbol("worldToScreen"),yg=Symbol("selectObjectForControls"),Cg=Symbol("clearSelectedObject");var Eg=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const wg=Symbol("traverseAndToggleLights"),Bg=(e,t,i=2)=>{switch(t){case"ft":return((e,t=1)=>(3.28084*e).toFixed(t))(e,i);case"in":return((e,t=1)=>(39.3701*e).toFixed(t))(e,i);case"yd":return((e,t=1)=>(1.09361*e).toFixed(t))(e,i);case"mi":return((e,t=1)=>(621371e-9*e).toFixed(t))(e,i);case"cm":return((e,t=1)=>(100*e).toFixed(t))(e,i);case"mm":return((e,t=1)=>(1e3*e).toFixed(t))(e,i);default:return e.toFixed(i)}},vg=["front","front-right","right","back-right","back","back-left","left","front-left"],xg=2*Math.PI,Sg=Math.PI/4,Qg=Math.PI/2;var Mg=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const Tg=Symbol("measureContainer");let Dg=class extends M{constructor(e,t){super(),this.needsRender=null,this.element=null,this.scene=null,this.targetObject=null,this.worldPlacementPosition=new v,this.name="cursor",this.visible=!1,this.scene=e,this.targetObject=t,t.add(this),this.positionAtPlacementLevel()}getPosition(){return this.worldPlacementPosition.clone()}setVisible(e){this.visible=e,e&&this.element&&this.needsRender?this.startMouseTracking():this.stopMouseTracking()}setupMouseTracking(e,t){this.element=e,this.needsRender=t,this.visible&&this.startMouseTracking()}cleanup(){var e;this.stopMouseTracking(),this.visible=!1,this.element=null,null===(e=this.needsRender)||void 0===e||e.call(this),this.needsRender=null}positionAtPlacementLevel(){this.scene&&this.scene.boundingBox&&(this.position.y=this.scene.boundingBox.min.y)}startMouseTracking(){!this.mouseMoveHandler&&this.element&&(this.mouseMoveHandler=e=>{this.updatePosition(e.clientX,e.clientY,this.element,this.needsRender)},this.dragOverHandler=e=>{e.preventDefault(),this.updatePosition(e.clientX,e.clientY,this.element,this.needsRender)},this.element.addEventListener("mousemove",this.mouseMoveHandler),this.element.addEventListener("dragover",this.dragOverHandler))}stopMouseTracking(){this.mouseMoveHandler&&this.element&&(this.element.removeEventListener("mousemove",this.mouseMoveHandler),this.mouseMoveHandler=void 0),this.dragOverHandler&&this.element&&(this.element.removeEventListener("dragover",this.dragOverHandler),this.dragOverHandler=void 0)}updatePosition(e,t,i,s){var n;if(!this.scene)return;const a=i.getBoundingClientRect(),r=e-a.left,o=t-a.top,A=r/a.width*2-1,l=-o/a.height*2+1,c=new Ct;c.setFromCamera(new y(A,l),this.scene.camera);const h=this.scene.boundingBox?this.scene.boundingBox.min.y:0,u=c.ray,d=u.direction.y;if(Math.abs(d)>1e-4){const e=(h-u.origin.y)/d;if(e>0){const t=u.origin.clone().add(u.direction.clone().multiplyScalar(e));if(this.worldPlacementPosition.copy(t),this.targetObject){const e=t.clone();this.targetObject.worldToLocal(e),this.position.copy(e);const i=new v(0,(null===(n=this.scene.boundingBox)||void 0===n?void 0:n.min.y)||0,0);this.targetObject.worldToLocal(i),this.position.y=i.y+.01}else this.position.copy(t),this.position.y=h+.01;this.setVisible(!0)}else this.setVisible(!1)}else this.setVisible(!1);s()}};const Rg=.618;let kg=class extends Dg{constructor(e,t,i=.1){super(e,t),this.baseY=.01,this.elapsedTime=0,this.radius=i,this.group=new ie;const s=new V({color:16777215,metalness:.1,roughness:.3});this.shaft=this.createShaft(s),this.head=this.createHead(s),this.group.add(this.shaft),this.group.add(this.head),this.add(this.group),this.position.set(0,this.baseY,0)}setVisible(e){super.setVisible(e),e||this.stopAnimation()}cleanup(){this.clear(),this.stopAnimation(),super.cleanup()}createShaft(e){const t=this.radius*Rg,i=this.radius,s=.33*this.radius,n=new Float32Array([-t/2,i/2,s/2,t/2,i/2,s/2,-t/2,-i/2,s/2,t/2,-i/2,s/2,-t/2,i/2,-s/2,t/2,i/2,-s/2,-t/2,-i/2,-s/2,t/2,-i/2,-s/2]),a=new h;a.setAttribute("position",new Je(n,3)),a.setIndex([0,1,2,1,3,2,1,5,3,5,7,3,5,4,7,4,6,7,4,0,6,0,2,6,4,5,0,5,1,0]),a.computeVertexNormals();const r=new X(a,e);return r.castShadow=!0,r.receiveShadow=!0,r.position.y=i/2+this.radius*Rg,r}createHead(e){const t=this.radius,i=this.radius*Rg,s=.33*this.radius,n=this.radius*Rg,a=new Float32Array([-t/2,0,s/2,-n/2,0,s/2,n/2,0,s/2,t/2,0,s/2,0,-i,s/2,-t/2,0,-s/2,-n/2,0,-s/2,n/2,0,-s/2,t/2,0,-s/2,0,-i,-s/2]),r=new h;r.setAttribute("position",new Je(a,3)),r.setIndex([0,1,4,1,2,4,2,3,4,5,9,6,6,9,7,7,9,8,4,9,5,4,5,0,4,3,8,4,8,9,0,5,1,1,5,6,1,6,2,2,6,7,2,7,3,3,7,8,3,8,4,4,8,9]),r.computeVertexNormals();const o=new X(r,e);return o.castShadow=!0,o.receiveShadow=!0,o.position.y=i,o}tick(e,t){if(!this.visible)return;this.elapsedTime+=t,this.group.rotation.y=this.elapsedTime/1e3*ne.DEG2RAD*45;const i=.5*(Math.sin(this.elapsedTime/1500*2*Math.PI)+1)*(.2*this.radius);this.group.position.y=this.baseY+i,this.needsRender&&this.needsRender()}stopAnimation(){this.elapsedTime=0}};class Fg extends Dg{constructor(e,t,i=.1){super(e,t),this.baseRadius=.1,this.contourLine=null,this.darkContourLine=null,this.elapsedTime=0,this.mesh=null,this.radius=.1,this.radius=i,this.baseRadius=i,this.createCursorGeometry()}setRadius(e){e<=0?console.warn("Cursor radius must be greater than 0"):(this.radius=e,this.baseRadius=e,this.createCursorGeometry())}getRadius(){return this.radius}createCursorGeometry(){this.clear();const e=new Dt(this.radius,32),t=new J({color:16119285,transparent:!0,opacity:.5,depthTest:!1});this.mesh=new X(e,t),this.mesh.rotation.x=-Math.PI/2,this.mesh.position.set(0,.01,0),this.mesh.castShadow=!1,this.add(this.mesh);const i=new h,s=[];for(let e=0;e<=64;e++){const t=e/64*Math.PI*2;s.push(new v(Math.cos(t)*this.radius,0,Math.sin(t)*this.radius))}i.setFromPoints(s);const n=new q({color:13882323,transparent:!0,opacity:.8,depthTest:!1});this.contourLine=new ee(i,n),this.contourLine.position.set(0,.011,0),this.contourLine.castShadow=!1,this.add(this.contourLine);const a=new q({color:3355443,transparent:!0,opacity:.6,depthTest:!1});this.darkContourLine=new ee(i.clone(),a),this.darkContourLine.position.set(0,.012,0),this.darkContourLine.castShadow=!1,this.add(this.darkContourLine)}setVisible(e){super.setVisible(e),e||this.stopAnimation()}tick(e,t){if(!this.visible)return;this.elapsedTime+=t;const i=this.elapsedTime%1500/1500,s=.1*Math.sin(2*i*Math.PI);this.radius=this.baseRadius*(1+s),this.createCursorGeometry(),this.needsRender&&this.needsRender()}cleanup(){this.clear(),this.stopAnimation(),super.cleanup()}stopAnimation(){this.radius=this.baseRadius,this.elapsedTime=0}}
/* @license
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lg=function(e,t,i,s){for(var n,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,o=e.length-1;o>=0;o--)(n=e[o])&&(r=(a<3?n(r):a>3?n(t,i,r):n(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};const _g=Symbol("arrowCursor"),Pg=Symbol("discCursor"),Og=Symbol("updateCursors"),Ug=Symbol("getArrowCursorPosition"),Gg=Symbol("getDiscCursorPosition"),Ng=Symbol("setArrowCursorVisible"),jg=Symbol("setDiscCursorVisible"),Hg=Symbol("findTargetObject");let zg,qg,Vg,Kg;function Jg(e,t=1/0,i=null){qg||(qg=new Ye(2,2,1,1)),Vg||(Vg=new st({uniforms:{blitTexture:new Rt(e)},vertexShader:"\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main(){\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = vec4(position.xy * 1.0,0.,.999999);\n\t\t\t}",fragmentShader:"\n\t\t\tuniform sampler2D blitTexture; \n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main(){ \n\t\t\t\tgl_FragColor = vec4(vUv.xy, 0, 1);\n\t\t\t\t\n\t\t\t\t#ifdef IS_SRGB\n\t\t\t\tgl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );\n\t\t\t\t#else\n\t\t\t\tgl_FragColor = texture2D( blitTexture, vUv);\n\t\t\t\t#endif\n\t\t\t}"})),Vg.uniforms.blitTexture.value=e,Vg.defines.IS_SRGB=e.colorSpace==l,Vg.needsUpdate=!0,Kg||(Kg=new X(qg,Vg),Kg.frustumCulled=!1);const s=new se,n=new qe;n.add(Kg),null===i&&(i=zg=new it({antialias:!1}));const a=Math.min(e.image.width,t),r=Math.min(e.image.height,t);i.setSize(a,r),i.clear(),i.render(n,s);const o=document.createElement("canvas"),A=o.getContext("2d");o.width=a,o.height=r,A.drawImage(i.domElement,0,0,a,r);const c=new ft(o);return c.minFilter=e.minFilter,c.magFilter=e.magFilter,c.wrapS=e.wrapS,c.wrapT=e.wrapT,c.colorSpace=e.colorSpace,c.name=e.name,zg&&(zg.forceContextLoss(),zg.dispose(),zg=null),c}const Yg=/\ \([0-9]+\)$/,Wg={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Xg{constructor(){this.pluginCallbacks=[],this.register((function(e){return new Dm(e)})),this.register((function(e){return new Rm(e)})),this.register((function(e){return new Lm(e)})),this.register((function(e){return new _m(e)})),this.register((function(e){return new Pm(e)})),this.register((function(e){return new Om(e)})),this.register((function(e){return new km(e)})),this.register((function(e){return new Fm(e)})),this.register((function(e){return new Um(e)})),this.register((function(e){return new Gm(e)})),this.register((function(e){return new Nm(e)})),this.register((function(e){return new jm(e)})),this.register((function(e){return new Hm(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){const n=new Tm,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](n));n.setPlugins(a),n.write(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise((function(s,n){i.parse(e,s,n,t)}))}}const $g=0,Zg=1,em=2,tm=3,im=4,sm=5120,nm=5121,am=5122,rm=5123,om=5124,Am=5125,lm=5126,cm=34962,hm=34963,um=9728,dm=9729,pm=9984,gm=9985,mm=9986,fm=9987,bm=33071,Im=33648,ym=10497,Cm="KHR_mesh_quantization",Em={};Em[U]=um,Em[P]=pm,Em[L]=mm,Em[O]=dm,Em[_]=gm,Em[F]=fm,Em[j]=bm,Em[G]=ym,Em[N]=Im;const wm={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Bm=new d;function vm(e,t){return e.length===t.length&&e.every((function(e,i){return e===t[i]}))}function xm(e){return 4*Math.ceil(e/4)}function Sm(e,t=0){const i=xm(e.byteLength);if(i!==e.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<i;n++)s[n]=t;return s.buffer}return e}function Qm(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Mm(e,t){if(void 0!==e.toBlob)return new Promise((i=>e.toBlob(i,t)));let i;return"image/jpeg"===t?i=.92:"image/webp"===t&&(i=.8),e.convertToBlob({type:t,quality:i})}class Tm{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.LDExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,n=s.buffers,a=s.json;i=s.options;const r=s.extensionsUsed,o=s.extensionsRequired,A=new Blob(n,{type:"application/octet-stream"}),l=Object.keys(r),c=Object.keys(o);if(l.length>0&&(a.extensionsUsed=l),c.length>0&&(a.extensionsRequired=c),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=A.size),!0===i.binary){const e=new FileReader;e.readAsArrayBuffer(A),e.onloadend=function(){const i=Sm(e.result),s=new DataView(new ArrayBuffer(8));s.setUint32(0,i.byteLength,!0),s.setUint32(4,5130562,!0);const n=Sm((r=JSON.stringify(a),(new TextEncoder).encode(r).buffer),32);var r;const o=new DataView(new ArrayBuffer(8));o.setUint32(0,n.byteLength,!0),o.setUint32(4,1313821514,!0);const A=new ArrayBuffer(12),l=new DataView(A);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);const c=12+o.byteLength+n.byteLength+s.byteLength+i.byteLength;l.setUint32(8,c,!0);const h=new Blob([A,o,n,s,i],{type:"application/octet-stream"}),u=new FileReader;u.readAsArrayBuffer(h),u.onloadend=function(){t(u.result)}}}else if(a.buffers&&a.buffers.length>0){const e=new FileReader;e.readAsDataURL(A),e.onloadend=function(){const i=e.result;a.buffers[0].uri=i,t(a)}}else t(a)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const i=this.options,s=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&n.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],s[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.LDExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new v;for(let i=0,s=e.count;i<s;i++)if(Math.abs(t.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),s=new v;for(let e=0,t=i.count;e<t;e++)s.fromBufferAttribute(i,e),0===s.x&&0===s.y&&0===s.z?s.setX(1):s.normalize(),i.setXYZ(e,s.x,s.y,s.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const s={};0===t.offset.x&&0===t.offset.y||(s.offset=t.offset.toArray(),i=!0),0!==t.rotation&&(s.rotation=t.rotation,i=!0),1===t.repeat.x&&1===t.repeat.y||(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(e){return e.colorSpace===l?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.LDExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Ce&&(e=Jg(e)),t instanceof Ce&&(t=Jg(t));const s=e?e.image:null,n=t?t.image:null,a=Math.max(s?s.width:0,n?n.width:0),r=Math.max(s?s.height:0,n?n.height:0),o=Qm();o.width=a,o.height=r;const A=o.getContext("2d");A.fillStyle="#00ffff",A.fillRect(0,0,a,r);const c=A.getImageData(0,0,a,r);if(s){A.drawImage(s,0,0,a,r);const t=i(e),n=A.getImageData(0,0,a,r).data;for(let e=2;e<n.length;e+=4)c.data[e]=256*t(n[e]/256)}if(n){A.drawImage(n,0,0,a,r);const e=i(t),s=A.getImageData(0,0,a,r).data;for(let t=1;t<s.length;t+=4)c.data[t]=256*e(s[t]/256)}A.putImageData(c,0,0);const h=(e||t).clone();return h.source=new ze(o),h.colorSpace=Ee,h.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.LDExporter: UV channels for metalnessMap and roughnessMap textures must match."),h}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,s,n){const a=this.json;let r;switch(a.bufferViews||(a.bufferViews=[]),t){case sm:case nm:r=1;break;case am:case rm:r=2;break;default:r=4}let o=e.itemSize*r;n===cm&&(o=4*Math.ceil(o/4));const A=xm(s*o),l=new DataView(new ArrayBuffer(A));let c=0;for(let n=i;n<i+s;n++){for(let i=0;i<e.itemSize;i++){let s;e.itemSize>4?s=e.array[n*e.itemSize+i]:(0===i?s=e.getX(n):1===i?s=e.getY(n):2===i?s=e.getZ(n):3===i&&(s=e.getW(n)),!0===e.normalized&&(s=ne.normalize(s,e.array))),t===lm?l.setFloat32(c,s,!0):t===om?l.setInt32(c,s,!0):t===Am?l.setUint32(c,s,!0):t===am?l.setInt16(c,s,!0):t===rm?l.setUint16(c,s,!0):t===sm?l.setInt8(c,s):t===nm&&l.setUint8(c,s),c+=r}c%o!==0&&(c+=o-c%o)}const h={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:A};void 0!==n&&(h.target=n),n===cm&&(h.byteStride=o),this.byteOffset+=A,a.bufferViews.push(h);return{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise((function(s){const n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){const e=Sm(n.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,s(i.bufferViews.push(a)-1)}}))}processAccessor(e,t,i,s){const n=this.json;let a;if(e.array.constructor===Float32Array)a=lm;else if(e.array.constructor===Int32Array)a=om;else if(e.array.constructor===Uint32Array)a=Am;else if(e.array.constructor===Int16Array)a=am;else if(e.array.constructor===Uint16Array)a=rm;else if(e.array.constructor===Int8Array)a=sm;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.LDExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);a=nm}if(void 0===i&&(i=0),void 0!==s&&s!==1/0||(s=e.count),0===s)return null;const r=function(e,t,i){const s={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=t;n<t+i;n++)for(let t=0;t<e.itemSize;t++){let i;e.itemSize>4?i=e.array[n*e.itemSize+t]:(0===t?i=e.getX(n):1===t?i=e.getY(n):2===t?i=e.getZ(n):3===t&&(i=e.getW(n)),!0===e.normalized&&(i=ne.normalize(i,e.array))),s.min[t]=Math.min(s.min[t],i),s.max[t]=Math.max(s.max[t],i)}return s}(e,i,s);let o;void 0!==t&&(o=e===t.index?hm:cm);const A=this.processBufferView(e,a,i,s,o),l={bufferView:A.id,byteOffset:A.byteOffset,componentType:a,count:s,max:r.max,min:r.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(l.normalized=!0),n.accessors||(n.accessors=[]),n.accessors.push(l)-1}processImage(e,t,i,s="image/png"){if(null!==e){const n=this,a=n.cache,r=n.json,o=n.options,A=n.pending;a.images.has(e)||a.images.set(e,{});const l=a.images.get(e),c=s+":flipY/"+i.toString();if(void 0!==l[c])return l[c];r.images||(r.images=[]);const h={mimeType:s},u=Qm();u.width=Math.min(e.width,o.maxTextureSize),u.height=Math.min(e.height,o.maxTextureSize);const d=u.getContext("2d");if(!0===i&&(d.translate(0,u.height),d.scale(1,-1)),void 0!==e.data){t!==Se&&console.error("LDExporter: Only RGBAFormat is supported.",t),(e.width>o.maxTextureSize||e.height>o.maxTextureSize)&&console.warn("LDExporter: Image size is bigger than maxTextureSize",e);const i=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<i.length;t+=4)i[t+0]=e.data[t+0],i[t+1]=e.data[t+1],i[t+2]=e.data[t+2],i[t+3]=e.data[t+3];d.putImageData(new ImageData(i,e.width,e.height),0,0)}else{if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("THREE.LDExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");d.drawImage(e,0,0,u.width,u.height)}!0===o.binary?A.push(Mm(u,s).then((e=>n.processBufferViewImage(e))).then((e=>{h.bufferView=e}))):void 0!==u.toDataURL?h.uri=u.toDataURL(s):A.push(Mm(u,s).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{h.uri=e})));const p=r.images.push(h)-1;return l[c]=p,p}throw new Error("THREE.LDExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:Em[e.magFilter],minFilter:Em[e.minFilter],wrapS:Em[e.wrapS],wrapT:Em[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const t=this.options,i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);s.textures||(s.textures=[]),e instanceof Ce&&(e=Jg(e,t.maxTextureSize));let n=e.userData.mimeType;"image/webp"===n&&(n="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,n)};e.name&&(a.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,a)}));const r=s.textures.push(a)-1;return i.textures.set(e,r),r}processMaterial(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("LDExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("LDExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const n=e.color.toArray().concat([e.opacity]);if(vm(n,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),i={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(i,t),s.pbrMetallicRoughness.metallicRoughnessTexture=i}if(e.map){const t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),s.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(s.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),s.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),s.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),s.occlusionTexture=t}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),e.side===K&&(s.doubleSided=!0),""!==e.name&&(s.name=e.name),this.serializeUserData(e,s),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,s)}));const a=i.materials.push(s)-1;return t.materials.set(e,a),a}processMesh(e){const t=this.cache,i=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)s.push(e.material[t].uuid);else s.push(e.material.uuid);const n=s.join(":");if(t.meshes.has(n))return t.meshes.get(n);const a=e.geometry;let r;r=e.isLineSegments?Zg:e.isLineLoop?em:e.isLine?tm:e.isPoints?$g:e.material.wireframe?Zg:im;const o={},A={},l=[],c=[],h={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=a.getAttribute("normal");void 0===d||this.isNormalizedNormalAttribute(d)||(console.warn("THREE.LDExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let p=null;for(let e in a.attributes){if("morph"===e.slice(0,5))continue;const i=a.attributes[e];e=h[e]||e.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),t.attributes.has(this.getUID(i))){A[e]=t.attributes.get(this.getUID(i));continue}p=null;const s=i.array;"JOINTS_0"!==e||s instanceof Uint16Array||s instanceof Uint8Array||(console.warn('LDExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new u(new Uint16Array(s),i.itemSize,i.normalized));const n=this.processAccessor(p||i,a);null!==n&&(e.startsWith("_")||this.detectMeshQuantization(e,i),A[e]=n,t.attributes.set(this.getUID(i),n))}if(void 0!==d&&a.setAttribute("normal",d),0===Object.keys(A).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const i=[],s=[],n={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let r=0;r<e.morphTargetInfluences.length;++r){const o={};let A=!1;for(const e in a.morphAttributes){if("position"!==e&&"normal"!==e){A||(console.warn("LDExporter: Only POSITION and NORMAL morph are supported."),A=!0);continue}const i=a.morphAttributes[e][r],s=e.toUpperCase(),n=a.attributes[e];if(t.attributes.has(this.getUID(i,!0))){o[s]=t.attributes.get(this.getUID(i,!0));continue}const l=i.clone();if(!a.morphTargetsRelative)for(let e=0,t=i.count;e<t;e++)for(let t=0;t<i.itemSize;t++)0===t&&l.setX(e,i.getX(e)-n.getX(e)),1===t&&l.setY(e,i.getY(e)-n.getY(e)),2===t&&l.setZ(e,i.getZ(e)-n.getZ(e)),3===t&&l.setW(e,i.getW(e)-n.getW(e));o[s]=this.processAccessor(l,a),t.attributes.set(this.getUID(n,!0),o[s])}c.push(o),i.push(e.morphTargetInfluences[r]),void 0!==e.morphTargetDictionary&&s.push(n[r])}o.weights=i,s.length>0&&(o.extras={},o.extras.targetNames=s)}const g=Array.isArray(e.material);if(g&&0===a.groups.length)return null;let m=!1;if(g&&null===a.index){const e=[];for(let t=0,i=a.attributes.position.count;t<i;t++)e[t]=t;a.setIndex(e),m=!0}const f=g?e.material:[e.material],b=g?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,i=b.length;e<i;e++){const i={mode:r,attributes:A};if(this.serializeUserData(a,i),c.length>0&&(i.targets=c),null!==a.index){let s=this.getUID(a.index);void 0===b[e].start&&void 0===b[e].count||(s+=":"+b[e].start+":"+b[e].count),t.attributes.has(s)?i.indices=t.attributes.get(s):(i.indices=this.processAccessor(a.index,a,b[e].start,b[e].count),t.attributes.set(s,i.indices)),null===i.indices&&delete i.indices}const s=this.processMaterial(f[b[e].materialIndex]);null!==s&&(i.material=s),l.push(i)}!0===m&&a.setIndex(null),o.primitives=l,Yg.test(e.name)?o.name=e.name.split(" ").slice(0,-1).join(" "):o.name=e.name,i.meshes||(i.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,o)}));const I=i.meshes.push(o)-1;return t.meshes.set(n,I),I}detectMeshQuantization(e,t){if(this.extensionsUsed[Cm])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const s=e.split("_",1)[0];Wg[s]&&Wg[s].includes(i)&&(this.extensionsUsed[Cm]=!0,this.extensionsRequired[Cm]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:ne.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]);const n=(e=Xg.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],r=[];for(let e=0;e<n.length;++e){const i=n[e],o=Y.parseTrackName(i.name);let A=Y.findNode(t,o.nodeName);const l=wm[o.propertyName];if("bones"===o.objectName&&(A=!0===A.isSkinnedMesh?A.skeleton.getBoneByName(o.objectIndex):void 0),!A||!l)return console.warn('THREE.LDExporter: Could not export animation track "%s".',i.name),null;const c=1;let h,d=i.values.length/i.times.length;l===wm.morphTargetInfluences&&(d/=A.morphTargetInfluences.length),!0===i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=i.getInterpolation()===le?"STEP":"LINEAR",r.push({input:this.processAccessor(new u(i.times,c)),output:this.processAccessor(new u(i.values,d)),interpolation:h}),a.push({sampler:r.length-1,target:{node:s.get(A),path:l}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:r,channels:a}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,s=t.nodes[i.get(e)],n=e.skeleton;if(void 0===n)return null;const a=e.skeleton.bones[0];if(void 0===a)return null;const r=[],o=new Float32Array(16*n.bones.length),A=new B;for(let t=0;t<n.bones.length;++t)r.push(i.get(n.bones[t])),A.copy(n.boneInverses[t]),A.multiply(e.bindMatrix).toArray(o,16*t);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new u(o,16)),joints:r,skeleton:i.get(a)});return s.skin=t.skins.length-1}processNode(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const n={};if(i.trs){const t=e.quaternion.toArray(),i=e.position.toArray(),s=e.scale.toArray();vm(t,[0,0,0,1])||(n.rotation=t),vm(i,[0,0,0])||(n.translation=i),vm(s,[1,1,1])||(n.scale=s)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===vm(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let s=0,n=e.children.length;s<n;s++){const n=e.children[s];if(n.visible||!1===i.onlyVisible){const e=this.processNode(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,n)}));const a=t.nodes.push(n)-1;return s.set(e,a),a}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};""!==e.name&&(s.name=e.name),t.scenes.push(s);const n=[];for(let t=0,s=e.children.length;t<s;t++){const s=e.children[t];if(s.visible||!1===i.onlyVisible){const e=this.processNode(s);null!==e&&n.push(e)}}n.length>0&&(s.nodes=n),this.serializeUserData(e,s)}processObjects(e){const t=new qe;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const i=[];for(let t=0;t<e.length;t++)e[t]instanceof qe?this.processScene(e[t]):i.push(e[t]);i.length>0&&this.processObjects(i);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class Dm{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.LDExporter: Only directional, point, and spot lights are supported.",e);const i=this.writer,s=i.json,n=i.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.LDExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.LDExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},n[this.name]=!0);const r=s.extensions[this.name].lights;r.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:r.length-1}}}class Rm{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class km{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Fm{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Lm{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){const t={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class _m{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){const t={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}n.attenuationDistance=e.attenuationDistance,n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Pm{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const i=this.writer.extensionsUsed,s={};s.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class Om{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(Bm)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.specularIntensityMap){const t={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(t,e.specularIntensityMap),n.specularTexture=t}if(e.specularColorMap){const t={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(t,e.specularColorMap),n.specularColorTexture=t}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Um{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.sheenRoughnessMap){const t={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Gm{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.anisotropyMap){const t={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(t,e.anisotropyMap),n.anisotropyTexture=t}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Nm{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const i=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class jm{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.bumpMap){const t={index:i.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(t,e.bumpMap),n.bumpTexture=t}n.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Hm{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const i=this.writer,s=e,n=new Float32Array(3*s.count),a=new Float32Array(4*s.count),r=new Float32Array(3*s.count),o=new B,A=new v,l=new x,c=new v;for(let e=0;e<s.count;e++)s.getMatrixAt(e,o),o.decompose(A,l,c),A.toArray(n,3*e),l.toArray(a,4*e),c.toArray(r,3*e);const h={TRANSLATION:i.processAccessor(new u(n,3)),ROTATION:i.processAccessor(new u(a,4)),SCALE:i.processAccessor(new u(r,3))};s.instanceColor&&(h._COLOR_0=i.processAccessor(s.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:h},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}}Xg.Utils={insertKeyframe:function(e,t){const i=.001,s=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+s),r=e.createInterpolant(new e.ValueBufferType(s));let o;if(0===e.times.length){n[0]=t;for(let e=0;e<s;e++)a[e]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<i)return 0;n[0]=t,n.set(e.times,1),a.set(r.evaluate(t),0),a.set(e.values,s),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<i)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),a.set(e.values,0),a.set(r.evaluate(t),e.values.length),o=n.length-1}else for(let A=0;A<e.times.length;A++){if(Math.abs(e.times[A]-t)<i)return A;if(e.times[A]<t&&e.times[A+1]>t){n.set(e.times.slice(0,A+1),0),n[A+1]=t,n.set(e.times.slice(A+1),A+2),a.set(e.values.slice(0,(A+1)*s),0),a.set(r.evaluate(t),(A+1)*s),a.set(e.values.slice((A+1)*s),(A+2)*s),o=A+1;break}}return e.times=n,e.values=a,o},mergeMorphTargetTracks:function(e,t){const i=[],s={},n=e.tracks;for(let e=0;e<n.length;++e){let a=n[e];const r=Y.parseTrackName(a.name),o=Y.findNode(t,r.nodeName);if("morphTargetInfluences"!==r.propertyName||void 0===r.propertyIndex){i.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.LDExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.LDExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(ce)}const A=o.morphTargetInfluences.length,l=o.morphTargetDictionary[r.propertyIndex];if(void 0===l)throw new Error("THREE.LDExporter: Morph target name not found: "+r.propertyIndex);let c;if(void 0===s[o.uuid]){c=a.clone();const e=new c.ValueBufferType(A*c.times.length);for(let t=0;t<c.times.length;t++)e[t*A+l]=c.values[t];c.name=(r.nodeName||"")+".morphTargetInfluences",c.values=e,s[o.uuid]=c,i.push(c);continue}const h=a.createInterpolant(new a.ValueBufferType(1));c=s[o.uuid];for(let e=0;e<c.times.length;e++)c.values[e*A+l]=h.evaluate(c.times[e]);for(let e=0;e<a.times.length;e++){const t=this.insertKeyframe(c,a.times[e]);c.values[t*A+l]=a.values[e]}}return e.tracks=i,e}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
class zm{constructor(e){this.url=e}get unsafeUrl(){return this.url}}function qm(e){return t=new Blob([new Uint8Array(e)]),new zm(URL.createObjectURL(t));var t}const Vm=.2;function Km(e){const t=(new fe).setFromObject(e),i=t.getCenter(new v),s=t.getSize(new v),n=e.worldToLocal(i.clone());return[{position:{x:n.x,y:n.y,z:n.z+s.z/2},rotation:{x:0,y:0,z:0},attraction:Vm},{position:{x:n.x,y:n.y,z:n.z-s.z/2},rotation:{x:0,y:Math.PI,z:0},attraction:Vm},{position:{x:n.x+s.x/2,y:n.y,z:n.z},rotation:{x:0,y:Math.PI/2,z:0},attraction:Vm},{position:{x:n.x-s.x/2,y:n.y,z:n.z},rotation:{x:0,y:-Math.PI/2,z:0},attraction:Vm}]}function Jm(e,t){const i=new v(t.position.x,t.position.y,t.position.z);return e.localToWorld(i)}function Ym(e){var t;return e.userData.isSnappedGroup?e:(null===(t=e.parent)||void 0===t?void 0:t.userData.isSnappedGroup)?e.parent:null}function Wm(e,t){const{slotMap:i,owner:s,container:n,scene:a,camera:r,onUpdate:o,onCreate:A}=t,l=new Set;e.forEach((e=>{const{name:t,worldPosition:c}=e,h=c.clone();h.project(r);const u=a.width/2,d=a.height/2,p=h.x*u+u,g=-h.y*d+d;if(h.z<1&&p>=-50&&p<=a.width+50&&g>=-50&&g<=a.height+50){l.add(t);let a=i.get(t);a||(a=A(e),n?n.appendChild(a):s.appendChild(a),i.set(t,a)),a.style.display="block",a.style.position="absolute",a.style.left=p-a.offsetWidth/2+"px",a.style.top=g-a.offsetHeight/2+"px",a.style.zIndex="10",o(a,e)}})),i.forEach(((e,t)=>{l.has(t)||(e.style.display="none")}))}function Xm(e,t,i,s,n=null){const a=document.createElement("div");if(a.setAttribute("aria-hidden","true"),s&&i){const e=s.querySelector(`slot[name="${i}"]`);if(e){const t=e.assignedNodes({flatten:!0}).find((e=>{if(e.nodeType!==Node.ELEMENT_NODE)return!1;const t=e;return!("hidden"===t.style.visibility||"none"===t.style.display)}));if(t)return a.innerHTML=t.outerHTML,a;const i=e.innerHTML;if(i&&i.trim())return a.innerHTML=i,a}}return n&&(a.innerHTML=n),a}const $m=(e=>{var t,i;class s extends e{constructor(){super(...arguments),this.floatingControlsEnabled=!1,this[t]=null,this[i]=null}[(t=mg,i=fg,Fu)](){var e;super[Fu](),this[mg]=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector('slot[name="floating-control-strip"]')}[yg](e){this[fg]=e,this[bg]()}[Cg](){this[fg]=null,this[bg]()}[ku](e,t){super[ku](e,t),this.floatingControlsEnabled&&this[fg]&&this[bg]()}[Ig](e){const t=this[Du].width,i=this[Du].height,s=e.clone().project(this[Du].camera);return{x:(.5*s.x+.5)*t,y:(-.5*s.y+.5)*i}}[bg](){if(!this[mg]||!this.floatingControlsEnabled)return void(this[mg]&&(this[mg].style.display="none"));if(!this[fg])return void(this[mg].style.display="none");const e=(new fe).setFromObject(this[fg]),t=e.getCenter(new v).clone();t.y=e.min.y-.2;const i=this[Ig](t);t.clone().project(this[Du].camera).z<1?(this[mg].style.display="block",this[mg].style.position="absolute",this[mg].style.left=`${i.x}px`,this[mg].style.top=`${i.y}px`,this[mg].style.transform="translate(-50%, -50%)",this[mg].style.zIndex="100",this[mg].style.pointerEvents="auto"):this[mg].style.display="none",this[Ru]()}}return gg([ii({type:Boolean,attribute:"floating-controls-enabled"})],s.prototype,"floatingControlsEnabled",void 0),s})((e=>{class t extends e{constructor(){super(...arguments),this.floorArrowCursor=!1,this.floorDiscCursor=!1,this.floorArrowCursorSize=.5,this.floorDiscCursorSize=.5}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback(),this[_g]&&(this[_g].cleanup(),this[_g]=void 0),this[Pg]&&(this[Pg].cleanup(),this[Pg]=void 0)}updated(e){super.updated(e),(e.has("floorArrowCursor")||e.has("floorArrowCursorSize")||e.has("floorDiscCursor")||e.has("floorDiscCursorSize"))&&this[Og]()}getArrowCursorPosition(){return this[Ug]()}getDiscCursorPosition(){return this[Gg]()}setArrowCursorVisible(e){this[Ng](e)}setDiscCursorVisible(e){this[jg](e)}[Ug](){return this[_g]?this[_g].getPosition():null}[Gg](){return this[Pg]?this[Pg].getPosition():null}[Ng](e){this[_g]&&this[_g].setVisible(e)}[jg](e){this[Pg]&&this[Pg].setVisible(e)}[Hg](){let e;try{this[Du].traverse((t=>{if("Target"===t.name)throw e=t,new Error("found target object")}))}catch(e){if("found target object"!==e.message)throw e}return e}[Og](){try{const e=this[Du];if(!e)return;this[_g]&&(this[_g].cleanup(),this[_g].parent&&this[_g].parent.remove(this[_g]),this[_g]=void 0),this[Pg]&&(this[Pg].cleanup(),this[Pg].parent&&this[Pg].parent.remove(this[Pg]),this[Pg]=void 0);const t=this[Hg]();if(t){if(this.floorArrowCursor){const i=this.floorArrowCursorSize/2;this[_g]=new kg(e,t,i),this[_g].setVisible(!0),this[_g].setupMouseTracking(this,(()=>this[Ru]()))}if(this.floorDiscCursor){const i=this.floorDiscCursorSize/2;this[Pg]=new Fg(e,t,i),this[Pg].setVisible(!0),this[Pg].setupMouseTracking(this,(()=>this[Ru]()))}(this.floorArrowCursor||this.floorDiscCursor)&&this[Ru]()}}catch(e){console.warn("Error updating placement cursors:",e)}}[ku](e,t){super[ku](e,t),this[_g]&&this[_g].tick(e,t),this[Pg]&&this[Pg].tick(e,t)}}return Lg([ii({type:Boolean,attribute:"floor-arrow-cursor"})],t.prototype,"floorArrowCursor",void 0),Lg([ii({type:Boolean,attribute:"floor-disc-cursor"})],t.prototype,"floorDiscCursor",void 0),Lg([ii({type:Number,attribute:"floor-arrow-cursor-size"})],t.prototype,"floorArrowCursorSize",void 0),Lg([ii({type:Number,attribute:"floor-disc-cursor-size"})],t.prototype,"floorDiscCursorSize",void 0),t})((e=>{var t;class i extends e{constructor(){super(...arguments),this.measure=!1,this.measureObjects="",this.measurementUnit="m",this.measurementPrecision=2,this.measurementOverrides="",this.disableMeasurementLines=!1,this[t]=this.shadowRoot.querySelector(".slot.ld-measure"),this._measureWidthElement=null,this._measureHeightElement=null,this._measureDepthElement=null,this._widthElementAnchorIndex=-1,this._heightElementAnchorIndex=-1,this._depthElementAnchorIndex=-1,this._pointerDwn=[0,0],this._pointerUp=[0,0],this._lineGroups=[],this._lastClickedObject=null,this._lastCameraAngle="",this._extensionLineLength=.2,this._modelLoaded=!1}_worldToScreen(e){const t=this[Du].width,i=this[Du].height,s=e.clone().project(this[Du].camera);return{x:(.5*s.x+.5)*t,y:(-.5*s.y+.5)*i}}_updateMarkerVisibility(){if(!this._lineGroups.length||!this._lastCameraAngle.length)return;this._lineGroups.forEach((e=>{e.lines.forEach((e=>{e.visible=!1}))}));const e=[],[t,i,s,n,a,r,o,A,l,c,h,u]=this._lineGroups;switch(this._lastCameraAngle){case"front":e.push(s,h,i),this._widthElementAnchorIndex=2,this._heightElementAnchorIndex=10,this._depthElementAnchorIndex=1;break;case"front-right":e.push(s,r,i),this._widthElementAnchorIndex=2,this._heightElementAnchorIndex=5,this._depthElementAnchorIndex=1;break;case"right":e.push(t,l,i),this._widthElementAnchorIndex=0,this._heightElementAnchorIndex=8,this._depthElementAnchorIndex=1;break;case"back-right":e.push(t,u,i),this._widthElementAnchorIndex=0,this._heightElementAnchorIndex=11,this._depthElementAnchorIndex=1;break;case"back":e.push(t,o,n),this._widthElementAnchorIndex=0,this._heightElementAnchorIndex=6,this._depthElementAnchorIndex=3;break;case"back-left":e.push(t,c,n),this._widthElementAnchorIndex=0,this._heightElementAnchorIndex=9,this._depthElementAnchorIndex=3;break;case"left":e.push(s,a,n),this._widthElementAnchorIndex=2,this._heightElementAnchorIndex=4,this._depthElementAnchorIndex=3;break;case"front-left":e.push(s,A,n),this._widthElementAnchorIndex=2,this._heightElementAnchorIndex=7,this._depthElementAnchorIndex=3}this.disableMeasurementLines||e.forEach((e=>{e.lines.forEach((e=>{e.visible=!0}))})),this._updateMarkerPosition(),this[Ru]()}_parseMeasurementOverrides(){return this.measurementOverrides?this.measurementOverrides.split(",").map((e=>{const[t,i,s]=e.trim().split(" ").map(Number);return{w:t,h:i,d:s}})).filter((e=>e.w&&e.h&&e.d)):[]}_parseMeasureObjects(){return this.measureObjects.split(",").map((e=>e.trim())).filter((e=>e.length>0))}_updateMarkerText(e,t){if(!this._measureWidthElement||!this._measureHeightElement||!this._measureDepthElement)return;const i=this[Du],s=this.measurementUnit,n=this.measurementPrecision,a=this._parseMeasurementOverrides(),r=this._parseMeasureObjects();const[o,A,l]=function(){const s=e.getSize(new v);if(a.length&&!r.length&&t===i)return[a[0].w,a[0].h,a[0].d];if(a.length&&"*"!==r[0]&&1==r.length)return[a[0].w,a[0].h,a[0].d];if(a.length&&r.length){const e=r.indexOf(t.name);if(-1!==e&&a[e])return[a[e].w,a[e].h,a[e].d]}return[s.x,s.y,s.z]}();let c=null;c=Bg(o,s,n),this._measureWidthElement.textContent=`${c} ${s}`,this._measureWidthElement.style.display="block",this._measureWidthElement.setAttribute("aria-label",`Width: ${c} ${s}`),c=Bg(A,s,n),this._measureHeightElement.textContent=`${c} ${s}`,this._measureHeightElement.style.display="block",this._measureHeightElement.setAttribute("aria-label",`Height: ${c} ${s}`),c=Bg(l,s,n),this._measureDepthElement.textContent=`${c} ${s}`,this._measureDepthElement.style.display="block",this._measureDepthElement.setAttribute("aria-label",`Depth: ${c} ${s}`)}_updateMarkerPosition(){var e,t,i,s,n,a,r,o,A;if(-1===this._widthElementAnchorIndex||-1===this._heightElementAnchorIndex||-1===this._depthElementAnchorIndex)return;if(!this._lineGroups.length)return;const l=this[Du].width;if(-1!==this._widthElementAnchorIndex&&this._measureWidthElement){const i=this._lineGroups[this._widthElementAnchorIndex].lines[0],s=new v;i.geometry.computeBoundingBox(),null===(e=i.geometry.boundingBox)||void 0===e||e.getCenter(s),i.localToWorld(s);const n=this._worldToScreen(s),a=this._measureWidthElement.offsetWidth/2;n.x=Math.max(a,Math.min(n.x,l-a)),null===(t=this._measureWidthElement)||void 0===t||t.setAttribute("style",`left: ${n.x}px; top: ${n.y}px; transform: translate(-50%, -50%);`)}else null===(i=this._measureWidthElement)||void 0===i||i.setAttribute("style","display: none;");if(-1!==this._heightElementAnchorIndex&&this._measureHeightElement){const e=this._lineGroups[this._heightElementAnchorIndex].lines[0],t=new v;e.geometry.computeBoundingBox(),null===(s=e.geometry.boundingBox)||void 0===s||s.getCenter(t),e.localToWorld(t);const i=this._worldToScreen(t),a=this._measureHeightElement.offsetWidth/2;i.x=Math.max(a,Math.min(i.x,l-a)),null===(n=this._measureHeightElement)||void 0===n||n.setAttribute("style",`left: ${i.x}px; top: ${i.y}px; transform: translate(-50%, -50%);`)}else null===(a=this._measureHeightElement)||void 0===a||a.setAttribute("style","display: none;");if(-1!==this._depthElementAnchorIndex&&this._measureDepthElement){const e=this._lineGroups[this._depthElementAnchorIndex].lines[0],t=new v;e.geometry.computeBoundingBox(),null===(r=e.geometry.boundingBox)||void 0===r||r.getCenter(t),e.localToWorld(t);const i=this._worldToScreen(t),s=this._measureDepthElement.offsetWidth/2;i.x=Math.max(s,Math.min(i.x,l-s)),null===(o=this._measureDepthElement)||void 0===o||o.setAttribute("style",`left: ${i.x}px; top: ${i.y}px; transform: translate(-50%, -50%);`)}else null===(A=this._measureDepthElement)||void 0===A||A.setAttribute("style","display: none;")}_getBoundingBox(e,t){const i=new fe,s=this._parseMeasureObjects();if(0===s.length)return e.boundingBox;if(!s.includes("*")){let e=t;for(;e&&e.parent;){if(s.includes(e.name))return i.setFromObject(e),i;e=e.parent}return i}return i.expandByObject(t),i}_setExtensionLineLength(){const e=this[Du],t=new v;e.boundingBox.getSize(t);const i=Math.min(t.x,t.y,t.z);this._extensionLineLength=i/10}_clearMeasurements(e=!1){e&&(this._lastClickedObject=null);const t=this[Du];try{t.traverse((e=>{var t;if("ld-measurements"===e.name)throw null===(t=e.parent)||void 0===t||t.remove(e),new Error("Line parent found and removed")}))}catch(e){if("Line parent found and removed"!==e.message)throw e}this._lineGroups=[],this._measureWidthElement&&(this._measureWidthElement.style.display="none"),this._measureHeightElement&&(this._measureHeightElement.style.display="none"),this._measureDepthElement&&(this._measureDepthElement.style.display="none"),this[Ru]()}_getEdgeGroups(e,t,i,s){const n=e.map((e=>e.clone().applyMatrix4(s.matrixWorld)));return[[[n[0].clone().setZ(n[0].z-t-i),n[1].clone().setZ(n[1].z-t-i)],[n[0].clone().setZ(n[0].z-i),n[0].clone().setZ(n[0].z-t-i)],[n[1].clone().setZ(n[1].z-i),n[1].clone().setZ(n[1].z-t-i)]],[[n[1].clone().setX(n[1].x+t+i),n[5].clone().setX(n[5].x+t+i)],[n[1].clone().setX(n[1].x+i),n[1].clone().setX(n[1].x+t+i)],[n[5].clone().setX(n[5].x+i),n[5].clone().setX(n[5].x+t+i)]],[[n[4].clone().setZ(n[4].z+t+i),n[5].clone().setZ(n[5].z+t+i)],[n[4].clone().setZ(n[4].z+i),n[4].clone().setZ(n[4].z+t+i)],[n[5].clone().setZ(n[5].z+i),n[5].clone().setZ(n[5].z+t+i)]],[[n[0].clone().setX(n[0].x-t-i),n[4].clone().setX(n[4].x-t-i)],[n[0].clone().setX(n[0].x-i),n[0].clone().setX(n[0].x-t-i)],[n[4].clone().setX(n[4].x-i),n[4].clone().setX(n[4].x-t-i)]],[[n[0].clone().setZ(n[0].z-t-i),n[3].clone().setZ(n[3].z-t-i)],[n[0].clone().setZ(n[0].z-i),n[0].clone().setZ(n[0].z-t-i)],[n[3].clone().setZ(n[3].z-i),n[3].clone().setZ(n[3].z-t-i)]],[[n[1].clone().setZ(n[1].z-t-i),n[2].clone().setZ(n[2].z-t-i)],[n[1].clone().setZ(n[1].z-i),n[1].clone().setZ(n[1].z-t-i)],[n[2].clone().setZ(n[2].z-i),n[2].clone().setZ(n[2].z-t-i)]],[[n[1].clone().setX(n[1].x+t+i),n[2].clone().setX(n[2].x+t+i)],[n[1].clone().setX(n[1].x+i),n[1].clone().setX(n[1].x+t+i)],[n[2].clone().setX(n[2].x+i),n[2].clone().setX(n[2].x+t+i)]],[[n[5].clone().setX(n[5].x+t+i),n[6].clone().setX(n[6].x+t+i)],[n[5].clone().setX(n[5].x+i),n[5].clone().setX(n[5].x+t+i)],[n[6].clone().setX(n[6].x+i),n[6].clone().setX(n[6].x+t+i)]],[[n[5].clone().setZ(n[5].z+t+i),n[6].clone().setZ(n[6].z+t+i)],[n[5].clone().setZ(n[5].z+i),n[5].clone().setZ(n[5].z+t+i)],[n[6].clone().setZ(n[6].z+i),n[6].clone().setZ(n[6].z+t+i)]],[[n[4].clone().setZ(n[4].z+t+i),n[7].clone().setZ(n[7].z+t+i)],[n[4].clone().setZ(n[4].z+i),n[4].clone().setZ(n[4].z+t+i)],[n[7].clone().setZ(n[7].z+i),n[7].clone().setZ(n[7].z+t+i)]],[[n[4].clone().setX(n[4].x-t-i),n[7].clone().setX(n[7].x-t-i)],[n[4].clone().setX(n[4].x-i),n[4].clone().setX(n[4].x-t-i)],[n[7].clone().setX(n[7].x-i),n[7].clone().setX(n[7].x-t-i)]],[[n[0].clone().setX(n[0].x-t-i),n[3].clone().setX(n[3].x-t-i)],[n[0].clone().setX(n[0].x-i),n[0].clone().setX(n[0].x-t-i)],[n[3].clone().setX(n[3].x-i),n[3].clone().setX(n[3].x-t-i)]]]}_measureObject(e,t){this[sA];const i=this[Du];if(!t&&e===this._lastClickedObject)return;this._lastClickedObject=e,this._clearMeasurements();const s=this._getBoundingBox(i,e);if(s.min.equals(new v(1/0,1/0,1/0))||s.max.equals(new v(-1/0,-1/0,-1/0)))return void console.warn("Bounding box is empty.");const n=s.min.clone(),a=s.max.clone(),r=[new v(n.x,n.y,n.z),new v(a.x,n.y,n.z),new v(a.x,a.y,n.z),new v(n.x,a.y,n.z),new v(n.x,n.y,a.z),new v(a.x,n.y,a.z),new v(a.x,a.y,a.z),new v(n.x,a.y,a.z)].map((t=>e.worldToLocal(t.clone()))),o=new q({color:0});o.transparent=!0,o.opacity=.75,o.depthTest=!1;const A=this._extensionLineLength,l=A/2,c=this._getEdgeGroups(r,A,l,e),u=new M;u.name="ld-measurements";const d=(new B).copy(e.matrixWorld).invert();if(u.applyMatrix4(d),e===i){let e;try{i.traverse((t=>{if("Target"===t.name)throw e=t,new Error("found target object")}))}catch(e){if("found target object"!==e.message)throw e}e?e.add(u):(console.warn("Target object not found in the scene."),i.add(u))}else e.add(u);c.forEach((e=>{const t=[];e.forEach((e=>{const i=(new h).setFromPoints(e),s=new $(i,o);s.userData.noHit=!0,s.renderOrder=9999,s.visible=!1,u.add(s),t.push(s)})),this._lineGroups.push({lines:t})})),this._updateMarkerVisibility(),this._updateMarkerText(s,e)}_measureScene(){const e=this[Du];this._measureObject(e,!0)}objectFromPoint(e,t){const i=this[Du],s=i.getNDC(e,t),n=i.hitFromPoint(s);return(null==n?void 0:n.object)||null}_measureModelAtPoint(e,t){const i=this.objectFromPoint(e,t);i&&this._measureObject(i)}_handleCameraChange(){const{theta:e,phi:t}=this.getCameraOrbit(),i=(8+Math.floor((e%xg+Sg/2)/(Qg/2)))%8,s=vg[i];this._lastCameraAngle!==s&&(this._lastCameraAngle=s,this._updateMarkerVisibility()),this._updateMarkerPosition()}_findObjectByName(e){const t=this[Du];let i=null;try{t.traverse((t=>{if(t.name===e)throw i=t,new Error("Object found")}))}catch(e){if("Object found"!==e.message)throw e}return i}_handleClick(e){const{_pointerDwn:t,_pointerUp:i}=this;if(Math.hypot(i[0]-t[0],i[1]-t[1])>4)return;const s=this._parseMeasureObjects();this.measure&&s.length>0&&this._measureModelAtPoint(e.clientX,e.clientY)}_handleProgress(e){const t=e.detail.totalProgress,i=e.detail.reason;this._modelLoaded&&"model-load"===i&&t<1&&(this._modelLoaded=!1)}_handleLoad(){this._modelLoaded=!0,this._setExtensionLineLength(),this.handleNewAttributes()}handleNewAttributes(e=!1){this._clearMeasurements(e);if(!!this.measure){this._handleCameraChange();const e=this._parseMeasureObjects();if(this._lastClickedObject)this._measureObject(this._lastClickedObject,!0);else if(e.length){if(1==e.length){const t=this._findObjectByName(e[0]);t&&this._measureObject(t)}}else this._measureScene()}}updated(e){super.updated(e),this._modelLoaded&&(e.has("measure")||e.has("measureObjects")?this.handleNewAttributes(!0):(e.has("disableMeasurementLines")||e.has("measurementUnit")||e.has("measurementPrecision")||e.has("measurementOverrides"))&&this.measure&&this.handleNewAttributes())}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this._handleCameraChange),this.addEventListener("load",this._handleLoad),this.addEventListener("progress",this._handleProgress);const e=this.shadowRoot;if(e){const t=e.querySelector('slot[name="ruler-width"]'),i=e.querySelector('slot[name="ruler-height"]'),s=e.querySelector('slot[name="ruler-depth"]');if(t){const e=t.assignedNodes({flatten:!0});this._measureWidthElement=e.find((e=>e.nodeType===Node.ELEMENT_NODE))}if(i){const e=i.assignedNodes({flatten:!0});this._measureHeightElement=e.find((e=>e.nodeType===Node.ELEMENT_NODE))}if(s){const e=s.assignedNodes({flatten:!0});this._measureDepthElement=e.find((e=>e.nodeType===Node.ELEMENT_NODE))}}}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this._handleCameraChange),this.removeEventListener("load",this._handleLoad),this.removeEventListener("progress",this._handleProgress),this._measureWidthElement=null,this._measureHeightElement=null,this._measureDepthElement=null}[(t=Tg,Fu)](){super[Fu](),this.addEventListener("pointerdown",(e=>{this._pointerDwn=[e.offsetX,e.offsetY]})),this.addEventListener("pointerup",(e=>{this._pointerUp=[e.offsetX,e.offsetY]})),this.addEventListener("click",this._handleClick)}}return Mg([ii({type:Boolean,attribute:"measure"})],i.prototype,"measure",void 0),Mg([ii({type:String,attribute:"measure-objects"})],i.prototype,"measureObjects",void 0),Mg([ii({type:String,attribute:"measurement-unit"})],i.prototype,"measurementUnit",void 0),Mg([ii({type:String,attribute:"measurement-precision"})],i.prototype,"measurementPrecision",void 0),Mg([ii({type:String,attribute:"measurement-overrides"})],i.prototype,"measurementOverrides",void 0),Mg([ii({type:Boolean,attribute:"disable-measurement-lines"})],i.prototype,"disableMeasurementLines",void 0),i})((e=>{return class extends e{constructor(){super(...arguments),this.addedGLBs=new Set,this._modelLoaded=!1,this.selectedObjects=[],this.selectedGroups=new Set,this.isDragging=!1,this.dragStartPosition=new v,this.dragStartMousePosition=new y,this.dragOffset=new v,this.currentMousePosition=new y,this.floorPlane=new xt(new v(0,1,0),0),this.raycaster=new Ct,this.lastClickTime=0,this.lastClickPosition=new y,this.outlineEffect=null,this.snappingPointSpheres=new Set,this.snappingEnabled=!0,this.pendingSnapConnection=null,this.snappingPointSlots=new Map,this.snappingPointsVisible=!1,this.breakLinkSlots=new Map,this.breakLinkSlotsVisible=!1,this.rotationSlots=new Map,this.rotationSlotsVisible=!1,this.originalSensitivities={orbit:1,zoom:1,pan:1,input:1}}updateSnappingPointSlots(){var e;if(!this.snappingPointsVisible)return void this.snappingPointSlots.forEach((e=>{e.style.display="none"}));const t=this[Du],i=t.getCamera();if(!i)return;const s=[],n=this.findTargetObject();n&&n.traverse((e=>{if(e.userData.isPlacedObject&&e.userData.snappingPoints){e.userData.snappingPoints.forEach(((t,n)=>{if(t.isUsed)return;const a=new v(t.position.x,t.position.y,t.position.z),r=e.localToWorld(a.clone()),o=new Ze(t.rotation.x,t.rotation.y,t.rotation.z),A=new v(0,0,1).applyEuler(o).clone().transformDirection(e.matrixWorld),l=(new v).copy(i.position).sub(r).dot(A)>0;s.push({name:`${e.uuid}_${n}`,worldPosition:r,isFacingCamera:l})}))}})),Wm(s,{slotMap:this.snappingPointSlots,owner:this,container:null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".slot.ld-puzzler"),scene:t,camera:i,onCreate:e=>Xm(0,0,"snapping-point",this.shadowRoot,null),onUpdate:(e,t)=>{t.isFacingCamera?e.classList.remove("back-facing"):e.classList.add("back-facing")}})}setSnappingPointSlotsVisible(e){this.snappingPointsVisible=e,this.updateSnappingPointSlots()}clearSnappingPointSlots(){this.clearSlots(this.snappingPointSlots)}updateBreakLinkSlots(){var e;if(!this.breakLinkSlotsVisible||0===this.selectedObjects.length)return void this.breakLinkSlots.forEach((e=>{e.style.display="none"}));const t=this[Du],i=t.getCamera();if(!i)return;const s=this.selectedObjects[0];if(!s.userData.isSnappedGroup||!s.userData.snapConnections)return void this.breakLinkSlots.forEach((e=>{e.style.display="none"}));Wm(s.userData.snapConnections.map(((e,t)=>{const i=`connection-${t}`;if(!e.object1||!e.object2)return null;const s=Jm(e.object1,e.snapPoint1),n=Jm(e.object2,e.snapPoint2);return{name:i,worldPosition:(new v).addVectors(s,n).multiplyScalar(.5),data:{connectionId:i}}})).filter((e=>null!==e)),{slotMap:this.breakLinkSlots,owner:this,container:null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".slot.ld-puzzler"),scene:t,camera:i,onCreate:e=>{const t=Xm(0,0,"break-link",this.shadowRoot,null);return t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),this.breakSpecificConnection(e.data.connectionId)})),t},onUpdate:(e,t)=>{e.style.zIndex="20"}})}setBreakLinkSlotsVisible(e){this.breakLinkSlotsVisible=e,this.updateBreakLinkSlots()}clearBreakLinkSlots(){this.clearSlots(this.breakLinkSlots)}breakSpecificConnection(e){if(1!==this.selectedObjects.length)return;const t=this.selectedObjects[0];if(!t.userData.isSnappedGroup||!t.userData.snapConnections)return;const i=parseInt(e.replace("connection-","")),s=t.userData.snapConnections;if(i<0||i>=s.length)return;const n=s[i];n.snapPoint1&&(n.snapPoint1.isUsed=!1),n.snapPoint2&&(n.snapPoint2.isUsed=!1),s.splice(i,1),this.clearBreakLinkSlots(),this.setBreakLinkSlotsVisible(!1),0!==s.length?(this.reorganizeGroupAfterBreakLink(t,n),this[Ru]()):this.ungroupSelectedObject()}reorganizeGroupAfterBreakLink(e,t){const i=this.findTargetObject();if(!i)return;const s=e.userData.snapConnections,n=[];s.forEach((e=>{const t=e.object1,i=e.object2;let s=n.find((e=>e.has(t))),a=n.find((e=>e.has(i)));if(s&&a&&s!==a){a.forEach((e=>s.add(e)));const e=n.indexOf(a);n.splice(e,1)}else if(s)s.add(i);else if(a)a.add(t);else{const e=new Set([t,i]);n.push(e)}}));const a=[...e.children],r=new Map;if(a.forEach((e=>{const t=new v,i=new x,s=new v;e.getWorldPosition(t),e.getWorldQuaternion(i),e.getWorldScale(s),r.set(e,{position:t,quaternion:i,scale:s})})),a.forEach((e=>{if(!n.some((t=>t.has(e)))){const t=new Set([e]);n.push(t)}})),a.forEach((t=>e.remove(t))),e.parent&&e.parent.remove(e),this.selectedObjects=[],1===n.length){const e=new ie;e.name=`SnappedGroup_${Date.now()}`,e.userData.isSnappedGroup=!0,i.add(e),n[0].forEach((t=>{const i=r.get(t);if(i){e.add(t);const s=i.position.clone();e.worldToLocal(s),t.position.copy(s),t.quaternion.copy(i.quaternion),t.scale.copy(i.scale)}else e.add(t)})),e.userData.snapConnections=[...s],e.userData.isPlacedObject=!0,e.userData.meshes=[],e.traverse((t=>{"Mesh"===t.type&&"SnappingPointSphere"!==t.name&&e.userData.meshes.push(t)})),this.selectObject(e)}else if(n.length>1){let e=null;n.forEach((t=>{if(t.size>1){const n=new ie;n.name=`SnappedGroup_${Date.now()}`,n.userData.isSnappedGroup=!0,i.add(n),t.forEach((e=>{const t=r.get(e);if(t){n.add(e);const i=t.position.clone();n.worldToLocal(i),e.position.copy(i),e.quaternion.copy(t.quaternion),e.scale.copy(t.scale)}else n.add(e)}));const a=s.filter((e=>t.has(e.object1)&&t.has(e.object2)));n.userData.snapConnections=a,n.userData.isPlacedObject=!0,n.userData.meshes=[],n.traverse((e=>{"Mesh"===e.type&&"SnappingPointSphere"!==e.name&&n.userData.meshes.push(e)})),e||(e=n)}else{const s=t.values().next().value,n=r.get(s);if(n){i.add(s);const e=n.position.clone();i.worldToLocal(e),s.position.copy(e),s.quaternion.copy(n.quaternion),s.scale.copy(n.scale)}else i.add(s);s.userData.isPlacedObject=!0,delete s.userData.isInGroup,s.userData.meshes=[],s.traverse((e=>{"Mesh"===e.type&&"SnappingPointSphere"!==e.name&&s.userData.meshes.push(e)})),s.userData.snappingPoints=Km(s),e||(e=s)}})),e&&this.selectObject(e)}else a.forEach((e=>{const t=r.get(e);if(t){i.add(e);const s=t.position.clone();i.worldToLocal(s),e.position.copy(s),e.quaternion.copy(t.quaternion),e.scale.copy(t.scale)}else i.add(e);e.userData.isPlacedObject=!0,delete e.userData.isInGroup,e.userData.meshes=[],e.traverse((t=>{"Mesh"===t.type&&"SnappingPointSphere"!==t.name&&e.userData.meshes.push(t)})),e.userData.snappingPoints=Km(e)})),a.length>0&&this.selectObject(a[0]);setTimeout((()=>{this.setSnappingPointSlotsVisible(!0),this.updateSnappingPointSlots(),this.selectedObjects.length>0&&this.selectedObjects[0].userData.isSnappedGroup?(this.setBreakLinkSlotsVisible(!0),this.updateBreakLinkSlots()):this.setBreakLinkSlotsVisible(!1),this.dispatchEvent(new CustomEvent("render"))}),10)}updateShadowsWithGLBs(){if(this[Du].boundingBox&&this.addedGLBs.size>0){void 0===this.originalFloorY&&(this.originalFloorY=this[Du].boundingBox.min.y);const e=this[Du].boundingBox.clone();this.addedGLBs.forEach((t=>{e.expandByObject(t)})),e.min.y=this.originalFloorY,this[Du].boundingBox.copy(e),this[Du].boundingBox.getSize(this[Du].size),this[Du].updateShadow()}}async setSrcFromBuffer(e){try{const t=qm(e);this.setAttribute("src",t.url)}catch(e){console.error(e)}}_handleProgress(e){const t=e.detail.totalProgress,i=e.detail.reason;this._modelLoaded&&"model-load"===i&&t<1&&(this._modelLoaded=!1)}_handleLoad(){this._modelLoaded=!0}setupOutlineSystem(){this.outlineEffect=this.querySelector("outline-effect"),this.outlineEffect||console.warn("ld-puzzler: No outline-effect element found. Outline functionality will be disabled. Please add <outline-effect> inside your <model-viewer> element.")}updateOutlineSelection(){if(this.outlineEffect||this.setupOutlineSystem(),this.outlineEffect){if(this.selectedObjects.length>0){const e=this.collectMeshesFromObjects(this.selectedObjects);this.outlineEffect.selection=e,this.outlineEffect.setAttribute("blend-mode","default")}else this.outlineEffect.setAttribute("blend-mode","skip"),this.outlineEffect.selection=[];this[Ru]()}}collectMeshesFromObjects(e){const t=[];return e.forEach((e=>{if("Mesh"!==e.type||this.isSnappingPointMesh(e)){if("Group"===e.type||e.userData.isSnappedGroup)if(e.userData.meshes&&Array.isArray(e.userData.meshes)){const i=e.userData.meshes.filter((e=>!this.isSnappingPointMesh(e)));t.push(...i)}else e.traverse((e=>{"Mesh"!==e.type||this.isSnappingPointMesh(e)||t.push(e)}))}else t.push(e)})),t}isSnappingPointMesh(e){if("SnappingPointSphere"===e.name)return!0;let t=e.parent;for(;t;){if("SnappingPointSphere"===t.name)return!0;t=t.parent}return!1}selectObjects(e){this.deselectObject(),this.selectedObjects=[...e],e.forEach((e=>{"Group"===e.type&&this.selectedGroups.add(e)})),this.updateOutlineSelection(),this[sA]&&(this[sA].enablePan=!1),this[Ru]()}findTargetObject(){let e;try{this[Du].traverse((t=>{if("Target"===t.name)throw e=t,new Error("found target object")}))}catch(e){if("found target object"!==e.message)throw e}return e}positionModelAtFloor(e,t=0){if(!this[Du]||!this[Du].boundingBox)return;void 0===this.originalFloorY&&(this.originalFloorY=this[Du].boundingBox.min.y);const i=(new fe).setFromObject(e),s=this.originalFloorY-i.min.y+t;e.position.y+=s}removeObject3D(e){return e instanceof M&&(e.geometry&&e.geometry.dispose(),e.material&&(e.material instanceof Array?e.material.forEach((e=>e.dispose())):e.material.dispose()),e.removeFromParent(),!0)}deleteObject(e){try{this.deselectObject(),e.userData.isPlacedObject&&this.addedGLBs.delete(e),this.removeObject3D(e),this[Du].updateShadow(),this[Ru]()}catch(e){console.error("Error deleting object:",e)}}deleteObjectByFileName(e){try{this[Du].traverse((t=>{var i;if((null===(i=t.userData)||void 0===i?void 0:i.filename)===e)throw this.deleteObject(t),new Error("Object deleted")}))}catch(e){if("Object deleted"!==e.message)throw e}}deleteSelected(){0!==this.selectedObjects.length&&this.selectedObjects.forEach((e=>{this.deleteObject(e)}))}async rotateSelected(e){if(0===this.selectedObjects.length)return;const t=this.selectedObjects[0];this.rotateObject(ne.degToRad(e),t)}async placeGLB(e,t={}){var i;this.deselectObject();const s=new Is,n=this.findTargetObject(),a=this.createVisualizationBox({x:1,y:1,z:1},null!==(i=t.position)&&void 0!==i?i:{x:0,y:0,z:0});return n.add(a),new Promise(((i,a)=>{s.load(e,(s=>{const r=t.name||`part__${Math.random().toString(36).substring(2,9)}`;s.scene.name="part__"+r,s.scene.userData.filepath=e,s.scene.userData.name=r;const o=this.parseNameMetadata(r);s.scene.userData=Object.assign(Object.assign({},s.scene.userData),{isPlacedObject:!0,groupId:o.groupId,tags:o.tags,instanceId:o.instanceId,placedAt:Date.now()}),t.snappingPoints&&t.snappingPoints.length>0?s.scene.userData.snappingPoints=t.snappingPoints:s.scene.userData.needsDefaultSnappingPoints=!0;const A=[];if(s.scene.traverse((e=>{"Mesh"===e.type&&A.push(e)})),s.scene.userData.meshes=A,n){let e;if(t.position){void 0===this.originalFloorY&&(this.originalFloorY=this[Du].boundingBox?this[Du].boundingBox.min.y:0);const i=this.originalFloorY,s=t.floorOffset||0;e={x:t.position.x,y:i+s,z:t.position.z}}else this.positionModelAtFloor(s.scene,t.floorOffset||0),e={x:s.scene.position.x,y:s.scene.position.y,z:s.scene.position.z};const a=e.y+.5;s.scene.position.set(e.x,a,e.z),n.add(s.scene),this.addedGLBs.add(s.scene),this.outlineEffect||this.setupOutlineSystem(),this.updateShadowsWithGLBs(),this[Ru]();const r=t.mass||1;((e,t,i,s=1,n,a)=>{const r=Math.abs(t-i);if(r<=.001)return e.position.y=i,n(),void(a&&a());const o=1e3*Math.sqrt(2*r/10),A=Math.max(.7,Math.min(1.3,1/Math.sqrt(s))),l=Math.max(200,Math.min(1e3,o*A)),c=performance.now(),h=s=>{const o=s-c,A=Math.min(o/l,1),u=A*A,d=t>i?t-r*u:t+r*u;e.position.y=t>i?Math.max(d,i):Math.min(d,i),n(),A<1?requestAnimationFrame(h):(e.position.y=i,n(),a&&a())};requestAnimationFrame(h)})(s.scene,a,e.y,r,(()=>{this.updateShadowsWithGLBs(),this[Ru]()}),(()=>{s.scene.userData.needsDefaultSnappingPoints&&(s.scene.userData.snappingPoints=Km(s.scene),delete s.scene.userData.needsDefaultSnappingPoints),this.updateShadowsWithGLBs(),this[Ru]()})),i()}else a()}),(e=>{if(e.loaded===e.total){const e=n.children.find((e=>"VisualizationBox"===e.name));e&&e instanceof X&&this.fadeOutVisualizationBox(e,300,(()=>{n.remove(e)}))}}),(e=>{console.error("Error loading GLB:",e),a(e)}))}))}deDraco(e){return new Promise((t=>{const i=new Is,s=new ms;s.setDecoderPath("https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/libs/draco/"),i.setDRACOLoader(s),i.parse(e,"",(i=>{if(i.scene){i.scene.traverse((e=>{e.userData.name&&(e.name=e.userData.name)}));(new Xg).parse(i.scene.children,(e=>{t(e)}),(function(e){console.error(e)}),{binary:!0})}else t(e)}),(e=>{console.error(e)}))}))}hideCustomSnappingPointSlots(){this.querySelectorAll('[slot="snapping-point"]').forEach((e=>{const t=e;t.dataset.originalDisplay=t.style.display||"",t.style.visibility="hidden",t.style.position="absolute",t.style.left="-9999px"}))}setupDragHandlers(){this.addEventListener("mousedown",this.onMouseDown.bind(this)),this.addEventListener("mousemove",this.onMouseMove.bind(this)),this.addEventListener("mouseup",this.onMouseUp.bind(this)),this.addEventListener("touchstart",this.onTouchStart.bind(this)),this.addEventListener("touchmove",this.onTouchMove.bind(this)),this.addEventListener("touchend",this.onTouchEnd.bind(this)),this.addEventListener("contextmenu",(e=>e.preventDefault()))}onMouseDown(e){if(0!==e.button)return;if(this.updateMousePosition(e),this.lastClickTime=performance.now(),this.lastClickPosition.copy(this.currentMousePosition),this.selectedObjects.length){if(this.selectedObjects.some((e=>this.isPointOnObject(this.currentMousePosition,e))))return e.stopImmediatePropagation(),e.preventDefault(),void this.startDragging(e)}this.getPartObjectAtPosition(this.currentMousePosition)&&(e.stopImmediatePropagation(),e.preventDefault())}onMouseMove(e){this.updateMousePosition(e),this.isDragging&&this.selectedObjects.length&&this.updateDragPosition()}onMouseUp(e){if(this.isDragging)this.stopDragging();else{const t=performance.now()-this.lastClickTime,i=this.currentMousePosition.distanceTo(this.lastClickPosition);if(t<300&&i<5){this.getPartObjectAtPosition(this.currentMousePosition)?this.handleSelection(e):this.deselectObject()}}}onTouchStart(e){if(1===e.touches.length){const t=e.touches[0];if(this.updateMousePositionFromTouch(t),this.lastClickTime=performance.now(),this.lastClickPosition.copy(this.currentMousePosition),this.selectedObjects.length){if(this.selectedObjects.some((e=>this.isPointOnObject(this.currentMousePosition,e))))return e.stopImmediatePropagation(),e.preventDefault(),void this.startDragging()}this.getPartObjectAtPosition(this.currentMousePosition)&&(e.stopImmediatePropagation(),e.preventDefault())}}onTouchMove(e){if(1===e.touches.length&&this.isDragging){const t=e.touches[0];this.updateMousePositionFromTouch(t),this.updateDragPosition(),e.preventDefault()}}onTouchEnd(e){if(this.isDragging)this.stopDragging();else if(1===e.changedTouches.length){const t=e.changedTouches[0];this.updateMousePositionFromTouch(t);const i=performance.now()-this.lastClickTime,s=this.currentMousePosition.distanceTo(this.lastClickPosition);i<300&&s<5&&this.handleSelection()}}updateMousePosition(e){const t=this.getBoundingClientRect();this.currentMousePosition.x=(e.clientX-t.left)/t.width*2-1,this.currentMousePosition.y=-(e.clientY-t.top)/t.height*2+1}updateMousePositionFromTouch(e){const t=this.getBoundingClientRect();this.currentMousePosition.x=(e.clientX-t.left)/t.width*2-1,this.currentMousePosition.y=-(e.clientY-t.top)/t.height*2+1}isPointOnObject(e,t){this.raycaster.setFromCamera(e,this[Du].camera);return this.raycaster.intersectObject(t,!0).length>0}getPartObjectAtPosition(e){this.raycaster.setFromCamera(e,this[Du].camera);const t=this.findTargetObject();if(!t)return null;const i=[];t.traverse((e=>{e.name&&e.name.startsWith("part__")&&i.push(e)}));const s=this.raycaster.intersectObjects(i,!0);if(s.length>0){let e=s[0].object;for(;e.parent&&!e.name.startsWith("part__");)e=e.parent;if(e.name&&e.name.startsWith("part__"))return e}return null}startDragging(e){if(!this.selectedObjects.length)return;this.isDragging=!0,this.dragStartMousePosition.copy(this.currentMousePosition),this.dragStartPosition.copy(this.selectedObjects[0].position),this.raycaster.setFromCamera(this.currentMousePosition,this[Du].camera),void 0!==this.originalFloorY&&(this.floorPlane.constant=-this.originalFloorY);const t=new v;this.raycaster.ray.intersectPlane(this.floorPlane,t)?this.dragOffset.set(this.selectedObjects[0].position.x-t.x,0,this.selectedObjects[0].position.z-t.z):this.dragOffset.set(0,0,0),this[sA]&&(this.originalSensitivities.orbit=this[sA].orbitSensitivity,this.originalSensitivities.zoom=this[sA].zoomSensitivity,this.originalSensitivities.pan=this[sA].panSensitivity,this.originalSensitivities.input=this[sA].inputSensitivity,this[sA].orbitSensitivity=0,this[sA].zoomSensitivity=0,this[sA].panSensitivity=0,this[sA].inputSensitivity=0),this.style.cursor="grabbing"}updateDragPosition(){if(!this.isDragging||0===this.selectedObjects.length)return;this.raycaster.setFromCamera(this.currentMousePosition,this[Du].camera);const e=this.selectedObjects[0],t=new v;if(this.raycaster.ray.intersectPlane(this.floorPlane,t)){const i=t.x+this.dragOffset.x,s=t.z+this.dragOffset.z,n=e.userData.isSnappedGroup?e.position.y:this.originalFloorY||0;e.position.set(i,n,s),this.pendingSnapConnection=null,this.snappingEnabled&&this.checkAndApplySnapping(e,t),this[Du].updateShadow(),this[Ru]()}}checkAndApplySnapping(e,t){const i=[];if(e.userData.isSnappedGroup?e.traverse((e=>{e.userData.isPlacedObject&&e.userData.snappingPoints&&i.push(e)})):e.userData.snappingPoints&&i.push(e),0===i.length)return;const s=this.findTargetObject();if(!s)return;let n=null;if(i.forEach((e=>{s.traverse((t=>{if(t.userData.isPlacedObject&&t!==e&&!this.areObjectsInSameGroup(e,t)&&t.userData.snappingPoints){const i=function(e,t){if(!e.userData.snappingPoints||!t.userData.snappingPoints)return[];const i=e.userData.snappingPoints,s=t.userData.snappingPoints,n=[];return i.forEach((i=>{i.isUsed||s.forEach((s=>{var a,r;if(s.isUsed)return;const o=Jm(e,i),A=Jm(t,s),l=o.distanceTo(A),c=null!==(a=i.attraction)&&void 0!==a?a:Vm,h=null!==(r=s.attraction)&&void 0!==r?r:Vm;l<=Math.max(c,h)&&n.push({draggedPoint:i,targetPoint:s,distance:l})}))})),n.sort(((e,t)=>e.distance-t.distance))}(e,t);if(i.length>0){const s=i[0];(!n||s.distance<n.distance)&&(n={draggedObject:e,targetObject:t,draggedPoint:s.draggedPoint,targetPoint:s.targetPoint,distance:s.distance})}}}))})),n){const t=Jm(n.draggedObject,n.draggedPoint),i=Jm(n.targetObject,n.targetPoint).sub(t);e.position.add(i),this.pendingSnapConnection={draggedObject:n.draggedObject,targetObject:n.targetObject,draggedPoint:n.draggedPoint,targetPoint:n.targetPoint}}}areObjectsInSameGroup(e,t){const i=Ym(e),s=Ym(t);return null!==i&&i===s}stopDragging(){this.isDragging&&(this.isDragging=!1,this.pendingSnapConnection&&(this.completeSnapConnection(this.pendingSnapConnection),this.pendingSnapConnection=null),this[sA]&&(this[sA].orbitSensitivity=this.originalSensitivities.orbit,this[sA].zoomSensitivity=this.originalSensitivities.zoom,this[sA].panSensitivity=this.originalSensitivities.pan,this[sA].inputSensitivity=this.originalSensitivities.input),this.style.cursor="")}completeSnapConnection(e){const t=Ym(e.draggedObject),i=Ym(e.targetObject);if(t||e.draggedObject,i||e.targetObject,t&&i)this.mergeSnappedGroups(t,i,e);else if(t&&!i)this.addObjectToSnappedGroup(t,e.targetObject,e);else if(!t&&i)this.addObjectToSnappedGroup(i,e.draggedObject,e);else{const t=function(e,t,i,s){const n=new ie;n.name=`SnappedGroup_${Date.now()}`,n.userData.isSnappedGroup=!0,n.userData.snapConnections=[{object1:e,object2:t,snapPoint1:Object.assign({},i),snapPoint2:Object.assign({},s)}];const a=e.parent;return a&&(a.remove(e),a.remove(t),a.add(n)),n.add(e),n.add(t),n.userData=Object.assign(Object.assign({},e.userData),n.userData),n.userData.isPlacedObject=!0,delete n.userData.snappingPoints,e.userData.isInGroup=!0,t.userData.isInGroup=!0,n.userData.meshes=[],n.traverse((e=>{"Mesh"!==e.type||function(e){if("SnappingPointSphere"===e.name)return!0;let t=e.parent;for(;t;){if("SnappingPointSphere"===t.name)return!0;t=t.parent}return!1}(e)||n.userData.meshes.push(e)})),n}(e.draggedObject,e.targetObject,e.draggedPoint,e.targetPoint);this.selectedObjects=[t]}this.updateOutlineSelection();this.findTargetObject()&&(this.setSnappingPointSlotsVisible(!1),this.setSnappingPointSlotsVisible(!0)),this.selectedObjects.length>0&&this.selectedObjects[0].userData.isSnappedGroup&&this.setBreakLinkSlotsVisible(!0),this[Ru]()}mergeSnappedGroups(e,t,i){[...t.children].forEach((i=>{const s=new v,n=new x,a=new v;i.getWorldPosition(s),i.getWorldQuaternion(n),i.getWorldScale(a),t.remove(i),e.add(i),e.worldToLocal(s),i.position.copy(s),i.quaternion.copy(n),i.scale.copy(a)})),e.userData.snapConnections||(e.userData.snapConnections=[]),e.userData.snapConnections.push({object1:i.draggedObject,object2:i.targetObject,snapPoint1:Object.assign({},i.draggedPoint),snapPoint2:Object.assign({},i.targetPoint)}),t.userData.snapConnections&&e.userData.snapConnections.push(...t.userData.snapConnections),i.draggedPoint.isUsed=!0,i.targetPoint.isUsed=!0,t.parent&&t.parent.remove(t),this.updateGroupMeshCache(e),this.selectedObjects=[e]}addObjectToSnappedGroup(e,t,i){const s=new v,n=new x,a=new v;t.getWorldPosition(s),t.getWorldQuaternion(n),t.getWorldScale(a),t.parent&&t.parent.remove(t),e.add(t),e.worldToLocal(s),t.position.copy(s),t.quaternion.copy(n),t.scale.copy(a),e.userData.snapConnections||(e.userData.snapConnections=[]),e.userData.snapConnections.push({object1:i.draggedObject,object2:i.targetObject,snapPoint1:Object.assign({},i.draggedPoint),snapPoint2:Object.assign({},i.targetPoint)}),i.draggedPoint.isUsed=!0,i.targetPoint.isUsed=!0,this.updateGroupMeshCache(e),this.selectedObjects=[e]}updateGroupMeshCache(e){e.userData.isSnappedGroup&&(e.userData.meshes=[],e.traverse((t=>{"Mesh"!==t.type||this.isSnappingPointMesh(t)||e.userData.meshes.push(t)})))}handleSelection(e){const t=this.getPartObjectAtPosition(this.currentMousePosition);if(t){const e=Ym(t)||t;1===this.selectedObjects.length&&this.selectedObjects[0]===e?this.deselectObject():this.selectObject(e)}else this.deselectObject()}selectObject(e){this.deselectObject(),this.selectedObjects=[e],this.updateOutlineSelection();this.findTargetObject()&&this.setSnappingPointSlotsVisible(!0),this.selectedObjects.length>0&&this.selectedObjects[0].userData.isSnappedGroup&&this.setBreakLinkSlotsVisible(!0),this[sA]&&(this[sA].enablePan=!1),this[yg](e),this[Ru]()}deselectObject(){if(this.selectedObjects.length>0){this.selectedObjects=[],this.selectedGroups.clear(),this.updateOutlineSelection();this.findTargetObject()&&this.setSnappingPointSlotsVisible(!1),this.isAnimatingRotation&&(this.isAnimatingRotation=!1,this.rotationAnimation=null),this.setBreakLinkSlotsVisible(!1),this[yg](null),this[Ru]()}this[sA]&&(this[sA].enablePan=!0)}getObjectsByGroupId(e){const t=[],i=this.findTargetObject();return i?(i.traverse((i=>{i.userData.groupId===e&&i.userData.isPlacedObject&&t.push(i)})),t):t}getObjectsByTags(e){const t=[],i=this.findTargetObject();return i?(i.traverse((i=>{if(i.userData.isPlacedObject&&i.userData.tags){e.some((e=>i.userData.tags.includes(e)))&&t.push(i)}})),t):t}selectObjectsByGroupId(e){const t=this.getObjectsByGroupId(e);t.length>0&&this.selectObjects(t)}parseNameMetadata(e){const t=e.match(/^([^#]+)#([^_]+)_(.+)$/);if(t)return{groupId:t[1],tags:[t[2]],instanceId:t[3]};const i=e.match(/^(.+)_([^_]+)$/);return i?{groupId:i[1],tags:[],instanceId:i[2]}:{groupId:e,tags:[],instanceId:""}}connectedCallback(){super.connectedCallback(),this.addEventListener("load",this._handleLoad),this.addEventListener("progress",this._handleProgress),"undefined"!=typeof window&&(window.deDraco=this.deDraco),this.hideCustomSnappingPointSlots(),this.setupDragHandlers()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("load",this._handleLoad),this.removeEventListener("progress",this._handleProgress),this.removeEventListener("mousedown",this.onMouseDown.bind(this)),this.removeEventListener("mousemove",this.onMouseMove.bind(this)),this.removeEventListener("mouseup",this.onMouseUp.bind(this)),this.removeEventListener("touchstart",this.onTouchStart.bind(this)),this.removeEventListener("touchmove",this.onTouchMove.bind(this)),this.removeEventListener("touchend",this.onTouchEnd.bind(this)),this.deselectObject(),this.isAnimatingRotation&&(this.isAnimatingRotation=!1,this.rotationAnimation=null);this.findTargetObject()&&(this.clearSlots(this.snappingPointSlots),this.clearSlots(this.breakLinkSlots))}setSnappingEnabled(e){this.snappingEnabled=e}getSnappingEnabled(){return this.snappingEnabled}ungroupSelectedObject(){if(1!==this.selectedObjects.length)return!1;const e=this.selectedObjects[0];return!!e.userData.isSnappedGroup&&this.ungroupSnappedGroup(e)}ungroupSnappedGroup(e){if(!e.userData.snapConnections)return!1;const t=this.findTargetObject(),i=[...e.children],s=[];return i.forEach((i=>{const n=new v,a=new x,r=new v;i.getWorldPosition(n),i.getWorldQuaternion(a),i.getWorldScale(r),e.remove(i),t&&(t.add(i),t.worldToLocal(n),i.position.copy(n),i.quaternion.copy(a),i.scale.copy(r),i.userData.isPlacedObject=!0,delete i.userData.isInGroup,i.userData.snappingPoints||(i.userData.snappingPoints=Km(i)),s.push(i))})),e.parent&&e.parent.remove(e),s.length>0?(this.selectObject(s[0]),setTimeout((()=>{this.setSnappingPointSlotsVisible(!0),this.updateSnappingPointSlots()}),10)):this.deselectObject(),this[Ru](),!0}createVisualizationBox(e,t){const i=new Ye(e.x,e.z),s=new J({color:16777215,transparent:!0,opacity:.3,side:2}),n=new X(i,s);return n.name="VisualizationBox",n.rotation.x=-Math.PI/2,n.position.set(t.x,0,t.z),this.startVisualizationBoxPulse(n),n}fadeOutVisualizationBox(e,t=500,i){if(!(e.material instanceof J))return void(null==i||i());const s=e.material.opacity,n=performance.now(),a=()=>{const r=performance.now()-n,o=Math.min(r/t,1),A=Math.pow(o,3),l=s*(1-A);e.material.opacity=l,this[Ru](),o<1?requestAnimationFrame(a):null==i||i()};requestAnimationFrame(a)}startVisualizationBoxPulse(e){if(!(e.material instanceof J))return void console.warn("Visualization box material is not MeshBasicMaterial:",e.material);const t=performance.now(),i=e.material,s=()=>{if(!e.parent)return;const n=(performance.now()-t)%2e3/2e3,a=.5*Math.sin(n*Math.PI*2)+.5,r=.2+(.6-.2)*a;i.opacity=r,i.needsUpdate=!0;const o=.95+(1.05-.95)*a;e.scale.setScalar(o),this[Ru](),requestAnimationFrame(s)};requestAnimationFrame(s)}updateAllSlots(){this.updateSnappingPointSlots(),this.updateBreakLinkSlots()}rotateObject(e,t){if(!t||this.isAnimatingRotation)return;const i=t.rotation.y;let s;s=i+e,console.log(`Rotating object ${t.name} from ${i} to ${s}`),t.userData.isSnappedGroup?this.rotateGroupAroundCenter(t,i,s,direction):this.startRotationAnimation(t,i,s)}rotateGroupAroundCenter(e,t,i,s){const n=(new fe).setFromObject(e).getCenter(new v),a=e.parent;a&&a.worldToLocal(n);const r=e.position.clone();this.isAnimatingRotation=!0,this.rotationAnimation={object:e,startRotation:t,targetRotation:i,startTime:performance.now(),duration:500,isGroup:!0,groupCenter:n,originalPosition:r}}startRotationAnimation(e,t,i){this.isAnimatingRotation=!0,this.rotationAnimation={object:e,startRotation:t,targetRotation:i,startTime:performance.now(),duration:500}}updateRotationAnimation(e){if(!this.isAnimatingRotation||!this.rotationAnimation)return;const{object:t,startRotation:i,targetRotation:s,startTime:n,duration:a}=this.rotationAnimation,r=e-n,o=Math.min(r/a,1),A=i+(s-i)*(1-Math.pow(1-o,3));if(this.rotationAnimation.isGroup&&this.rotationAnimation.groupCenter&&this.rotationAnimation.originalPosition){const{groupCenter:e,originalPosition:s}=this.rotationAnimation,n=A-i,a=s.clone().sub(e).clone();a.applyAxisAngle(new v(0,1,0),n),t.position.copy(a.add(e)),t.rotation.y=A}else t.rotation.y=A;this.updateShadowsWithGLBs(),this[Ru](),o>=1&&this.finishRotationAnimation()}finishRotationAnimation(){if(!this.rotationAnimation)return;const{object:e,targetRotation:t}=this.rotationAnimation;e.rotation.y=t,this.isAnimatingRotation=!1,this.rotationAnimation=null,this.updateShadowsWithGLBs(),this[Ru]()}[ku](e,t){super[ku](e,t),this.isAnimatingRotation&&this.updateRotationAnimation(e),this.updateAllSlots()}clearSlots(e){e.forEach((e=>{e.parentElement&&e.parentElement.removeChild(e)})),e.clear()}}})((e=>{var t;class i extends e{constructor(){super(...arguments),this.lights=!1,this[t]=e=>{this[Du].traverse((function(t){const i=t;i.isLight&&(i.visible=e)})),this[Ru]()}}toggleLights(e){const t=void 0!==e?e:!this.lights;return this.lights=t,t}updated(e){super.updated(e),e.has("lights")&&this[wg](this.lights)}[(t=wg,Fu)](){super[Fu](),this[wg](this.lights)}}return Eg([ii({type:Boolean,attribute:"lights"})],i.prototype,"lights",void 0),i})((e=>{return class extends e{constructor(){super(...arguments),this._pointerDwn=[0,0],this._pointerUp=[0,0]}handleClick(e){const{_pointerDwn:t,_pointerUp:i}=this;if(Math.hypot(i[0]-t[0],i[1]-t[1])>4)return;const{clientX:s,clientY:n}=e,a=this[Du],r=a.getNDC(s,n),o=a.hitFromPoint(r);if(o){const{object:e}=o;if(e&&e.isObject3D&&e.visible){const t={},{material:i,name:s,geometry:n}=e;s&&(t.mesh=s),n&&(t.geometry=n.name),void 0===i||Array.isArray(i)||(t.material=i.name),this.dispatchEvent(new CustomEvent("click",{detail:t}))}}}async setCameraFromJSON(e){const t=this[sA],{camera:i}=t;console.log("scene",this[Du]),console.log("camera",i),console.log("controls",t),Object.keys(e).forEach((t=>{const s=e[t];if(i.hasOwnProperty(t)&&i[t]!==s)switch(t){case"matrix":case"up":break;default:console.log("setting camera property",t,s)}}))}getCameraMeta(){const{camera:e}=this[Du];return e&&(null==e?void 0:e.toJSON())||null}[Fu](){super[Fu]();const{currentGLTF:e}=this[Du];this.addEventListener("pointerdown",(e=>{this._pointerDwn=[e.offsetX,e.offsetY]})),this.addEventListener("pointerup",(e=>{this._pointerUp=[e.offsetX,e.offsetY]})),this.addEventListener("click",this.handleClick)}}})((e=>{var t,i,s,n,a,r;class o extends e{constructor(){super(...arguments),this.waterTexture=null,this.waterDistortionScale=null,this.waterSize=null,this.sky=null,this.sunElevation=void 0,this.sunAzimuth=void 0,this[t]=null,this[i]=null,this[s]=null,this[n]=null,this[a]=null,this[r]=null}[(t=lg,i=hg,s=cg,n=ug,a=dg,r=pg,Ag)](){this[lg]&&(this[lg].animate(),this[Ru](),requestAnimationFrame((()=>{this[Ag]()})))}[ag](){if(this[Du]&&!this[lg]){const{waterTexture:e}=this,t=new Ye(1e4,1e4);this[lg]=new ig(t,{textureWidth:512,textureHeight:512,waterNormals:(new T).load(e,(function(e){e.wrapS=e.wrapT=G})),sunDirection:new v,sunColor:13887743,waterColor:7695,distortionScale:this.waterDistortionScale||3.7,fog:void 0!==this[Du].fog}),this[lg].rotation.x=-Math.PI/2,this[Du].add(this[lg]),this[Ag]()}}[og](e=2,t=180){if(!(this[cg]&&this[hg]&&this[lg]&&this[ug]))return;const i=ne.degToRad(90-e),s=ne.degToRad(t);this[cg].setFromSphericalCoords(1,i,s),this[hg].material.uniforms.sunPosition.value.copy(this[cg]),this[lg].material.uniforms.sunDirection.value.copy(this[cg]).normalize(),this[pg]&&this[pg].dispose(),this[dg].add(this[hg]),this[pg]=this[ug].fromScene(this[dg]),this[Du].add(this[hg]),this[Du].environment=this[pg].texture}[rg](){this[cg]=new v,this[hg]=new sg,this[hg].scale.setScalar(1e4),this[Du].add(this[hg]);const e=this[hg].material.uniforms;e.turbidity.value=10,e.rayleigh.value=2,e.mieCoefficient.value=.005,e.mieDirectionalG.value=.8,this[ug]=new Tt(Gl.singleton.threeRenderer),this[dg]=new qe}updated(e){super.updated(e),e.has("waterTexture")&&null!=this.waterTexture&&this[ag](),e.has("sky")&&null!=this.sky&&(this[rg](),this[og](this.sunElevation,this.sunAzimuth)),(e.has("sunElevation")&&null!=this.sunElevation||e.has("sunAzimuth")&&null!=this.sunAzimuth)&&this[og](this.sunElevation,this.sunAzimuth),e.has("waterDistortionScale")&&this[lg]&&this.waterDistortionScale&&(this[lg].material.uniforms.distortionScale.value=this.waterDistortionScale),e.has("waterSize")&&this[lg]&&this.waterSize&&(this[lg].material.uniforms.size.value=this.waterSize)}}return ng([ii({type:String,attribute:"water-texture"})],o.prototype,"waterTexture",void 0),ng([ii({type:Number,attribute:"water-distortion-scale"})],o.prototype,"waterDistortionScale",void 0),ng([ii({type:Number,attribute:"water-size"})],o.prototype,"waterSize",void 0),ng([ii({type:Number,attribute:"sky"})],o.prototype,"sky",void 0),ng([ii({type:Number,attribute:"sun-elevation"})],o.prototype,"sunElevation",void 0),ng([ii({type:Number,attribute:"sun-azimuth"})],o.prototype,"sunAzimuth",void 0),o})((e=>{var t,i,s,n;class a extends e{constructor(){super(...arguments),this[t]=new M,this[i]=new Map,this[s]=new Map,this[n]=ns((async()=>{await this[Du].updateFraming(),this[Ru]()}),400)}_updateNodePosition(e,t){e&&(e.position.set(...t),this[Du].updateBoundingBox(),this[Du].updateShadow(),this[Ru](),this[tg]())}_updateNodeRotation(e,t,i="XYZ"){e&&(e.rotation.set(...t,i),this[Du].updateBoundingBox(),this[Du].updateShadow(),this[Ru](),this[tg]())}_updateNodeScale(e,t){e&&(e.scale.set(...t),this[Du].updateBoundingBox(),this[Du].updateShadow(),this[Ru](),this[tg]())}getSceneMeshes(){return[...this[Zp].keys()]}getSceneObjects(){return[...this[eg].keys()]}updateMeshPosition(e,t){const i=this[Zp].get(e);this._updateNodePosition(i,t)}updateMeshRotation(e,t,i){const s=this[Zp].get(e);this._updateNodeRotation(s,t,i)}updateMeshScale(e,t){const i=this[Zp].get(e);this._updateNodeScale(i,t)}updateObjectPosition(e,t){const i=this[eg].get(e);this._updateNodePosition(i,t)}updateObjectRotation(e,t,i){const s=this[eg].get(e);this._updateNodeRotation(s,t,i)}updateObjectScale(e,t){const i=this[eg].get(e);this._updateNodeScale(i,t)}updateScenePosition(e){const t=this[$p];this._updateNodePosition(t,e)}updateSceneRotation(e){const t=this[$p];this._updateNodeRotation(t,e)}updateSceneScale(e){const t=this[$p];this._updateNodeScale(t,e)}getSceneRotation(){var e,t;const i=(null===(t=null===(e=this[$p])||void 0===e?void 0:e.rotation)||void 0===t?void 0:t.toArray().map((e=>+(e||0))))||[0,0,0];return i.slice(0,3)}[(t=$p,i=Zp,s=eg,n=tg,Fu)](){super[Fu]();const{currentGLTF:e}=this[Du];if(null!=e){const e=this[Du];this[Zp].clear(),this[eg].clear(),e.traverse((e=>{e.parent||(this[$p]=e),"Mesh"===e.type&&e.name.length&&this[Zp].set(e.name,e),"Object3D"===e.type&&e.name.length&&this[eg].set(e.name,e)}))}}}return a})((e=>{var t,i,s;class n extends e{constructor(){super(...arguments),this[t]=new Map,this[i]=e=>{e.forEach((e=>{e instanceof MutationRecord&&"childList"!==e.type||(e.addedNodes.forEach((e=>{this[td](e)})),e.removedNodes.forEach((e=>{this[id](e)})),this[Ru]())}))},this[s]=new MutationObserver(this[Zu])}connectedCallback(){super.connectedCallback();for(let e=0;e<this.children.length;++e)this[td](this.children[e]);const{ShadyDOM:e}=self;null==e?this[ed].observe(this,{childList:!0}):this[ed]=e.observeChildren(this,this[Zu])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:e}=self;null==e?this[ed].disconnect():e.unobserveChildren(this[ed])}[(t=$u,i=Zu,s=ed,Fu)](){super[Fu]();const e=this[Du];e.forHotspots((t=>{e.updateSurfaceHotspot(t)}))}[ku](e,t){super[ku](e,t);const i=this[Du],{annotationRenderer:s}=i,n=i.getCamera();i.shouldRender()&&(i.animateSurfaceHotspots(),i.updateHotspotsVisibility(n.position),s.domElement.style.display="",s.render(i,n))}updateHotspot(e){const t=this[$u].get(e.name);null!=t&&(t.updatePosition(e.position),t.updateNormal(e.normal),t.surface=e.surface,this[Du].updateSurfaceHotspot(t),this[Ru]())}queryHotspot(e){const t=this[$u].get(e);if(null==t)return null;const i=Nu(t.position),s=Nu(t.normal),n=t.facingCamera,a=this[Du],r=a.getCamera(),o=new v;o.setFromMatrixPosition(t.matrixWorld),o.project(r);const A=a.width/2,l=a.height/2;o.x=o.x*A+A,o.y=-o.y*l+l;const c=Nu(new v(o.x,o.y,o.z));return Number.isFinite(c.x)&&Number.isFinite(c.y)?{position:i,normal:s,canvasPosition:c,facingCamera:n}:null}positionAndNormalFromPoint(e,t){const i=this[Du],s=i.getNDC(e,t),n=i.positionAndNormalFromPoint(s);if(null==n)return null;sd.copy(i.target.matrixWorld).invert();const a=Nu(n.position.applyMatrix4(sd)),r=Nu(n.normal.transformDirection(sd));let o=null;return null!=n.uv&&(o=ju(n.uv)),{position:a,normal:r,uv:o}}surfaceFromPoint(e,t){const i=this[Du],s=i.getNDC(e,t);return i.surfaceFromPoint(s)}[td](e){if(!(e instanceof HTMLElement&&0===e.slot.indexOf("hotspot")))return;let t=this[$u].get(e.slot);null!=t?t.increment():(t=new Fh({name:e.slot,position:e.dataset.position,normal:e.dataset.normal,surface:e.dataset.surface}),this[$u].set(e.slot,t),this[Du].addHotspot(t)),this[Du].queueRender()}[id](e){if(!(e instanceof HTMLElement))return;const t=this[$u].get(e.slot);t&&(t.decrement()&&(this[Du].removeHotspot(t),this[$u].delete(e.slot)),this[Du].queueRender())}}return n})((e=>{var t,i,s;class n extends e{constructor(){super(...arguments),this[t]=void 0,this[i]=null,this[s]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[Bh]}get availableVariants(){return this.model?this.model[mh]():[]}get originalGltfJson(){return this[wh]}[(t=Bh,i=Eh,s=wh,vh)](){return()=>{this[Ru]()}}[xh](e){return e.colorSpace=l,e.wrapS=G,e.wrapT=G,new pc(this[vh](),e)}async createTexture(e,t="image/png"){const{textureUtils:i}=this[_u],s=await i.loadImage(e,this.withCredentials);return s.userData.mimeType=t,this[xh](s)}async createLottieTexture(e,t=1){const{textureUtils:i}=this[_u],s=await i.loadLottie(e,t,this.withCredentials);return this[xh](s)}createVideoTexture(e){const t=document.createElement("video");t.crossOrigin=this.withCredentials?"use-credentials":"anonymous",t.src=e,t.muted=!0,t.playsInline=!0,t.loop=!0,t.play();const i=new mt(t);return this[xh](i)}createCanvasTexture(){const e=document.createElement("canvas"),t=new ft(e);return this[xh](t)}async updated(e){if(super.updated(e),e.has("variantName")){const e=this[Pu].beginActivity("variant-update");e(.1);const t=this[Bh],{variantName:i}=this;null!=t&&(await t[hh](i),this[Ru](),this.dispatchEvent(new CustomEvent("variant-applied"))),e(1)}if(e.has("orientation")||e.has("scale")){if(!this.loaded)return;const e=this[Du];e.applyTransform(),e.updateBoundingBox(),e.updateShadow(),this[_u].arRenderer.onUpdateScene(),this[Ru]()}}[Fu](){super[Fu]();const{currentGLTF:e}=this[Du];if(null!=e){const{correlatedSceneGraph:t}=e;null!=t&&e!==this[Eh]&&(this[Bh]=new yh(t,this[vh]()),this[wh]=JSON.parse(JSON.stringify(t.gltf))),"variants"in e.userData&&this.requestUpdate("variantName")}this[Eh]=e}async exportScene(e){const t=this[Du];return new Promise((async(i,s)=>{const n={binary:!0,onlyVisible:!0,maxTextureSize:1/0,includeCustomExtensions:!1,forceIndices:!1};Object.assign(n,e),n.animations=t.animations,n.truncateDrawRange=!0;const a=t.shadow;let r=!1;null!=a&&(r=a.visible,a.visible=!1),await this[Bh][ch]();(new Da).register((e=>new Sr(e))).parse(t.model,(e=>i(new Blob([n.binary?e:JSON.stringify(e)],{type:n.binary?"application/octet-stream":"application/json"}))),(()=>s("glTF export failed")),n),null!=a&&(a.visible=r)}))}materialFromPoint(e,t){const i=this[Bh];if(null==i)return null;const s=this[Du],n=s.getNDC(e,t),a=s.hitFromPoint(n);return null==a||null==a.face?null:i[uh](a)}}return Ch([ii({type:String,attribute:"variant-name"})],n.prototype,"variantName",void 0),Ch([ii({type:String,attribute:"orientation"})],n.prototype,"orientation",void 0),Ch([ii({type:String,attribute:"scale"})],n.prototype,"scale",void 0),n})((e=>{var t,i,s;class n extends e{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=3e3,this.rotationPerSecond="auto",this[t]=performance.now(),this[i]=0,this[s]=e=>{this.autoRotate&&"user-interaction"===e.detail.source&&(this[Jp]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[Xp]),this[Jp]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[Xp]),this[Jp]=performance.now()}updated(e){super.updated(e),e.has("autoRotate")&&(this[Jp]=performance.now())}[(t=Jp,i=Yp,Wp)](e){this[Yp]=e[0]}[ku](e,t){if(super[ku](e,t),!this.autoRotate||!this[Uu]()||this[_u].isPresenting)return;const i=Math.min(t,e-this[Jp]-this.autoRotateDelay);i>0&&(this[Du].yaw=this.turntableRotation+this[Yp]*i*.001)}get turntableRotation(){return this[Du].yaw}resetTurntableRotation(e=0){this[Du].yaw=e}}return s=Xp,qp([ii({type:Boolean,attribute:"auto-rotate"})],n.prototype,"autoRotate",void 0),qp([ii({type:Number,attribute:"auto-rotate-delay"})],n.prototype,"autoRotateDelay",void 0),qp([ko({intrinsics:Kp,updateHandler:Wp}),ii({type:String,attribute:"rotation-per-second"})],n.prototype,"rotationPerSecond",void 0),n})((o=>{var A,l,c;class h extends o{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=0,this.shadowSoftness=1,this.exposure=1,this.toneMapping="auto",this.skyboxHeight="0",this[A]=null,this[l]=null,this[c]=null}updated(o){super.updated(o),o.has("shadowIntensity")&&(this[Du].setShadowIntensity(.5*this.shadowIntensity),this[Ru]()),o.has("shadowSoftness")&&(this[Du].setShadowSoftness(this.shadowSoftness),this[Ru]()),o.has("exposure")&&(this[Du].exposure=this.exposure,this[Ru]()),o.has("toneMapping")&&(this[Du].toneMapping="aces"===this.toneMapping?e:"agx"===this.toneMapping?t:"reinhard"===this.toneMapping?i:"cineon"===this.toneMapping?s:"linear"===this.toneMapping?n:"none"===this.toneMapping?a:r,this[Ru]()),(o.has("environmentImage")||o.has("skyboxImage"))&&this[Gu]()&&this[hs](),o.has("skyboxHeight")&&(this[Du].setGroundedSkybox(),this[Ru]())}hasBakedShadow(){return this[Du].bakedShadows.size>0}async[(A=ls,l=cs,c=us,hs)](){const{skyboxImage:e,environmentImage:t}=this;null!=this[us]&&(this[us](),this[us]=null);const{textureUtils:i}=this[_u];if(null==i)return;const s=this[Pu].beginActivity("environment-update");try{const{environmentMap:n,skybox:a}=await i.generateEnvironmentMapAndSkybox(ts(e),t,(e=>s(rs(e,0,1))),this.withCredentials);this[ls]!==n&&(this[ls]=n,this.dispatchEvent(new CustomEvent("environment-change"))),this[cs]=null!=a?a.name===n.name?n:a:null,this[Du].setEnvironmentAndSkybox(this[ls],this[cs])}catch(e){if(e instanceof Error)throw this[Du].setEnvironmentAndSkybox(null,null),e}finally{s(1)}}}return As([ii({type:String,attribute:"environment-image"})],h.prototype,"environmentImage",void 0),As([ii({type:String,attribute:"skybox-image"})],h.prototype,"skyboxImage",void 0),As([ii({type:Number,attribute:"shadow-intensity"})],h.prototype,"shadowIntensity",void 0),As([ii({type:Number,attribute:"shadow-softness"})],h.prototype,"shadowSoftness",void 0),As([ii({type:Number})],h.prototype,"exposure",void 0),As([ii({type:String,attribute:"tone-mapping"})],h.prototype,"toneMapping",void 0),As([ii({type:String,attribute:"skybox-height"})],h.prototype,"skyboxHeight",void 0),h})((e=>{var t,i,s,n,a,r,o,A,l,c,h,u,d,p,g,m,f,b;class I extends e{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=Go,this.cameraTarget="auto auto auto",this.fieldOfView="auto",this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=3e3,this.interactionPrompt=Ho,this.interactionPromptStyle=qo,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.touchAction=Vo,this.disableZoom=!1,this.disablePan=!1,this.disableTap=!1,this.interpolationDecay=50,this.a11y=null,this[t]=this.shadowRoot.querySelector(".interaction-prompt"),this[i]=this.shadowRoot.querySelector("#prompt"),this[s]=[this.shadowRoot.querySelector("#finger0"),this.shadowRoot.querySelector("#finger1")],this[n]=this.shadowRoot.querySelector(".pan-target"),this[a]=0,this[r]=1/0,this[o]=!1,this[A]=!1,this[l]=PA.AUTOMATIC,this[c]=new OA(this[Du].camera,this[Mu],this[Du]),this[h]=new Xe,this[u]=!1,this[d]=!1,this[p]=!1,this[g]={},this[m]=()=>{const e=this[sA].changeSource;this[yA]=e,e===PA.USER_INTERACTION&&(this[fA]=!0,this[AA]())},this[f]=()=>{const e=this[lA]();this[Ru]();const t=this[sA].changeSource;this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:t,spatialRegion:e}}))},this[b]=e=>{this[Qu].classList.toggle("pointer-tumbling","pointer-change-start"===e.type)}}get inputSensitivity(){return this[sA].inputSensitivity}set inputSensitivity(e){this[sA].inputSensitivity=e}getCameraOrbit(){const{theta:e,phi:t,radius:i}=this[CA];return{theta:e,phi:t,radius:i,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return Nu(this[_u].isPresenting?this[_u].arRenderer.target:this[Du].getDynamicTarget())}getFieldOfView(){return this[sA].getFieldOfView()}getMinimumFieldOfView(){return this[sA].options.minimumFieldOfView}getMaximumFieldOfView(){return this[sA].options.maximumFieldOfView}getIdealAspect(){return this[Du].idealAspect}jumpCameraToGoal(){this[EA]=!0,this.requestUpdate(EA,!1)}resetInteractionPrompt(){this[IA]=0,this[bA]=1/0,this[fA]=!1,this[mA]=this.interactionPrompt===Ho&&this.cameraControls}zoom(e){const t=new WheelEvent("wheel",{deltaY:-30*e});this[Mu].dispatchEvent(t)}connectedCallback(){super.connectedCallback(),this[sA].addEventListener("user-interaction",this[dA]),this[sA].addEventListener("pointer-change-start",this[gA]),this[sA].addEventListener("pointer-change-end",this[gA])}disconnectedCallback(){super.disconnectedCallback(),this[sA].removeEventListener("user-interaction",this[dA]),this[sA].removeEventListener("pointer-change-start",this[gA]),this[sA].removeEventListener("pointer-change-end",this[gA])}updated(e){super.updated(e);const t=this[sA],i=this[Du];if(e.has("cameraControls")&&(this.cameraControls?(t.enableInteraction(),this.interactionPrompt===Ho&&(this[mA]=!0)):(t.disableInteraction(),this[AA]()),this[Mu].setAttribute("aria-label",this[Cu])),e.has("disableZoom")&&(t.disableZoom=this.disableZoom),e.has("disablePan")&&(t.enablePan=!this.disablePan),e.has("disableTap")&&(t.enableTap=!this.disableTap),(e.has("interactionPrompt")||e.has("cameraControls")||e.has("src"))&&(this.interactionPrompt===Ho&&this.cameraControls&&!this[fA]?this[mA]=!0:this[AA]()),e.has("interactionPromptStyle")&&(this[rA].style.opacity=this.interactionPromptStyle==zo?"1":"0"),e.has("touchAction")){const e=this.touchAction;t.applyOptions({touchAction:e}),t.updateTouchActionStyle()}e.has("orbitSensitivity")&&(t.orbitSensitivity=this.orbitSensitivity),e.has("zoomSensitivity")&&(t.zoomSensitivity=this.zoomSensitivity),e.has("panSensitivity")&&(t.panSensitivity=this.panSensitivity),e.has("interpolationDecay")&&(t.setDamperDecayTime(this.interpolationDecay),i.setTargetDamperDecayTime(this.interpolationDecay)),e.has("a11y")&&this[hA](),!0===this[EA]&&Promise.resolve().then((()=>{t.jumpToGoal(),i.jumpToGoal(),this[pA](),this[EA]=!1}))}async updateFraming(){const e=this[Du],t=e.adjustedFoV(e.framedFoVDeg);await e.updateFraming();const i=e.adjustedFoV(e.framedFoVDeg),s=this[sA].getFieldOfView()/t;this[sA].setFieldOfView(i*s),this[BA]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),this.requestUpdate("cameraOrbit"),await this.updateComplete}interact(e,t,i){const s=this[Mu],n=this[oA];if("1"===n[0].style.opacity)return void console.warn("interact() failed because an existing interaction is running.");const a=new Array;a.push({x:_o(t.x),y:_o(t.y)});const r=[{x:a[0].x(0),y:a[0].y(0)}];null!=i&&(a.push({x:_o(i.x),y:_o(i.y)}),r.push({x:a[1].x(0),y:a[1].y(0)}));let o=performance.now();const{width:A,height:l}=this[Du],c=this.getBoundingClientRect(),h=e=>{for(const[t,i]of r.entries()){const{style:a}=n[t];a.transform=`translateX(${A*i.x}px) translateY(${l*i.y}px)`,"pointerdown"===e?a.opacity="1":"pointerup"===e&&(a.opacity="0");const r={pointerId:t-5678,pointerType:"touch",target:s,clientX:A*i.x+c.x,clientY:l*i.y+c.y,altKey:!0};s.dispatchEvent(new PointerEvent(e,r))}},u=()=>{const t=this[yA];if(t!==PA.AUTOMATIC||!s.isConnected){for(const e of this[oA])e.style.opacity="0";return h("pointercancel"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:t}})),void document.removeEventListener("visibilitychange",d)}const i=Math.min(1,(performance.now()-o)/e);for(const[e,t]of r.entries())t.x=a[e].x(i),t.y=a[e].y(i);h("pointermove"),i<1?requestAnimationFrame(u):(h("pointerup"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:PA.AUTOMATIC}})),document.removeEventListener("visibilitychange",d))},d=()=>{let e=0;"hidden"===document.visibilityState?e=performance.now()-o:o=performance.now()-e};document.addEventListener("visibilitychange",d),h("pointerdown"),this[yA]=PA.AUTOMATIC,requestAnimationFrame(u)}[(t=aA,i=rA,s=oA,n=nA,a=IA,r=bA,o=fA,A=mA,l=yA,c=sA,h=CA,u=EA,d=wA,p=BA,g=cA,xA)](e){const t=this[sA],i=this[Du];i.framedFoVDeg=180*e[0]/Math.PI,t.changeSource=PA.NONE,t.setFieldOfView(i.adjustedFoV(i.framedFoVDeg)),this[dA]()}[vA](e){const t=this[sA];if(this[BA]){const{theta:t,phi:i}=this.getCameraOrbit();e[0]=t,e[1]=i,this[BA]=!1}t.changeSource=PA.NONE,t.setOrbit(e[0],e[1],e[2]),this[dA]()}[QA](e){this[sA].applyOptions({minimumAzimuthalAngle:e[0],minimumPolarAngle:e[1],minimumRadius:e[2]}),this.jumpCameraToGoal()}[MA](e){this[sA].applyOptions({maximumAzimuthalAngle:e[0],maximumPolarAngle:e[1],maximumRadius:e[2]}),this[uA](e[2]),this.jumpCameraToGoal()}[TA](e){this[sA].applyOptions({minimumFieldOfView:180*e[0]/Math.PI}),this.jumpCameraToGoal()}[DA](e){const t=this[Du].adjustedFoV(180*e[0]/Math.PI);this[sA].applyOptions({maximumFieldOfView:t}),this.jumpCameraToGoal()}[SA](e){const[t,i,s]=e;this[_u].arRenderer.isPresenting||this[Du].setTarget(t,i,s),this[sA].changeSource=PA.NONE,this[_u].arRenderer.updateTarget(),this[dA]()}[ku](e,t){if(super[ku](e,t),this[_u].isPresenting||!this[Uu]())return;const i=this[sA],s=this[Du],n=performance.now();if(this[mA]&&this.loaded&&n>this[vu]+this.interactionPromptThreshold&&(this[mA]=!1,this[bA]=n,this[aA].classList.add("visible")),isFinite(this[bA])&&this.interactionPromptStyle===qo){const e=(n-this[bA])/5e3%1,t=Oo(e),a=Uo(e);if(this[rA].style.opacity=`${a}`,t!==this[IA]){const e=t*s.width*.05,n=(t-this[IA])*Math.PI/16;this[rA].style.transform=`translateX(${e}px)`,i.changeSource=PA.AUTOMATIC,i.adjustOrbit(n,0,0),this[IA]=t}}const a=i.update(e,t),r=s.updateTarget(t);(a||r)&&this[pA]()}[AA](){this[mA]=!1,this[aA].classList.remove("visible"),this[bA]=1/0}[uA](e){const t=Math.max(this[Du].farRadius(),e),i=Math.abs(2*t);this[sA].updateNearFar(0,i)}[lA](){const{theta:e,phi:t}=this[sA].getCameraSpherical(this[CA]),i=(4+Math.floor((e%iA+tA)/Zo))%4,s=Math.floor(t/eA),n=`${jo[s]}${No[i]}`,a=n;return a in this[cA]?this[Bu](this[cA][a]):this[Bu](`View from stage ${n}`),n}get[Cu](){let e=". Use mouse, touch or arrow keys to move.";return"interaction-prompt"in this[cA]&&(e=`. ${this[cA]["interaction-prompt"]}`),super[Cu].replace(/\.$/,"")+(this.cameraControls?e:"")}async[Lu](e){const t=this[sA],i=this[Du],s=i.adjustedFoV(i.framedFoVDeg);super[Lu](e);const n=i.adjustedFoV(i.framedFoVDeg)/s,a=t.getFieldOfView()*(isFinite(n)?n:1);t.updateAspect(this[Du].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),await this.updateComplete,this[sA].setFieldOfView(a),this.jumpCameraToGoal()}[Fu](){super[Fu](),this[wA]?this[BA]=!0:this[wA]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}[(m=dA,f=pA,b=gA,hA)](){if("string"==typeof this.a11y)if(this.a11y.startsWith("{"))try{this[cA]=JSON.parse(this.a11y)}catch(e){console.warn("Error parsing a11y JSON:",e)}else this.a11y.length>0?console.warn("Error not supported format, should be a JSON string:",this.a11y):this[cA]={};else"object"==typeof this.a11y&&null!=this.a11y?this[cA]=Object.assign({},this.a11y):this[cA]={};this[Mu].setAttribute("aria-label",this[Cu])}}return Po([ii({type:Boolean,attribute:"camera-controls"})],I.prototype,"cameraControls",void 0),Po([ko({intrinsics:Yo,observeEffects:!0,updateHandler:vA}),ii({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],I.prototype,"cameraOrbit",void 0),Po([ko({intrinsics:$o,observeEffects:!0,updateHandler:SA}),ii({type:String,attribute:"camera-target",hasChanged:()=>!0})],I.prototype,"cameraTarget",void 0),Po([ko({intrinsics:Ko,observeEffects:!0,updateHandler:xA}),ii({type:String,attribute:"field-of-view",hasChanged:()=>!0})],I.prototype,"fieldOfView",void 0),Po([ko({intrinsics:Wo,updateHandler:QA}),ii({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],I.prototype,"minCameraOrbit",void 0),Po([ko({intrinsics:Xo,updateHandler:MA}),ii({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],I.prototype,"maxCameraOrbit",void 0),Po([ko({intrinsics:Jo,updateHandler:TA}),ii({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],I.prototype,"minFieldOfView",void 0),Po([ko({intrinsics:Ko,updateHandler:DA}),ii({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],I.prototype,"maxFieldOfView",void 0),Po([ii({type:Number,attribute:"interaction-prompt-threshold"})],I.prototype,"interactionPromptThreshold",void 0),Po([ii({type:String,attribute:"interaction-prompt"})],I.prototype,"interactionPrompt",void 0),Po([ii({type:String,attribute:"interaction-prompt-style"})],I.prototype,"interactionPromptStyle",void 0),Po([ii({type:Number,attribute:"orbit-sensitivity"})],I.prototype,"orbitSensitivity",void 0),Po([ii({type:Number,attribute:"zoom-sensitivity"})],I.prototype,"zoomSensitivity",void 0),Po([ii({type:Number,attribute:"pan-sensitivity"})],I.prototype,"panSensitivity",void 0),Po([ii({type:String,attribute:"touch-action"})],I.prototype,"touchAction",void 0),Po([ii({type:Boolean,attribute:"disable-zoom"})],I.prototype,"disableZoom",void 0),Po([ii({type:Boolean,attribute:"disable-pan"})],I.prototype,"disablePan",void 0),Po([ii({type:Boolean,attribute:"disable-tap"})],I.prototype,"disableTap",void 0),Po([ii({type:Number,attribute:"interpolation-decay"})],I.prototype,"interpolationDecay",void 0),Po([ii()],I.prototype,"a11y",void 0),I})((e=>{var t,i,s,n,a,r,o,A,l,c;class h extends e{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arUsdzMaxTextureSize="auto",this.arPlacement="floor",this.arModes="webxr scene-viewer quick-look",this.iosSrc=null,this.xrEnvironment=!1,this[t]=!1,this[i]=this.shadowRoot.querySelector(".ar-button"),this[s]=document.createElement("a"),this[n]=new Set,this[a]=mp,this[r]=!1,this[o]=e=>{e.preventDefault(),this.activateAR()},this[A]=({status:e})=>{e!==GA&&this[_u].arRenderer.presentedScene!==this[Du]||(this.setAttribute("ar-status",e),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:e}})),e===GA?this.removeAttribute("ar-tracking"):e===NA&&this.setAttribute("ar-tracking",zA))},this[l]=({status:e})=>{this.setAttribute("ar-tracking",e),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:e}}))},this[c]=e=>{"_apple_ar_quicklook_button_tapped"==e.data&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[Ep]!==mp}connectedCallback(){super.connectedCallback(),this[_u].arRenderer.addEventListener("status",this[Sp]),this.setAttribute("ar-status",GA),this[_u].arRenderer.addEventListener("tracking",this[Qp]),this[Bp].addEventListener("message",this[Mp])}disconnectedCallback(){super.disconnectedCallback(),this[_u].arRenderer.removeEventListener("status",this[Sp]),this[_u].arRenderer.removeEventListener("tracking",this[Qp]),this[Bp].removeEventListener("message",this[Mp])}update(e){super.update(e),e.has("arScale")&&(this[Du].canScale="fixed"!==this.arScale),e.has("arPlacement")&&(this[Du].updateShadow(),this[Ru]()),e.has("arModes")&&(this[wp]=hp(this.arModes)),(e.has("ar")||e.has("arModes")||e.has("src")||e.has("iosSrc")||e.has("arUsdzMaxTextureSize"))&&this[Tp]()}async activateAR(){switch(this[Ep]){case dp:await this[yp]();break;case gp:await this[bp]();break;case pp:this[Ip]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities")}}async[(t=Cp,i=fp,s=Bp,n=wp,a=Ep,r=vp,o=xp,A=Sp,l=Qp,c=Mp,Tp)](){var e;let t=mp;if(this.ar){if(null!=this.src)for(const i of this[wp]){if("webxr"===i&&Ki&&!Ap&&await this[_u].arRenderer.supportsPresentation()){t=gp;break}if("scene-viewer"===i&&!lp&&($i||navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues&&(null===(e=(await navigator.userAgentData.getHighEntropyValues(["formFactor"])).formFactor)||void 0===e?void 0:e.includes("XR")))){t=pp;break}if("quick-look"===i&&es){t=dp;break}}t===mp&&null!=this.iosSrc&&es&&(t=dp)}if(t!==mp)this[fp].classList.add("enabled"),this[fp].addEventListener("click",this[xp]);else if(this[fp].classList.contains("enabled")){this[fp].removeEventListener("click",this[xp]),this[fp].classList.remove("enabled");const e=HA;this.setAttribute("ar-status",e),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:e}}))}this[Ep]=t}async[bp](){console.log("Attempting to present in AR with WebXR..."),await this[Dp]();try{this[fp].removeEventListener("click",this[xp]);const{arRenderer:e}=this[_u];e.placeOnWall="wall"===this.arPlacement,await e.present(this[Du],this.xrEnvironment)}catch(e){console.warn("Error while trying to present in AR with WebXR"),console.error(e),await this[_u].arRenderer.stopPresenting(),Ap=!0,console.warn("Falling back to next ar-mode"),await this[Tp](),this.activateAR()}finally{this[Tp]()}}async[Dp](){this.loaded||(this[vp]=!0,this[xu](),await((e,t,i=null)=>new Promise((s=>{e.addEventListener(t,(function n(a){i&&!i(a)||(s(a),e.removeEventListener(t,n))}))})))(this,"load"),this[vp]=!1)}[Gu](){return super[Gu]()||this[vp]}[Ip](){const e=self.location.toString(),t=new URL(e),i=new URL(this.src,e);i.hash&&(i.hash="");const s=new URLSearchParams(i.search);if(t.hash=cp,s.set("mode","ar_preferred"),s.has("disable_occlusion")||s.set("disable_occlusion","true"),"fixed"===this.arScale&&s.set("resizable","false"),"wall"===this.arPlacement&&s.set("enable_vertical_placement","true"),s.has("sound")){const t=new URL(s.get("sound"),e);s.set("sound",t.toString())}if(s.has("link")){const t=new URL(s.get("link"),e);s.set("link",t.toString())}const n=`intent://arvr.google.com/scene-viewer/1.2?${s.toString()+"&file="+encodeURIComponent(i.toString())}#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(t.toString())};end;`;self.addEventListener("hashchange",(()=>{self.location.hash===cp&&(lp=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[Tp]())}),{once:!0}),this[Bp].setAttribute("href",n),console.log("Attempting to present in AR with Scene Viewer..."),this[Bp].click()}async[yp](){const e=!this.iosSrc;this[fp].classList.remove("enabled");const t=e?await this.prepareUSDZ():this.iosSrc,i=new URL(t,self.location.toString());if(e){const e=self.location.toString(),t=new URL(e),s=new URL(this.src,t);s.hash&&(i.hash=s.hash)}"fixed"===this.arScale&&(i.hash&&(i.hash+="&"),i.hash+="allowsContentScaling=0");const s=this[Bp];s.setAttribute("rel","ar");const n=document.createElement("img");s.appendChild(n),s.setAttribute("href",i.toString()),e&&s.setAttribute("download","model.usdz"),s.style.display="none",s.isConnected||this.shadowRoot.appendChild(s),console.log("Attempting to present in AR with Quick Look..."),s.click(),s.removeChild(n),e&&URL.revokeObjectURL(t),this[fp].classList.add("enabled")}async prepareUSDZ(){const e=this[Pu].beginActivity("usdz-conversion");await this[Dp]();const{model:t,shadow:i,target:s}=this[Du];if(null==t)return"";let n=!1;null!=i&&(n=i.visible,i.visible=!1),e(.2);const a=new Wd;s.remove(t),t.position.copy(s.position),t.updateWorldMatrix(!1,!0);const r=await a.parseAsync(t,{maxTextureSize:isNaN(this.arUsdzMaxTextureSize)?1/0:Math.max(parseInt(this.arUsdzMaxTextureSize),16)});t.position.set(0,0,0),s.add(t);const o=new Blob([r],{type:"model/vnd.usdz+zip"}),A=URL.createObjectURL(o);return e(1),null!=i&&(i.visible=n),A}}return op([ii({type:Boolean,attribute:"ar"})],h.prototype,"ar",void 0),op([ii({type:String,attribute:"ar-scale"})],h.prototype,"arScale",void 0),op([ii({type:String,attribute:"ar-usdz-max-texture-size"})],h.prototype,"arUsdzMaxTextureSize",void 0),op([ii({type:String,attribute:"ar-placement"})],h.prototype,"arPlacement",void 0),op([ii({type:String,attribute:"ar-modes"})],h.prototype,"arModes",void 0),op([ii({type:String,attribute:"ios-src"})],h.prototype,"iosSrc",void 0),op([ii({type:Boolean,attribute:"xr-environment"})],h.prototype,"xrEnvironment",void 0),h})((e=>{var t,i,s,n,a,r,o,A;class l extends e{static set dracoDecoderLocation(e){Ca.setDRACODecoderLocation(e)}static get dracoDecoderLocation(){return Ca.getDRACODecoderLocation()}static set ktx2TranscoderLocation(e){Ca.setKTX2TranscoderLocation(e)}static get ktx2TranscoderLocation(){return Ca.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(e){Ca.setMeshoptDecoderLocation(e)}static get meshoptDecoderLocation(){return Ca.getMeshoptDecoderLocation()}static set lottieLoaderLocation(e){Gl.singleton.textureUtils.lottieLoaderUrl=e}static get lottieLoaderLocation(){return Gl.singleton.textureUtils.lottieLoaderUrl}static mapURLs(e){Gl.singleton.loader[ba].manager.setURLModifier(e)}dismissPoster(){this.loaded?this[Gp]():(this[Up]=!0,this[xu]())}showPoster(){const e=this[Pp];if(e.classList.contains("show"))return;e.classList.add("show"),this[Mu].classList.remove("show");const t=this[Op];t.removeAttribute("tabindex"),t.removeAttribute("aria-hidden");const i=this.modelIsVisible;this[Np]=!1,this[yu](i)}getDimensions(){return Nu(this[Du].size)}getBoundingBoxCenter(){return Nu(this[Du].boundingBox.getCenter(new v))}constructor(...e){super(...e),this.poster=null,this.reveal=kp,this.loading=Fp,this[t]=!1,this[i]=!1,this[s]=this.shadowRoot.querySelector(".slot.poster"),this[n]=this.shadowRoot.querySelector("#default-poster"),this[a]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[r]=this[Op].getAttribute("aria-label"),this[o]=ns((e=>{const t=this[_p].parentNode;requestAnimationFrame((()=>{this[_p].style.transform=`scaleX(${e})`,0===e&&(t.removeChild(this[_p]),t.appendChild(this[_p])),this[_p].classList.toggle("hide",1===e)}))}),100),this[A]=e=>{const t=e.detail.totalProgress,i=e.detail.reason;1===t&&(this[jp].flush(),this.loaded&&(this[Up]||this.reveal===kp)&&this[Gp]()),this[jp](t),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:t,reason:i}}))};const l=self.ModelViewerElement||{},c=l.dracoDecoderLocation||"https://www.gstatic.com/draco/versioned/decoders/1.5.6/";Ca.setDRACODecoderLocation(c);const h=l.ktx2TranscoderLocation||"https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";Ca.setKTX2TranscoderLocation(h),l.meshoptDecoderLocation&&Ca.setMeshoptDecoderLocation(l.meshoptDecoderLocation);const u=l.lottieLoaderLocation||"https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/LottieLoader.js";Gl.singleton.textureUtils.lottieLoaderUrl=u}connectedCallback(){super.connectedCallback(),this.loaded||this.showPoster(),this[Pu].addEventListener("progress",this[zp])}disconnectedCallback(){super.disconnectedCallback(),this[Pu].removeEventListener("progress",this[zp])}async updated(e){super.updated(e),e.has("poster")&&null!=this.poster&&(this[Op].style.backgroundImage=`url(${this.poster})`),e.has("alt")&&this[Op].setAttribute("aria-label",this[Eu]),(e.has("reveal")||e.has("loading"))&&this[xu]()}[(t=Np,i=Up,s=Pp,n=Op,a=_p,r=Hp,o=jp,A=zp,Gu)](){return!!this.src&&(this[Up]||this.loading===Lp||this.reveal===kp&&this[Iu])}[Gp](){this[Up]=!1;const e=this[Pp];if(!e.classList.contains("show"))return;e.classList.remove("show"),this[Mu].classList.add("show");const t=this.modelIsVisible;this[Np]=!0,this[yu](t);const i=this.getRootNode();i&&i.activeElement===this&&this[Mu].focus();const s=this[Op];s.setAttribute("aria-hidden","true"),s.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))}[Uu](){return super[Uu]()&&this[Np]}}return Rp([ii({type:String})],l.prototype,"poster",void 0),Rp([ii({type:String})],l.prototype,"reveal",void 0),Rp([ii({type:String})],l.prototype,"loading",void 0),l})((e=>{var t;class i extends e{constructor(...e){super(e),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[t]=!0,this[Du].subscribeMixerEvent("loop",(e=>{const t=e.action._loopCount,i=e.action._clip.name,s=e.action._clip.uuid,n=this[Du].markedAnimations.find((e=>e.name===i));if(n){this[Du].updateAnimationLoop(n.name,n.loopMode,n.repetitionCount);const e=this[Du].markedAnimations.filter((e=>e.name!==i));this[Du].markedAnimations=e}this.dispatchEvent(new CustomEvent("loop",{detail:{count:t,name:i,uuid:s}}))})),this[Du].subscribeMixerEvent("finished",(e=>{if(this[Du].appendedAnimations.includes(e.action._clip.name)){const t=this[Du].appendedAnimations.filter((t=>t!==e.action._clip.name));this[Du].appendedAnimations=t}else this[Ju]=!0;this.dispatchEvent(new CustomEvent("finished"))}))}get availableAnimations(){return this.loaded?this[Du].animationNames:[]}get duration(){return this[Du].duration}get paused(){return this[Ju]}get currentTime(){return this[Du].animationTime}get appendedAnimations(){return this[Du].appendedAnimations}set currentTime(e){this[Du].animationTime=e,this[Ru]()}get timeScale(){return this[Du].animationTimeScale}set timeScale(e){this[Du].animationTimeScale=e}pause(){this[Ju]||(this[Ju]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(e){this.availableAnimations.length>0&&(this[Ju]=!1,this[qu](e),this.dispatchEvent(new CustomEvent("play")))}appendAnimation(e,t){this.availableAnimations.length>0&&(this[Ju]=!1,this[Vu](e,t),this.dispatchEvent(new CustomEvent("append-animation")))}detachAnimation(e,t){this.availableAnimations.length>0&&(this[Ju]=!1,this[Ku](e,t),this.dispatchEvent(new CustomEvent("detach-animation")))}[(t=Ju,Fu)](){super[Fu](),this[Ju]=!0,null!=this.animationName&&this[qu](),this.autoplay&&this.play()}[ku](e,t){super[ku](e,t),this[Ju]||!this[Uu]()&&!this[_u].isPresenting||(this[Du].updateAnimation(t/1e3),this[Ru]())}updated(e){super.updated(e),e.has("autoplay")&&this.autoplay&&this.play(),e.has("animationName")&&this[qu]()}[qu](e=Yu){var t;const i=null!==(t=e.repetitions)&&void 0!==t?t:1/0,s=e.pingpong?wt:1===i?vt:Bt;this[Du].playAnimation(this.animationName,this.animationCrossfadeDuration/1e3,s,i),this[Ju]&&(this[Du].updateAnimation(0),this[Ru]())}[Vu](e="",t=Wu){var i;const s=null!==(i=t.repetitions)&&void 0!==i?i:1/0,n=t.pingpong?wt:1===s?vt:Bt,a=!!t.repetitions||"pingpong"in t;this[Du].appendAnimation(e||this.animationName,n,s,t.weight,t.timeScale,t.fade,t.warp,t.relativeWarp,t.time,a),this[Ju]&&(this[Du].updateAnimation(0),this[Ru]())}[Ku](e="",t=Xu){this[Du].detachAnimation(e||this.animationName,t.fade),this[Ju]&&(this[Du].updateAnimation(0),this[Ru]())}}return zu([ii({type:Boolean})],i.prototype,"autoplay",void 0),zu([ii({type:String,attribute:"animation-name"})],i.prototype,"animationName",void 0),zu([ii({type:Number,attribute:"animation-crossfade-duration"})],i.prototype,"animationCrossfadeDuration",void 0),i})(Hu)))))))))))))))),Zm=$m;customElements.define("model-viewer",Zm);export{Zm as ModelViewerElement};
//# sourceMappingURL=model-viewer-module.min.js.map
